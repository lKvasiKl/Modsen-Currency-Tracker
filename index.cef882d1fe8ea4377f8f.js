/*! For license information please see index.cef882d1fe8ea4377f8f.js.LICENSE.txt */
(()=>{var e,t,i,n,r={599:(e,t,i)=>{"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},n.apply(this,arguments)}var r;i.d(t,{Ep:()=>h,J0:()=>a,RQ:()=>D,WK:()=>F,X3:()=>B,Zn:()=>A,Zq:()=>I,aU:()=>r,cP:()=>d,fp:()=>m,pC:()=>z,q_:()=>s}),function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(r||(r={}));const o="popstate";function s(e){return void 0===e&&(e={}),p((function(e,t){let{pathname:i="/",search:n="",hash:r=""}=d(e.location.hash.substr(1));return i.startsWith("/")||i.startsWith(".")||(i="/"+i),u("",{pathname:i,search:n,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){let i=e.document.querySelector("base"),n="";if(i&&i.getAttribute("href")){let t=e.location.href,i=t.indexOf("#");n=-1===i?t:t.slice(0,i)}return n+"#"+("string"==typeof t?t:h(t))}),(function(e,t){l("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(t)+")")}),e)}function a(e,t){if(!1===e||null==e)throw new Error(t)}function l(e,t){if(!e){"undefined"!=typeof console&&console.warn(t);try{throw new Error(t)}catch(e){}}}function c(e,t){return{usr:e.state,key:e.key,idx:t}}function u(e,t,i,r){return void 0===i&&(i=null),n({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?d(t):t,{state:i,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function h(e){let{pathname:t="/",search:i="",hash:n=""}=e;return i&&"?"!==i&&(t+="?"===i.charAt(0)?i:"?"+i),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function d(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function p(e,t,i,s){void 0===s&&(s={});let{window:l=document.defaultView,v5Compat:d=!1}=s,p=l.history,f=r.Pop,m=null,g=_();function _(){return(p.state||{idx:null}).idx}function y(){f=r.Pop;let e=_(),t=null==e?null:e-g;g=e,m&&m({action:f,location:v.location,delta:t})}function x(e){let t="null"!==l.location.origin?l.location.origin:l.location.href,i="string"==typeof e?e:h(e);return a(t,"No window.location.(origin|href) available to create URL for href: "+i),new URL(i,t)}null==g&&(g=0,p.replaceState(n({},p.state,{idx:g}),""));let v={get action(){return f},get location(){return e(l,p)},listen(e){if(m)throw new Error("A history only accepts one active listener");return l.addEventListener(o,y),m=e,()=>{l.removeEventListener(o,y),m=null}},createHref:e=>t(l,e),createURL:x,encodeLocation(e){let t=x(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){f=r.Push;let n=u(v.location,e,t);i&&i(n,e),g=_()+1;let o=c(n,g),s=v.createHref(n);try{p.pushState(o,"",s)}catch(e){if(e instanceof DOMException&&"DataCloneError"===e.name)throw e;l.location.assign(s)}d&&m&&m({action:f,location:v.location,delta:1})},replace:function(e,t){f=r.Replace;let n=u(v.location,e,t);i&&i(n,e),g=_();let o=c(n,g),s=v.createHref(n);p.replaceState(o,"",s),d&&m&&m({action:f,location:v.location,delta:0})},go:e=>p.go(e)};return v}var f;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(f||(f={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function m(e,t,i){void 0===i&&(i="/");let n=A(("string"==typeof t?d(t):t).pathname||"/",i);if(null==n)return null;let r=g(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let i=e.length===t.length&&e.slice(0,-1).every(((e,i)=>e===t[i]));return i?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(r);let o=null;for(let e=0;null==o&&e<r.length;++e)o=C(r[e],M(n));return o}function g(e,t,i,n){void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===n&&(n="");let r=(e,r,o)=>{let s={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};s.relativePath.startsWith("/")&&(a(s.relativePath.startsWith(n),'Absolute route path "'+s.relativePath+'" nested under path "'+n+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),s.relativePath=s.relativePath.slice(n.length));let l=D([n,s.relativePath]),c=i.concat(s);e.children&&e.children.length>0&&(a(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+l+'".'),g(e.children,t,c,l)),(null!=e.path||e.index)&&t.push({path:l,score:E(l,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var i;if(""!==e.path&&null!=(i=e.path)&&i.includes("?"))for(let i of _(e.path))r(e,t,i);else r(e,t)})),t}function _(e){let t=e.split("/");if(0===t.length)return[];let[i,...n]=t,r=i.endsWith("?"),o=i.replace(/\?$/,"");if(0===n.length)return r?[o,""]:[o];let s=_(n.join("/")),a=[];return a.push(...s.map((e=>""===e?o:[o,e].join("/")))),r&&a.push(...s),a.map((t=>e.startsWith("/")&&""===t?"/":t))}const y=/^:\w+$/,x=3,v=2,b=1,w=10,S=-2,T=e=>"*"===e;function E(e,t){let i=e.split("/"),n=i.length;return i.some(T)&&(n+=S),t&&(n+=v),i.filter((e=>!T(e))).reduce(((e,t)=>e+(y.test(t)?x:""===t?b:w)),n)}function C(e,t){let{routesMeta:i}=e,n={},r="/",o=[];for(let e=0;e<i.length;++e){let s=i[e],a=e===i.length-1,l="/"===r?t:t.slice(r.length)||"/",c=k({path:s.relativePath,caseSensitive:s.caseSensitive,end:a},l);if(!c)return null;Object.assign(n,c.params);let u=s.route;o.push({params:n,pathname:D([r,c.pathname]),pathnameBase:L(D([r,c.pathnameBase])),route:u}),"/"!==c.pathnameBase&&(r=D([r,c.pathnameBase]))}return o}function k(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[i,n]=function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=!0);l("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let n=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,((e,t)=>(n.push(t),"/([^\\/]+)")));e.endsWith("*")?(n.push("*"),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let o=new RegExp(r,t?void 0:"i");return[o,n]}(e.path,e.caseSensitive,e.end),r=t.match(i);if(!r)return null;let o=r[0],s=o.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:n.reduce(((e,t,i)=>{if("*"===t){let e=a[i]||"";s=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(i){return l(!1,'The value for the URL param "'+t+'" will not be decoded because the string "'+e+'" is a malformed URL segment. This is probably due to a bad percent encoding ('+i+")."),e}}(a[i]||"",t),e}),{}),pathname:o,pathnameBase:s,pattern:e}}function M(e){try{return decodeURI(e)}catch(t){return l(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function A(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,n=e.charAt(i);return n&&"/"!==n?null:e.slice(i)||"/"}function P(e,t,i,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+i+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function I(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function z(e,t,i,r){let o;void 0===r&&(r=!1),"string"==typeof e?o=d(e):(o=n({},e),a(!o.pathname||!o.pathname.includes("?"),P("?","pathname","search",o)),a(!o.pathname||!o.pathname.includes("#"),P("#","pathname","hash",o)),a(!o.search||!o.search.includes("#"),P("#","search","hash",o)));let s,l=""===e||""===o.pathname,c=l?"/":o.pathname;if(r||null==c)s=i;else{let e=t.length-1;if(c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;o.pathname=t.join("/")}s=e>=0?t[e]:"/"}let u=function(e,t){void 0===t&&(t="/");let{pathname:i,search:n="",hash:r=""}="string"==typeof e?d(e):e,o=i?i.startsWith("/")?i:function(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?i.length>1&&i.pop():"."!==e&&i.push(e)})),i.length>1?i.join("/"):"/"}(i,t):t;return{pathname:o,search:R(n),hash:O(r)}}(o,s),h=c&&"/"!==c&&c.endsWith("/"),p=(l||"."===c)&&i.endsWith("/");return u.pathname.endsWith("/")||!h&&!p||(u.pathname+="/"),u}const D=e=>e.join("/").replace(/\/\/+/g,"/"),L=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),R=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",O=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";class B extends Error{}function F(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}const N=["post","put","patch","delete"],j=(new Set(N),["get",...N]);new Set(j),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred")},646:(e,t,i)=>{"use strict";i.d(t,{gV:()=>Jt,W3:()=>eo,X6:()=>Eo,px:()=>qa,SV:()=>hr,$_:()=>Wn,h4:()=>tn,aN:()=>Hn,u_:()=>nr,wp:()=>Wi,F0:()=>yg,B:()=>mg,ET:()=>hn});var n=i(294);var r=function(){return r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)};Object.create;function o(e,t,i){if(i||2===arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}Object.create;"function"==typeof SuppressedError&&SuppressedError;var s=i(774),a=i.n(s),l="-ms-",c="-moz-",u="-webkit-",h="comm",d="rule",p="decl",f="@import",m="@keyframes",g="@layer",_=Math.abs,y=String.fromCharCode,x=Object.assign;function v(e){return e.trim()}function b(e,t){return(e=t.exec(e))?e[0]:e}function w(e,t,i){return e.replace(t,i)}function S(e,t){return e.indexOf(t)}function T(e,t){return 0|e.charCodeAt(t)}function E(e,t,i){return e.slice(t,i)}function C(e){return e.length}function k(e){return e.length}function M(e,t){return t.push(e),e}function A(e,t){return e.filter((function(e){return!b(e,t)}))}var P=1,I=1,z=0,D=0,L=0,R="";function O(e,t,i,n,r,o,s,a){return{value:e,root:t,parent:i,type:n,props:r,children:o,line:P,column:I,length:s,return:"",siblings:a}}function B(e,t){return x(O("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function F(e){for(;e.root;)e=B(e.root,{children:[e]});M(e,e.siblings)}function N(){return L=D>0?T(R,--D):0,I--,10===L&&(I=1,P--),L}function j(){return L=D<z?T(R,D++):0,I++,10===L&&(I=1,P++),L}function U(){return T(R,D)}function $(){return D}function V(e,t){return E(R,e,t)}function G(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function W(e){return P=I=1,z=C(R=e),D=0,[]}function q(e){return R="",e}function X(e){return v(V(D-1,Y(91===e?e+2:40===e?e+1:e)))}function Z(e){for(;(L=U())&&L<33;)j();return G(e)>2||G(L)>3?"":" "}function H(e,t){for(;--t&&j()&&!(L<48||L>102||L>57&&L<65||L>70&&L<97););return V(e,$()+(t<6&&32==U()&&32==j()))}function Y(e){for(;j();)switch(L){case e:return D;case 34:case 39:34!==e&&39!==e&&Y(L);break;case 40:41===e&&Y(e);break;case 92:j()}return D}function K(e,t){for(;j()&&e+L!==57&&(e+L!==84||47!==U()););return"/*"+V(t,D-1)+"*"+y(47===e?e:j())}function J(e){for(;!G(U());)j();return V(e,D)}function Q(e,t){for(var i="",n=0;n<e.length;n++)i+=t(e[n],n,e,t)||"";return i}function ee(e,t,i,n){switch(e.type){case g:if(e.children.length)break;case f:case p:return e.return=e.return||e.value;case h:return"";case m:return e.return=e.value+"{"+Q(e.children,n)+"}";case d:if(!C(e.value=e.props.join(",")))return""}return C(i=Q(e.children,n))?e.return=e.value+"{"+i+"}":""}function te(e,t,i){switch(function(e,t){return 45^T(e,0)?(((t<<2^T(e,0))<<2^T(e,1))<<2^T(e,2))<<2^T(e,3):0}(e,t)){case 5103:return u+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return u+e+e;case 4789:return c+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return u+e+c+e+l+e+e;case 5936:switch(T(e,t+11)){case 114:return u+e+l+w(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return u+e+l+w(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return u+e+l+w(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return u+e+l+e+e;case 6165:return u+e+l+"flex-"+e+e;case 5187:return u+e+w(e,/(\w+).+(:[^]+)/,u+"box-$1$2"+l+"flex-$1$2")+e;case 5443:return u+e+l+"flex-item-"+w(e,/flex-|-self/g,"")+(b(e,/flex-|baseline/)?"":l+"grid-row-"+w(e,/flex-|-self/g,""))+e;case 4675:return u+e+l+"flex-line-pack"+w(e,/align-content|flex-|-self/g,"")+e;case 5548:return u+e+l+w(e,"shrink","negative")+e;case 5292:return u+e+l+w(e,"basis","preferred-size")+e;case 6060:return u+"box-"+w(e,"-grow","")+u+e+l+w(e,"grow","positive")+e;case 4554:return u+w(e,/([^-])(transform)/g,"$1"+u+"$2")+e;case 6187:return w(w(w(e,/(zoom-|grab)/,u+"$1"),/(image-set)/,u+"$1"),e,"")+e;case 5495:case 3959:return w(e,/(image-set\([^]*)/,u+"$1$`$1");case 4968:return w(w(e,/(.+:)(flex-)?(.*)/,u+"box-pack:$3"+l+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+u+e+e;case 4200:if(!b(e,/flex-|baseline/))return l+"grid-column-align"+E(e,t)+e;break;case 2592:case 3360:return l+w(e,"template-","")+e;case 4384:case 3616:return i&&i.some((function(e,i){return t=i,b(e.props,/grid-\w+-end/)}))?~S(e+(i=i[t].value),"span")?e:l+w(e,"-start","")+e+l+"grid-row-span:"+(~S(i,"span")?b(i,/\d+/):+b(i,/\d+/)-+b(e,/\d+/))+";":l+w(e,"-start","")+e;case 4896:case 4128:return i&&i.some((function(e){return b(e.props,/grid-\w+-start/)}))?e:l+w(w(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return w(e,/(.+)-inline(.+)/,u+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(C(e)-1-t>6)switch(T(e,t+1)){case 109:if(45!==T(e,t+4))break;case 102:return w(e,/(.+:)(.+)-([^]+)/,"$1"+u+"$2-$3$1"+c+(108==T(e,t+3)?"$3":"$2-$3"))+e;case 115:return~S(e,"stretch")?te(w(e,"stretch","fill-available"),t,i)+e:e}break;case 5152:case 5920:return w(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,(function(t,i,n,r,o,s,a){return l+i+":"+n+a+(r?l+i+"-span:"+(o?s:+s-+n)+a:"")+e}));case 4949:if(121===T(e,t+6))return w(e,":",":"+u)+e;break;case 6444:switch(T(e,45===T(e,14)?18:11)){case 120:return w(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+u+(45===T(e,14)?"inline-":"")+"box$3$1"+u+"$2$3$1"+l+"$2box$3")+e;case 100:return w(e,":",":"+l)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return w(e,"scroll-","scroll-snap-")+e}return e}function ie(e,t,i,n){if(e.length>-1&&!e.return)switch(e.type){case p:return void(e.return=te(e.value,e.length,i));case m:return Q([B(e,{value:w(e.value,"@","@"+u)})],n);case d:if(e.length)return function(e,t){return e.map(t).join("")}(i=e.props,(function(t){switch(b(t,n=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":F(B(e,{props:[w(t,/:(read-\w+)/,":"+c+"$1")]})),F(B(e,{props:[t]})),x(e,{props:A(i,n)});break;case"::placeholder":F(B(e,{props:[w(t,/:(plac\w+)/,":"+u+"input-$1")]})),F(B(e,{props:[w(t,/:(plac\w+)/,":"+c+"$1")]})),F(B(e,{props:[w(t,/:(plac\w+)/,l+"input-$1")]})),F(B(e,{props:[t]})),x(e,{props:A(i,n)})}return""}))}}function ne(e){return q(re("",null,null,null,[""],e=W(e),0,[0],e))}function re(e,t,i,n,r,o,s,a,l){for(var c=0,u=0,h=s,d=0,p=0,f=0,m=1,g=1,_=1,x=0,v="",b=r,E=o,k=n,A=v;g;)switch(f=x,x=j()){case 40:if(108!=f&&58==T(A,h-1)){-1!=S(A+=w(X(x),"&","&\f"),"&\f")&&(_=-1);break}case 34:case 39:case 91:A+=X(x);break;case 9:case 10:case 13:case 32:A+=Z(f);break;case 92:A+=H($()-1,7);continue;case 47:switch(U()){case 42:case 47:M(se(K(j(),$()),t,i,l),l);break;default:A+="/"}break;case 123*m:a[c++]=C(A)*_;case 125*m:case 59:case 0:switch(x){case 0:case 125:g=0;case 59+u:-1==_&&(A=w(A,/\f/g,"")),p>0&&C(A)-h&&M(p>32?ae(A+";",n,i,h-1,l):ae(w(A," ","")+";",n,i,h-2,l),l);break;case 59:A+=";";default:if(M(k=oe(A,t,i,c,u,r,a,v,b=[],E=[],h,o),o),123===x)if(0===u)re(A,t,k,k,b,o,h,a,E);else switch(99===d&&110===T(A,3)?100:d){case 100:case 108:case 109:case 115:re(e,k,k,n&&M(oe(e,k,k,0,0,r,a,v,r,b=[],h,E),E),r,E,h,a,n?b:E);break;default:re(A,k,k,k,[""],E,0,a,E)}}c=u=p=0,m=_=1,v=A="",h=s;break;case 58:h=1+C(A),p=f;default:if(m<1)if(123==x)--m;else if(125==x&&0==m++&&125==N())continue;switch(A+=y(x),x*m){case 38:_=u>0?1:(A+="\f",-1);break;case 44:a[c++]=(C(A)-1)*_,_=1;break;case 64:45===U()&&(A+=X(j())),d=U(),u=h=C(v=A+=J($())),x++;break;case 45:45===f&&2==C(A)&&(m=0)}}return o}function oe(e,t,i,n,r,o,s,a,l,c,u,h){for(var p=r-1,f=0===r?o:[""],m=k(f),g=0,y=0,x=0;g<n;++g)for(var b=0,S=E(e,p+1,p=_(y=s[g])),T=e;b<m;++b)(T=v(y>0?f[b]+" "+S:w(S,/&\f/g,f[b])))&&(l[x++]=T);return O(e,t,i,0===r?d:a,l,c,u,h)}function se(e,t,i,n){return O(e,t,i,h,y(L),E(e,2,-2),0,n)}function ae(e,t,i,n,r){return O(e,t,i,p,E(e,0,n),E(e,n+1,-1),n,r)}var le={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},ce="undefined"!=typeof process&&("MISSING_ENV_VAR".REACT_APP_SC_ATTR||"MISSING_ENV_VAR".SC_ATTR)||"data-styled",ue="undefined"!=typeof window&&"HTMLElement"in window,he=Boolean("boolean"==typeof SC_DISABLE_SPEEDY?SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!=="MISSING_ENV_VAR".REACT_APP_SC_DISABLE_SPEEDY&&""!=="MISSING_ENV_VAR".REACT_APP_SC_DISABLE_SPEEDY?"false"!=="MISSING_ENV_VAR".REACT_APP_SC_DISABLE_SPEEDY&&"MISSING_ENV_VAR".REACT_APP_SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!=="MISSING_ENV_VAR".SC_DISABLE_SPEEDY&&""!=="MISSING_ENV_VAR".SC_DISABLE_SPEEDY&&("false"!=="MISSING_ENV_VAR".SC_DISABLE_SPEEDY&&"MISSING_ENV_VAR".SC_DISABLE_SPEEDY)),de={},pe=(new Set,Object.freeze([])),fe=Object.freeze({});function me(e,t,i){return void 0===i&&(i=fe),e.theme!==i.theme&&e.theme||t||i.theme}var ge=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),_e=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,ye=/(^-|-$)/g;function xe(e){return e.replace(_e,"-").replace(ye,"")}var ve=/(a)(d)/gi,be=function(e){return String.fromCharCode(e+(e>25?39:97))};function we(e){var t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=be(t%52)+i;return(be(t%52)+i).replace(ve,"$1-$2")}var Se,Te=function(e,t){for(var i=t.length;i;)e=33*e^t.charCodeAt(--i);return e},Ee=function(e){return Te(5381,e)};function Ce(e){return we(Ee(e)>>>0)}function ke(e){return"string"==typeof e&&!0}var Me="function"==typeof Symbol&&Symbol.for,Ae=Me?Symbol.for("react.memo"):60115,Pe=Me?Symbol.for("react.forward_ref"):60112,Ie={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},ze={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},De={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Le=((Se={})[Pe]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Se[Ae]=De,Se);function Re(e){return("type"in(t=e)&&t.type.$$typeof)===Ae?De:"$$typeof"in e?Le[e.$$typeof]:Ie;var t}var Oe=Object.defineProperty,Be=Object.getOwnPropertyNames,Fe=Object.getOwnPropertySymbols,Ne=Object.getOwnPropertyDescriptor,je=Object.getPrototypeOf,Ue=Object.prototype;function $e(e,t,i){if("string"!=typeof t){if(Ue){var n=je(t);n&&n!==Ue&&$e(e,n,i)}var r=Be(t);Fe&&(r=r.concat(Fe(t)));for(var o=Re(e),s=Re(t),a=0;a<r.length;++a){var l=r[a];if(!(l in ze||i&&i[l]||s&&l in s||o&&l in o)){var c=Ne(t,l);try{Oe(e,l,c)}catch(e){}}}}return e}function Ve(e){return"function"==typeof e}function Ge(e){return"object"==typeof e&&"styledComponentId"in e}function We(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function qe(e,t){if(0===e.length)return"";for(var i=e[0],n=1;n<e.length;n++)i+=t?t+e[n]:e[n];return i}function Xe(e){return null!==e&&"object"==typeof e&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function Ze(e,t,i){if(void 0===i&&(i=!1),!i&&!Xe(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var n=0;n<t.length;n++)e[n]=Ze(e[n],t[n]);else if(Xe(t))for(var n in t)e[n]=Ze(e[n],t[n]);return e}function He(e,t){Object.defineProperty(e,"toString",{value:t})}function Ye(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var Ke=function(){function e(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return e.prototype.indexOfGroup=function(e){for(var t=0,i=0;i<e;i++)t+=this.groupSizes[i];return t},e.prototype.insertRules=function(e,t){if(e>=this.groupSizes.length){for(var i=this.groupSizes,n=i.length,r=n;e>=r;)if((r<<=1)<0)throw Ye(16,"".concat(e));this.groupSizes=new Uint32Array(r),this.groupSizes.set(i),this.length=r;for(var o=n;o<r;o++)this.groupSizes[o]=0}for(var s=this.indexOfGroup(e+1),a=(o=0,t.length);o<a;o++)this.tag.insertRule(s,t[o])&&(this.groupSizes[e]++,s++)},e.prototype.clearGroup=function(e){if(e<this.length){var t=this.groupSizes[e],i=this.indexOfGroup(e),n=i+t;this.groupSizes[e]=0;for(var r=i;r<n;r++)this.tag.deleteRule(i)}},e.prototype.getGroup=function(e){var t="";if(e>=this.length||0===this.groupSizes[e])return t;for(var i=this.groupSizes[e],n=this.indexOfGroup(e),r=n+i,o=n;o<r;o++)t+="".concat(this.tag.getRule(o)).concat("/*!sc*/\n");return t},e}(),Je=new Map,Qe=new Map,et=1,tt=function(e){if(Je.has(e))return Je.get(e);for(;Qe.has(et);)et++;var t=et++;return Je.set(e,t),Qe.set(t,e),t},it=function(e,t){Je.set(e,t),Qe.set(t,e)},nt="style[".concat(ce,"][").concat("data-styled-version",'="').concat("6.0.7",'"]'),rt=new RegExp("^".concat(ce,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),ot=function(e,t,i){for(var n,r=i.split(","),o=0,s=r.length;o<s;o++)(n=r[o])&&e.registerName(t,n)},st=function(e,t){for(var i,n=(null!==(i=t.textContent)&&void 0!==i?i:"").split("/*!sc*/\n"),r=[],o=0,s=n.length;o<s;o++){var a=n[o].trim();if(a){var l=a.match(rt);if(l){var c=0|parseInt(l[1],10),u=l[2];0!==c&&(it(u,c),ot(e,u,l[3]),e.getTag().insertRules(c,r)),r.length=0}else r.push(a)}}};function at(){return i.nc}var lt=function(e){var t=document.head,i=e||t,n=document.createElement("style"),r=function(e){var t=Array.from(e.querySelectorAll("style[".concat(ce,"]")));return t[t.length-1]}(i),o=void 0!==r?r.nextSibling:null;n.setAttribute(ce,"active"),n.setAttribute("data-styled-version","6.0.7");var s=at();return s&&n.setAttribute("nonce",s),i.insertBefore(n,o),n},ct=function(){function e(e){this.element=lt(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(e){if(e.sheet)return e.sheet;for(var t=document.styleSheets,i=0,n=t.length;i<n;i++){var r=t[i];if(r.ownerNode===e)return r}throw Ye(17)}(this.element),this.length=0}return e.prototype.insertRule=function(e,t){try{return this.sheet.insertRule(t,e),this.length++,!0}catch(e){return!1}},e.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},e.prototype.getRule=function(e){var t=this.sheet.cssRules[e];return t&&t.cssText?t.cssText:""},e}(),ut=function(){function e(e){this.element=lt(e),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(e,t){if(e<=this.length&&e>=0){var i=document.createTextNode(t);return this.element.insertBefore(i,this.nodes[e]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},e.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},e}(),ht=function(){function e(e){this.rules=[],this.length=0}return e.prototype.insertRule=function(e,t){return e<=this.length&&(this.rules.splice(e,0,t),this.length++,!0)},e.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},e.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},e}(),dt=ue,pt={isServer:!ue,useCSSOMInjection:!he},ft=function(){function e(e,t,i){void 0===e&&(e=fe),void 0===t&&(t={});var n=this;this.options=r(r({},pt),e),this.gs=t,this.names=new Map(i),this.server=!!e.isServer,!this.server&&ue&&dt&&(dt=!1,function(e){for(var t=document.querySelectorAll(nt),i=0,n=t.length;i<n;i++){var r=t[i];r&&"active"!==r.getAttribute(ce)&&(st(e,r),r.parentNode&&r.parentNode.removeChild(r))}}(this)),He(this,(function(){return function(e){for(var t=e.getTag(),i=t.length,n="",r=function(i){var r=function(e){return Qe.get(e)}(i);if(void 0===r)return"continue";var o=e.names.get(r),s=t.getGroup(i);if(void 0===o||0===s.length)return"continue";var a="".concat(ce,".g").concat(i,'[id="').concat(r,'"]'),l="";void 0!==o&&o.forEach((function(e){e.length>0&&(l+="".concat(e,","))})),n+="".concat(s).concat(a,'{content:"').concat(l,'"}').concat("/*!sc*/\n")},o=0;o<i;o++)r(o);return n}(n)}))}return e.registerId=function(e){return tt(e)},e.prototype.reconstructWithOptions=function(t,i){return void 0===i&&(i=!0),new e(r(r({},this.options),t),this.gs,i&&this.names||void 0)},e.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(e=function(e){var t=e.useCSSOMInjection,i=e.target;return e.isServer?new ht(i):t?new ct(i):new ut(i)}(this.options),new Ke(e)));var e},e.prototype.hasNameForId=function(e,t){return this.names.has(e)&&this.names.get(e).has(t)},e.prototype.registerName=function(e,t){if(tt(e),this.names.has(e))this.names.get(e).add(t);else{var i=new Set;i.add(t),this.names.set(e,i)}},e.prototype.insertRules=function(e,t,i){this.registerName(e,t),this.getTag().insertRules(tt(e),i)},e.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},e.prototype.clearRules=function(e){this.getTag().clearGroup(tt(e)),this.clearNames(e)},e.prototype.clearTag=function(){this.tag=void 0},e}(),mt=/&/g,gt=/^\s*\/\/.*$/gm;function _t(e,t){return e.map((function(e){return"rule"===e.type&&(e.value="".concat(t," ").concat(e.value),e.value=e.value.replaceAll(",",",".concat(t," ")),e.props=e.props.map((function(e){return"".concat(t," ").concat(e)}))),Array.isArray(e.children)&&"@keyframes"!==e.type&&(e.children=_t(e.children,t)),e}))}function yt(e){var t,i,n,r=void 0===e?fe:e,o=r.options,s=void 0===o?fe:o,a=r.plugins,l=void 0===a?pe:a,c=function(e,n,r){return r===i||r.startsWith(i)&&r.endsWith(i)&&r.replaceAll(i,"").length>0?".".concat(t):e},u=l.slice();u.push((function(e){e.type===d&&e.value.includes("&")&&(e.props[0]=e.props[0].replace(mt,i).replace(n,c))})),s.prefix&&u.push(ie),u.push(ee);var h=function(e,r,o,a){void 0===r&&(r=""),void 0===o&&(o=""),void 0===a&&(a="&"),t=a,i=r,n=new RegExp("\\".concat(i,"\\b"),"g");var l=e.replace(gt,""),c=ne(o||r?"".concat(o," ").concat(r," { ").concat(l," }"):l);s.namespace&&(c=_t(c,s.namespace));var h,d,p=[];return Q(c,(h=u.concat(function(e){return function(t){t.root||(t=t.return)&&e(t)}}((function(e){return p.push(e)}))),d=k(h),function(e,t,i,n){for(var r="",o=0;o<d;o++)r+=h[o](e,t,i,n)||"";return r})),p};return h.hash=l.length?l.reduce((function(e,t){return t.name||Ye(15),Te(e,t.name)}),5381).toString():"",h}var xt=new ft,vt=yt(),bt=n.createContext({shouldForwardProp:void 0,styleSheet:xt,stylis:vt}),wt=(bt.Consumer,n.createContext(void 0));function St(){return(0,n.useContext)(bt)}function Tt(e){var t=(0,n.useState)(e.stylisPlugins),i=t[0],r=t[1],o=St().styleSheet,s=(0,n.useMemo)((function(){var t=o;return e.sheet?t=e.sheet:e.target&&(t=t.reconstructWithOptions({target:e.target},!1)),e.disableCSSOMInjection&&(t=t.reconstructWithOptions({useCSSOMInjection:!1})),t}),[e.disableCSSOMInjection,e.sheet,e.target,o]),l=(0,n.useMemo)((function(){return yt({options:{namespace:e.namespace,prefix:e.enableVendorPrefixes},plugins:i})}),[e.enableVendorPrefixes,e.namespace,i]);return(0,n.useEffect)((function(){a()(i,e.stylisPlugins)||r(e.stylisPlugins)}),[e.stylisPlugins]),n.createElement(bt.Provider,{value:{shouldForwardProp:e.shouldForwardProp,styleSheet:s,stylis:l}},n.createElement(wt.Provider,{value:l},e.children))}var Et=function(){function e(e,t){var i=this;this.inject=function(e,t){void 0===t&&(t=vt);var n=i.name+t.hash;e.hasNameForId(i.id,n)||e.insertRules(i.id,n,t(i.rules,n,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=t,He(this,(function(){throw Ye(12,String(i.name))}))}return e.prototype.getName=function(e){return void 0===e&&(e=vt),this.name+e.hash},e}(),Ct=function(e){return e>="A"&&e<="Z"};function kt(e){for(var t="",i=0;i<e.length;i++){var n=e[i];if(1===i&&"-"===n&&"-"===e[0])return e;Ct(n)?t+="-"+n.toLowerCase():t+=n}return t.startsWith("ms-")?"-"+t:t}var Mt=function(e){return null==e||!1===e||""===e},At=function(e){var t,i,n=[];for(var r in e){var s=e[r];e.hasOwnProperty(r)&&!Mt(s)&&(Array.isArray(s)&&s.isCss||Ve(s)?n.push("".concat(kt(r),":"),s,";"):Xe(s)?n.push.apply(n,o(o(["".concat(r," {")],At(s),!1),["}"],!1)):n.push("".concat(kt(r),": ").concat((t=r,null==(i=s)||"boolean"==typeof i||""===i?"":"number"!=typeof i||0===i||t in le||t.startsWith("--")?String(i).trim():"".concat(i,"px")),";")))}return n};function Pt(e,t,i,n){return Mt(e)?[]:Ge(e)?[".".concat(e.styledComponentId)]:Ve(e)?!Ve(r=e)||r.prototype&&r.prototype.isReactComponent||!t?[e]:Pt(e(t),t,i,n):e instanceof Et?i?(e.inject(i,n),[e.getName(n)]):[e]:Xe(e)?At(e):Array.isArray(e)?Array.prototype.concat.apply(pe,e.map((function(e){return Pt(e,t,i,n)}))):[e.toString()];var r}function It(e){for(var t=0;t<e.length;t+=1){var i=e[t];if(Ve(i)&&!Ge(i))return!1}return!0}var zt=Ee("6.0.7"),Dt=function(){function e(e,t,i){this.rules=e,this.staticRulesId="",this.isStatic=(void 0===i||i.isStatic)&&It(e),this.componentId=t,this.baseHash=Te(zt,t),this.baseStyle=i,ft.registerId(t)}return e.prototype.generateAndInjectStyles=function(e,t,i){var n=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,t,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&t.hasNameForId(this.componentId,this.staticRulesId))n=We(n,this.staticRulesId);else{var r=qe(Pt(this.rules,e,t,i)),o=we(Te(this.baseHash,r)>>>0);if(!t.hasNameForId(this.componentId,o)){var s=i(r,".".concat(o),void 0,this.componentId);t.insertRules(this.componentId,o,s)}n=We(n,o),this.staticRulesId=o}else{for(var a=Te(this.baseHash,i.hash),l="",c=0;c<this.rules.length;c++){var u=this.rules[c];if("string"==typeof u)l+=u;else if(u){var h=qe(Pt(u,e,t,i));a=Te(a,h),l+=h}}if(l){var d=we(a>>>0);t.hasNameForId(this.componentId,d)||t.insertRules(this.componentId,d,i(l,".".concat(d),void 0,this.componentId)),n=We(n,d)}}return n},e}(),Lt=n.createContext(void 0);Lt.Consumer;function Rt(e){var t=n.useContext(Lt),i=(0,n.useMemo)((function(){return function(e,t){if(!e)throw Ye(14);if(Ve(e))return e(t);if(Array.isArray(e)||"object"!=typeof e)throw Ye(8);return t?r(r({},t),e):e}(e.theme,t)}),[e.theme,t]);return e.children?n.createElement(Lt.Provider,{value:i},e.children):null}var Ot={};new Set;function Bt(e,t,i){var o=Ge(e),s=e,a=!ke(e),l=t.attrs,c=void 0===l?pe:l,u=t.componentId,h=void 0===u?function(e,t){var i="string"!=typeof e?"sc":xe(e);Ot[i]=(Ot[i]||0)+1;var n="".concat(i,"-").concat(Ce("6.0.7"+i+Ot[i]));return t?"".concat(t,"-").concat(n):n}(t.displayName,t.parentComponentId):u,d=t.displayName,p=(void 0===d&&function(e){ke(e)?"styled.".concat(e):"Styled(".concat(function(e){return e.displayName||e.name||"Component"}(e),")")}(e),t.displayName&&t.componentId?"".concat(xe(t.displayName),"-").concat(t.componentId):t.componentId||h),f=o&&s.attrs?s.attrs.concat(c).filter(Boolean):c,m=t.shouldForwardProp;if(o&&s.shouldForwardProp){var g=s.shouldForwardProp;if(t.shouldForwardProp){var _=t.shouldForwardProp;m=function(e,t){return g(e,t)&&_(e,t)}}else m=g}var y=new Dt(i,p,o?s.componentStyle:void 0);var x=n.forwardRef((function(e,t){return function(e,t,i){var o=e.attrs,s=e.componentStyle,a=e.defaultProps,l=e.foldedComponentIds,c=e.styledComponentId,u=e.target,h=n.useContext(Lt),d=St(),p=e.shouldForwardProp||d.shouldForwardProp,f=function(e,t,i){for(var n,o=r(r({},t),{className:void 0,theme:i}),s=0;s<e.length;s+=1){var a=Ve(n=e[s])?n(o):n;for(var l in a)o[l]="className"===l?We(o[l],a[l]):"style"===l?r(r({},o[l]),a[l]):a[l]}return t.className&&(o.className=We(o.className,t.className)),o}(o,t,me(t,h,a)||fe),m=f.as||u,g={};for(var _ in f)void 0===f[_]||"$"===_[0]||"as"===_||"theme"===_||("forwardedAs"===_?g.as=f.forwardedAs:p&&!p(_,m)||(g[_]=f[_]));var y=function(e,t){var i=St();return e.generateAndInjectStyles(t,i.styleSheet,i.stylis)}(s,f),x=We(l,c);return y&&(x+=" "+y),f.className&&(x+=" "+f.className),g[ke(m)&&!ge.has(m)?"class":"className"]=x,g.ref=i,(0,n.createElement)(m,g)}(x,e,t)}));return x.attrs=f,x.componentStyle=y,x.shouldForwardProp=m,x.foldedComponentIds=o?We(s.foldedComponentIds,s.styledComponentId):"",x.styledComponentId=p,x.target=o?s.target:e,Object.defineProperty(x,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(e){this._foldedDefaultProps=o?function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var n=0,r=t;n<r.length;n++)Ze(e,r[n],!0);return e}({},s.defaultProps,e):e}}),He(x,(function(){return".".concat(x.styledComponentId)})),a&&$e(x,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),x}function Ft(e,t){for(var i=[e[0]],n=0,r=t.length;n<r;n+=1)i.push(t[n],e[n+1]);return i}var Nt=function(e){return Object.assign(e,{isCss:!0})};function jt(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(Ve(e)||Xe(e))return Nt(Pt(Ft(pe,o([e],t,!0))));var n=e;return 0===t.length&&1===n.length&&"string"==typeof n[0]?Pt(n):Nt(Pt(Ft(n,t)))}function Ut(e,t,i){if(void 0===i&&(i=fe),!t)throw Ye(1,t);var n=function(n){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];return e(t,i,jt.apply(void 0,o([n],r,!1)))};return n.attrs=function(n){return Ut(e,t,r(r({},i),{attrs:Array.prototype.concat(i.attrs,n).filter(Boolean)}))},n.withConfig=function(n){return Ut(e,t,r(r({},i),n))},n}var $t=function(e){return Ut(Bt,e)},Vt=$t;ge.forEach((function(e){Vt[e]=$t(e)}));var Gt=function(){function e(e,t){this.rules=e,this.componentId=t,this.isStatic=It(e),ft.registerId(this.componentId+1)}return e.prototype.createStyles=function(e,t,i,n){var r=n(qe(Pt(this.rules,t,i,n)),""),o=this.componentId+e;i.insertRules(o,o,r)},e.prototype.removeStyles=function(e,t){t.clearRules(this.componentId+e)},e.prototype.renderStyles=function(e,t,i,n){e>2&&ft.registerId(this.componentId+e),this.removeStyles(e,i),this.createStyles(e,t,i,n)},e}();function Wt(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var s=jt.apply(void 0,o([e],t,!1)),a="sc-global-".concat(Ce(JSON.stringify(s))),l=new Gt(s,a),c=function(e){var t=St(),i=n.useContext(Lt),r=n.useRef(t.styleSheet.allocateGSInstance(a)).current;return t.styleSheet.server&&u(r,e,t.styleSheet,i,t.stylis),n.useLayoutEffect((function(){if(!t.styleSheet.server)return u(r,e,t.styleSheet,i,t.stylis),function(){return l.removeStyles(r,t.styleSheet)}}),[r,e,t.styleSheet,i,t.stylis]),null};function u(e,t,i,n,o){if(l.isStatic)l.renderStyles(e,de,i,o);else{var s=r(r({},t),{theme:me(t,n,c.defaultProps)});l.renderStyles(e,s,i,o)}}return n.memo(c)}function qt(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=qe(jt.apply(void 0,o([e],t,!1))),r=Ce(n);return new Et(r,n)}(function(){function e(){var e=this;this._emitSheetCSS=function(){var t=e.instance.toString(),i=at(),n=qe([i&&'nonce="'.concat(i,'"'),"".concat(ce,'="true"'),"".concat("data-styled-version",'="').concat("6.0.7",'"')].filter(Boolean)," ");return"<style ".concat(n,">").concat(t,"</style>")},this.getStyleTags=function(){if(e.sealed)throw Ye(2);return e._emitSheetCSS()},this.getStyleElement=function(){var t;if(e.sealed)throw Ye(2);var i=((t={})[ce]="",t["data-styled-version"]="6.0.7",t.dangerouslySetInnerHTML={__html:e.instance.toString()},t),o=at();return o&&(i.nonce=o),[n.createElement("style",r({},i,{key:"sc-0-0"}))]},this.seal=function(){e.sealed=!0},this.instance=new ft({isServer:!0}),this.sealed=!1}e.prototype.collectStyles=function(e){if(this.sealed)throw Ye(2);return n.createElement(Tt,{sheet:this.instance},e)},e.prototype.interleaveWithNodeStream=function(e){throw Ye(3)}})(),"__sc-".concat(ce,"__");var Xt=i(200);const Zt={white:"#ffffff",black:"#000000",green:"#84dd37",darkGreen:"#00ce2c",lightGreen:"#a3dc00",shadowGreen:"#84dd3770",emeraldGreen:"#2479408a",prodigalGreen:"#d9e7da33",yellow:"#aedf23",red:"#d10708",gray:"#898989",lightGray:"#9e9e9e",shadowGray:"#121212",cardLightGray:"#d9d9d9",borderGray:"#202025",darkGray:"#474747",blue:"#3b71d3",darkBlue:"#1b2028",lightBlue:"#a7b2c3",purpleBlue:"#303036",oceanBlue:"#607d94",successGreen:"#16C782",errorRed:"#EA3943"},Ht={colors:{...Zt},font:{fontFamily:{popins:"Poppins",inter:"Inter"},fontSize:{XXL:76,XL:50,L:32,M:24,S:20,XS:16},fontWeight:{L:600,M:500,S:400,XS:300,XXS:200}},media:{XL:1200,L:900,M:700,S:650,XS:600,XXS:500},space:{XXS0:0,XXS2:2,XXS8:8,XXS:10,XS12:12,XS:15,S17:17,S18:18,S:20,S24:24,M:25,L:30,L33:33,L35:35,L40:40,XL:50,XL55:55,XL56:56,XL58:58,XL70:70,XL79:79,XL80:80,XL86:86,XL105:105,XXL:100,XXL110:110,XXL155:155,XXL170:170,XXL200:200,XXL310:310}},Yt={light:{...Ht,backgroundColor:Zt.white,textColor:Zt.black},dark:{...Ht,backgroundColor:Zt.black,textColor:Zt.white}};var Kt=i(893);const Jt=()=>{const{theme:e}=(0,n.useContext)(Xt.N);return(0,Kt.jsx)(Rt,{theme:Yt[e],children:(0,Kt.jsx)(yg,{})})};var Qt=i(655);const ei="/",ti="/timeline",ii="/bank-card",ni="/contato",ri="*",oi=(0,n.lazy)((()=>i.e(124).then(i.bind(i,124)))),si=(0,n.lazy)((()=>i.e(937).then(i.bind(i,937)))),ai=(0,n.lazy)((()=>i.e(154).then(i.bind(i,154)))),li=(0,n.lazy)((()=>i.e(729).then(i.bind(i,729)))),ci={Home:{path:ei,element:(0,Kt.jsx)(oi,{})},Timeline:{path:ti,element:(0,Kt.jsx)(ai,{})},BankCard:{path:ii,element:(0,Kt.jsx)(li,{})},Contato:{path:ni,element:(0,Kt.jsx)(si,{})}};var ui=i(998),hi=i(545);const di="dark",pi="light",fi=jt`
  display: flex;
`,mi=jt`
  ${fi}
  flex-direction: column;
`,gi=jt`
  ${fi}
  flex-direction: row;
`,_i=jt`
  display: block;
`,yi=jt`
  display: inline-block;
`,xi=jt`
  display: none;
`,vi=jt`
  line-height: normal;
  font-style: normal;
`,bi=jt`
  font-style: normal;
  line-height: 150%;
`,wi=jt`
  font-style: normal;
  line-height: 49px;
`,Si=jt`
  font-style: normal;
  line-height: 41px;
`,Ti=Vt.label`
  ${yi}
  margin: 0 ${({theme:e})=>e.space.XS12}px;
  position: relative;
  width: 100%;
  max-width: 50px;
  height: 25px;
`,Ei=Vt.span`
  background-color: ${({theme:e})=>e.colors.green};
  position: absolute;
  cursor: pointer;
  border-radius: 25px;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  transition: background-color 0.2s ease;

  &:before {
    background-color: ${({theme:e})=>e.backgroundColor};
    position: absolute;
    content: "";
    left: 2px;
    top: 2px;
    width: 21px;
    height: 21px;
    border-radius: 50%;
    transition: transform 0.3s ease;
  }
`,Ci=Vt.input`
  ${xi}

  &:checked + ${Ei} {
    background-color: ${({theme:e})=>e.colors.green};
  }

  &:checked + ${Ei}::before {
    background-color: ${({theme:e})=>e.backgroundColor};
    transform: translateX(25px);
  }
`,ki=()=>{const{theme:e,setTheme:t}=(0,n.useContext)(Xt.N),i=e===pi;return(0,Kt.jsxs)(Ti,{children:[(0,Kt.jsx)(Ci,{checked:i,"data-cy":"nav-switch",type:"checkbox",onChange:()=>{const i=e===pi?di:pi;t(i),(0,ui.fv)(hi.T.cacheThemeKey,i)}}),(0,Kt.jsx)(Ei,{})]})},Mi=(e,t)=>{(0,n.useEffect)((()=>{if(!t)return;const i=i=>{e.current&&!e.current.contains(i.target)&&t(i)};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}}),[e,t])},Ai=Vt.div`
  width: 30px;
  height: 30px;
  position: relative;
  cursor: pointer;

  @media (min-width: ${({theme:e})=>e.media.S+1}px) {
    ${xi}
  }
`,Pi=Vt.div`
  background-color: ${({theme:e})=>e.textColor};
  width: 30px;
  height: 4px;
  position: absolute;
  transition: all 0.3s ease-in-out;
  transform-origin: center;
  border-radius: 4px;

  &:nth-of-type(1) {
    top: ${({$isOpen:e})=>e?"50%":"20%"};
    transform: ${({$isOpen:e})=>e?"rotate(45deg)":"rotate(0deg)"};
  }

  &:nth-of-type(2) {
    opacity: ${({$isOpen:e})=>e?0:1};
    top: 50%;
  }

  &:nth-of-type(3) {
    top: ${({$isOpen:e})=>e?"50%":"80%"};
    transform: ${({$isOpen:e})=>e?"rotate(-45deg)":"rotate(0deg)"};
  }
`,Ii=Vt.ul`
  ${fi}
  color: ${({theme:e})=>e.textColor};
  height: ${({$isOpen:e})=>e?"0":"auto"};
  background-color: ${({theme:e})=>e.backgroundColor};
  padding-bottom: ${({theme:e})=>e.space.XS}px;
  list-style-type: none;
  z-index: 1;
  align-items: center;
  flex-direction: column;
  transition: all 0.3s ease-in-out;
  overflow: hidden;
  position: absolute;
  width: 100%;
  left: 0;
  top: 10%;

  li {
    padding-bottom: ${({theme:e})=>e.space.XS}px;
  }

  a {
    font-size: ${({theme:e})=>e.font.fontSize.S}px;
    font-weight: ${({theme:e})=>e.font.fontWeight.XS};
    color: ${({theme:e})=>e.textColor};
    text-decoration: none;

    &:hover {
      color: ${({theme:e})=>e.colors.green};
    }

    &.active {
      color: ${({theme:e})=>e.colors.green};
      text-decoration: underline;
      text-underline-offset: 5px;
    }
  }
`,zi=()=>{const[e,t]=(0,n.useState)(!1),i=(0,n.useRef)(null),r=(0,n.useCallback)((()=>{t(!1)}),[t]);Mi(i,r);const o=Array.from({length:3},((t,i)=>(0,Kt.jsx)(Pi,{$isOpen:e},i)));return(0,Kt.jsxs)(Kt.Fragment,{children:[(0,Kt.jsx)(Ai,{"data-cy":"nav-burger-menu",onClick:()=>{t((e=>!e))},children:o}),e&&(0,Kt.jsxs)(Ii,{ref:i,children:[Object.keys(ci).map((e=>{const{path:t}=ci[e];return(0,Kt.jsx)("li",{children:(0,Kt.jsx)(Qt.OL,{to:t,onClick:r,children:e})},e)})),(0,Kt.jsx)(ki,{})]})]})},Di=i.p+"a5730e66cec325da8a07.svg",Li={width:"300px",height:"300px"},Ri={width:"80px",height:"80px"},Oi={width:"50px",height:"50px"},Bi={width:"40px",height:"40px"},Fi={width:"25px",height:"25px"},Ni={width:"20px",height:"20px"},ji={alt:"Application logotype",src:Di,...Bi},Ui=Vt.nav`
  ${fi}
  background-color: ${({theme:e})=>e.backgroundColor};
  padding: 0 ${({theme:e})=>e.space.XXL}px;
  align-items: center;
  justify-content: space-between;
  height: 103px;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    padding: 0 ${({theme:e})=>e.space.L}px;
  }
`,$i=Vt.img`
  user-select: none;
`,Vi=Vt.ul`
  ${fi}
  justify-content: space-between;
  list-style-type: none;
  width: 657px;

  a {
    font-size: ${({theme:e})=>e.font.fontSize.S}px;
    font-weight: ${({theme:e})=>e.font.fontWeight.XS};
    color: ${({theme:e})=>e.textColor};
    text-decoration: none;

    &:hover {
      color: ${({theme:e})=>e.colors.green};
    }

    &.active {
      color: ${({theme:e})=>e.colors.green};
      text-decoration: underline;
      text-underline-offset: 5px;
    }
  }

  @media (max-width: ${({theme:e})=>e.media.L}px) {
    gap: ${({theme:e})=>e.space.L}px;
    justify-content: center;
  }

  @media (max-width: ${({theme:e})=>e.media.S}px) {
    ${xi}
  }
`,Gi=Vt.div`
  width: 100%;
  display: contents;
  max-width: 50px;

  @media (max-width: ${({theme:e})=>e.media.S}px) {
    ${xi}
  }
`,Wi=(Vt.label`
  ${yi}
  margin: 0 ${({theme:e})=>e.space.XS12}px;
  width: 50px;
  position: relative;
  height: 25px;
`,()=>(0,Kt.jsxs)(Ui,{children:[(0,Kt.jsx)($i,{"data-cy":"nav-logo",...ji}),(0,Kt.jsx)(Vi,{"data-cy":"nav-links-container",children:Object.keys(ci).map((e=>{const{path:t}=ci[e];return(0,Kt.jsx)("li",{children:(0,Kt.jsx)(Qt.OL,{"data-cy":`nav-${e}`,to:t,children:e})},e)}))}),(0,Kt.jsx)(Gi,{children:(0,Kt.jsx)(ki,{})}),(0,Kt.jsx)(zi,{})]})),qi={alt:"Application logotype",src:Di,...Li},Xi=Vt.header`
  ${fi}
  padding-top: ${({theme:e})=>e.space.L33}px;
  padding-right: ${({theme:e})=>e.space.XXL310}px;
  padding-bottom: ${({theme:e})=>e.space.XL58}px;
  background: linear-gradient(
    253deg,
    ${Zt.shadowGray} 11.77%,
    ${Zt.emeraldGreen} 91.12%
  );
  justify-content: center;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    padding-right: ${({theme:e})=>e.space.XXS0};
  }
`,Zi=Vt.section`
  ${fi}
  align-items: center;
`,Hi=Vt.div`
  ${mi}
  align-items: flex-end;
  text-align: center;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    align-items: center;
  }
`,Yi=Vt.h1`
  ${vi}
  font-size: ${({theme:e})=>e.font.fontSize.XXL}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.L};
  padding-right: ${({theme:e})=>e.space.XL70}px;
  background: linear-gradient(
    90deg,
    ${({theme:e})=>e.colors.darkGreen} 0.18%,
    ${({theme:e})=>e.colors.yellow} 49.3%,
    ${({theme:e})=>e.colors.lightGreen} 99.88%
  );
  flex-shrink: 0;
  text-align: right;
  max-width: 760px;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    padding: ${({theme:e})=>e.space.XXS0};
    text-align: center;
  }

  @media (max-width: ${({theme:e})=>e.media.M}px) {
    font-size: ${({theme:e})=>e.font.fontSize.XL}px;
  }

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    font-size: ${({theme:e})=>e.font.fontSize.L}px;
  }
`,Ki=Vt.p`
  color: ${({theme:e})=>e.colors.cardLightGray};
  font-size: ${({theme:e})=>e.font.fontSize.M}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.XS};
  text-align: center;
  flex-shrink: 0;
  max-width: 400px;
  font-style: normal;
  line-height: 47px;

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    font-size: ${({theme:e})=>e.font.fontSize.S}px;
  }
`,Ji=Vt.img`
  flex-shrink: 0;
  user-select: none;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    ${xi}
  }
`,{title:Qi,quote:en}={title:"Modsen Currency Tracker",quote:"Quotes for the dollar and other international currencies."},tn=()=>(0,Kt.jsx)(Xi,{children:(0,Kt.jsxs)(Zi,{children:[(0,Kt.jsxs)(Hi,{children:[(0,Kt.jsx)(Yi,{children:Qi}),(0,Kt.jsx)(Ki,{children:en})]}),(0,Kt.jsx)(Ji,{...qi})]})}),nn=e=>{const t=new Date(e),i=t.getHours(),n=t.getMinutes(),r=i>=12?"PM":"AM";return`${(i%12||12).toString().padStart(2,"0")}:${n.toString().padStart(2,"0")} ${r}`},rn=e=>`${e.getDate().toString().padStart(2,"0")}.${(e.getMonth()+1).toString().padStart(2,"0")}.${e.getFullYear()}`,on=i.p+"8c1d4310ac16104fb235.svg",sn={alt:"Last update circle",src:on,...Oi},an=qt`
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
`,ln=Vt.section`
  ${fi}
  padding: ${({theme:e})=>e.space.XL56}px
    ${({theme:e})=>e.space.XXS}px;
  gap: ${({theme:e})=>e.space.S18}px;
  align-items: center;
  justify-content: center;
`,cn=Vt.img`
  animation: ${an} 2s ease-in-out infinite;
  user-select: none;

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    width: 35px;
    height: 35px;
  }
`,un=Vt.p`
  ${Si}
  color: ${({theme:e})=>e.colors.cardLightGray};
  font-size: ${({theme:e})=>e.font.fontSize.L}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.XS};

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    font-size: ${({theme:e})=>e.font.fontSize.S}px;
  }
`,hn=()=>{const e=(0,ui.lJ)(hi.T.cacheLastUpdateKey);let t=nn((new Date).getTime());return 0!==Object.keys(e).length&&(t=nn(e)),(0,Kt.jsxs)(ln,{children:[(0,Kt.jsx)(cn,{...sn}),(0,Kt.jsxs)(un,{children:["Last updated at"," ",t]})]})};var dn=i(697),pn=i.n(dn);const fn=Vt.section`
  ${mi}
`,mn=Vt.span`
  ${bi}
  color: ${({theme:e})=>e.textColor};
  font-size: ${({theme:e})=>e.font.fontSize.L}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.S};
`,gn=Vt.div`
  ${mi}
  padding-top: ${({theme:e})=>e.space.L40}px;
  gap: ${({theme:e})=>e.space.S17}px;

  a {
    color: ${({theme:e})=>e.colors.gray};
    font-size: ${({theme:e})=>e.font.fontSize.M}px;
    font-weight: ${({theme:e})=>e.font.fontWeight.S};
    line-height: normal;
    font-style: normal;
    text-decoration: none;

    &:hover {
      color: ${({theme:e})=>e.colors.green};
    }
  }
`,_n=({title:e,links:t})=>(0,Kt.jsxs)(fn,{children:[(0,Kt.jsx)(mn,{children:e}),(0,Kt.jsx)(gn,{children:t.map((e=>(0,Kt.jsx)(Qt.rU,{children:e},e)))})]});_n.propTypes={title:pn().string.isRequired,links:pn().array.isRequired};const yn=_n,xn=i.p+"06f4510b7662ed93f20c.svg",vn={alt:"Accordion arrow icon",src:xn,...Ni},bn=Vt.button`
  ${fi}
  justify-content: space-between;
  border: none;
  outline: none;
  padding: ${({theme:e})=>e.space.XS}px 0;
  border-bottom: 1px solid ${({theme:e})=>e.colors.oceanBlue};
  transition: 0.4s;
  background-color: transparent;
`,wn=Vt.span`
  ${fi}
  color: ${({theme:e})=>e.textColor};
  font-size: ${({theme:e})=>e.font.fontSize.M}px;
  font-style: normal;
  font-weight: ${({theme:e})=>e.font.fontWeight.S};
  line-height: 24px;
  letter-spacing: -0.24px;
`,Sn=Vt.img`
  transform: ${({$isOpen:e})=>e?"rotate(180deg)":"rotate(0deg)"};
`,Tn=Vt.div`
  display: ${({$isOpen:e})=>e?"flex":"none"};
  overflow: hidden;
  flex-direction: column;

  a {
    padding-top: ${({theme:e})=>e.space.XXS}px;
    color: ${({theme:e})=>e.colors.gray};
    font-size: ${({theme:e})=>e.font.fontSize.M}px;
    font-weight: ${({theme:e})=>e.font.fontWeight.S};
    line-height: normal;
    font-style: normal;
    text-decoration: none;

    &:hover {
      color: ${({theme:e})=>e.colors.green};
    }
  }
`,En=({title:e,links:t})=>{const[i,r]=(0,n.useState)(!1),o=(0,n.useRef)(null);return(0,Kt.jsxs)(Kt.Fragment,{children:[(0,Kt.jsxs)(bn,{onClick:()=>{r((e=>!e))},children:[(0,Kt.jsx)(wn,{children:e}),(0,Kt.jsx)(Sn,{$isOpen:i,ref:o,...vn})]}),(0,Kt.jsx)(Tn,{$isOpen:i,children:t.map((e=>(0,Kt.jsx)(Qt.rU,{children:e},e)))})]})};En.propTypes={title:pn().string.isRequired,links:pn().array.isRequired};const Cn=En,kn={title:"Modsen Currency Tracker",quote:"Since then, the company has grown organically to. Starsup is the world's largest trading platform, with $12 billion worth of currency trading and 500,000 tickets sold daily to tens of thousands of traders worldwide.",footerSections:[{title:"General",links:["Market","Service"]},{title:"Product",links:["Sparks","Snaps"]},{title:"Community",links:["Ideas","Streams"]}],get copyright(){const e=(new Date).getFullYear();return`Startsup © ${e}-${e+1}, All Rights Reserved`}},Mn={alt:"Application logotype",src:Di,...Bi},An=Vt.footer`
  ${fi}
  justify-content: center;
  align-items: center;
  flex-direction: column;

  @media (max-width: ${({theme:e})=>e.media.S}px) {
    padding: 0 ${({theme:e})=>e.space.L}px;
    align-items: unset;
  }
`,Pn=Vt.section`
  ${gi}
  gap: ${({theme:e})=>e.space.XL105}px;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    gap: ${({theme:e})=>e.space.L35}px;
    flex-direction: column;
  }
`,In=Vt.div`
  ${mi}
  gap: ${({theme:e})=>e.space.M}px;
  max-width: 482px;
`,zn=Vt.div`
  ${fi}
  gap: ${({theme:e})=>e.space.XXS}px;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    justify-content: center;
  }
`,Dn=Vt.img`
  user-select: none;
`,Ln=Vt.h3`
  ${vi}
  font-size: ${({theme:e})=>e.font.fontSize.M}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.L};
  background: linear-gradient(
    90deg,
    ${({theme:e})=>e.colors.darkGreen} 0.18%,
    ${({theme:e})=>e.colors.yellow} 49.3%,
    ${({theme:e})=>e.colors.lightGreen} 99.88%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
`,Rn=Vt.p`
  ${bi}
  color: ${({theme:e})=>e.textColor};
  font-size: ${({theme:e})=>e.font.fontSize.M}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.XS};

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    text-align: justify;
  }

  @media (max-width: ${({theme:e})=>e.media.S}px) {
    ${xi}
  }
`,On=Vt.div`
  ${fi}
  gap: ${({theme:e})=>e.space.XL79}px;

  @media (max-width: ${({theme:e})=>e.media.S}px) {
    ${xi}
  }
`,Bn=Vt.div`
  ${mi}

  @media (min-width: ${({theme:e})=>e.media.S+1}px) {
    ${xi}
  }
`,Fn=Vt.p`
  ${bi}
  color: ${({theme:e})=>e.colors.gray};
  font-family: ${({theme:e})=>e.font.fontFamily.inter};
  font-size: ${({theme:e})=>e.font.fontSize.M}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.S};
  padding-top: ${({theme:e})=>e.space.XL55}px;
  padding-bottom: ${({theme:e})=>e.space.L40}px;
  user-select: none;

  @media (max-width: ${({theme:e})=>e.media.S}px) {
    font-size: ${({theme:e})=>e.font.fontSize.S}px;
    text-align: center;
  }
`,{title:Nn,quote:jn,footerSections:Un,copyright:$n}=kn,Vn=Un.map((e=>(0,Kt.jsx)(yn,{...e},e.title))),Gn=Un.map((e=>(0,Kt.jsx)(Cn,{...e},e.title))),Wn=()=>(0,Kt.jsxs)(An,{children:[(0,Kt.jsxs)(Pn,{children:[(0,Kt.jsxs)(In,{children:[(0,Kt.jsxs)(zn,{children:[(0,Kt.jsx)(Dn,{...Mn}),(0,Kt.jsx)(Ln,{children:Nn})]}),(0,Kt.jsx)(Rn,{children:jn})]}),(0,Kt.jsx)(On,{children:Vn}),(0,Kt.jsx)(Bn,{children:Gn})]}),(0,Kt.jsx)(Fn,{children:$n})]}),qn=qt`
  0%, 100% {
    transform: scale(0.2);
    background-color: ${Zt.darkGreen};
  }
  40% {
    transform: scale(1);
    background-color: ${Zt.yellow};
  }
  50% {
    transform: scale(1);
    background-color: ${Zt.lightGreen};
  }
`,Xn=Vt.div`
  ${fi}
  background-color: ${({theme:e})=>e.backgroundColor};
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  justify-content: center;
  align-items: center;

  .loader {
    div {
      ${yi}
      animation: ${qn} 1.5s ease-in-out infinite;
      margin: ${({theme:e})=>e.space.XXS8}px;
      height: 20px;
      width: 20px;
      border-radius: 50%;
      transform: scale(0);

      &:nth-child(1) {
        animation-delay: 0s;
      }
      &:nth-child(2) {
        animation-delay: 0.2s;
      }
      &:nth-child(3) {
        animation-delay: 0.4s;
      }
      &:nth-child(4) {
        animation-delay: 0.6s;
      }
      &:nth-child(5) {
        animation-delay: 0.8s;
      }
      &:nth-child(6) {
        animation-delay: 1s;
      }
      &:nth-child(7) {
        animation-delay: 1.2s;
      }
    }
  }
`,Zn=Array.from({length:7},((e,t)=>(0,Kt.jsx)("div",{},t))),Hn=n.memo((()=>(0,Kt.jsx)(Xn,{children:(0,Kt.jsx)("div",{className:"loader",children:Zn})}))),Yn={alt:"Close icon",src:i.p+"3979655497792af3381c.svg",...Fi},Kn=jt`
  color: ${({theme:e})=>e.textColor};
`,Jn=Vt.div`
  ${Kn}
  ${fi}
  height: 100vh;
  width: 100vw;
  position: fixed;
  top: 0;
  left: 0;
  justify-content: center;
  align-items: center;
`,Qn=Vt.div`
  ${Kn}
  ${mi}
  background-color: ${({theme:e})=>e.colors.borderGray};
  border: 1px solid ${({theme:e})=>e.colors.darkGray};
  padding: ${({theme:e})=>e.space.XXS}px;
  box-shadow: 0px 0px 13px 0px ${({theme:e})=>e.colors.prodigalGreen};
  width: fit-content;
  height: fit-content;
  position: relative;
  border-radius: 10px;
`,er=Vt.button`
  background: transparent;
  align-self: flex-end;
  cursor: pointer;
  height: 25px;
  width: 25px;
  border: none;
  transition: transform 0.3s;

  &:hover {
    transform: scale(1.15);
  }
`,tr=Vt.img`
  user-select: none;
`,ir=n.memo((({children:e,onClose:t})=>{const i=(0,n.useRef)(null);Mi(i,t);return(0,Kt.jsx)(Jn,{"data-cy":"currency-modal",children:(0,Kt.jsxs)(Qn,{ref:i,children:[(0,Kt.jsx)(er,{"data-cy":"close-modal-button",onClick:()=>{t()},children:(0,Kt.jsx)(tr,{...Yn})}),e]})})}));ir.propTypes={children:pn().node.isRequired,onClose:pn().func.isRequired};const nr=ir,rr=Wt`
    * {
        margin: ${({theme:e})=>e.space.XXS0};
        padding: ${({theme:e})=>e.space.XXS0};
        box-sizing: border-box;
        font-family: ${({theme:e})=>e.font.fontFamily.popins};
    }

    body {
      background-color: ${({theme:e})=>e.backgroundColor};
    }
`,or=Wt`
  body {
    overflow: hidden;
  }
`,sr=Vt.div`
  ${mi}
  gap: ${({theme:e})=>e.space.XXS}px;
  align-items: center;
  justify-content: center;
  height: 100vh;
  font-weight: bolder;

  a {
    color: ${({theme:e})=>e.colors.green};
  }
`,ar=Vt.h1`
  background: linear-gradient(
    90deg,
    ${({theme:e})=>e.colors.darkGreen} 0.18%,
    ${({theme:e})=>e.colors.yellow} 49.3%,
    ${({theme:e})=>e.colors.lightGreen} 99.88%
  );
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
`,lr=Vt.p`
  color: ${({theme:e})=>e.colors.red};
  max-width: 800px;
  word-wrap: break-word;
`,cr=Vt.p`
  color: ${({theme:e})=>e.colors.green};
  font-size: ${({theme:e})=>e.font.fontSize.L}px;
`;class ur extends n.Component{state={hasError:!1,error:null,errorInfo:null};static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}render(){const{hasError:e,error:t}=this.state;return e?(0,Kt.jsxs)(sr,{children:[(0,Kt.jsx)(rr,{}),(0,Kt.jsx)(ar,{children:"An error has occured"}),(0,Kt.jsx)(lr,{children:t&&t.toString()}),(0,Kt.jsx)(cr,{children:"(╯°□°）╯︵ ┻━┻"}),(0,Kt.jsx)(cr,{children:errorInfo&&errorInfo.componentStack})]}):this.props.children}}ur.propTypes={children:pn().node.isRequired};const hr=ur,dr=qt`
    0%,
    100% {
        transform: translate(0, 0);
    }
    25% {
        transform: translate(-10px, -10px);
    }
    50% {
        transform: translate(10px, 10px);
    }
    75% {
        transform: translate(-10px, 10px);
    }
`,pr=Vt.main`
  ${fi}
  gap: ${({theme:e})=>e.space.XXS}px;
  min-height: 100vh;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  a {
    color: ${({theme:e})=>e.colors.lightGreen};
    border: 1px solid ${({theme:e})=>e.colors.darkGreen};
    font-size: ${({theme:e})=>e.font.fontSize.XS}px;
    font-weight: ${({theme:e})=>e.font.fontWeight.XXS};
    padding: ${({theme:e})=>e.space.XS12}px;
    ${({theme:e})=>e.space.S24}px;
    box-shadow: 0px 7px 0px -2px ${({theme:e})=>e.colors.darkGreen};
    margin-top: ${({theme:e})=>e.space.XS}px;
    transition: all 0.3s ease-in-out;
    text-decoration: none;
    border-radius: 15px;

    &:hover {
      box-shadow: none;
      background-color: ${({theme:e})=>e.colors.darkGreen};
      color: ${({theme:e})=>e.textColor};
    }
  }
`,fr=Vt.div`
  ${fi}
  gap: ${({theme:e})=>e.space.XXS2}px;
  justify-content: center;
`,mr=Vt.div`
  background: linear-gradient(
    35deg,
    ${({theme:e})=>e.colors.darkGreen} 0.18%,
    ${({theme:e})=>e.colors.yellow} 49.3%,
    ${({theme:e})=>e.colors.lightGreen} 99.88%
  );
  border-radius: 50%;
  display: grid;
  width: 80px;
  height: 80px;
  place-items: center;
`,gr=Vt.div`
  background-color: ${({theme:e})=>e.backgroundColor};
  animation: ${dr} 2s infinite ease-in-out;
  width: 30px;
  border-radius: 50%;
  height: 30px;
  transform-origin: center;
`,_r=Vt.h1`
  font-size: ${({theme:e})=>e.font.fontSize.XL}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.M};
  background: linear-gradient(
    90deg,
    ${({theme:e})=>e.colors.green} 0.18%,
    ${({theme:e})=>e.colors.yellow} 49.3%,
    ${({theme:e})=>e.colors.lightGreen} 99.88%
  );
  text-align: center;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
`,yr=Vt.p`
  margin-top: ${({theme:e})=>e.space.XXS}px;
  font-size: ${({theme:e})=>e.font.fontSize.L}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.XXS};
  color: ${({theme:e})=>e.colors.red};
`,xr=()=>(0,Kt.jsxs)(Kt.Fragment,{children:[(0,Kt.jsx)(rr,{}),(0,Kt.jsxs)(pr,{children:[(0,Kt.jsxs)(fr,{children:[(0,Kt.jsx)(mr,{children:(0,Kt.jsx)(gr,{})}),(0,Kt.jsx)(mr,{children:(0,Kt.jsx)(gr,{})})]}),(0,Kt.jsx)(_r,{children:"Looks Like You're Lost"}),(0,Kt.jsx)(yr,{children:"404 Error"}),(0,Kt.jsx)(Qt.rU,{to:ei,children:"Back To Home"})]})]}),vr=i.p+"7568973855fa351b900e.svg",br=i.p+"aa6fa5b7d6a096597acf.svg",wr=i.p+"15f8f7ed3ce26d810c1f.svg",Sr=i.p+"25c52698d8fc1872869c.svg",Tr=i.p+"8426b63f9741d9af88c4.svg",Er=i.p+"a67a313cdb55c49ce292.svg",Cr=i.p+"ddcbe6e6306680d862e1.svg",kr=i.p+"8f5640cec377a4428a07.svg",Mr=i.p+"85ecbdf958dc0db5bb0d.svg",Ar=i.p+"ea6742e4e4709cfe2a29.svg",Pr=i.p+"8b0fa5ad758b963b4720.svg",Ir={id:"USD",imgPath:wr,title:"Commercial Dollar"},zr=[{imgPath:vr,title:"Bovespa Index",rateValue:"0.15%"},{imgPath:br,title:"IFIX",rateValue:"0.15%"}],Dr=[{id:"USD",imgPath:wr,title:"Commercial Dollar"},{id:"ARS",imgPath:Sr,title:"Argentine Peso"},{id:"CAD",imgPath:Tr,title:"Canadian Dollar"},{id:"JPY",imgPath:Er,title:"Yen"},{id:"AUD",imgPath:Cr,title:"Australian Dollar"},{id:"CNY",imgPath:kr,title:"Yuan"},{id:"EUR",imgPath:Mr,title:"Euro"},{id:"BTC",imgPath:Ar,title:"Bitcoin"},{id:"LBP",imgPath:Pr,title:"Libra"}],Lr=i.p+"fe1b2f9d315e41ace5cb.svg",Rr={alt:"Search icon",src:Lr,...Fi},Or=Vt.div`
  position: relative;
  max-width: 450px;
  width: 100%;

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    max-width: 350px;
  }
`,Br=Vt.div`
  ${gi}
  height: 65px;
  border-radius: 5px;
  background-color: ${({theme:e})=>e.colors.darkBlue};
  margin-top: ${({theme:e})=>e.space.M}px;
  margin-bottom: ${({theme:e})=>e.space.XL80}px;
  gap: ${({theme:e})=>e.space.S}px;
`,Fr=Vt.input`
  height: 65px;
  width: 100%;
  padding-left: ${({theme:e})=>e.space.S}px;
  font-size: ${({theme:e})=>e.font.fontSize.XS}px;
  font-style: normal;
  font-weight: ${({theme:e})=>e.font.fontWeight.S};
  color: ${({theme:e})=>e.colors.lightGray};
  background-color: transparent;
  outline: none;
  border: none;
`,Nr=Vt.img`
  user-select: none;
  margin-right: ${({theme:e})=>e.space.S}px;
  align-self: center;
`,jr=Vt.ul`
  border: 1px solid ${({theme:e})=>e.colors.darkGray};
  width: 100%;
  position: absolute;
  top: 55%;
  left: 50%;
  transform: translateX(-50%);
  list-style: none;
  overflow-y: auto;
  border-radius: 5px;
  z-index: 1;

  &::-webkit-scrollbar {
    width: 4px;
  }

  &::-webkit-scrollbar-track {
    background: ${({theme:e})=>e.colors.borderGray};
    border-right: 1px solid ${({theme:e})=>e.colors.darkGray};
    border-bottom: 1px solid ${({theme:e})=>e.colors.darkGray};
  }

  &::-webkit-scrollbar-thumb {
    background-color: ${({theme:e})=>e.colors.darkGray};

    &:hover {
      background-color: ${({theme:e})=>e.colors.purpuleBlue};
    }
  }
`,Ur=Vt.li`
  ${fi}
  padding: ${({theme:e})=>e.space.XXS}px ${({theme:e})=>e.space.M}px;
  background-color: ${({theme:e})=>e.colors.darkBlue};
  border-bottom: 1px solid ${({theme:e})=>e.colors.darkGray};
  gap: ${({theme:e})=>e.space.S}px;
  color: ${({theme:e})=>e.colors.lightGray};
  cursor: pointer;
  align-items: center;

  &:hover {
    background-color: ${({theme:e})=>e.colors.purpuleBlue};
  }
`;class $r extends n.PureComponent{state={searchInputValue:""};handleInputCurrenciesSearch=e=>{const t=e.target.value.toLowerCase(),{currencies:i,setSearchCurrencies:n}=this.props;let r=[];""!==t.trim()&&(r=i.filter((e=>e.id.toLowerCase().includes(t)||e.title.toLowerCase().includes(t)))),n(r),this.setState({searchInputValue:e.target.value})};handleSearchCurrencyClick=e=>()=>{this.props.onCurrencySelection(e),this.setState({searchInputValue:""})};render(){const{searchCurrencies:e}=this.props,{searchInputValue:t}=this.state;return(0,Kt.jsxs)(Or,{children:[(0,Kt.jsxs)(Br,{children:[(0,Kt.jsx)(Fr,{placeholder:"Currency search...",value:t,onChange:this.handleInputCurrenciesSearch}),(0,Kt.jsx)(Nr,{...Rr})]}),t.length>0&&(0,Kt.jsx)(jr,{children:0!==e.length?e.map((({id:e,title:t})=>(0,Kt.jsxs)(Ur,{onClick:this.handleSearchCurrencyClick(e),children:[t," (",e,")"]},e))):(0,Kt.jsx)(Ur,{children:"Not found"})})]})}}$r.propTypes={currencies:pn().array.isRequired,setSearchCurrencies:pn().func.isRequired,searchCurrencies:pn().array.isRequired,onCurrencySelection:pn().func.isRequired};const Vr=n.memo($r);var Gr=i(158),Wr=i.n(Gr);const qr={center:[23.799660434222,53.67184676224526],style:"mapbox://styles/mapbox/streets-v11",zoom:10,attributionControl:!1},Xr=[{name:"Белагропромбанк",latitude:53.67184676224526,longitude:23.799660434222,currencies:["USD","EUR","ARS"]},{name:"Банк РРБ",latitude:53.6576601234156,longitude:23.78070085868956,currencies:["ARS","CAD"]},{name:"Беларусбанк",latitude:53.66491803830769,longitude:23.835104412134847,currencies:["CAD","BTC"]},{name:"МТБанк",latitude:53.680760142911986,longitude:23.841330712035308,currencies:["JPY","ARS"]},{name:"Белорусский народный банк",latitude:53.679430118964966,longitude:23.83459406189011,currencies:["AUD","EUR","CNY"]},{name:"МТБанк",latitude:53.672085532044704,longitude:23.86663701372747,currencies:["CNY","LBP"]},{name:"Белагропромбанк",latitude:53.648873819694145,longitude:23.83963952023741,currencies:["EUR","ARS"]},{name:"Беларусбанк",latitude:53.68830165840084,longitude:23.848723791113333,currencies:["BTC","JPY"]},{name:"Технобанк",latitude:53.70256399193914,longitude:23.833719433060732,currencies:["LBP","AUD"]},{name:"Банк Решение",latitude:53.69151518178308,longitude:23.835560815292048,currencies:["LBP","EUR"]},{name:"Дримкас бел",latitude:53.672332086702816,longitude:23.809766522992078,currencies:["BTC","CNY","JPY"]},{name:"Белинвестбанк",latitude:53.67156938536866,longitude:23.808908216180274,currencies:["EUR","BTC"]},{name:"Банк БелВЭБ",latitude:53.679972709293956,longitude:23.83099115310157,currencies:["CNY","LBP","EUR"]},{name:"Paritetbank",latitude:53.67742908406812,longitude:23.828140251972695,currencies:["AUD","LBP","CNY"]},{name:"Альфа-Банк",latitude:53.68298279511608,longitude:23.833206120753676,currencies:["JPY","BTC"]},{name:"Приорбанк",latitude:53.674349288141656,longitude:23.828222287169446,currencies:["CAD","EUR"]},{name:"Банк Дабрабыт",latitude:53.675709632241606,longitude:23.84162857547961,currencies:["ARS","CNY"]},{name:"Банк ВТБ",latitude:53.64480544846846,longitude:23.847179488440403,currencies:["USD","AUD","EUR"]},{name:"Приорбанк",latitude:53.65013681482404,longitude:23.85448209352428,currencies:["USD","JPY","ARS","BTC"]},{name:"Белорусский народный банк",latitude:53.6781846004123,longitude:23.83463147826866,currencies:["ARS","JPY"]}],Zr=Vt.div`
  margin-bottom: ${({theme:e})=>e.space.XXL200}px;
  width: 100%;
  height: 460px;
`;class Hr extends n.PureComponent{mapContainer=n.createRef();markers=[];componentDidMount(){Wr().accessToken=hi.T.mapboxAccessToken,this.map=new(Wr().Map)({container:this.mapContainer.current,...qr}),this.map.addControl(new(Wr().NavigationControl))}componentWillUnmount(){this.map&&this.map.remove()}componentDidUpdate(e){e.banksCoords!==this.props.banksCoords&&(this.removeMarkers(),this.addMarkers())}addMarkers(){const{banksCoords:e}=this.props;e.forEach((e=>{const t=(new(Wr().Marker)).setLngLat([e.longitude,e.latitude]).setPopup((new(Wr().Popup)).setHTML(`<h4>${e.name}</h4>`)).addTo(this.map);this.markers.push(t)}))}removeMarkers(){this.markers.forEach((e=>{e.remove()})),this.markers=[]}render(){return(0,Kt.jsx)(Zr,{ref:this.mapContainer})}}Hr.propTypes={banksCoords:pn().array};const Yr=Hr,Kr=Vt.main`
  ${mi}
  align-items: center;
`,Jr=Vt.h2`
  ${vi}
  color: ${({theme:e})=>e.textColor};
  font-size: ${({theme:e})=>e.font.fontSize.L}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.S};
  margin-top: ${({theme:e})=>e.space.XXL110}px;
  text-align: center;

  @media (max-width: ${({theme:e})=>e.media.S}px) {
    padding: 0 ${({theme:e})=>e.space.S}px;
  }
`;class Qr extends n.PureComponent{state={currencies:[],searchCurrencies:[],banksCoords:[]};componentDidMount(){const e=Dr.map((e=>({id:e.id,title:e.title})));this.setState({currencies:e})}setSearchCurrencies=e=>{this.setState({searchCurrencies:e})};handleCurrencySelection=e=>{const t=Xr.filter((t=>t.currencies.includes(e)));this.setState({banksCoords:t})};render(){const{currencies:e,searchCurrencies:t,banksCoords:i}=this.state;return(0,Kt.jsxs)(Kr,{children:[(0,Kt.jsx)(Jr,{children:"Search currency in the bank"}),(0,Kt.jsx)(Vr,{currencies:e,searchCurrencies:t,setSearchCurrencies:this.setSearchCurrencies,onCurrencySelection:this.handleCurrencySelection}),(0,Kt.jsx)(Yr,{banksCoords:i})]})}}const eo=Qr,to=Vt.form`
  ${mi}
  color: ${({theme:e})=>e.textColor};
  padding-top: ${({theme:e})=>e.space.XXS}px;
`,io=Vt.label`
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  background: transparent;
`,no=Vt.div`
  ${fi}
  color: ${({theme:e})=>e.textColor};
  border-bottom: 1px solid ${({theme:e})=>e.colors.darkGray};
  margin-bottom: ${({theme:e})=>e.space.XS}px;
  height: 35px;
  justify-content: space-between;
  align-items: center;
`,ro=Vt.input`
  color: ${({theme:e})=>e.textColor};
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  background-color: transparent;
  height: 30px;
  border: none;
  outline: none;
`,oo=Vt.button`
  background-color: ${({theme:e})=>e.colors.darkGreen};
  color: ${({theme:e})=>e.textColor};
  margin: ${({theme:e})=>e.space.S}px 0;
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  height: 50px;
  border-radius: 25px;
  border: none;
  cursor: pointer;

  &:hover {
    background-color: ${({theme:e})=>e.colors.yellow};
  }
`,so=({label:e,type:t})=>(0,Kt.jsxs)(Kt.Fragment,{children:[(0,Kt.jsx)(io,{children:e}),(0,Kt.jsx)(no,{children:(0,Kt.jsx)(ro,{type:t})})]});so.propTypes={label:pn().string.isRequired,type:pn().string};const ao=()=>(0,Kt.jsxs)(to,{children:[(0,Kt.jsx)(so,{label:"Full Name"}),(0,Kt.jsx)(so,{label:"E-mail",type:"Email"}),(0,Kt.jsx)(so,{label:"Message"}),(0,Kt.jsx)(oo,{children:"Contact Us"})]}),lo="Contact us",co="Contact",uo="Email:",ho="Phone:",po="Based in",fo="Stefana Okrzei 1a/10 Warsaw, Poland",mo="contact@modsen-software.com",go="+48501157180",_o=Vt.main`
  ${mi}
  align-items: center;
`,yo=Vt.h2`
  ${vi}
  font-size: ${({theme:e})=>e.font.fontSize.XL}px;
  padding: ${({theme:e})=>e.space.L}px 0;
  font-weight: ${({theme:e})=>e.font.fontWeight.L};
  background: linear-gradient(
    90deg,
    ${({theme:e})=>e.colors.darkGreen} 0.18%,
    ${({theme:e})=>e.colors.yellow} 49.3%,
    ${({theme:e})=>e.colors.lightGreen} 99.88%
  );
  text-align: center;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
`,xo=Vt.div`
  ${fi}
  border: 1px solid ${({theme:e})=>e.textColor};
  margin-left: ${({theme:e})=>e.space.S}px;
  margin-bottom: ${({theme:e})=>e.space.XXL170}px;
  margin-right: ${({theme:e})=>e.space.S}px;
  padding: ${({theme:e})=>e.space.L}px;
  gap: ${({theme:e})=>e.space.XL}px;
  justify-content: space-between;
  max-width: 800px;
  height: fit-content;

  @media (max-width: ${({theme:e})=>e.media.L}px) {
    flex-direction: column;
  }
`,vo=Vt.div`
  ${mi}

  @media (max-width: ${({theme:e})=>e.media.L}px) {
    flex-direction: column;
    order: -1;
  }
`,bo=Vt.h3`
  ${vi}
  font-size: ${({theme:e})=>e.font.fontSize.M}px;
  padding-top: ${({theme:e})=>e.space.XXS}px;
  padding-bottom: ${({theme:e})=>e.space.XS}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.L};
  color: ${({theme:e})=>e.textColor};
  text-align: left;
`,wo=Vt.div`
  ${fi}
  gap: ${({theme:e})=>e.space.XXS}px;
`,So=Vt.a`
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  ${vi}
  color: ${({theme:e})=>e.colors.gray};
  font-weight: ${({theme:e})=>e.font.fontWeight.S};
  text-align: left;
  text-decoration: none;

  &:hover {
    color: ${({theme:e})=>e.colors.green};
  }
`,To=Vt.p`
  ${vi}
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  color: ${({theme:e})=>e.colors.gray};
  text-align: left;
`,Eo=()=>(0,Kt.jsxs)(_o,{children:[(0,Kt.jsx)(yo,{children:lo}),(0,Kt.jsxs)(xo,{children:[(0,Kt.jsx)(ao,{}),(0,Kt.jsxs)(vo,{children:[(0,Kt.jsx)(bo,{children:co}),(0,Kt.jsxs)(wo,{children:[(0,Kt.jsx)(To,{children:uo}),(0,Kt.jsx)(So,{href:`mailto:${mo}`,children:mo})]}),(0,Kt.jsxs)(wo,{children:[(0,Kt.jsx)(To,{children:ho}),(0,Kt.jsx)(So,{href:`tel:${go}`,children:go})]}),(0,Kt.jsx)(bo,{children:po}),(0,Kt.jsx)(To,{children:fo})]})]})]});function Co(e,t){return function(){return e.apply(t,arguments)}}const{toString:ko}=Object.prototype,{getPrototypeOf:Mo}=Object,Ao=(Po=Object.create(null),e=>{const t=ko.call(e);return Po[t]||(Po[t]=t.slice(8,-1).toLowerCase())});var Po;const Io=e=>(e=e.toLowerCase(),t=>Ao(t)===e),zo=e=>t=>typeof t===e,{isArray:Do}=Array,Lo=zo("undefined");const Ro=Io("ArrayBuffer");const Oo=zo("string"),Bo=zo("function"),Fo=zo("number"),No=e=>null!==e&&"object"==typeof e,jo=e=>{if("object"!==Ao(e))return!1;const t=Mo(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},Uo=Io("Date"),$o=Io("File"),Vo=Io("Blob"),Go=Io("FileList"),Wo=Io("URLSearchParams");function qo(e,t,{allOwnKeys:i=!1}={}){if(null==e)return;let n,r;if("object"!=typeof e&&(e=[e]),Do(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let s;for(n=0;n<o;n++)s=r[n],t.call(null,e[s],s,e)}}function Xo(e,t){t=t.toLowerCase();const i=Object.keys(e);let n,r=i.length;for(;r-- >0;)if(n=i[r],t===n.toLowerCase())return n;return null}const Zo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Ho=e=>!Lo(e)&&e!==Zo;const Yo=(Ko="undefined"!=typeof Uint8Array&&Mo(Uint8Array),e=>Ko&&e instanceof Ko);var Ko;const Jo=Io("HTMLFormElement"),Qo=(({hasOwnProperty:e})=>(t,i)=>e.call(t,i))(Object.prototype),es=Io("RegExp"),ts=(e,t)=>{const i=Object.getOwnPropertyDescriptors(e),n={};qo(i,((i,r)=>{let o;!1!==(o=t(i,r,e))&&(n[r]=o||i)})),Object.defineProperties(e,n)},is="abcdefghijklmnopqrstuvwxyz",ns="0123456789",rs={DIGIT:ns,ALPHA:is,ALPHA_DIGIT:is+is.toUpperCase()+ns};const os=Io("AsyncFunction"),ss={isArray:Do,isArrayBuffer:Ro,isBuffer:function(e){return null!==e&&!Lo(e)&&null!==e.constructor&&!Lo(e.constructor)&&Bo(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||Bo(e.append)&&("formdata"===(t=Ao(e))||"object"===t&&Bo(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ro(e.buffer),t},isString:Oo,isNumber:Fo,isBoolean:e=>!0===e||!1===e,isObject:No,isPlainObject:jo,isUndefined:Lo,isDate:Uo,isFile:$o,isBlob:Vo,isRegExp:es,isFunction:Bo,isStream:e=>No(e)&&Bo(e.pipe),isURLSearchParams:Wo,isTypedArray:Yo,isFileList:Go,forEach:qo,merge:function e(){const{caseless:t}=Ho(this)&&this||{},i={},n=(n,r)=>{const o=t&&Xo(i,r)||r;jo(i[o])&&jo(n)?i[o]=e(i[o],n):jo(n)?i[o]=e({},n):Do(n)?i[o]=n.slice():i[o]=n};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&qo(arguments[e],n);return i},extend:(e,t,i,{allOwnKeys:n}={})=>(qo(t,((t,n)=>{i&&Bo(t)?e[n]=Co(t,i):e[n]=t}),{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,i,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,n)=>{let r,o,s;const a={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),o=r.length;o-- >0;)s=r[o],n&&!n(s,e,t)||a[s]||(t[s]=e[s],a[s]=!0);e=!1!==i&&Mo(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:Ao,kindOfTest:Io,endsWith:(e,t,i)=>{e=String(e),(void 0===i||i>e.length)&&(i=e.length),i-=t.length;const n=e.indexOf(t,i);return-1!==n&&n===i},toArray:e=>{if(!e)return null;if(Do(e))return e;let t=e.length;if(!Fo(t))return null;const i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{const i=(e&&e[Symbol.iterator]).call(e);let n;for(;(n=i.next())&&!n.done;){const i=n.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let i;const n=[];for(;null!==(i=e.exec(t));)n.push(i);return n},isHTMLForm:Jo,hasOwnProperty:Qo,hasOwnProp:Qo,reduceDescriptors:ts,freezeMethods:e=>{ts(e,((t,i)=>{if(Bo(e)&&-1!==["arguments","caller","callee"].indexOf(i))return!1;const n=e[i];Bo(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))}))},toObjectSet:(e,t)=>{const i={},n=e=>{e.forEach((e=>{i[e]=!0}))};return Do(e)?n(e):n(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,i){return t.toUpperCase()+i})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:Xo,global:Zo,isContextDefined:Ho,ALPHABET:rs,generateString:(e=16,t=rs.ALPHA_DIGIT)=>{let i="";const{length:n}=t;for(;e--;)i+=t[Math.random()*n|0];return i},isSpecCompliantForm:function(e){return!!(e&&Bo(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),i=(e,n)=>{if(No(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const r=Do(e)?[]:{};return qo(e,((e,t)=>{const o=i(e,n+1);!Lo(o)&&(r[t]=o)})),t[n]=void 0,r}}return e};return i(e,0)},isAsyncFn:os,isThenable:e=>e&&(No(e)||Bo(e))&&Bo(e.then)&&Bo(e.catch)};function as(e,t,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r)}ss.inherits(as,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ss.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ls=as.prototype,cs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{cs[e]={value:e}})),Object.defineProperties(as,cs),Object.defineProperty(ls,"isAxiosError",{value:!0}),as.from=(e,t,i,n,r,o)=>{const s=Object.create(ls);return ss.toFlatObject(e,s,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),as.call(s,e.message,t,i,n,r),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const us=as;function hs(e){return ss.isPlainObject(e)||ss.isArray(e)}function ds(e){return ss.endsWith(e,"[]")?e.slice(0,-2):e}function ps(e,t,i){return e?e.concat(t).map((function(e,t){return e=ds(e),!i&&t?"["+e+"]":e})).join(i?".":""):t}const fs=ss.toFlatObject(ss,{},null,(function(e){return/^is[A-Z]/.test(e)}));const ms=function(e,t,i){if(!ss.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(i=ss.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!ss.isUndefined(t[e])}))).metaTokens,r=i.visitor||c,o=i.dots,s=i.indexes,a=(i.Blob||"undefined"!=typeof Blob&&Blob)&&ss.isSpecCompliantForm(t);if(!ss.isFunction(r))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(ss.isDate(e))return e.toISOString();if(!a&&ss.isBlob(e))throw new us("Blob is not supported. Use a Buffer instead.");return ss.isArrayBuffer(e)||ss.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,i,r){let a=e;if(e&&!r&&"object"==typeof e)if(ss.endsWith(i,"{}"))i=n?i:i.slice(0,-2),e=JSON.stringify(e);else if(ss.isArray(e)&&function(e){return ss.isArray(e)&&!e.some(hs)}(e)||(ss.isFileList(e)||ss.endsWith(i,"[]"))&&(a=ss.toArray(e)))return i=ds(i),a.forEach((function(e,n){!ss.isUndefined(e)&&null!==e&&t.append(!0===s?ps([i],n,o):null===s?i:i+"[]",l(e))})),!1;return!!hs(e)||(t.append(ps(r,i,o),l(e)),!1)}const u=[],h=Object.assign(fs,{defaultVisitor:c,convertValue:l,isVisitable:hs});if(!ss.isObject(e))throw new TypeError("data must be an object");return function e(i,n){if(!ss.isUndefined(i)){if(-1!==u.indexOf(i))throw Error("Circular reference detected in "+n.join("."));u.push(i),ss.forEach(i,(function(i,o){!0===(!(ss.isUndefined(i)||null===i)&&r.call(t,i,ss.isString(o)?o.trim():o,n,h))&&e(i,n?n.concat(o):[o])})),u.pop()}}(e),t};function gs(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function _s(e,t){this._pairs=[],e&&ms(e,this,t)}const ys=_s.prototype;ys.append=function(e,t){this._pairs.push([e,t])},ys.toString=function(e){const t=e?function(t){return e.call(this,t,gs)}:gs;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const xs=_s;function vs(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bs(e,t,i){if(!t)return e;const n=i&&i.encode||vs,r=i&&i.serialize;let o;if(o=r?r(t,i):ss.isURLSearchParams(t)?t.toString():new xs(t,i).toString(n),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}const ws=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ss.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Ss={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ts={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:xs,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};const Es=function(e){function t(e,i,n,r){let o=e[r++];const s=Number.isFinite(+o),a=r>=e.length;if(o=!o&&ss.isArray(n)?n.length:o,a)return ss.hasOwnProp(n,o)?n[o]=[n[o],i]:n[o]=i,!s;n[o]&&ss.isObject(n[o])||(n[o]=[]);return t(e,i,n[o],r)&&ss.isArray(n[o])&&(n[o]=function(e){const t={},i=Object.keys(e);let n;const r=i.length;let o;for(n=0;n<r;n++)o=i[n],t[o]=e[o];return t}(n[o])),!s}if(ss.isFormData(e)&&ss.isFunction(e.entries)){const i={};return ss.forEachEntry(e,((e,n)=>{t(function(e){return ss.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),n,i,0)})),i}return null};const Cs={transitional:Ss,adapter:Ts.isNode?"http":"xhr",transformRequest:[function(e,t){const i=t.getContentType()||"",n=i.indexOf("application/json")>-1,r=ss.isObject(e);r&&ss.isHTMLForm(e)&&(e=new FormData(e));if(ss.isFormData(e))return n&&n?JSON.stringify(Es(e)):e;if(ss.isArrayBuffer(e)||ss.isBuffer(e)||ss.isStream(e)||ss.isFile(e)||ss.isBlob(e))return e;if(ss.isArrayBufferView(e))return e.buffer;if(ss.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(r){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ms(e,new Ts.classes.URLSearchParams,Object.assign({visitor:function(e,t,i,n){return Ts.isNode&&ss.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=ss.isFileList(e))||i.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ms(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||n?(t.setContentType("application/json",!1),function(e,t,i){if(ss.isString(e))try{return(t||JSON.parse)(e),ss.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(i||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Cs.transitional,i=t&&t.forcedJSONParsing,n="json"===this.responseType;if(e&&ss.isString(e)&&(i&&!this.responseType||n)){const i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw us.from(e,us.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ts.classes.FormData,Blob:Ts.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ss.forEach(["delete","get","head","post","put","patch"],(e=>{Cs.headers[e]={}}));const ks=Cs,Ms=ss.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),As=Symbol("internals");function Ps(e){return e&&String(e).trim().toLowerCase()}function Is(e){return!1===e||null==e?e:ss.isArray(e)?e.map(Is):String(e)}function zs(e,t,i,n,r){return ss.isFunction(n)?n.call(this,t,i):(r&&(t=i),ss.isString(t)?ss.isString(n)?-1!==t.indexOf(n):ss.isRegExp(n)?n.test(t):void 0:void 0)}class Ds{constructor(e){e&&this.set(e)}set(e,t,i){const n=this;function r(e,t,i){const r=Ps(t);if(!r)throw new Error("header name must be a non-empty string");const o=ss.findKey(n,r);(!o||void 0===n[o]||!0===i||void 0===i&&!1!==n[o])&&(n[o||t]=Is(e))}const o=(e,t)=>ss.forEach(e,((e,i)=>r(e,i,t)));return ss.isPlainObject(e)||e instanceof this.constructor?o(e,t):ss.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?o((e=>{const t={};let i,n,r;return e&&e.split("\n").forEach((function(e){r=e.indexOf(":"),i=e.substring(0,r).trim().toLowerCase(),n=e.substring(r+1).trim(),!i||t[i]&&Ms[i]||("set-cookie"===i?t[i]?t[i].push(n):t[i]=[n]:t[i]=t[i]?t[i]+", "+n:n)})),t})(e),t):null!=e&&r(t,e,i),this}get(e,t){if(e=Ps(e)){const i=ss.findKey(this,e);if(i){const e=this[i];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(e);)t[n[1]]=n[2];return t}(e);if(ss.isFunction(t))return t.call(this,e,i);if(ss.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ps(e)){const i=ss.findKey(this,e);return!(!i||void 0===this[i]||t&&!zs(0,this[i],i,t))}return!1}delete(e,t){const i=this;let n=!1;function r(e){if(e=Ps(e)){const r=ss.findKey(i,e);!r||t&&!zs(0,i[r],r,t)||(delete i[r],n=!0)}}return ss.isArray(e)?e.forEach(r):r(e),n}clear(e){const t=Object.keys(this);let i=t.length,n=!1;for(;i--;){const r=t[i];e&&!zs(0,this[r],r,e,!0)||(delete this[r],n=!0)}return n}normalize(e){const t=this,i={};return ss.forEach(this,((n,r)=>{const o=ss.findKey(i,r);if(o)return t[o]=Is(n),void delete t[r];const s=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,i)=>t.toUpperCase()+i))}(r):String(r).trim();s!==r&&delete t[r],t[s]=Is(n),i[s]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return ss.forEach(this,((i,n)=>{null!=i&&!1!==i&&(t[n]=e&&ss.isArray(i)?i.join(", "):i)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach((e=>i.set(e))),i}static accessor(e){const t=(this[As]=this[As]={accessors:{}}).accessors,i=this.prototype;function n(e){const n=Ps(e);t[n]||(!function(e,t){const i=ss.toCamelCase(" "+t);["get","set","has"].forEach((n=>{Object.defineProperty(e,n+i,{value:function(e,i,r){return this[n].call(this,t,e,i,r)},configurable:!0})}))}(i,e),t[n]=!0)}return ss.isArray(e)?e.forEach(n):n(e),this}}Ds.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ss.reduceDescriptors(Ds.prototype,(({value:e},t)=>{let i=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[i]=e}}})),ss.freezeMethods(Ds);const Ls=Ds;function Rs(e,t){const i=this||ks,n=t||i,r=Ls.from(n.headers);let o=n.data;return ss.forEach(e,(function(e){o=e.call(i,o,r.normalize(),t?t.status:void 0)})),r.normalize(),o}function Os(e){return!(!e||!e.__CANCEL__)}function Bs(e,t,i){us.call(this,null==e?"canceled":e,us.ERR_CANCELED,t,i),this.name="CanceledError"}ss.inherits(Bs,us,{__CANCEL__:!0});const Fs=Bs;const Ns=Ts.isStandardBrowserEnv?{write:function(e,t,i,n,r,o){const s=[];s.push(e+"="+encodeURIComponent(t)),ss.isNumber(i)&&s.push("expires="+new Date(i).toGMTString()),ss.isString(n)&&s.push("path="+n),ss.isString(r)&&s.push("domain="+r),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function js(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Us=Ts.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let i;function n(i){let n=i;return e&&(t.setAttribute("href",n),n=t.href),t.setAttribute("href",n),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return i=n(window.location.href),function(e){const t=ss.isString(e)?n(e):e;return t.protocol===i.protocol&&t.host===i.host}}():function(){return!0};const $s=function(e,t){e=e||10;const i=new Array(e),n=new Array(e);let r,o=0,s=0;return t=void 0!==t?t:1e3,function(a){const l=Date.now(),c=n[s];r||(r=l),i[o]=a,n[o]=l;let u=s,h=0;for(;u!==o;)h+=i[u++],u%=e;if(o=(o+1)%e,o===s&&(s=(s+1)%e),l-r<t)return;const d=c&&l-c;return d?Math.round(1e3*h/d):void 0}};function Vs(e,t){let i=0;const n=$s(50,250);return r=>{const o=r.loaded,s=r.lengthComputable?r.total:void 0,a=o-i,l=n(a);i=o;const c={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:l||void 0,estimated:l&&s&&o<=s?(s-o)/l:void 0,event:r};c[t?"download":"upload"]=!0,e(c)}}const Gs="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,i){let n=e.data;const r=Ls.from(e.headers).normalize(),o=e.responseType;let s;function a(){e.cancelToken&&e.cancelToken.unsubscribe(s),e.signal&&e.signal.removeEventListener("abort",s)}ss.isFormData(n)&&(Ts.isStandardBrowserEnv||Ts.isStandardBrowserWebWorkerEnv?r.setContentType(!1):r.setContentType("multipart/form-data;",!1));let l=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",i=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";r.set("Authorization","Basic "+btoa(t+":"+i))}const c=js(e.baseURL,e.url);function u(){if(!l)return;const n=Ls.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders());!function(e,t,i){const n=i.config.validateStatus;i.status&&n&&!n(i.status)?t(new us("Request failed with status code "+i.status,[us.ERR_BAD_REQUEST,us.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}((function(e){t(e),a()}),(function(e){i(e),a()}),{data:o&&"text"!==o&&"json"!==o?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:n,config:e,request:l}),l=null}if(l.open(e.method.toUpperCase(),bs(c,e.params,e.paramsSerializer),!0),l.timeout=e.timeout,"onloadend"in l?l.onloadend=u:l.onreadystatechange=function(){l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))&&setTimeout(u)},l.onabort=function(){l&&(i(new us("Request aborted",us.ECONNABORTED,e,l)),l=null)},l.onerror=function(){i(new us("Network Error",us.ERR_NETWORK,e,l)),l=null},l.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const n=e.transitional||Ss;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),i(new us(t,n.clarifyTimeoutError?us.ETIMEDOUT:us.ECONNABORTED,e,l)),l=null},Ts.isStandardBrowserEnv){const t=(e.withCredentials||Us(c))&&e.xsrfCookieName&&Ns.read(e.xsrfCookieName);t&&r.set(e.xsrfHeaderName,t)}void 0===n&&r.setContentType(null),"setRequestHeader"in l&&ss.forEach(r.toJSON(),(function(e,t){l.setRequestHeader(t,e)})),ss.isUndefined(e.withCredentials)||(l.withCredentials=!!e.withCredentials),o&&"json"!==o&&(l.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&l.addEventListener("progress",Vs(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",Vs(e.onUploadProgress)),(e.cancelToken||e.signal)&&(s=t=>{l&&(i(!t||t.type?new Fs(null,e,l):t),l.abort(),l=null)},e.cancelToken&&e.cancelToken.subscribe(s),e.signal&&(e.signal.aborted?s():e.signal.addEventListener("abort",s)));const h=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(c);h&&-1===Ts.protocols.indexOf(h)?i(new us("Unsupported protocol "+h+":",us.ERR_BAD_REQUEST,e)):l.send(n||null)}))},Ws={http:null,xhr:Gs};ss.forEach(Ws,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const qs=e=>{e=ss.isArray(e)?e:[e];const{length:t}=e;let i,n;for(let r=0;r<t&&(i=e[r],!(n=ss.isString(i)?Ws[i.toLowerCase()]:i));r++);if(!n){if(!1===n)throw new us(`Adapter ${i} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(ss.hasOwnProp(Ws,i)?`Adapter '${i}' is not available in the build`:`Unknown adapter '${i}'`)}if(!ss.isFunction(n))throw new TypeError("adapter is not a function");return n};function Xs(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Fs(null,e)}function Zs(e){Xs(e),e.headers=Ls.from(e.headers),e.data=Rs.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return qs(e.adapter||ks.adapter)(e).then((function(t){return Xs(e),t.data=Rs.call(e,e.transformResponse,t),t.headers=Ls.from(t.headers),t}),(function(t){return Os(t)||(Xs(e),t&&t.response&&(t.response.data=Rs.call(e,e.transformResponse,t.response),t.response.headers=Ls.from(t.response.headers))),Promise.reject(t)}))}const Hs=e=>e instanceof Ls?e.toJSON():e;function Ys(e,t){t=t||{};const i={};function n(e,t,i){return ss.isPlainObject(e)&&ss.isPlainObject(t)?ss.merge.call({caseless:i},e,t):ss.isPlainObject(t)?ss.merge({},t):ss.isArray(t)?t.slice():t}function r(e,t,i){return ss.isUndefined(t)?ss.isUndefined(e)?void 0:n(void 0,e,i):n(e,t,i)}function o(e,t){if(!ss.isUndefined(t))return n(void 0,t)}function s(e,t){return ss.isUndefined(t)?ss.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function a(i,r,o){return o in t?n(i,r):o in e?n(void 0,i):void 0}const l={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(e,t)=>r(Hs(e),Hs(t),!0)};return ss.forEach(Object.keys(Object.assign({},e,t)),(function(n){const o=l[n]||r,s=o(e[n],t[n],n);ss.isUndefined(s)&&o!==a||(i[n]=s)})),i}const Ks="1.5.0",Js={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Js[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}}));const Qs={};Js.transitional=function(e,t,i){function n(e,t){return"[Axios v1.5.0] Transitional option '"+e+"'"+t+(i?". "+i:"")}return(i,r,o)=>{if(!1===e)throw new us(n(r," has been removed"+(t?" in "+t:"")),us.ERR_DEPRECATED);return t&&!Qs[r]&&(Qs[r]=!0,console.warn(n(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,r,o)}};const ea={assertOptions:function(e,t,i){if("object"!=typeof e)throw new us("options must be an object",us.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let r=n.length;for(;r-- >0;){const o=n[r],s=t[o];if(s){const t=e[o],i=void 0===t||s(t,o,e);if(!0!==i)throw new us("option "+o+" must be "+i,us.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new us("Unknown option "+o,us.ERR_BAD_OPTION)}},validators:Js},ta=ea.validators;class ia{constructor(e){this.defaults=e,this.interceptors={request:new ws,response:new ws}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Ys(this.defaults,t);const{transitional:i,paramsSerializer:n,headers:r}=t;void 0!==i&&ea.assertOptions(i,{silentJSONParsing:ta.transitional(ta.boolean),forcedJSONParsing:ta.transitional(ta.boolean),clarifyTimeoutError:ta.transitional(ta.boolean)},!1),null!=n&&(ss.isFunction(n)?t.paramsSerializer={serialize:n}:ea.assertOptions(n,{encode:ta.function,serialize:ta.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=r&&ss.merge(r.common,r[t.method]);r&&ss.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete r[e]})),t.headers=Ls.concat(o,r);const s=[];let a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let u,h=0;if(!a){const e=[Zs.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);h<u;)c=c.then(e[h++],e[h++]);return c}u=s.length;let d=t;for(h=0;h<u;){const e=s[h++],t=s[h++];try{d=e(d)}catch(e){t.call(this,e);break}}try{c=Zs.call(this,d)}catch(e){return Promise.reject(e)}for(h=0,u=l.length;h<u;)c=c.then(l[h++],l[h++]);return c}getUri(e){return bs(js((e=Ys(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}ss.forEach(["delete","get","head","options"],(function(e){ia.prototype[e]=function(t,i){return this.request(Ys(i||{},{method:e,url:t,data:(i||{}).data}))}})),ss.forEach(["post","put","patch"],(function(e){function t(t){return function(i,n,r){return this.request(Ys(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}ia.prototype[e]=t(),ia.prototype[e+"Form"]=t(!0)}));const na=ia;class ra{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const i=this;this.promise.then((e=>{if(!i._listeners)return;let t=i._listeners.length;for(;t-- >0;)i._listeners[t](e);i._listeners=null})),this.promise.then=e=>{let t;const n=new Promise((e=>{i.subscribe(e),t=e})).then(e);return n.cancel=function(){i.unsubscribe(t)},n},e((function(e,n,r){i.reason||(i.reason=new Fs(e,n,r),t(i.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new ra((function(t){e=t})),cancel:e}}}const oa=ra;const sa={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(sa).forEach((([e,t])=>{sa[t]=e}));const aa=sa;const la=function e(t){const i=new na(t),n=Co(na.prototype.request,i);return ss.extend(n,na.prototype,i,{allOwnKeys:!0}),ss.extend(n,i,null,{allOwnKeys:!0}),n.create=function(i){return e(Ys(t,i))},n}(ks);la.Axios=na,la.CanceledError=Fs,la.CancelToken=oa,la.isCancel=Os,la.VERSION=Ks,la.toFormData=ms,la.AxiosError=us,la.Cancel=la.CanceledError,la.all=function(e){return Promise.all(e)},la.spread=function(e){return function(t){return e.apply(null,t)}},la.isAxiosError=function(e){return ss.isObject(e)&&!0===e.isAxiosError},la.mergeConfig=Ys,la.AxiosHeaders=Ls,la.formToJSON=e=>Es(ss.isHTMLForm(e)?new FormData(e):e),la.getAdapter=qs,la.HttpStatusCode=aa,la.default=la;const ca=la.create(),ua=async e=>{const t={method:"GET",url:`${hi.T.currencyApiUrl}`,params:{apikey:`${hi.T.currencyApiKey}`,currencies:e.join(hi.T.splitter)}},i=await(async({headers:e={},method:t,url:i,data:n,params:r})=>{const o={headers:e,method:t,url:i,data:n,params:r};return(await ca(o)).data})(t);return i.data};var ha=i(935);const da=function(e="modal-portal-wrapper"){const t=(0,n.useRef)(null);return(0,n.useLayoutEffect)((()=>{let i=document.getElementById(e),n=!1;return i||(n=!0,i=document.createElement("div"),i.id=e,document.body.appendChild(i)),t.current=i,()=>{n&&i.parentNode&&i.parentNode.removeChild(i)}}),[e]),e=>ha.createPortal(e,t.current)},pa={alt:"Currency icon",...Ri},fa=Vt.div`
  ${fi}
  padding: ${({theme:e})=>e.space.L}px;
  gap: ${({theme:e})=>e.space.L}px;
  border: 1px solid ${({theme:e})=>e.colors.darkGray};
  background-color: ${({theme:e})=>e.colors.borderGray};
  margin-bottom: ${({theme:e})=>e.space.XL56}px;
  transition: ${({$isInteractive:e})=>e?"transform 0.5s":"none"};
  border-radius: 8px;
  align-items: center;
  width: 100%;
  max-width: 520px;
  height: fit-content;

  &:hover {
    transform: ${({$isInteractive:e})=>e?"scale(1.03)":"none"};
    cursor: ${({$isInteractive:e})=>e?"pointer":"arrow"};
    box-shadow: ${({$isInteractive:e})=>e?`0px 0px 25px 4px ${Zt.shadowGreen}`:""};
  }

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    max-width: unset;
  }

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    height: 100px;
    padding-right: ${({theme:e})=>e.space.L}px;
  }
`,ma=Vt.img`
  user-select: none;

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    width: 50px;
    height: 50px;
  }
`,ga=Vt.div`
  ${_i}
`,_a=Vt.p`
  ${wi}
  color: ${({theme:e})=>e.colors.cardLightGray};
  font-size: ${({theme:e})=>e.font.fontSize.L}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.S};

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    font-size: ${({theme:e})=>e.font.fontSize.S}px;
    line-height: normal;
  }
`,ya=Vt.span`
  ${Si}
  color: ${({theme:e})=>e.colors.lightBlue};
  font-size: ${({theme:e})=>e.font.fontSize.L}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.XS};

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    font-size: ${({theme:e})=>e.font.fontSize.M}px;
    line-height: normal;
  }
`,xa=n.memo((({imgPath:e,title:t,rateValue:i,onClick:n,$isInteractive:r})=>(0,Kt.jsxs)(fa,{"data-cy":"currency-card",onClick:n,$isInteractive:r,children:[(0,Kt.jsx)(ma,{src:e,...pa}),(0,Kt.jsxs)(ga,{children:[(0,Kt.jsx)(_a,{children:t}),(0,Kt.jsx)(ya,{children:i})]})]})));xa.propTypes={imgPath:pn().string.isRequired,title:pn().string.isRequired,$isInteractive:pn().bool.isRequired,rateValue:pn().string,onClick:pn().func};const va=xa,ba=Vt.section`
  ${mi}
  margin-bottom: ${({theme:e})=>e.space.XL86}px;
  width: 100%;
  max-width: 1140px;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    padding: 0 ${({theme:e})=>e.space.L}px;
  }
`,wa=Vt.p`
  color: ${({theme:e})=>e.textColor};
  font-size: ${({theme:e})=>e.font.fontSize.M}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.XS};
  border-bottom: 2px solid ${({theme:e})=>e.colors.darkGray};
  padding-bottom: ${({theme:e})=>e.space.M}px;
  margin-bottom: ${({theme:e})=>e.space.XL}px;
  line-height: 41px;
  font-style: normal;
  max-width: 520px;
  flex-shrink: 0;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    max-width: unset;
  }

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    font-size: ${({theme:e})=>e.font.fontSize.M}px;
  }
`,Sa=Vt.div`
  ${fi}
  justify-content: space-between;
  flex-wrap: wrap;

  @media (max-width: ${({theme:e})=>e.media.XL}px) {
    justify-content: unset;
    flex-direction: column;
  }
`,Ta=n.memo((({title:e,cardsArray:t,onClick:i,rates:r,$isInteractive:o})=>{const s=(0,n.useCallback)(((e,t)=>()=>{i&&i({id:e,imgPath:t})}),[i]),a=(0,n.useMemo)((()=>t.map((({id:e,rateValue:t})=>((e,t,i)=>{if(e&&e.data&&e.data[t])return`$ ${Number(e.data[t].value.toFixed(hi.T.decimalPlaces))}`;return i||"Loading..."})(r,e,t)))),[t,r]);return(0,Kt.jsxs)(ba,{children:[(0,Kt.jsx)(wa,{children:e}),(0,Kt.jsx)(Sa,{children:t.map((({id:e,imgPath:t,title:i},n)=>(0,Kt.jsx)(va,{$isInteractive:o,imgPath:t,rateValue:a[n],title:i,onClick:s(e,t)},i)))})]})}));Ta.propTypes={title:pn().string.isRequired,cardsArray:pn().array.isRequired,onClick:pn().func,rates:pn().object};const Ea=Ta,Ca=jt`
  color: ${Zt.white};
`,ka=Vt.img`
  user-select: none;
`,Ma=Vt.label`
  ${Ca}
  padding-left: ${({theme:e})=>e.space.M}px;
`,Aa=Vt.div`
  ${Ca}
  ${fi}
  border-bottom: 1px solid ${({theme:e})=>e.colors.darkGray};
  margin-left: ${({theme:e})=>e.space.M}px;
  margin-bottom: ${({theme:e})=>e.space.XS}px;
  margin-right: ${({theme:e})=>e.space.M}px;
  height: 50px;
  justify-content: space-between;
  align-items: center;
`,Pa=Vt.input`
  ${Ca}
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  height: 50px;
  border: none;
  background: transparent;
  outline: none;

  &::-webkit-inner-spin-button,
  &::-webkit-outer-spin-button {
    -webkit-appearance: none;
    -moz-appearance: textfield;
    appearance: none;
    margin: ${({theme:e})=>e.space.XXS0};
  }
`,Ia=Vt.div`
  ${Ca}
  ${fi}
  margin: ${({theme:e})=>e.space.XXS}px ${({theme:e})=>e.space.M}px;
  padding: ${({theme:e})=>e.space.XXS}px ${({theme:e})=>e.space.S}px;
  border: 1px solid ${({theme:e})=>e.colors.darkGray};
  gap: ${({theme:e})=>e.space.S}px;
  align-items: center;
  background: transparent;
  width: 252px;
  border-radius: 3px;
`,za=Vt(Ia)`
  padding: ${({theme:e})=>e.space.XXS0};
`,Da=Vt.span`
  ${Ca}
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  background: transparent;
  text-align: center;
`,La=Vt.button`
  ${Ca}
  margin: ${({theme:e})=>e.space.M}px;
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  background-color: ${({theme:e})=>e.colors.blue};
  height: 50px;
  border-radius: 5px;
  border: none;
  cursor: pointer;

  &:hover {
    background-color: ${({theme:e})=>e.colors.lightBlue};
  }
`,Ra={alt:"Arrow icon",src:xn,...Ni},Oa=Vt.button`
  ${fi}
  padding: ${({theme:e})=>e.space.XXS}px ${({theme:e})=>e.space.S}px;
  color: ${({theme:e})=>e.textColor};
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  cursor: pointer;
  background: transparent;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  border: none;

  &:hover {
    background- ${({theme:e})=>e.colors.purpuleBlue};
  }
`,Ba=Vt.div`
  ${fi}
  gap: ${({theme:e})=>e.space.S}px;
  align-items: center;
  background: transparent;
`,Fa=Vt.img`
  transition: transform 0.3s;

  transform: ${({$isOpen:e})=>e?"rotate(180deg)":"rotate(360deg)"};
`,Na=Vt.ul`
  position: absolute;
  top: 74%;
  width: inherit;
  left: 35px;
  list-style-type: none;
  height: 183px;
  overflow: auto;

  display: ${({$isOpen:e})=>e?"block":"none"};

  &::-webkit-scrollbar {
    width: 4px;
  }

  &::-webkit-scrollbar-track {
    background: ${({theme:e})=>e.colors.borderGray};
    border-right: 1px solid ${({theme:e})=>e.colors.darkGray};
    border-bottom: 1px solid ${({theme:e})=>e.colors.darkGray};
  }

  &::-webkit-scrollbar-thumb {
    background-color: ${({theme:e})=>e.colors.darkGray};

    &:hover {
      background-color: ${({theme:e})=>e.colors.purpuleBlue};
    }
  }
`,ja=Vt.li`
  padding: ${({theme:e})=>e.space.XXS}px ${({theme:e})=>e.space.M}px;
  background-color: ${({theme:e})=>e.colors.borderGray};
  border-bottom: 1px solid ${({theme:e})=>e.colors.darkGray};
  border-right: 1px solid ${({theme:e})=>e.colors.darkGray};
  border-left: 1px solid ${({theme:e})=>e.colors.darkGray};
  ${fi}
  gap: ${({theme:e})=>e.space.S}px;
  align-items: center;
  cursor: pointer;

  &:hover {
    background-color: ${({theme:e})=>e.colors.purpuleBlue};
  }
`,Ua=n.memo((({selectedCurrency:e,setSelectedCurrency:t,setConvertedCurrencyValue:i})=>{const{id:r,imgPath:o}=e,[s,a]=(0,n.useState)(!1);return(0,Kt.jsxs)(Kt.Fragment,{children:[(0,Kt.jsxs)(Oa,{"data-cy":"to-currency",onClick:()=>{a((e=>!e))},children:[(0,Kt.jsxs)(Ba,{children:[(0,Kt.jsx)(ka,{alt:`${r} icon`,src:o,...Bi}),(0,Kt.jsx)(Da,{children:r})]}),(0,Kt.jsx)(Fa,{$isOpen:s,...Ra})]}),(0,Kt.jsx)(Na,{$isOpen:s,children:Dr.map((e=>{const{id:n,imgPath:r}=e;return(0,Kt.jsxs)(ja,{"data-cy":`select-option-${n}`,onClick:(o=e,()=>{t({id:o.id,imgPath:o.imgPath,valueRate:o.valueRate}),a(!1),i("")}),children:[(0,Kt.jsx)(ka,{alt:`${n} icon`,src:r,...Bi}),(0,Kt.jsx)(Da,{children:n})]},n);var o}))})]})}));Ua.propTypes={selectedCurrency:pn().object.isRequired,setSelectedCurrency:pn().func.isRequired,setConvertedCurrencyValue:pn().func.isRequired};const $a=Ua,Va=({setIsModalOpen:e,targetCurrency:t,exchangeAmount:i,setExchangeAmount:r,rates:o})=>{const{id:s,imgPath:a}=t,l=s,[c,u]=(0,n.useState)(""),[h,d]=(0,n.useState)(""),[p,f]=(0,n.useState)(Ir),m=(0,n.useCallback)((()=>{e(!1)}),[e]);return(0,Kt.jsxs)(nr,{onClose:m,children:[(0,Kt.jsx)(Ma,{children:"Amount"}),(0,Kt.jsx)(Aa,{children:(0,Kt.jsx)(Pa,{"data-cy":"amount-input",value:i,onChange:e=>{const t=e.target.value;(t>=0||""===t)&&(r(t),u("")),d("")}})}),(0,Kt.jsx)(Ma,{children:"From:"}),(0,Kt.jsxs)(Ia,{children:[(0,Kt.jsx)(ka,{alt:`${s} icon`,src:a,...Bi}),(0,Kt.jsx)(Da,{children:s})]}),(0,Kt.jsx)(Ma,{children:"To:"}),(0,Kt.jsx)(za,{children:(0,Kt.jsx)($a,{selectedCurrency:p,setConvertedCurrencyValue:u,setSelectedCurrency:f})}),(0,Kt.jsx)(La,{"data-cy":"convert-button",onClick:()=>{i||d("Введите значение для конвертации");const e=p.id,t=((e,t,i,n)=>{const r=n.data[i].value/n.data[t].value,o=(Number(e)*r).toFixed(hi.T.decimalPlaces);return Number(o)})(i,l,e,o);u(Number(t))},children:"Convert"}),(0,Kt.jsxs)(Da,{"data-cy":"converted-result",children:[""!==c&&i&&`${Number(Number(i).toFixed(hi.T.decimalPlaces))} ${l} = ${c} ${p.id}`,""!==h&&h]})]})};Va.propTypes={setIsModalOpen:pn().func.isRequired,targetCurrency:pn().object.isRequired,exchangeAmount:pn().string.isRequired,setExchangeAmount:pn().func.isRequired,rates:pn().object};const Ga=Va,Wa=Vt.main`
  ${mi}
  align-items: center;
`,qa=()=>{const[e,t]=(0,n.useState)({expirationDate:(new Date).getTime()+hi.T.cacheLifetime,data:{}}),[i,r]=(0,n.useState)(!1),[o,s]=(0,n.useState)(""),[a,l]=(0,n.useState)(Ir),c=da(),u=(0,n.useCallback)((({id:t,imgPath:i})=>{0!==Object.keys(e.data).length&&(r((e=>!e)),s(String(e.data[t].value)),l({id:t,imgPath:i}))}),[e.data]);return(0,n.useEffect)((()=>{const e=(0,ui.lJ)(hi.T.cacheCurrencyRatesKey);(0,ui.kI)(e)?t(e):(async()=>{const e=(new Date).getTime(),i=Dr.map((e=>e.id)),n=await ua(i);t({expirationDate:e+hi.T.cacheLifetime,data:n}),(0,ui.fv)(hi.T.cacheLastUpdateKey,e),(0,ui.fv)(hi.T.cacheCurrencyRatesKey,{expirationDate:e+hi.T.cacheLifetime,data:n})})()}),[]),(0,Kt.jsxs)(Wa,{children:[(0,Kt.jsx)(Ea,{$isInteractive:!1,cardsArray:zr,title:"Stocks"}),(0,Kt.jsx)(Ea,{$isInteractive:!0,cardsArray:Dr,rates:e,title:"Quotes",onClick:u}),i&&c((0,Kt.jsx)(Ga,{exchangeAmount:o,rates:e,setExchangeAmount:s,setIsModalOpen:r,targetCurrency:a})),i&&(0,Kt.jsx)(or,{})]})},Xa=Vt.select`
  color: ${({theme:e})=>e.textColor};
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  padding-right: ${({theme:e})=>e.space.M}px;
  margin-bottom: ${({theme:e})=>e.space.XXL155}px;
  cursor: pointer;
  border: none;
  outline: none;
  background-color: transparent;
  max-width: 400px;
`,Za=Vt.option`
  background-color: ${({theme:e})=>e.backgroundColor};

  &:hover {
    cursor: pointer;
  }
`,Ha=Dr.map((e=>{const{id:t,title:i}=e;return(0,Kt.jsx)(Za,{children:i},t)}));class Ya extends n.PureComponent{handleSelectChange=e=>{const t=Dr.find((t=>t.title===e.target.value));this.props.onCurrencyChange(t)};render(){const{title:e}=this.props.selectedCurrency.title;return(0,Kt.jsx)(Xa,{"data-cy":"currency-select",value:e,onChange:this.handleSelectChange,children:Ha})}}Ya.propTypes={onCurrencyChange:pn().func.isRequired,selectedCurrency:pn().object.isRequired};const Ka=Ya,Ja=Vt.div`
  ${fi}
  gap: ${({theme:e})=>e.space.M}px;
  margin-bottom: ${({theme:e})=>e.space.XL}px;
  cursor: ${e=>e?"arrow":"pointer"};
  padding: ${({theme:e})=>e.space.L}px;
  border: 1px solid ${({theme:e})=>e.colors.darkGray};
  background-color: ${({theme:e})=>e.colors.borderGray};
  transition: transform 0.5s;
  border-radius: 8px;
  width: 100%;
  max-width: 520px;
  align-items: center;

  &:hover {
    transform: ${({$isChartCanBuild:e})=>e?"none":"scale(1.03)"};
    box-shadow: ${({$isChartCanBuild:e})=>e?"none":`0px 0px 25px 4px ${Zt.shadowGreen}`};
    cursor: pointer;
  }

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    height: 100px;
  }
`,Qa=Vt.img`
  user-select: none;

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    width: 50px;
    height: 50px;
  }
`,el=Vt.div`
  ${mi}
`,tl=Vt.p`
  ${wi}
  color: ${({theme:e})=>e.colors.cardLightGray};
  font-size: ${({theme:e})=>e.font.fontSize.L}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.S};

  @media (max-width: ${({theme:e})=>e.media.XS}px) {
    font-size: ${({theme:e})=>e.font.fontSize.M}px;
  }

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    line-height: normal;
  }
`,il=Vt.span`
  ${wi}
  color: ${({theme:e})=>e.colors.cardLightGray};
  font-size: ${({theme:e})=>e.font.fontSize.XS}px;
  font-weight: ${({theme:e})=>e.font.fontWeight.XS};
  text-align: left;

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    line-height: normal;
  }
`;class nl extends n.PureComponent{handleCurrencyInfoClick=()=>{this.props.isChartCanBuild||this.props.onClick()};render(){const{id:e,imgPath:t,title:i}=this.props.selectedCurrency,{isChartCanBuild:n}=this.props;return(0,Kt.jsxs)(Ja,{$isChartCanBuild:n,"data-cy":"currency-info",onClick:this.handleCurrencyInfoClick,children:[(0,Kt.jsx)(Qa,{alt:`${e} icon`,src:t,...Ri}),(0,Kt.jsxs)(el,{children:[(0,Kt.jsx)(tl,{"data-cy":"currency-info-text",children:i}),(0,Kt.jsx)(il,{"data-cy":"currency-info-id",children:e})]})]})}}const rl=nl;nl.propTypes={selectedCurrency:pn().object.isRequired,onClick:pn().func.isRequired,isChartCanBuild:pn().bool.isRequired};const ol=new class{constructor(){this.observers=[]}subscribe(e){this.observers.push(e)}unsubscribe(e){this.observers=this.observers.filter((t=>t!==e))}notifySubscribers(){this.observers.forEach((e=>{e.update()}))}};function sl(e){return e+.5|0}const al=(e,t,i)=>Math.max(Math.min(e,i),t);function ll(e){return al(sl(2.55*e),0,255)}function cl(e){return al(sl(255*e),0,255)}function ul(e){return al(sl(e/2.55)/100,0,1)}function hl(e){return al(sl(100*e),0,100)}const dl={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},pl=[..."0123456789ABCDEF"],fl=e=>pl[15&e],ml=e=>pl[(240&e)>>4]+pl[15&e],gl=e=>(240&e)>>4==(15&e);function _l(e){var t=(e=>gl(e.r)&&gl(e.g)&&gl(e.b)&&gl(e.a))(e)?fl:ml;return e?"#"+t(e.r)+t(e.g)+t(e.b)+((e,t)=>e<255?t(e):"")(e.a,t):void 0}const yl=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function xl(e,t,i){const n=t*Math.min(i,1-i),r=(t,r=(t+e/30)%12)=>i-n*Math.max(Math.min(r-3,9-r,1),-1);return[r(0),r(8),r(4)]}function vl(e,t,i){const n=(n,r=(n+e/60)%6)=>i-i*t*Math.max(Math.min(r,4-r,1),0);return[n(5),n(3),n(1)]}function bl(e,t,i){const n=xl(e,1,.5);let r;for(t+i>1&&(r=1/(t+i),t*=r,i*=r),r=0;r<3;r++)n[r]*=1-t-i,n[r]+=t;return n}function wl(e){const t=e.r/255,i=e.g/255,n=e.b/255,r=Math.max(t,i,n),o=Math.min(t,i,n),s=(r+o)/2;let a,l,c;return r!==o&&(c=r-o,l=s>.5?c/(2-r-o):c/(r+o),a=function(e,t,i,n,r){return e===r?(t-i)/n+(t<i?6:0):t===r?(i-e)/n+2:(e-t)/n+4}(t,i,n,c,r),a=60*a+.5),[0|a,l||0,s]}function Sl(e,t,i,n){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,i,n)).map(cl)}function Tl(e,t,i){return Sl(xl,e,t,i)}function El(e){return(e%360+360)%360}function Cl(e){const t=yl.exec(e);let i,n=255;if(!t)return;t[5]!==i&&(n=t[6]?ll(+t[5]):cl(+t[5]));const r=El(+t[2]),o=+t[3]/100,s=+t[4]/100;return i="hwb"===t[1]?function(e,t,i){return Sl(bl,e,t,i)}(r,o,s):"hsv"===t[1]?function(e,t,i){return Sl(vl,e,t,i)}(r,o,s):Tl(r,o,s),{r:i[0],g:i[1],b:i[2],a:n}}const kl={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ml={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Al;function Pl(e){Al||(Al=function(){const e={},t=Object.keys(Ml),i=Object.keys(kl);let n,r,o,s,a;for(n=0;n<t.length;n++){for(s=a=t[n],r=0;r<i.length;r++)o=i[r],a=a.replace(o,kl[o]);o=parseInt(Ml[s],16),e[a]=[o>>16&255,o>>8&255,255&o]}return e}(),Al.transparent=[0,0,0,0]);const t=Al[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:4===t.length?t[3]:255}}const Il=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const zl=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,Dl=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function Ll(e,t,i){if(e){let n=wl(e);n[t]=Math.max(0,Math.min(n[t]+n[t]*i,0===t?360:1)),n=Tl(n),e.r=n[0],e.g=n[1],e.b=n[2]}}function Rl(e,t){return e?Object.assign(t||{},e):e}function Ol(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=cl(e[3]))):(t=Rl(e,{r:0,g:0,b:0,a:1})).a=cl(t.a),t}function Bl(e){return"r"===e.charAt(0)?function(e){const t=Il.exec(e);let i,n,r,o=255;if(t){if(t[7]!==i){const e=+t[7];o=t[8]?ll(e):al(255*e,0,255)}return i=+t[1],n=+t[3],r=+t[5],i=255&(t[2]?ll(i):al(i,0,255)),n=255&(t[4]?ll(n):al(n,0,255)),r=255&(t[6]?ll(r):al(r,0,255)),{r:i,g:n,b:r,a:o}}}(e):Cl(e)}class Fl{constructor(e){if(e instanceof Fl)return e;const t=typeof e;let i;var n,r,o;"object"===t?i=Ol(e):"string"===t&&(o=(n=e).length,"#"===n[0]&&(4===o||5===o?r={r:255&17*dl[n[1]],g:255&17*dl[n[2]],b:255&17*dl[n[3]],a:5===o?17*dl[n[4]]:255}:7!==o&&9!==o||(r={r:dl[n[1]]<<4|dl[n[2]],g:dl[n[3]]<<4|dl[n[4]],b:dl[n[5]]<<4|dl[n[6]],a:9===o?dl[n[7]]<<4|dl[n[8]]:255})),i=r||Pl(e)||Bl(e)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var e=Rl(this._rgb);return e&&(e.a=ul(e.a)),e}set rgb(e){this._rgb=Ol(e)}rgbString(){return this._valid?function(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${ul(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}(this._rgb):void 0}hexString(){return this._valid?_l(this._rgb):void 0}hslString(){return this._valid?function(e){if(!e)return;const t=wl(e),i=t[0],n=hl(t[1]),r=hl(t[2]);return e.a<255?`hsla(${i}, ${n}%, ${r}%, ${ul(e.a)})`:`hsl(${i}, ${n}%, ${r}%)`}(this._rgb):void 0}mix(e,t){if(e){const i=this.rgb,n=e.rgb;let r;const o=t===r?.5:t,s=2*o-1,a=i.a-n.a,l=((s*a==-1?s:(s+a)/(1+s*a))+1)/2;r=1-l,i.r=255&l*i.r+r*n.r+.5,i.g=255&l*i.g+r*n.g+.5,i.b=255&l*i.b+r*n.b+.5,i.a=o*i.a+(1-o)*n.a,this.rgb=i}return this}interpolate(e,t){return e&&(this._rgb=function(e,t,i){const n=Dl(ul(e.r)),r=Dl(ul(e.g)),o=Dl(ul(e.b));return{r:cl(zl(n+i*(Dl(ul(t.r))-n))),g:cl(zl(r+i*(Dl(ul(t.g))-r))),b:cl(zl(o+i*(Dl(ul(t.b))-o))),a:e.a+i*(t.a-e.a)}}(this._rgb,e._rgb,t)),this}clone(){return new Fl(this.rgb)}alpha(e){return this._rgb.a=cl(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,t=sl(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Ll(this._rgb,2,e),this}darken(e){return Ll(this._rgb,2,-e),this}saturate(e){return Ll(this._rgb,1,e),this}desaturate(e){return Ll(this._rgb,1,-e),this}rotate(e){return function(e,t){var i=wl(e);i[0]=El(i[0]+t),i=Tl(i),e.r=i[0],e.g=i[1],e.b=i[2]}(this._rgb,e),this}}function Nl(){}const jl=(()=>{let e=0;return()=>e++})();function Ul(e){return null==e}function $l(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function Vl(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function Gl(e){return("number"==typeof e||e instanceof Number)&&isFinite(+e)}function Wl(e,t){return Gl(e)?e:t}function ql(e,t){return void 0===e?t:e}const Xl=(e,t)=>"string"==typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function Zl(e,t,i){if(e&&"function"==typeof e.call)return e.apply(i,t)}function Hl(e,t,i,n){let r,o,s;if($l(e))if(o=e.length,n)for(r=o-1;r>=0;r--)t.call(i,e[r],r);else for(r=0;r<o;r++)t.call(i,e[r],r);else if(Vl(e))for(s=Object.keys(e),o=s.length,r=0;r<o;r++)t.call(i,e[s[r]],s[r])}function Yl(e,t){let i,n,r,o;if(!e||!t||e.length!==t.length)return!1;for(i=0,n=e.length;i<n;++i)if(r=e[i],o=t[i],r.datasetIndex!==o.datasetIndex||r.index!==o.index)return!1;return!0}function Kl(e){if($l(e))return e.map(Kl);if(Vl(e)){const t=Object.create(null),i=Object.keys(e),n=i.length;let r=0;for(;r<n;++r)t[i[r]]=Kl(e[i[r]]);return t}return e}function Jl(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function Ql(e,t,i,n){if(!Jl(e))return;const r=t[e],o=i[e];Vl(r)&&Vl(o)?ec(r,o,n):t[e]=Kl(o)}function ec(e,t,i){const n=$l(t)?t:[t],r=n.length;if(!Vl(e))return e;const o=(i=i||{}).merger||Ql;let s;for(let t=0;t<r;++t){if(s=n[t],!Vl(s))continue;const r=Object.keys(s);for(let t=0,n=r.length;t<n;++t)o(r[t],e,s,i)}return e}function tc(e,t){return ec(e,t,{merger:ic})}function ic(e,t,i){if(!Jl(e))return;const n=t[e],r=i[e];Vl(n)&&Vl(r)?tc(n,r):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=Kl(r))}const nc={"":e=>e,x:e=>e.x,y:e=>e.y};function rc(e,t){const i=nc[t]||(nc[t]=function(e){const t=function(e){const t=e.split("."),i=[];let n="";for(const e of t)n+=e,n.endsWith("\\")?n=n.slice(0,-1)+".":(i.push(n),n="");return i}(e);return e=>{for(const i of t){if(""===i)break;e=e&&e[i]}return e}}(t));return i(e)}function oc(e){return e.charAt(0).toUpperCase()+e.slice(1)}const sc=e=>void 0!==e,ac=e=>"function"==typeof e,lc=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0};const cc=Math.PI,uc=2*cc,hc=uc+cc,dc=Number.POSITIVE_INFINITY,pc=cc/180,fc=cc/2,mc=cc/4,gc=2*cc/3,_c=Math.log10,yc=Math.sign;function xc(e,t,i){return Math.abs(e-t)<i}function vc(e){const t=Math.round(e);e=xc(e,t,e/1e3)?t:e;const i=Math.pow(10,Math.floor(_c(e))),n=e/i;return(n<=1?1:n<=2?2:n<=5?5:10)*i}function bc(e){return!isNaN(parseFloat(e))&&isFinite(e)}function wc(e,t,i){let n,r,o;for(n=0,r=e.length;n<r;n++)o=e[n][i],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function Sc(e){return e*(cc/180)}function Tc(e){return e*(180/cc)}function Ec(e){if(!Gl(e))return;let t=1,i=0;for(;Math.round(e*t)/t!==e;)t*=10,i++;return i}function Cc(e,t){const i=t.x-e.x,n=t.y-e.y,r=Math.sqrt(i*i+n*n);let o=Math.atan2(n,i);return o<-.5*cc&&(o+=uc),{angle:o,distance:r}}function kc(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Mc(e,t){return(e-t+hc)%uc-cc}function Ac(e){return(e%uc+uc)%uc}function Pc(e,t,i,n){const r=Ac(e),o=Ac(t),s=Ac(i),a=Ac(o-r),l=Ac(s-r),c=Ac(r-o),u=Ac(r-s);return r===o||r===s||n&&o===s||a>l&&c<u}function Ic(e,t,i){return Math.max(t,Math.min(i,e))}function zc(e,t,i,n=1e-6){return e>=Math.min(t,i)-n&&e<=Math.max(t,i)+n}function Dc(e,t,i){i=i||(i=>e[i]<t);let n,r=e.length-1,o=0;for(;r-o>1;)n=o+r>>1,i(n)?o=n:r=n;return{lo:o,hi:r}}const Lc=(e,t,i,n)=>Dc(e,i,n?n=>{const r=e[n][t];return r<i||r===i&&e[n+1][t]===i}:n=>e[n][t]<i),Rc=(e,t,i)=>Dc(e,i,(n=>e[n][t]>=i));const Oc=["push","pop","shift","splice","unshift"];function Bc(e,t){const i=e._chartjs;if(!i)return;const n=i.listeners,r=n.indexOf(t);-1!==r&&n.splice(r,1),n.length>0||(Oc.forEach((t=>{delete e[t]})),delete e._chartjs)}function Fc(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const Nc="undefined"==typeof window?function(e){return e()}:window.requestAnimationFrame;function jc(e,t){let i=[],n=!1;return function(...r){i=r,n||(n=!0,Nc.call(window,(()=>{n=!1,e.apply(t,i)})))}}const Uc=e=>"start"===e?"left":"end"===e?"right":"center",$c=(e,t,i)=>"start"===e?t:"end"===e?i:(t+i)/2;function Vc(e,t,i){const n=t.length;let r=0,o=n;if(e._sorted){const{iScale:s,_parsed:a}=e,l=s.axis,{min:c,max:u,minDefined:h,maxDefined:d}=s.getUserBounds();h&&(r=Ic(Math.min(Lc(a,l,c).lo,i?n:Lc(t,l,s.getPixelForValue(c)).lo),0,n-1)),o=d?Ic(Math.max(Lc(a,s.axis,u,!0).hi+1,i?0:Lc(t,l,s.getPixelForValue(u),!0).hi+1),r,n)-r:n-r}return{start:r,count:o}}function Gc(e){const{xScale:t,yScale:i,_scaleRanges:n}=e,r={xmin:t.min,xmax:t.max,ymin:i.min,ymax:i.max};if(!n)return e._scaleRanges=r,!0;const o=n.xmin!==t.min||n.xmax!==t.max||n.ymin!==i.min||n.ymax!==i.max;return Object.assign(n,r),o}const Wc=e=>0===e||1===e,qc=(e,t,i)=>-Math.pow(2,10*(e-=1))*Math.sin((e-t)*uc/i),Xc=(e,t,i)=>Math.pow(2,-10*e)*Math.sin((e-t)*uc/i)+1,Zc={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*fc),easeOutSine:e=>Math.sin(e*fc),easeInOutSine:e=>-.5*(Math.cos(cc*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>Wc(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>Wc(e)?e:qc(e,.075,.3),easeOutElastic:e=>Wc(e)?e:Xc(e,.075,.3),easeInOutElastic(e){const t=.1125;return Wc(e)?e:e<.5?.5*qc(2*e,t,.45):.5+.5*Xc(2*e-1,t,.45)},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-Zc.easeOutBounce(1-e),easeOutBounce(e){const t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375},easeInOutBounce:e=>e<.5?.5*Zc.easeInBounce(2*e):.5*Zc.easeOutBounce(2*e-1)+.5};function Hc(e){if(e&&"object"==typeof e){const t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function Yc(e){return Hc(e)?e:new Fl(e)}function Kc(e){return Hc(e)?e:new Fl(e).saturate(.5).darken(.1).hexString()}const Jc=["x","y","borderWidth","radius","tension"],Qc=["color","borderColor","backgroundColor"];const eu=new Map;function tu(e,t,i){return function(e,t){t=t||{};const i=e+JSON.stringify(t);let n=eu.get(i);return n||(n=new Intl.NumberFormat(e,t),eu.set(i,n)),n}(t,i).format(e)}const iu={values:e=>$l(e)?e:""+e,numeric(e,t,i){if(0===e)return"0";const n=this.chart.options.locale;let r,o=e;if(i.length>1){const t=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(t<1e-4||t>1e15)&&(r="scientific"),o=function(e,t){let i=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;Math.abs(i)>=1&&e!==Math.floor(e)&&(i=e-Math.floor(e));return i}(e,i)}const s=_c(Math.abs(o)),a=isNaN(s)?1:Math.max(Math.min(-1*Math.floor(s),20),0),l={notation:r,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),tu(e,n,l)},logarithmic(e,t,i){if(0===e)return"0";const n=i[t].significand||e/Math.pow(10,Math.floor(_c(e)));return[1,2,3,5,10,15].includes(n)||t>.8*i.length?iu.numeric.call(this,e,t,i):""}};var nu={formatters:iu};const ru=Object.create(null),ou=Object.create(null);function su(e,t){if(!t)return e;const i=t.split(".");for(let t=0,n=i.length;t<n;++t){const n=i[t];e=e[n]||(e[n]=Object.create(null))}return e}function au(e,t,i){return"string"==typeof t?ec(su(e,t),i):ec(su(e,""),t)}class lu{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>Kc(t.backgroundColor),this.hoverBorderColor=(e,t)=>Kc(t.borderColor),this.hoverColor=(e,t)=>Kc(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return au(this,e,t)}get(e){return su(this,e)}describe(e,t){return au(ou,e,t)}override(e,t){return au(ru,e,t)}route(e,t,i,n){const r=su(this,e),o=su(this,i),s="_"+t;Object.defineProperties(r,{[s]:{value:r[t],writable:!0},[t]:{enumerable:!0,get(){const e=this[s],t=o[n];return Vl(e)?Object.assign({},t,e):ql(e,t)},set(e){this[s]=e}}})}apply(e){e.forEach((e=>e(this)))}}var cu=new lu({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),e.set("animations",{colors:{type:"color",properties:Qc},numbers:{type:"number",properties:Jc}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}})},function(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:nu.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e&&"dash"!==e}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e})}]);function uu(e,t,i,n,r){let o=t[r];return o||(o=t[r]=e.measureText(r).width,i.push(r)),o>n&&(n=o),n}function hu(e,t,i,n){let r=(n=n||{}).data=n.data||{},o=n.garbageCollect=n.garbageCollect||[];n.font!==t&&(r=n.data={},o=n.garbageCollect=[],n.font=t),e.save(),e.font=t;let s=0;const a=i.length;let l,c,u,h,d;for(l=0;l<a;l++)if(h=i[l],null==h||$l(h)){if($l(h))for(c=0,u=h.length;c<u;c++)d=h[c],null==d||$l(d)||(s=uu(e,r,o,s,d))}else s=uu(e,r,o,s,h);e.restore();const p=o.length/2;if(p>i.length){for(l=0;l<p;l++)delete r[o[l]];o.splice(0,p)}return s}function du(e,t,i){const n=e.currentDevicePixelRatio,r=0!==i?Math.max(i/2,.5):0;return Math.round((t-r)*n)/n+r}function pu(e,t){(t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore()}function fu(e,t,i,n){mu(e,t,i,n,null)}function mu(e,t,i,n,r){let o,s,a,l,c,u,h,d;const p=t.pointStyle,f=t.rotation,m=t.radius;let g=(f||0)*pc;if(p&&"object"==typeof p&&(o=p.toString(),"[object HTMLImageElement]"===o||"[object HTMLCanvasElement]"===o))return e.save(),e.translate(i,n),e.rotate(g),e.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),void e.restore();if(!(isNaN(m)||m<=0)){switch(e.beginPath(),p){default:r?e.ellipse(i,n,r/2,m,0,0,uc):e.arc(i,n,m,0,uc),e.closePath();break;case"triangle":u=r?r/2:m,e.moveTo(i+Math.sin(g)*u,n-Math.cos(g)*m),g+=gc,e.lineTo(i+Math.sin(g)*u,n-Math.cos(g)*m),g+=gc,e.lineTo(i+Math.sin(g)*u,n-Math.cos(g)*m),e.closePath();break;case"rectRounded":c=.516*m,l=m-c,s=Math.cos(g+mc)*l,h=Math.cos(g+mc)*(r?r/2-c:l),a=Math.sin(g+mc)*l,d=Math.sin(g+mc)*(r?r/2-c:l),e.arc(i-h,n-a,c,g-cc,g-fc),e.arc(i+d,n-s,c,g-fc,g),e.arc(i+h,n+a,c,g,g+fc),e.arc(i-d,n+s,c,g+fc,g+cc),e.closePath();break;case"rect":if(!f){l=Math.SQRT1_2*m,u=r?r/2:l,e.rect(i-u,n-l,2*u,2*l);break}g+=mc;case"rectRot":h=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),e.moveTo(i-h,n-a),e.lineTo(i+d,n-s),e.lineTo(i+h,n+a),e.lineTo(i-d,n+s),e.closePath();break;case"crossRot":g+=mc;case"cross":h=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),e.moveTo(i-h,n-a),e.lineTo(i+h,n+a),e.moveTo(i+d,n-s),e.lineTo(i-d,n+s);break;case"star":h=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),e.moveTo(i-h,n-a),e.lineTo(i+h,n+a),e.moveTo(i+d,n-s),e.lineTo(i-d,n+s),g+=mc,h=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),e.moveTo(i-h,n-a),e.lineTo(i+h,n+a),e.moveTo(i+d,n-s),e.lineTo(i-d,n+s);break;case"line":s=r?r/2:Math.cos(g)*m,a=Math.sin(g)*m,e.moveTo(i-s,n-a),e.lineTo(i+s,n+a);break;case"dash":e.moveTo(i,n),e.lineTo(i+Math.cos(g)*(r?r/2:m),n+Math.sin(g)*m);break;case!1:e.closePath()}e.fill(),t.borderWidth>0&&e.stroke()}}function gu(e,t,i){return i=i||.5,!t||e&&e.x>t.left-i&&e.x<t.right+i&&e.y>t.top-i&&e.y<t.bottom+i}function _u(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function yu(e){e.restore()}function xu(e,t,i,n,r){if(!t)return e.lineTo(i.x,i.y);if("middle"===r){const n=(t.x+i.x)/2;e.lineTo(n,t.y),e.lineTo(n,i.y)}else"after"===r!=!!n?e.lineTo(t.x,i.y):e.lineTo(i.x,t.y);e.lineTo(i.x,i.y)}function vu(e,t,i,n){if(!t)return e.lineTo(i.x,i.y);e.bezierCurveTo(n?t.cp1x:t.cp2x,n?t.cp1y:t.cp2y,n?i.cp2x:i.cp1x,n?i.cp2y:i.cp1y,i.x,i.y)}function bu(e,t,i,n,r){if(r.strikethrough||r.underline){const o=e.measureText(n),s=t-o.actualBoundingBoxLeft,a=t+o.actualBoundingBoxRight,l=i-o.actualBoundingBoxAscent,c=i+o.actualBoundingBoxDescent,u=r.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=r.decorationWidth||2,e.moveTo(s,u),e.lineTo(a,u),e.stroke()}}function wu(e,t){const i=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=i}function Su(e,t,i,n,r,o={}){const s=$l(t)?t:[t],a=o.strokeWidth>0&&""!==o.strokeColor;let l,c;for(e.save(),e.font=r.string,function(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),Ul(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}(e,o),l=0;l<s.length;++l)c=s[l],o.backdrop&&wu(e,o.backdrop),a&&(o.strokeColor&&(e.strokeStyle=o.strokeColor),Ul(o.strokeWidth)||(e.lineWidth=o.strokeWidth),e.strokeText(c,i,n,o.maxWidth)),e.fillText(c,i,n,o.maxWidth),bu(e,i,n,c,o),n+=Number(r.lineHeight);e.restore()}function Tu(e,t){const{x:i,y:n,w:r,h:o,radius:s}=t;e.arc(i+s.topLeft,n+s.topLeft,s.topLeft,1.5*cc,cc,!0),e.lineTo(i,n+o-s.bottomLeft),e.arc(i+s.bottomLeft,n+o-s.bottomLeft,s.bottomLeft,cc,fc,!0),e.lineTo(i+r-s.bottomRight,n+o),e.arc(i+r-s.bottomRight,n+o-s.bottomRight,s.bottomRight,fc,0,!0),e.lineTo(i+r,n+s.topRight),e.arc(i+r-s.topRight,n+s.topRight,s.topRight,0,-fc,!0),e.lineTo(i+s.topLeft,n)}const Eu=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Cu=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function ku(e,t){const i=(""+e).match(Eu);if(!i||"normal"===i[1])return 1.2*t;switch(e=+i[2],i[3]){case"px":return e;case"%":e/=100}return t*e}const Mu=e=>+e||0;function Au(e,t){const i={},n=Vl(t),r=n?Object.keys(t):t,o=Vl(e)?n?i=>ql(e[i],e[t[i]]):t=>e[t]:()=>e;for(const e of r)i[e]=Mu(o(e));return i}function Pu(e){return Au(e,{top:"y",right:"x",bottom:"y",left:"x"})}function Iu(e){return Au(e,["topLeft","topRight","bottomLeft","bottomRight"])}function zu(e){const t=Pu(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Du(e,t){e=e||{},t=t||cu.font;let i=ql(e.size,t.size);"string"==typeof i&&(i=parseInt(i,10));let n=ql(e.style,t.style);n&&!(""+n).match(Cu)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const r={family:ql(e.family,t.family),lineHeight:ku(ql(e.lineHeight,t.lineHeight),i),size:i,style:n,weight:ql(e.weight,t.weight),string:""};return r.string=function(e){return!e||Ul(e.size)||Ul(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(r),r}function Lu(e,t,i,n){let r,o,s,a=!0;for(r=0,o=e.length;r<o;++r)if(s=e[r],void 0!==s&&(void 0!==t&&"function"==typeof s&&(s=s(t),a=!1),void 0!==i&&$l(s)&&(s=s[i%s.length],a=!1),void 0!==s))return n&&!a&&(n.cacheable=!1),s}function Ru(e,t){return Object.assign(Object.create(e),t)}function Ou(e,t=[""],i,n,r=(()=>e[0])){const o=i||e;void 0===n&&(n=Xu("_fallback",e));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:o,_fallback:n,_getTarget:r,override:i=>Ou([i,...e],t,o,n)};return new Proxy(s,{deleteProperty:(t,i)=>(delete t[i],delete t._keys,delete e[0][i],!0),get:(i,n)=>Uu(i,n,(()=>function(e,t,i,n){let r;for(const o of t)if(r=Xu(Nu(o,e),i),void 0!==r)return ju(e,r)?Wu(i,n,e,r):r}(n,t,e,i))),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e._scopes[0],t),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(e,t)=>Zu(e).includes(t),ownKeys:e=>Zu(e),set(e,t,i){const n=e._storage||(e._storage=r());return e[t]=n[t]=i,delete e._keys,!0}})}function Bu(e,t,i,n){const r={_cacheable:!1,_proxy:e,_context:t,_subProxy:i,_stack:new Set,_descriptors:Fu(e,n),setContext:t=>Bu(e,t,i,n),override:r=>Bu(e.override(r),t,i,n)};return new Proxy(r,{deleteProperty:(t,i)=>(delete t[i],delete e[i],!0),get:(e,t,i)=>Uu(e,t,(()=>function(e,t,i){const{_proxy:n,_context:r,_subProxy:o,_descriptors:s}=e;let a=n[t];ac(a)&&s.isScriptable(t)&&(a=function(e,t,i,n){const{_proxy:r,_context:o,_subProxy:s,_stack:a}=i;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);a.add(e);let l=t(o,s||n);a.delete(e),ju(e,l)&&(l=Wu(r._scopes,r,e,l));return l}(t,a,e,i));$l(a)&&a.length&&(a=function(e,t,i,n){const{_proxy:r,_context:o,_subProxy:s,_descriptors:a}=i;if(void 0!==o.index&&n(e))return t[o.index%t.length];if(Vl(t[0])){const i=t,n=r._scopes.filter((e=>e!==i));t=[];for(const l of i){const i=Wu(n,r,e,l);t.push(Bu(i,o,s&&s[e],a))}}return t}(t,a,e,s.isIndexable));ju(t,a)&&(a=Bu(a,r,o&&o[t],s));return a}(e,t,i))),getOwnPropertyDescriptor:(t,i)=>t._descriptors.allKeys?Reflect.has(e,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,i),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(t,i)=>Reflect.has(e,i),ownKeys:()=>Reflect.ownKeys(e),set:(t,i,n)=>(e[i]=n,delete t[i],!0)})}function Fu(e,t={scriptable:!0,indexable:!0}){const{_scriptable:i=t.scriptable,_indexable:n=t.indexable,_allKeys:r=t.allKeys}=e;return{allKeys:r,scriptable:i,indexable:n,isScriptable:ac(i)?i:()=>i,isIndexable:ac(n)?n:()=>n}}const Nu=(e,t)=>e?e+oc(t):t,ju=(e,t)=>Vl(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function Uu(e,t,i){if(Object.prototype.hasOwnProperty.call(e,t))return e[t];const n=i();return e[t]=n,n}function $u(e,t,i){return ac(e)?e(t,i):e}const Vu=(e,t)=>!0===e?t:"string"==typeof e?rc(t,e):void 0;function Gu(e,t,i,n,r){for(const o of t){const t=Vu(i,o);if(t){e.add(t);const o=$u(t._fallback,i,r);if(void 0!==o&&o!==i&&o!==n)return o}else if(!1===t&&void 0!==n&&i!==n)return null}return!1}function Wu(e,t,i,n){const r=t._rootScopes,o=$u(t._fallback,i,n),s=[...e,...r],a=new Set;a.add(n);let l=qu(a,s,i,o||i,n);return null!==l&&((void 0===o||o===i||(l=qu(a,s,o,l,n),null!==l))&&Ou(Array.from(a),[""],r,o,(()=>function(e,t,i){const n=e._getTarget();t in n||(n[t]={});const r=n[t];if($l(r)&&Vl(i))return i;return r||{}}(t,i,n))))}function qu(e,t,i,n,r){for(;i;)i=Gu(e,t,i,n,r);return i}function Xu(e,t){for(const i of t){if(!i)continue;const t=i[e];if(void 0!==t)return t}}function Zu(e){let t=e._keys;return t||(t=e._keys=function(e){const t=new Set;for(const i of e)for(const e of Object.keys(i).filter((e=>!e.startsWith("_"))))t.add(e);return Array.from(t)}(e._scopes)),t}function Hu(e,t,i,n){const{iScale:r}=e,{key:o="r"}=this._parsing,s=new Array(n);let a,l,c,u;for(a=0,l=n;a<l;++a)c=a+i,u=t[c],s[a]={r:r.parse(rc(u,o),c)};return s}const Yu=Number.EPSILON||1e-14,Ku=(e,t)=>t<e.length&&!e[t].skip&&e[t],Ju=e=>"x"===e?"y":"x";function Qu(e,t,i,n){const r=e.skip?t:e,o=t,s=i.skip?t:i,a=kc(o,r),l=kc(s,o);let c=a/(a+l),u=l/(a+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const h=n*c,d=n*u;return{previous:{x:o.x-h*(s.x-r.x),y:o.y-h*(s.y-r.y)},next:{x:o.x+d*(s.x-r.x),y:o.y+d*(s.y-r.y)}}}function eh(e,t="x"){const i=Ju(t),n=e.length,r=Array(n).fill(0),o=Array(n);let s,a,l,c=Ku(e,0);for(s=0;s<n;++s)if(a=l,l=c,c=Ku(e,s+1),l){if(c){const e=c[t]-l[t];r[s]=0!==e?(c[i]-l[i])/e:0}o[s]=a?c?yc(r[s-1])!==yc(r[s])?0:(r[s-1]+r[s])/2:r[s-1]:r[s]}!function(e,t,i){const n=e.length;let r,o,s,a,l,c=Ku(e,0);for(let u=0;u<n-1;++u)l=c,c=Ku(e,u+1),l&&c&&(xc(t[u],0,Yu)?i[u]=i[u+1]=0:(r=i[u]/t[u],o=i[u+1]/t[u],a=Math.pow(r,2)+Math.pow(o,2),a<=9||(s=3/Math.sqrt(a),i[u]=r*s*t[u],i[u+1]=o*s*t[u])))}(e,r,o),function(e,t,i="x"){const n=Ju(i),r=e.length;let o,s,a,l=Ku(e,0);for(let c=0;c<r;++c){if(s=a,a=l,l=Ku(e,c+1),!a)continue;const r=a[i],u=a[n];s&&(o=(r-s[i])/3,a[`cp1${i}`]=r-o,a[`cp1${n}`]=u-o*t[c]),l&&(o=(l[i]-r)/3,a[`cp2${i}`]=r+o,a[`cp2${n}`]=u+o*t[c])}}(e,o,t)}function th(e,t,i){return Math.max(Math.min(e,i),t)}function ih(e,t,i,n,r){let o,s,a,l;if(t.spanGaps&&(e=e.filter((e=>!e.skip))),"monotone"===t.cubicInterpolationMode)eh(e,r);else{let i=n?e[e.length-1]:e[0];for(o=0,s=e.length;o<s;++o)a=e[o],l=Qu(i,a,e[Math.min(o+1,s-(n?0:1))%s],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,i=a}t.capBezierPoints&&function(e,t){let i,n,r,o,s,a=gu(e[0],t);for(i=0,n=e.length;i<n;++i)s=o,o=a,a=i<n-1&&gu(e[i+1],t),o&&(r=e[i],s&&(r.cp1x=th(r.cp1x,t.left,t.right),r.cp1y=th(r.cp1y,t.top,t.bottom)),a&&(r.cp2x=th(r.cp2x,t.left,t.right),r.cp2y=th(r.cp2y,t.top,t.bottom)))}(e,i)}function nh(){return"undefined"!=typeof window&&"undefined"!=typeof document}function rh(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function oh(e,t,i){let n;return"string"==typeof e?(n=parseInt(e,10),-1!==e.indexOf("%")&&(n=n/100*t.parentNode[i])):n=e,n}const sh=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);const ah=["top","right","bottom","left"];function lh(e,t,i){const n={};i=i?"-"+i:"";for(let r=0;r<4;r++){const o=ah[r];n[o]=parseFloat(e[t+"-"+o+i])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const ch=(e,t,i)=>(e>0||t>0)&&(!i||!i.shadowRoot);function uh(e,t){if("native"in e)return e;const{canvas:i,currentDevicePixelRatio:n}=t,r=sh(i),o="border-box"===r.boxSizing,s=lh(r,"padding"),a=lh(r,"border","width"),{x:l,y:c,box:u}=function(e,t){const i=e.touches,n=i&&i.length?i[0]:e,{offsetX:r,offsetY:o}=n;let s,a,l=!1;if(ch(r,o,e.target))s=r,a=o;else{const e=t.getBoundingClientRect();s=n.clientX-e.left,a=n.clientY-e.top,l=!0}return{x:s,y:a,box:l}}(e,i),h=s.left+(u&&a.left),d=s.top+(u&&a.top);let{width:p,height:f}=t;return o&&(p-=s.width+a.width,f-=s.height+a.height),{x:Math.round((l-h)/p*i.width/n),y:Math.round((c-d)/f*i.height/n)}}const hh=e=>Math.round(10*e)/10;function dh(e,t,i,n){const r=sh(e),o=lh(r,"margin"),s=oh(r.maxWidth,e,"clientWidth")||dc,a=oh(r.maxHeight,e,"clientHeight")||dc,l=function(e,t,i){let n,r;if(void 0===t||void 0===i){const o=rh(e);if(o){const e=o.getBoundingClientRect(),s=sh(o),a=lh(s,"border","width"),l=lh(s,"padding");t=e.width-l.width-a.width,i=e.height-l.height-a.height,n=oh(s.maxWidth,o,"clientWidth"),r=oh(s.maxHeight,o,"clientHeight")}else t=e.clientWidth,i=e.clientHeight}return{width:t,height:i,maxWidth:n||dc,maxHeight:r||dc}}(e,t,i);let{width:c,height:u}=l;if("content-box"===r.boxSizing){const e=lh(r,"border","width"),t=lh(r,"padding");c-=t.width+e.width,u-=t.height+e.height}c=Math.max(0,c-o.width),u=Math.max(0,n?c/n:u-o.height),c=hh(Math.min(c,s,l.maxWidth)),u=hh(Math.min(u,a,l.maxHeight)),c&&!u&&(u=hh(c/2));return(void 0!==t||void 0!==i)&&n&&l.height&&u>l.height&&(u=l.height,c=hh(Math.floor(u*n))),{width:c,height:u}}function ph(e,t,i){const n=t||1,r=Math.floor(e.height*n),o=Math.floor(e.width*n);e.height=Math.floor(e.height),e.width=Math.floor(e.width);const s=e.canvas;return s.style&&(i||!s.style.height&&!s.style.width)&&(s.style.height=`${e.height}px`,s.style.width=`${e.width}px`),(e.currentDevicePixelRatio!==n||s.height!==r||s.width!==o)&&(e.currentDevicePixelRatio=n,s.height=r,s.width=o,e.ctx.setTransform(n,0,0,n,0,0),!0)}const fh=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e}();function mh(e,t){const i=function(e,t){return sh(e).getPropertyValue(t)}(e,t),n=i&&i.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function gh(e,t,i,n){return{x:e.x+i*(t.x-e.x),y:e.y+i*(t.y-e.y)}}function _h(e,t,i,n){return{x:e.x+i*(t.x-e.x),y:"middle"===n?i<.5?e.y:t.y:"after"===n?i<1?e.y:t.y:i>0?t.y:e.y}}function yh(e,t,i,n){const r={x:e.cp2x,y:e.cp2y},o={x:t.cp1x,y:t.cp1y},s=gh(e,r,i),a=gh(r,o,i),l=gh(o,t,i),c=gh(s,a,i),u=gh(a,l,i);return gh(c,u,i)}function xh(e,t,i){return e?function(e,t){return{x:i=>e+e+t-i,setWidth(e){t=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,t)=>e-t,leftForLtr:(e,t)=>e-t}}(t,i):{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}}function vh(e,t){let i,n;"ltr"!==t&&"rtl"!==t||(i=e.canvas.style,n=[i.getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",t,"important"),e.prevTextDirection=n)}function bh(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function wh(e){return"angle"===e?{between:Pc,compare:Mc,normalize:Ac}:{between:zc,compare:(e,t)=>e-t,normalize:e=>e}}function Sh({start:e,end:t,count:i,loop:n,style:r}){return{start:e%i,end:t%i,loop:n&&(t-e+1)%i==0,style:r}}function Th(e,t,i){if(!i)return[e];const{property:n,start:r,end:o}=i,s=t.length,{compare:a,between:l,normalize:c}=wh(n),{start:u,end:h,loop:d,style:p}=function(e,t,i){const{property:n,start:r,end:o}=i,{between:s,normalize:a}=wh(n),l=t.length;let c,u,{start:h,end:d,loop:p}=e;if(p){for(h+=l,d+=l,c=0,u=l;c<u&&s(a(t[h%l][n]),r,o);++c)h--,d--;h%=l,d%=l}return d<h&&(d+=l),{start:h,end:d,loop:p,style:e.style}}(e,t,i),f=[];let m,g,_,y=!1,x=null;const v=()=>y||l(r,_,m)&&0!==a(r,_),b=()=>!y||0===a(o,m)||l(o,_,m);for(let e=u,i=u;e<=h;++e)g=t[e%s],g.skip||(m=c(g[n]),m!==_&&(y=l(m,r,o),null===x&&v()&&(x=0===a(m,r)?e:i),null!==x&&b()&&(f.push(Sh({start:x,end:e,loop:d,count:s,style:p})),x=null),i=e,_=m));return null!==x&&f.push(Sh({start:x,end:h,loop:d,count:s,style:p})),f}function Eh(e,t){const i=[],n=e.segments;for(let r=0;r<n.length;r++){const o=Th(n[r],e.points,t);o.length&&i.push(...o)}return i}function Ch(e,t,i,n){return n&&n.setContext&&i?function(e,t,i,n){const r=e._chart.getContext(),o=kh(e.options),{_datasetIndex:s,options:{spanGaps:a}}=e,l=i.length,c=[];let u=o,h=t[0].start,d=h;function p(e,t,n,r){const o=a?-1:1;if(e!==t){for(e+=l;i[e%l].skip;)e-=o;for(;i[t%l].skip;)t+=o;e%l!=t%l&&(c.push({start:e%l,end:t%l,loop:n,style:r}),u=r,h=t%l)}}for(const e of t){h=a?h:e.start;let t,o=i[h%l];for(d=h+1;d<=e.end;d++){const a=i[d%l];t=kh(n.setContext(Ru(r,{type:"segment",p0:o,p1:a,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:s}))),Mh(t,u)&&p(h,d-1,e.loop,u),o=a,u=t}h<d-1&&p(h,d-1,e.loop,u)}return c}(e,t,i,n):t}function kh(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function Mh(e,t){if(!t)return!1;const i=[],n=function(e,t){return Hc(t)?(i.includes(t)||i.push(t),i.indexOf(t)):t};return JSON.stringify(e,n)!==JSON.stringify(t,n)}class Ah{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,i,n){const r=t.listeners[n],o=t.duration;r.forEach((n=>n({chart:e,initial:t.initial,numSteps:o,currentStep:Math.min(i-t.start,o)})))}_refresh(){this._request||(this._running=!0,this._request=Nc.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(e=Date.now()){let t=0;this._charts.forEach(((i,n)=>{if(!i.running||!i.items.length)return;const r=i.items;let o,s=r.length-1,a=!1;for(;s>=0;--s)o=r[s],o._active?(o._total>i.duration&&(i.duration=o._total),o.tick(e),a=!0):(r[s]=r[r.length-1],r.pop());a&&(n.draw(),this._notify(n,i,e,"progress")),r.length||(i.running=!1,this._notify(n,i,e,"complete"),i.initial=!1),t+=r.length})),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){const t=this._charts;let i=t.get(e);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,i)),i}listen(e,t,i){this._getAnims(e).listeners[t].push(i)}add(e,t){t&&t.length&&this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce(((e,t)=>Math.max(e,t._duration)),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!!(t&&t.running&&t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const i=t.items;let n=i.length-1;for(;n>=0;--n)i[n].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Ph=new Ah;const Ih="transparent",zh={boolean:(e,t,i)=>i>.5?t:e,color(e,t,i){const n=Yc(e||Ih),r=n.valid&&Yc(t||Ih);return r&&r.valid?r.mix(n,i).hexString():t},number:(e,t,i)=>e+(t-e)*i};class Dh{constructor(e,t,i,n){const r=t[i];n=Lu([e.to,n,r,e.from]);const o=Lu([e.from,r,n]);this._active=!0,this._fn=e.fn||zh[e.type||typeof o],this._easing=Zc[e.easing]||Zc.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=i,this._from=o,this._to=n,this._promises=void 0}active(){return this._active}update(e,t,i){if(this._active){this._notify(!1);const n=this._target[this._prop],r=i-this._start,o=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(o,e.duration)),this._total+=r,this._loop=!!e.loop,this._to=Lu([e.to,t,n,e.from]),this._from=Lu([e.from,n,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,i=this._duration,n=this._prop,r=this._from,o=this._loop,s=this._to;let a;if(this._active=r!==s&&(o||t<i),!this._active)return this._target[n]=s,void this._notify(!0);t<0?this._target[n]=r:(a=t/i%2,a=o&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[n]=this._fn(r,s,a))}wait(){const e=this._promises||(this._promises=[]);return new Promise(((t,i)=>{e.push({res:t,rej:i})}))}_notify(e){const t=e?"res":"rej",i=this._promises||[];for(let e=0;e<i.length;e++)i[e][t]()}}class Lh{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!Vl(e))return;const t=Object.keys(cu.animation),i=this._properties;Object.getOwnPropertyNames(e).forEach((n=>{const r=e[n];if(!Vl(r))return;const o={};for(const e of t)o[e]=r[e];($l(r.properties)&&r.properties||[n]).forEach((e=>{e!==n&&i.has(e)||i.set(e,o)}))}))}_animateOptions(e,t){const i=t.options,n=function(e,t){if(!t)return;let i=e.options;if(!i)return void(e.options=t);i.$shared&&(e.options=i=Object.assign({},i,{$shared:!1,$animations:{}}));return i}(e,i);if(!n)return[];const r=this._createAnimations(n,i);return i.$shared&&function(e,t){const i=[],n=Object.keys(t);for(let t=0;t<n.length;t++){const r=e[n[t]];r&&r.active()&&i.push(r.wait())}return Promise.all(i)}(e.options.$animations,i).then((()=>{e.options=i}),(()=>{})),r}_createAnimations(e,t){const i=this._properties,n=[],r=e.$animations||(e.$animations={}),o=Object.keys(t),s=Date.now();let a;for(a=o.length-1;a>=0;--a){const l=o[a];if("$"===l.charAt(0))continue;if("options"===l){n.push(...this._animateOptions(e,t));continue}const c=t[l];let u=r[l];const h=i.get(l);if(u){if(h&&u.active()){u.update(h,c,s);continue}u.cancel()}h&&h.duration?(r[l]=u=new Dh(h,e,l,c),n.push(u)):e[l]=c}return n}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);const i=this._createAnimations(e,t);return i.length?(Ph.add(this._chart,i),!0):void 0}}function Rh(e,t){const i=e&&e.options||{},n=i.reverse,r=void 0===i.min?t:0,o=void 0===i.max?t:0;return{start:n?o:r,end:n?r:o}}function Oh(e,t){const i=[],n=e._getSortedDatasetMetas(t);let r,o;for(r=0,o=n.length;r<o;++r)i.push(n[r].index);return i}function Bh(e,t,i,n={}){const r=e.keys,o="single"===n.mode;let s,a,l,c;if(null!==t){for(s=0,a=r.length;s<a;++s){if(l=+r[s],l===i){if(n.all)continue;break}c=e.values[l],Gl(c)&&(o||0===t||yc(t)===yc(c))&&(t+=c)}return t}}function Fh(e,t){const i=e&&e.options.stacked;return i||void 0===i&&void 0!==t.stack}function Nh(e,t,i){const n=e[t]||(e[t]={});return n[i]||(n[i]={})}function jh(e,t,i,n){for(const r of t.getMatchingVisibleMetas(n).reverse()){const t=e[r.index];if(i&&t>0||!i&&t<0)return r.index}return null}function Uh(e,t){const{chart:i,_cachedMeta:n}=e,r=i._stacks||(i._stacks={}),{iScale:o,vScale:s,index:a}=n,l=o.axis,c=s.axis,u=function(e,t,i){return`${e.id}.${t.id}.${i.stack||i.type}`}(o,s,n),h=t.length;let d;for(let e=0;e<h;++e){const i=t[e],{[l]:o,[c]:h}=i;d=(i._stacks||(i._stacks={}))[c]=Nh(r,u,o),d[a]=h,d._top=jh(d,s,!0,n.type),d._bottom=jh(d,s,!1,n.type);(d._visualValues||(d._visualValues={}))[a]=h}}function $h(e,t){const i=e.scales;return Object.keys(i).filter((e=>i[e].axis===t)).shift()}function Vh(e,t){const i=e.controller.index,n=e.vScale&&e.vScale.axis;if(n){t=t||e._parsed;for(const e of t){const t=e._stacks;if(!t||void 0===t[n]||void 0===t[n][i])return;delete t[n][i],void 0!==t[n]._visualValues&&void 0!==t[n]._visualValues[i]&&delete t[n]._visualValues[i]}}}const Gh=e=>"reset"===e||"none"===e,Wh=(e,t)=>t?e:Object.assign({},e);class qh{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Fh(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&Vh(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,i=this.getDataset(),n=(e,t,i,n)=>"x"===e?t:"r"===e?n:i,r=t.xAxisID=ql(i.xAxisID,$h(e,"x")),o=t.yAxisID=ql(i.yAxisID,$h(e,"y")),s=t.rAxisID=ql(i.rAxisID,$h(e,"r")),a=t.indexAxis,l=t.iAxisID=n(a,r,o,s),c=t.vAxisID=n(a,o,r,s);t.xScale=this.getScaleForId(r),t.yScale=this.getScaleForId(o),t.rScale=this.getScaleForId(s),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&Bc(this._data,this),e._stacked&&Vh(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),i=this._data;if(Vl(t))this._data=function(e){const t=Object.keys(e),i=new Array(t.length);let n,r,o;for(n=0,r=t.length;n<r;++n)o=t[n],i[n]={x:o,y:e[o]};return i}(t);else if(i!==t){if(i){Bc(i,this);const e=this._cachedMeta;Vh(e),e._parsed=[]}t&&Object.isExtensible(t)&&(r=this,(n=t)._chartjs?n._chartjs.listeners.push(r):(Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),Oc.forEach((e=>{const t="_onData"+oc(e),i=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...e){const r=i.apply(this,e);return n._chartjs.listeners.forEach((i=>{"function"==typeof i[t]&&i[t](...e)})),r}})})))),this._syncList=[],this._data=t}var n,r}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,i=this.getDataset();let n=!1;this._dataCheck();const r=t._stacked;t._stacked=Fh(t.vScale,t),t.stack!==i.stack&&(n=!0,Vh(t),t.stack=i.stack),this._resyncElements(e),(n||r!==t._stacked)&&Uh(this,t._parsed)}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),i=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:i,_data:n}=this,{iScale:r,_stacked:o}=i,s=r.axis;let a,l,c,u=0===e&&t===n.length||i._sorted,h=e>0&&i._parsed[e-1];if(!1===this._parsing)i._parsed=n,i._sorted=!0,c=n;else{c=$l(n[e])?this.parseArrayData(i,n,e,t):Vl(n[e])?this.parseObjectData(i,n,e,t):this.parsePrimitiveData(i,n,e,t);const r=()=>null===l[s]||h&&l[s]<h[s];for(a=0;a<t;++a)i._parsed[a+e]=l=c[a],u&&(r()&&(u=!1),h=l);i._sorted=u}o&&Uh(this,c)}parsePrimitiveData(e,t,i,n){const{iScale:r,vScale:o}=e,s=r.axis,a=o.axis,l=r.getLabels(),c=r===o,u=new Array(n);let h,d,p;for(h=0,d=n;h<d;++h)p=h+i,u[h]={[s]:c||r.parse(l[p],p),[a]:o.parse(t[p],p)};return u}parseArrayData(e,t,i,n){const{xScale:r,yScale:o}=e,s=new Array(n);let a,l,c,u;for(a=0,l=n;a<l;++a)c=a+i,u=t[c],s[a]={x:r.parse(u[0],c),y:o.parse(u[1],c)};return s}parseObjectData(e,t,i,n){const{xScale:r,yScale:o}=e,{xAxisKey:s="x",yAxisKey:a="y"}=this._parsing,l=new Array(n);let c,u,h,d;for(c=0,u=n;c<u;++c)h=c+i,d=t[h],l[c]={x:r.parse(rc(d,s),h),y:o.parse(rc(d,a),h)};return l}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,i){const n=this.chart,r=this._cachedMeta,o=t[e.axis];return Bh({keys:Oh(n,!0),values:t._stacks[e.axis]._visualValues},o,r.index,{mode:i})}updateRangeFromParsed(e,t,i,n){const r=i[t.axis];let o=null===r?NaN:r;const s=n&&i._stacks[t.axis];n&&s&&(n.values=s,o=Bh(n,r,this._cachedMeta.index)),e.min=Math.min(e.min,o),e.max=Math.max(e.max,o)}getMinMax(e,t){const i=this._cachedMeta,n=i._parsed,r=i._sorted&&e===i.iScale,o=n.length,s=this._getOtherScale(e),a=((e,t,i)=>e&&!t.hidden&&t._stacked&&{keys:Oh(i,!0),values:null})(t,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(e){const{min:t,max:i,minDefined:n,maxDefined:r}=e.getUserBounds();return{min:n?t:Number.NEGATIVE_INFINITY,max:r?i:Number.POSITIVE_INFINITY}}(s);let h,d;function p(){d=n[h];const t=d[s.axis];return!Gl(d[e.axis])||c>t||u<t}for(h=0;h<o&&(p()||(this.updateRangeFromParsed(l,e,d,a),!r));++h);if(r)for(h=o-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(l,e,d,a);break}return l}getAllParsedValues(e){const t=this._cachedMeta._parsed,i=[];let n,r,o;for(n=0,r=t.length;n<r;++n)o=t[n][e.axis],Gl(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,i=t.iScale,n=t.vScale,r=this.getParsed(e);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:n?""+n.getLabelForValue(r[n.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=function(e){let t,i,n,r;return Vl(e)?(t=e.top,i=e.right,n=e.bottom,r=e.left):t=i=n=r=e,{top:t,right:i,bottom:n,left:r,disabled:!1===e}}(ql(this.options.clip,function(e,t,i){if(!1===i)return!1;const n=Rh(e,i),r=Rh(t,i);return{top:r.end,right:n.end,bottom:r.start,left:n.start}}(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,i=this._cachedMeta,n=i.data||[],r=t.chartArea,o=[],s=this._drawStart||0,a=this._drawCount||n.length-s,l=this.options.drawActiveElementsOnTop;let c;for(i.dataset&&i.dataset.draw(e,r,s,a),c=s;c<s+a;++c){const t=n[c];t.hidden||(t.active&&l?o.push(t):t.draw(e,r))}for(c=0;c<o.length;++c)o[c].draw(e,r)}getStyle(e,t){const i=t?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(e||0,i)}getContext(e,t,i){const n=this.getDataset();let r;if(e>=0&&e<this._cachedMeta.data.length){const t=this._cachedMeta.data[e];r=t.$context||(t.$context=function(e,t,i){return Ru(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:i,index:t,mode:"default",type:"data"})}(this.getContext(),e,t)),r.parsed=this.getParsed(e),r.raw=n.data[e],r.index=r.dataIndex=e}else r=this.$context||(this.$context=function(e,t){return Ru(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),r.dataset=n,r.index=r.datasetIndex=this.index;return r.active=!!t,r.mode=i,r}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",i){const n="active"===t,r=this._cachedDataOpts,o=e+"-"+t,s=r[o],a=this.enableOptionSharing&&sc(i);if(s)return Wh(s,a);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,e),u=n?[`${e}Hover`,"hover",e,""]:[e,""],h=l.getOptionScopes(this.getDataset(),c),d=Object.keys(cu.elements[e]),p=l.resolveNamedOptions(h,d,(()=>this.getContext(i,n,t)),u);return p.$shared&&(p.$shared=a,r[o]=Object.freeze(Wh(p,a))),p}_resolveAnimations(e,t,i){const n=this.chart,r=this._cachedDataOpts,o=`animation-${t}`,s=r[o];if(s)return s;let a;if(!1!==n.options.animation){const n=this.chart.config,r=n.datasetAnimationScopeKeys(this._type,t),o=n.getOptionScopes(this.getDataset(),r);a=n.createResolver(o,this.getContext(e,i,t))}const l=new Lh(n,a&&a.animations);return a&&a._cacheable&&(r[o]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||Gh(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const i=this.resolveDataElementOptions(e,t),n=this._sharedOptions,r=this.getSharedOptions(i),o=this.includeOptions(t,r)||r!==n;return this.updateSharedOptions(r,t,i),{sharedOptions:r,includeOptions:o}}updateElement(e,t,i,n){Gh(n)?Object.assign(e,i):this._resolveAnimations(t,n).update(e,i)}updateSharedOptions(e,t,i){e&&!Gh(t)&&this._resolveAnimations(void 0,t).update(e,i)}_setStyle(e,t,i,n){e.active=n;const r=this.getStyle(t,n);this._resolveAnimations(t,i,n).update(e,{options:!n&&this.getSharedOptions(r)||r})}removeHoverStyle(e,t,i){this._setStyle(e,i,"active",!1)}setHoverStyle(e,t,i){this._setStyle(e,i,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,i=this._cachedMeta.data;for(const[e,t,i]of this._syncList)this[e](t,i);this._syncList=[];const n=i.length,r=t.length,o=Math.min(r,n);o&&this.parse(0,o),r>n?this._insertElements(n,r-n,e):r<n&&this._removeElements(r,n-r)}_insertElements(e,t,i=!0){const n=this._cachedMeta,r=n.data,o=e+t;let s;const a=e=>{for(e.length+=t,s=e.length-1;s>=o;s--)e[s]=e[s-t]};for(a(r),s=e;s<o;++s)r[s]=new this.dataElementType;this._parsing&&a(n._parsed),this.parse(e,t),i&&this.updateElements(r,e,t,"reset")}updateElements(e,t,i,n){}_removeElements(e,t){const i=this._cachedMeta;if(this._parsing){const n=i._parsed.splice(e,t);i._stacked&&Vh(i,n)}i.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,i,n]=e;this[t](i,n)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const i=arguments.length-2;i&&this._sync(["_insertElements",e,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function Xh(e){const t=e.iScale,i=function(e,t){if(!e._cache.$bar){const i=e.getMatchingVisibleMetas(t);let n=[];for(let t=0,r=i.length;t<r;t++)n=n.concat(i[t].controller.getAllParsedValues(e));e._cache.$bar=Fc(n.sort(((e,t)=>e-t)))}return e._cache.$bar}(t,e.type);let n,r,o,s,a=t._length;const l=()=>{32767!==o&&-32768!==o&&(sc(s)&&(a=Math.min(a,Math.abs(o-s)||a)),s=o)};for(n=0,r=i.length;n<r;++n)o=t.getPixelForValue(i[n]),l();for(s=void 0,n=0,r=t.ticks.length;n<r;++n)o=t.getPixelForTick(n),l();return a}function Zh(e,t,i,n){return $l(e)?function(e,t,i,n){const r=i.parse(e[0],n),o=i.parse(e[1],n),s=Math.min(r,o),a=Math.max(r,o);let l=s,c=a;Math.abs(s)>Math.abs(a)&&(l=a,c=s),t[i.axis]=c,t._custom={barStart:l,barEnd:c,start:r,end:o,min:s,max:a}}(e,t,i,n):t[i.axis]=i.parse(e,n),t}function Hh(e,t,i,n){const r=e.iScale,o=e.vScale,s=r.getLabels(),a=r===o,l=[];let c,u,h,d;for(c=i,u=i+n;c<u;++c)d=t[c],h={},h[r.axis]=a||r.parse(s[c],c),l.push(Zh(d,h,o,c));return l}function Yh(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function Kh(e,t,i,n){let r=t.borderSkipped;const o={};if(!r)return void(e.borderSkipped=o);if(!0===r)return void(e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:s,end:a,reverse:l,top:c,bottom:u}=function(e){let t,i,n,r,o;return e.horizontal?(t=e.base>e.x,i="left",n="right"):(t=e.base<e.y,i="bottom",n="top"),t?(r="end",o="start"):(r="start",o="end"),{start:i,end:n,reverse:t,top:r,bottom:o}}(e);"middle"===r&&i&&(e.enableBorderRadius=!0,(i._top||0)===n?r=c:(i._bottom||0)===n?r=u:(o[Jh(u,s,a,l)]=!0,r=c)),o[Jh(r,s,a,l)]=!0,e.borderSkipped=o}function Jh(e,t,i,n){var r,o,s;return n?(s=i,e=Qh(e=(r=e)===(o=t)?s:r===s?o:r,i,t)):e=Qh(e,t,i),e}function Qh(e,t,i){return"start"===e?t:"end"===e?i:e}function ed(e,{inflateAmount:t},i){e.inflateAmount="auto"===t?1===i?.33:0:t}class td extends qh{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:i,color:n}}=e.legend.options;return t.labels.map(((t,r)=>{const o=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,fontColor:n,lineWidth:o.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(r),index:r}}))}return[]}},onClick(e,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}}}};constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const i=this.getDataset().data,n=this._cachedMeta;if(!1===this._parsing)n._parsed=i;else{let r,o,s=e=>+i[e];if(Vl(i[e])){const{key:e="value"}=this._parsing;s=t=>+rc(i[t],e)}for(r=e,o=e+t;r<o;++r)n._parsed[r]=s(r)}}_getRotation(){return Sc(this.options.rotation-90)}_getCircumference(){return Sc(this.options.circumference)}_getRotationExtents(){let e=uc,t=-uc;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const n=this.chart.getDatasetMeta(i).controller,r=n._getRotation(),o=n._getCircumference();e=Math.min(e,r),t=Math.max(t,r+o)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:i}=t,n=this._cachedMeta,r=n.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,s=Math.max((Math.min(i.width,i.height)-o)/2,0),a=Math.min((l=this.options.cutout,c=s,"string"==typeof l&&l.endsWith("%")?parseFloat(l)/100:+l/c),1);var l,c;const u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:m,offsetY:g}=function(e,t,i){let n=1,r=1,o=0,s=0;if(t<uc){const a=e,l=a+t,c=Math.cos(a),u=Math.sin(a),h=Math.cos(l),d=Math.sin(l),p=(e,t,n)=>Pc(e,a,l,!0)?1:Math.max(t,t*i,n,n*i),f=(e,t,n)=>Pc(e,a,l,!0)?-1:Math.min(t,t*i,n,n*i),m=p(0,c,h),g=p(fc,u,d),_=f(cc,c,h),y=f(cc+fc,u,d);n=(m-_)/2,r=(g-y)/2,o=-(m+_)/2,s=-(g+y)/2}return{ratioX:n,ratioY:r,offsetX:o,offsetY:s}}(d,h,a),_=(i.width-o)/p,y=(i.height-o)/f,x=Math.max(Math.min(_,y)/2,0),v=Xl(this.options.radius,x),b=(v-Math.max(v*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*v,this.offsetY=g*v,n.total=this.calculateTotal(),this.outerRadius=v-b*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-b*u,0),this.updateElements(r,0,r.length,e)}_circumference(e,t){const i=this.options,n=this._cachedMeta,r=this._getCircumference();return t&&i.animation.animateRotate||!this.chart.getDataVisibility(e)||null===n._parsed[e]||n.data[e].hidden?0:this.calculateCircumference(n._parsed[e]*r/uc)}updateElements(e,t,i,n){const r="reset"===n,o=this.chart,s=o.chartArea,a=o.options.animation,l=(s.left+s.right)/2,c=(s.top+s.bottom)/2,u=r&&a.animateScale,h=u?0:this.innerRadius,d=u?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(t,n);let m,g=this._getRotation();for(m=0;m<t;++m)g+=this._circumference(m,r);for(m=t;m<t+i;++m){const t=this._circumference(m,r),i=e[m],o={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+t,circumference:t,outerRadius:d,innerRadius:h};f&&(o.options=p||this.resolveDataElementOptions(m,i.active?"active":n)),g+=t,this.updateElement(i,m,o,n)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let i,n=0;for(i=0;i<t.length;i++){const r=e._parsed[i];null===r||isNaN(r)||!this.chart.getDataVisibility(i)||t[i].hidden||(n+=Math.abs(r))}return n}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?uc*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=tu(t._parsed[e],i.options.locale);return{label:n[e]||"",value:r}}getMaxBorderWidth(e){let t=0;const i=this.chart;let n,r,o,s,a;if(!e)for(n=0,r=i.data.datasets.length;n<r;++n)if(i.isDatasetVisible(n)){o=i.getDatasetMeta(n),e=o.data,s=o.controller;break}if(!e)return 0;for(n=0,r=e.length;n<r;++n)a=s.resolveDataElementOptions(n),"inner"!==a.borderAlign&&(t=Math.max(t,a.borderWidth||0,a.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let i=0,n=e.length;i<n;++i){const e=this.resolveDataElementOptions(i);t=Math.max(t,e.offset||0,e.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let i=0;i<e;++i)this.chart.isDatasetVisible(i)&&(t+=this._getRingWeight(i));return t}_getRingWeight(e){return Math.max(ql(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class id extends qh{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:i,color:n}}=e.legend.options;return t.labels.map(((t,r)=>{const o=e.getDatasetMeta(0).controller.getStyle(r);return{text:t,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,fontColor:n,lineWidth:o.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(r),index:r}}))}return[]}},onClick(e,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,n=i.data.labels||[],r=tu(t._parsed[e].r,i.options.locale);return{label:n[e]||"",value:r}}parseObjectData(e,t,i,n){return Hu.bind(this)(e,t,i,n)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach(((e,i)=>{const n=this.getParsed(i).r;!isNaN(n)&&this.chart.getDataVisibility(i)&&(n<t.min&&(t.min=n),n>t.max&&(t.max=n))})),t}_updateRadius(){const e=this.chart,t=e.chartArea,i=e.options,n=Math.min(t.right-t.left,t.bottom-t.top),r=Math.max(n/2,0),o=(r-Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0))/e.getVisibleDatasetCount();this.outerRadius=r-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(e,t,i,n){const r="reset"===n,o=this.chart,s=o.options.animation,a=this._cachedMeta.rScale,l=a.xCenter,c=a.yCenter,u=a.getIndexAngle(0)-.5*cc;let h,d=u;const p=360/this.countVisibleElements();for(h=0;h<t;++h)d+=this._computeAngle(h,n,p);for(h=t;h<t+i;h++){const t=e[h];let i=d,f=d+this._computeAngle(h,n,p),m=o.getDataVisibility(h)?a.getDistanceFromCenterForValue(this.getParsed(h).r):0;d=f,r&&(s.animateScale&&(m=0),s.animateRotate&&(i=f=u));const g={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:i,endAngle:f,options:this.resolveDataElementOptions(h,t.active?"active":n)};this.updateElement(t,h,g,n)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach(((e,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&t++})),t}_computeAngle(e,t,i){return this.chart.getDataVisibility(e)?Sc(this.resolveDataElementOptions(e,t).angle||i):0}}var nd=Object.freeze({__proto__:null,BarController:class extends qh{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,t,i,n){return Hh(e,t,i,n)}parseArrayData(e,t,i,n){return Hh(e,t,i,n)}parseObjectData(e,t,i,n){const{iScale:r,vScale:o}=e,{xAxisKey:s="x",yAxisKey:a="y"}=this._parsing,l="x"===r.axis?s:a,c="x"===o.axis?s:a,u=[];let h,d,p,f;for(h=i,d=i+n;h<d;++h)f=t[h],p={},p[r.axis]=r.parse(rc(f,l),h),u.push(Zh(rc(f,c),p,o,h));return u}updateRangeFromParsed(e,t,i,n){super.updateRangeFromParsed(e,t,i,n);const r=i._custom;r&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,r.min),e.max=Math.max(e.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:i,vScale:n}=t,r=this.getParsed(e),o=r._custom,s=Yh(o)?"["+o.start+", "+o.end+"]":""+n.getLabelForValue(r[n.axis]);return{label:""+i.getLabelForValue(r[i.axis]),value:s}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,i,n){const r="reset"===n,{index:o,_cachedMeta:{vScale:s}}=this,a=s.getBasePixel(),l=s.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(t,n);for(let d=t;d<t+i;d++){const t=this.getParsed(d),i=r||Ul(t[s.axis])?{base:a,head:a}:this._calculateBarValuePixels(d),p=this._calculateBarIndexPixels(d,c),f=(t._stacks||{})[s.axis],m={horizontal:l,base:i.base,enableBorderRadius:!f||Yh(t._custom)||o===f._top||o===f._bottom,x:l?i.head:p.center,y:l?p.center:i.head,height:l?p.size:Math.abs(i.size),width:l?Math.abs(i.size):p.size};h&&(m.options=u||this.resolveDataElementOptions(d,e[d].active?"active":n));const g=m.options||e[d].options;Kh(m,g,f,o),ed(m,g,c.ratio),this.updateElement(e[d],d,m,n)}}_getStacks(e,t){const{iScale:i}=this._cachedMeta,n=i.getMatchingVisibleMetas(this._type).filter((e=>e.controller.options.grouped)),r=i.options.stacked,o=[],s=e=>{const i=e.controller.getParsed(t),n=i&&i[e.vScale.axis];if(Ul(n)||isNaN(n))return!0};for(const i of n)if((void 0===t||!s(i))&&((!1===r||-1===o.indexOf(i.stack)||void 0===r&&void 0===i.stack)&&o.push(i.stack),i.index===e))break;return o.length||o.push(void 0),o}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,i){const n=this._getStacks(e,i),r=void 0!==t?n.indexOf(t):-1;return-1===r?n.length-1:r}_getRuler(){const e=this.options,t=this._cachedMeta,i=t.iScale,n=[];let r,o;for(r=0,o=t.data.length;r<o;++r)n.push(i.getPixelForValue(this.getParsed(r)[i.axis],r));const s=e.barThickness;return{min:s||Xh(t),pixels:n,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:e.grouped,ratio:s?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:i,index:n},options:{base:r,minBarLength:o}}=this,s=r||0,a=this.getParsed(e),l=a._custom,c=Yh(l);let u,h,d=a[t.axis],p=0,f=i?this.applyStack(t,a,i):d;f!==d&&(p=f-d,f=d),c&&(d=l.barStart,f=l.barEnd-l.barStart,0!==d&&yc(d)!==yc(l.barEnd)&&(p=0),p+=d);const m=Ul(r)||c?p:r;let g=t.getPixelForValue(m);if(u=this.chart.getDataVisibility(e)?t.getPixelForValue(p+f):g,h=u-g,Math.abs(h)<o){h=function(e,t,i){return 0!==e?yc(e):(t.isHorizontal()?1:-1)*(t.min>=i?1:-1)}(h,t,s)*o,d===s&&(g-=h/2);const e=t.getPixelForDecimal(0),r=t.getPixelForDecimal(1),l=Math.min(e,r),p=Math.max(e,r);g=Math.max(Math.min(g,p),l),u=g+h,i&&!c&&(a._stacks[t.axis]._visualValues[n]=t.getValueForPixel(u)-t.getValueForPixel(g))}if(g===t.getPixelForValue(s)){const e=yc(h)*t.getLineWidthForValue(s)/2;g+=e,h-=e}return{size:h,base:g,head:u,center:u+h/2}}_calculateBarIndexPixels(e,t){const i=t.scale,n=this.options,r=n.skipNull,o=ql(n.maxBarThickness,1/0);let s,a;if(t.grouped){const i=r?this._getStackCount(e):t.stackCount,l="flex"===n.barThickness?function(e,t,i,n){const r=t.pixels,o=r[e];let s=e>0?r[e-1]:null,a=e<r.length-1?r[e+1]:null;const l=i.categoryPercentage;null===s&&(s=o-(null===a?t.end-t.start:a-o)),null===a&&(a=o+o-s);const c=o-(o-Math.min(s,a))/2*l;return{chunk:Math.abs(a-s)/2*l/n,ratio:i.barPercentage,start:c}}(e,t,n,i):function(e,t,i,n){const r=i.barThickness;let o,s;return Ul(r)?(o=t.min*i.categoryPercentage,s=i.barPercentage):(o=r*n,s=1),{chunk:o/n,ratio:s,start:t.pixels[e]-o/2}}(e,t,n,i),c=this._getStackIndex(this.index,this._cachedMeta.stack,r?e:void 0);s=l.start+l.chunk*c+l.chunk/2,a=Math.min(o,l.chunk*l.ratio)}else s=i.getPixelForValue(this.getParsed(e)[i.axis],e),a=Math.min(o,t.min*t.ratio);return{base:s-a/2,head:s+a/2,center:s,size:a}}draw(){const e=this._cachedMeta,t=e.vScale,i=e.data,n=i.length;let r=0;for(;r<n;++r)null!==this.getParsed(r)[t.axis]&&i[r].draw(this._ctx)}},BubbleController:class extends qh{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,i,n){const r=super.parsePrimitiveData(e,t,i,n);for(let e=0;e<r.length;e++)r[e]._custom=this.resolveDataElementOptions(e+i).radius;return r}parseArrayData(e,t,i,n){const r=super.parseArrayData(e,t,i,n);for(let e=0;e<r.length;e++){const n=t[i+e];r[e]._custom=ql(n[2],this.resolveDataElementOptions(e+i).radius)}return r}parseObjectData(e,t,i,n){const r=super.parseObjectData(e,t,i,n);for(let e=0;e<r.length;e++){const n=t[i+e];r[e]._custom=ql(n&&n.r&&+n.r,this.resolveDataElementOptions(e+i).radius)}return r}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=t,o=this.getParsed(e),s=n.getLabelForValue(o.x),a=r.getLabelForValue(o.y),l=o._custom;return{label:i[e]||"",value:"("+s+", "+a+(l?", "+l:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,i,n){const r="reset"===n,{iScale:o,vScale:s}=this._cachedMeta,{sharedOptions:a,includeOptions:l}=this._getSharedOptions(t,n),c=o.axis,u=s.axis;for(let h=t;h<t+i;h++){const t=e[h],i=!r&&this.getParsed(h),d={},p=d[c]=r?o.getPixelForDecimal(.5):o.getPixelForValue(i[c]),f=d[u]=r?s.getBasePixel():s.getPixelForValue(i[u]);d.skip=isNaN(p)||isNaN(f),l&&(d.options=a||this.resolveDataElementOptions(h,t.active?"active":n),r&&(d.options.radius=0)),this.updateElement(t,h,d,n)}}resolveDataElementOptions(e,t){const i=this.getParsed(e);let n=super.resolveDataElementOptions(e,t);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const r=n.radius;return"active"!==t&&(n.radius=0),n.radius+=ql(i&&i._custom,r),n}},DoughnutController:td,LineController:class extends qh{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:i,data:n=[],_dataset:r}=t,o=this.chart._animationsDisabled;let{start:s,count:a}=Vc(t,n,o);this._drawStart=s,this._drawCount=a,Gc(t)&&(s=0,a=n.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=n;const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:l},e),this.updateElements(n,s,a,e)}updateElements(e,t,i,n){const r="reset"===n,{iScale:o,vScale:s,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(t,n),h=o.axis,d=s.axis,{spanGaps:p,segment:f}=this.options,m=bc(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||r||"none"===n,_=t+i,y=e.length;let x=t>0&&this.getParsed(t-1);for(let i=0;i<y;++i){const p=e[i],y=g?p:{};if(i<t||i>=_){y.skip=!0;continue}const v=this.getParsed(i),b=Ul(v[d]),w=y[h]=o.getPixelForValue(v[h],i),S=y[d]=r||b?s.getBasePixel():s.getPixelForValue(a?this.applyStack(s,v,a):v[d],i);y.skip=isNaN(w)||isNaN(S)||b,y.stop=i>0&&Math.abs(v[h]-x[h])>m,f&&(y.parsed=v,y.raw=l.data[i]),u&&(y.options=c||this.resolveDataElementOptions(i,p.active?"active":n)),g||this.updateElement(p,i,y,n),x=v}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,i=t.options&&t.options.borderWidth||0,n=e.data||[];if(!n.length)return i;const r=n[0].size(this.resolveDataElementOptions(0)),o=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,r,o)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}},PieController:class extends td{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}},PolarAreaController:id,RadarController:class extends qh{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(e){const t=this._cachedMeta.vScale,i=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(i[t.axis])}}parseObjectData(e,t,i,n){return Hu.bind(this)(e,t,i,n)}update(e){const t=this._cachedMeta,i=t.dataset,n=t.data||[],r=t.iScale.getLabels();if(i.points=n,"resize"!==e){const t=this.resolveDatasetElementOptions(e);this.options.showLine||(t.borderWidth=0);const o={_loop:!0,_fullLoop:r.length===n.length,options:t};this.updateElement(i,void 0,o,e)}this.updateElements(n,0,n.length,e)}updateElements(e,t,i,n){const r=this._cachedMeta.rScale,o="reset"===n;for(let s=t;s<t+i;s++){const t=e[s],i=this.resolveDataElementOptions(s,t.active?"active":n),a=r.getPointPositionForValue(s,this.getParsed(s).r),l=o?r.xCenter:a.x,c=o?r.yCenter:a.y,u={x:l,y:c,angle:a.angle,skip:isNaN(l)||isNaN(c),options:i};this.updateElement(t,s,u,n)}}},ScatterController:class extends qh{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){const t=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:r}=t,o=this.getParsed(e),s=n.getLabelForValue(o.x),a=r.getLabelForValue(o.y);return{label:i[e]||"",value:"("+s+", "+a+")"}}update(e){const t=this._cachedMeta,{data:i=[]}=t,n=this.chart._animationsDisabled;let{start:r,count:o}=Vc(t,i,n);if(this._drawStart=r,this._drawCount=o,Gc(t)&&(r=0,o=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:o}=t;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!o._decimated,r.points=i;const s=this.resolveDatasetElementOptions(e);s.segment=this.options.segment,this.updateElement(r,void 0,{animated:!n,options:s},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(i,r,o,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,i,n){const r="reset"===n,{iScale:o,vScale:s,_stacked:a,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(t,n),u=this.getSharedOptions(c),h=this.includeOptions(n,u),d=o.axis,p=s.axis,{spanGaps:f,segment:m}=this.options,g=bc(f)?f:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||r||"none"===n;let y=t>0&&this.getParsed(t-1);for(let c=t;c<t+i;++c){const t=e[c],i=this.getParsed(c),f=_?t:{},x=Ul(i[p]),v=f[d]=o.getPixelForValue(i[d],c),b=f[p]=r||x?s.getBasePixel():s.getPixelForValue(a?this.applyStack(s,i,a):i[p],c);f.skip=isNaN(v)||isNaN(b)||x,f.stop=c>0&&Math.abs(i[d]-y[d])>g,m&&(f.parsed=i,f.raw=l.data[c]),h&&(f.options=u||this.resolveDataElementOptions(c,t.active?"active":n)),_||this.updateElement(t,c,f,n),y=i}this.updateSharedOptions(u,n,c)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}const i=e.dataset,n=i.options&&i.options.borderWidth||0;if(!t.length)return n;const r=t[0].size(this.resolveDataElementOptions(0)),o=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(n,r,o)/2}}});function rd(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class od{static override(e){Object.assign(od.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return rd()}parse(){return rd()}format(){return rd()}add(){return rd()}diff(){return rd()}startOf(){return rd()}endOf(){return rd()}}var sd=od;function ad(e,t,i,n){const{controller:r,data:o,_sorted:s}=e,a=r._cachedMeta.iScale;if(a&&t===a.axis&&"r"!==t&&s&&o.length){const e=a._reversePixels?Rc:Lc;if(!n)return e(o,t,i);if(r._sharedOptions){const n=o[0],r="function"==typeof n.getRange&&n.getRange(t);if(r){const n=e(o,t,i-r),s=e(o,t,i+r);return{lo:n.lo,hi:s.hi}}}}return{lo:0,hi:o.length-1}}function ld(e,t,i,n,r){const o=e.getSortedVisibleDatasetMetas(),s=i[t];for(let e=0,i=o.length;e<i;++e){const{index:i,data:a}=o[e],{lo:l,hi:c}=ad(o[e],t,s,r);for(let e=l;e<=c;++e){const t=a[e];t.skip||n(t,i,e)}}}function cd(e,t,i,n,r){const o=[];if(!r&&!e.isPointInArea(t))return o;return ld(e,i,t,(function(i,s,a){(r||gu(i,e.chartArea,0))&&i.inRange(t.x,t.y,n)&&o.push({element:i,datasetIndex:s,index:a})}),!0),o}function ud(e,t,i,n,r,o){let s=[];const a=function(e){const t=-1!==e.indexOf("x"),i=-1!==e.indexOf("y");return function(e,n){const r=t?Math.abs(e.x-n.x):0,o=i?Math.abs(e.y-n.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}(i);let l=Number.POSITIVE_INFINITY;return ld(e,i,t,(function(i,c,u){const h=i.inRange(t.x,t.y,r);if(n&&!h)return;const d=i.getCenterPoint(r);if(!(!!o||e.isPointInArea(d))&&!h)return;const p=a(t,d);p<l?(s=[{element:i,datasetIndex:c,index:u}],l=p):p===l&&s.push({element:i,datasetIndex:c,index:u})})),s}function hd(e,t,i,n,r,o){return o||e.isPointInArea(t)?"r"!==i||n?ud(e,t,i,n,r,o):function(e,t,i,n){let r=[];return ld(e,i,t,(function(e,i,o){const{startAngle:s,endAngle:a}=e.getProps(["startAngle","endAngle"],n),{angle:l}=Cc(e,{x:t.x,y:t.y});Pc(l,s,a)&&r.push({element:e,datasetIndex:i,index:o})})),r}(e,t,i,r):[]}function dd(e,t,i,n,r){const o=[],s="x"===i?"inXRange":"inYRange";let a=!1;return ld(e,i,t,((e,n,l)=>{e[s](t[i],r)&&(o.push({element:e,datasetIndex:n,index:l}),a=a||e.inRange(t.x,t.y,r))})),n&&!a?[]:o}var pd={evaluateInteractionItems:ld,modes:{index(e,t,i,n){const r=uh(t,e),o=i.axis||"x",s=i.includeInvisible||!1,a=i.intersect?cd(e,r,o,n,s):hd(e,r,o,!1,n,s),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach((e=>{const t=a[0].index,i=e.data[t];i&&!i.skip&&l.push({element:i,datasetIndex:e.index,index:t})})),l):[]},dataset(e,t,i,n){const r=uh(t,e),o=i.axis||"xy",s=i.includeInvisible||!1;let a=i.intersect?cd(e,r,o,n,s):hd(e,r,o,!1,n,s);if(a.length>0){const t=a[0].datasetIndex,i=e.getDatasetMeta(t).data;a=[];for(let e=0;e<i.length;++e)a.push({element:i[e],datasetIndex:t,index:e})}return a},point:(e,t,i,n)=>cd(e,uh(t,e),i.axis||"xy",n,i.includeInvisible||!1),nearest(e,t,i,n){const r=uh(t,e),o=i.axis||"xy",s=i.includeInvisible||!1;return hd(e,r,o,i.intersect,n,s)},x:(e,t,i,n)=>dd(e,uh(t,e),"x",i.intersect,n),y:(e,t,i,n)=>dd(e,uh(t,e),"y",i.intersect,n)}};const fd=["left","top","right","bottom"];function md(e,t){return e.filter((e=>e.pos===t))}function gd(e,t){return e.filter((e=>-1===fd.indexOf(e.pos)&&e.box.axis===t))}function _d(e,t){return e.sort(((e,i)=>{const n=t?i:e,r=t?e:i;return n.weight===r.weight?n.index-r.index:n.weight-r.weight}))}function yd(e,t){const i=function(e){const t={};for(const i of e){const{stack:e,pos:n,stackWeight:r}=i;if(!e||!fd.includes(n))continue;const o=t[e]||(t[e]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}(e),{vBoxMaxWidth:n,hBoxMaxHeight:r}=t;let o,s,a;for(o=0,s=e.length;o<s;++o){a=e[o];const{fullSize:s}=a.box,l=i[a.stack],c=l&&a.stackWeight/l.weight;a.horizontal?(a.width=c?c*n:s&&t.availableWidth,a.height=r):(a.width=n,a.height=c?c*r:s&&t.availableHeight)}return i}function xd(e,t,i,n){return Math.max(e[i],t[i])+Math.max(e[n],t[n])}function vd(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function bd(e,t,i,n){const{pos:r,box:o}=i,s=e.maxPadding;if(!Vl(r)){i.size&&(e[r]-=i.size);const t=n[i.stack]||{size:0,count:1};t.size=Math.max(t.size,i.horizontal?o.height:o.width),i.size=t.size/t.count,e[r]+=i.size}o.getPadding&&vd(s,o.getPadding());const a=Math.max(0,t.outerWidth-xd(s,e,"left","right")),l=Math.max(0,t.outerHeight-xd(s,e,"top","bottom")),c=a!==e.w,u=l!==e.h;return e.w=a,e.h=l,i.horizontal?{same:c,other:u}:{same:u,other:c}}function wd(e,t){const i=t.maxPadding;function n(e){const n={left:0,top:0,right:0,bottom:0};return e.forEach((e=>{n[e]=Math.max(t[e],i[e])})),n}return n(e?["left","right"]:["top","bottom"])}function Sd(e,t,i,n){const r=[];let o,s,a,l,c,u;for(o=0,s=e.length,c=0;o<s;++o){a=e[o],l=a.box,l.update(a.width||t.w,a.height||t.h,wd(a.horizontal,t));const{same:s,other:h}=bd(t,i,a,n);c|=s&&r.length,u=u||h,l.fullSize||r.push(a)}return c&&Sd(r,t,i,n)||u}function Td(e,t,i,n,r){e.top=i,e.left=t,e.right=t+n,e.bottom=i+r,e.width=n,e.height=r}function Ed(e,t,i,n){const r=i.padding;let{x:o,y:s}=t;for(const a of e){const e=a.box,l=n[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/l.weight||1;if(a.horizontal){const n=t.w*c,o=l.size||e.height;sc(l.start)&&(s=l.start),e.fullSize?Td(e,r.left,s,i.outerWidth-r.right-r.left,o):Td(e,t.left+l.placed,s,n,o),l.start=s,l.placed+=n,s=e.bottom}else{const n=t.h*c,s=l.size||e.width;sc(l.start)&&(o=l.start),e.fullSize?Td(e,o,r.top,s,i.outerHeight-r.bottom-r.top):Td(e,o,t.top+l.placed,s,n),l.start=o,l.placed+=n,o=e.right}}t.x=o,t.y=s}var Cd={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},e.boxes.push(t)},removeBox(e,t){const i=e.boxes?e.boxes.indexOf(t):-1;-1!==i&&e.boxes.splice(i,1)},configure(e,t,i){t.fullSize=i.fullSize,t.position=i.position,t.weight=i.weight},update(e,t,i,n){if(!e)return;const r=zu(e.options.layout.padding),o=Math.max(t-r.width,0),s=Math.max(i-r.height,0),a=function(e){const t=function(e){const t=[];let i,n,r,o,s,a;for(i=0,n=(e||[]).length;i<n;++i)r=e[i],({position:o,options:{stack:s,stackWeight:a=1}}=r),t.push({index:i,box:r,pos:o,horizontal:r.isHorizontal(),weight:r.weight,stack:s&&o+s,stackWeight:a});return t}(e),i=_d(t.filter((e=>e.box.fullSize)),!0),n=_d(md(t,"left"),!0),r=_d(md(t,"right")),o=_d(md(t,"top"),!0),s=_d(md(t,"bottom")),a=gd(t,"x"),l=gd(t,"y");return{fullSize:i,leftAndTop:n.concat(o),rightAndBottom:r.concat(l).concat(s).concat(a),chartArea:md(t,"chartArea"),vertical:n.concat(r).concat(l),horizontal:o.concat(s).concat(a)}}(e.boxes),l=a.vertical,c=a.horizontal;Hl(e.boxes,(e=>{"function"==typeof e.beforeLayout&&e.beforeLayout()}));const u=l.reduce(((e,t)=>t.box.options&&!1===t.box.options.display?e:e+1),0)||1,h=Object.freeze({outerWidth:t,outerHeight:i,padding:r,availableWidth:o,availableHeight:s,vBoxMaxWidth:o/2/u,hBoxMaxHeight:s/2}),d=Object.assign({},r);vd(d,zu(n));const p=Object.assign({maxPadding:d,w:o,h:s,x:r.left,y:r.top},r),f=yd(l.concat(c),h);Sd(a.fullSize,p,h,f),Sd(l,p,h,f),Sd(c,p,h,f)&&Sd(l,p,h,f),function(e){const t=e.maxPadding;function i(i){const n=Math.max(t[i]-e[i],0);return e[i]+=n,n}e.y+=i("top"),e.x+=i("left"),i("right"),i("bottom")}(p),Ed(a.leftAndTop,p,h,f),p.x+=p.w,p.y+=p.h,Ed(a.rightAndBottom,p,h,f),e.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},Hl(a.chartArea,(t=>{const i=t.box;Object.assign(i,e.chartArea),i.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})}))}};class kd{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,i){}removeEventListener(e,t,i){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,i,n){return t=Math.max(0,t||e.width),i=i||e.height,{width:t,height:Math.max(0,n?Math.floor(t/n):i)}}isAttached(e){return!0}updateConfig(e){}}class Md extends kd{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Ad="$chartjs",Pd={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Id=e=>null===e||""===e;const zd=!!fh&&{passive:!0};function Dd(e,t,i){e.canvas.removeEventListener(t,i,zd)}function Ld(e,t){for(const i of e)if(i===t||i.contains(t))return!0}function Rd(e,t,i){const n=e.canvas,r=new MutationObserver((e=>{let t=!1;for(const i of e)t=t||Ld(i.addedNodes,n),t=t&&!Ld(i.removedNodes,n);t&&i()}));return r.observe(document,{childList:!0,subtree:!0}),r}function Od(e,t,i){const n=e.canvas,r=new MutationObserver((e=>{let t=!1;for(const i of e)t=t||Ld(i.removedNodes,n),t=t&&!Ld(i.addedNodes,n);t&&i()}));return r.observe(document,{childList:!0,subtree:!0}),r}const Bd=new Map;let Fd=0;function Nd(){const e=window.devicePixelRatio;e!==Fd&&(Fd=e,Bd.forEach(((t,i)=>{i.currentDevicePixelRatio!==e&&t()})))}function jd(e,t,i){const n=e.canvas,r=n&&rh(n);if(!r)return;const o=jc(((e,t)=>{const n=r.clientWidth;i(e,t),n<r.clientWidth&&i()}),window),s=new ResizeObserver((e=>{const t=e[0],i=t.contentRect.width,n=t.contentRect.height;0===i&&0===n||o(i,n)}));return s.observe(r),function(e,t){Bd.size||window.addEventListener("resize",Nd),Bd.set(e,t)}(e,o),s}function Ud(e,t,i){i&&i.disconnect(),"resize"===t&&function(e){Bd.delete(e),Bd.size||window.removeEventListener("resize",Nd)}(e)}function $d(e,t,i){const n=e.canvas,r=jc((t=>{null!==e.ctx&&i(function(e,t){const i=Pd[e.type]||e.type,{x:n,y:r}=uh(e,t);return{type:i,chart:t,native:e,x:void 0!==n?n:null,y:void 0!==r?r:null}}(t,e))}),e);return function(e,t,i){e.addEventListener(t,i,zd)}(n,t,r),r}class Vd extends kd{acquireContext(e,t){const i=e&&e.getContext&&e.getContext("2d");return i&&i.canvas===e?(function(e,t){const i=e.style,n=e.getAttribute("height"),r=e.getAttribute("width");if(e[Ad]={initial:{height:n,width:r,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",Id(r)){const t=mh(e,"width");void 0!==t&&(e.width=t)}if(Id(n))if(""===e.style.height)e.height=e.width/(t||2);else{const t=mh(e,"height");void 0!==t&&(e.height=t)}}(e,t),i):null}releaseContext(e){const t=e.canvas;if(!t[Ad])return!1;const i=t[Ad].initial;["height","width"].forEach((e=>{const n=i[e];Ul(n)?t.removeAttribute(e):t.setAttribute(e,n)}));const n=i.style||{};return Object.keys(n).forEach((e=>{t.style[e]=n[e]})),t.width=t.width,delete t[Ad],!0}addEventListener(e,t,i){this.removeEventListener(e,t);const n=e.$proxies||(e.$proxies={}),r={attach:Rd,detach:Od,resize:jd}[t]||$d;n[t]=r(e,t,i)}removeEventListener(e,t){const i=e.$proxies||(e.$proxies={}),n=i[t];if(!n)return;({attach:Ud,detach:Ud,resize:Ud}[t]||Dd)(e,t,n),i[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,i,n){return dh(e,t,i,n)}isAttached(e){const t=rh(e);return!(!t||!t.isConnected)}}class Gd{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}hasValue(){return bc(this.x)&&bc(this.y)}getProps(e,t){const i=this.$animations;if(!t||!i)return this;const n={};return e.forEach((e=>{n[e]=i[e]&&i[e].active()?i[e]._to:this[e]})),n}}function Wd(e,t){const i=e.options.ticks,n=function(e){const t=e.options.offset,i=e._tickSize(),n=e._length/i+(t?0:1),r=e._maxLength/i;return Math.floor(Math.min(n,r))}(e),r=Math.min(i.maxTicksLimit||n,n),o=i.major.enabled?function(e){const t=[];let i,n;for(i=0,n=e.length;i<n;i++)e[i].major&&t.push(i);return t}(t):[],s=o.length,a=o[0],l=o[s-1],c=[];if(s>r)return function(e,t,i,n){let r,o=0,s=i[0];for(n=Math.ceil(n),r=0;r<e.length;r++)r===s&&(t.push(e[r]),o++,s=i[o*n])}(t,c,o,s/r),c;const u=function(e,t,i){const n=function(e){const t=e.length;let i,n;if(t<2)return!1;for(n=e[0],i=1;i<t;++i)if(e[i]-e[i-1]!==n)return!1;return n}(e),r=t.length/i;if(!n)return Math.max(r,1);const o=function(e){const t=[],i=Math.sqrt(e);let n;for(n=1;n<i;n++)e%n==0&&(t.push(n),t.push(e/n));return i===(0|i)&&t.push(i),t.sort(((e,t)=>e-t)).pop(),t}(n);for(let e=0,t=o.length-1;e<t;e++){const t=o[e];if(t>r)return t}return Math.max(r,1)}(o,t,r);if(s>0){let e,i;const n=s>1?Math.round((l-a)/(s-1)):null;for(qd(t,c,u,Ul(n)?0:a-n,a),e=0,i=s-1;e<i;e++)qd(t,c,u,o[e],o[e+1]);return qd(t,c,u,l,Ul(n)?t.length:l+n),c}return qd(t,c,u),c}function qd(e,t,i,n,r){const o=ql(n,0),s=Math.min(ql(r,e.length),e.length);let a,l,c,u=0;for(i=Math.ceil(i),r&&(a=r-n,i=a/Math.floor(a/i)),c=o;c<0;)u++,c=Math.round(o+u*i);for(l=Math.max(o,0);l<s;l++)l===c&&(t.push(e[l]),u++,c=Math.round(o+u*i))}const Xd=(e,t,i)=>"top"===t||"left"===t?e[t]+i:e[t]-i,Zd=(e,t)=>Math.min(t||e,e);function Hd(e,t){const i=[],n=e.length/t,r=e.length;let o=0;for(;o<r;o+=n)i.push(e[Math.floor(o)]);return i}function Yd(e,t,i){const n=e.ticks.length,r=Math.min(t,n-1),o=e._startPixel,s=e._endPixel,a=1e-6;let l,c=e.getPixelForTick(r);if(!(i&&(l=1===n?Math.max(c-o,s-c):0===t?(e.getPixelForTick(1)-c)/2:(c-e.getPixelForTick(r-1))/2,c+=r<t?l:-l,c<o-a||c>s+a)))return c}function Kd(e){return e.drawTicks?e.tickLength:0}function Jd(e,t){if(!e.display)return 0;const i=Du(e.font,t),n=zu(e.padding);return($l(e.text)?e.text.length:1)*i.lineHeight+n.height}function Qd(e,t,i){let n=Uc(e);return(i&&"right"!==t||!i&&"right"===t)&&(n=(e=>"left"===e?"right":"right"===e?"left":e)(n)),n}class ep extends Gd{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:i,_suggestedMax:n}=this;return e=Wl(e,Number.POSITIVE_INFINITY),t=Wl(t,Number.NEGATIVE_INFINITY),i=Wl(i,Number.POSITIVE_INFINITY),n=Wl(n,Number.NEGATIVE_INFINITY),{min:Wl(e,i),max:Wl(t,n),minDefined:Gl(e),maxDefined:Gl(t)}}getMinMax(e){let t,{min:i,max:n,minDefined:r,maxDefined:o}=this.getUserBounds();if(r&&o)return{min:i,max:n};const s=this.getMatchingVisibleMetas();for(let a=0,l=s.length;a<l;++a)t=s[a].controller.getMinMax(this,e),r||(i=Math.min(i,t.min)),o||(n=Math.max(n,t.max));return i=o&&i>n?n:i,n=r&&i>n?i:n,{min:Wl(i,Wl(n,i)),max:Wl(n,Wl(i,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Zl(this.options.beforeUpdate,[this])}update(e,t,i){const{beginAtZero:n,grace:r,ticks:o}=this.options,s=o.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(e,t,i){const{min:n,max:r}=e,o=Xl(t,(r-n)/2),s=(e,t)=>i&&0===e?0:e+t;return{min:s(n,-Math.abs(o)),max:s(r,o)}}(this,r,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=s<this.ticks.length;this._convertTicksToLabels(a?Hd(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||"auto"===o.source)&&(this.ticks=Wd(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,t,i=this.options.reverse;this.isHorizontal()?(e=this.left,t=this.right):(e=this.top,t=this.bottom,i=!i),this._startPixel=e,this._endPixel=t,this._reversePixels=i,this._length=t-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Zl(this.options.afterUpdate,[this])}beforeSetDimensions(){Zl(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Zl(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Zl(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Zl(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let i,n,r;for(i=0,n=e.length;i<n;i++)r=e[i],r.label=Zl(t.callback,[r.value,i,e],this)}afterTickToLabelConversion(){Zl(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Zl(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,i=Zd(this.ticks.length,e.ticks.maxTicksLimit),n=t.minRotation||0,r=t.maxRotation;let o,s,a,l=n;if(!this._isVisible()||!t.display||n>=r||i<=1||!this.isHorizontal())return void(this.labelRotation=n);const c=this._getLabelSizes(),u=c.widest.width,h=c.highest.height,d=Ic(this.chart.width-u,0,this.maxWidth);o=e.offset?this.maxWidth/i:d/(i-1),u+6>o&&(o=d/(i-(e.offset?.5:1)),s=this.maxHeight-Kd(e.grid)-t.padding-Jd(e.title,this.chart.options.font),a=Math.sqrt(u*u+h*h),l=Tc(Math.min(Math.asin(Ic((c.highest.height+6)/o,-1,1)),Math.asin(Ic(s/a,-1,1))-Math.asin(Ic(h/a,-1,1)))),l=Math.max(n,Math.min(r,l))),this.labelRotation=l}afterCalculateLabelRotation(){Zl(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Zl(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:i,title:n,grid:r}}=this,o=this._isVisible(),s=this.isHorizontal();if(o){const o=Jd(n,t.options.font);if(s?(e.width=this.maxWidth,e.height=Kd(r)+o):(e.height=this.maxHeight,e.width=Kd(r)+o),i.display&&this.ticks.length){const{first:t,last:n,widest:r,highest:o}=this._getLabelSizes(),a=2*i.padding,l=Sc(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(s){const t=i.mirror?0:u*r.width+c*o.height;e.height=Math.min(this.maxHeight,e.height+t+a)}else{const t=i.mirror?0:c*r.width+u*o.height;e.width=Math.min(this.maxWidth,e.width+t+a)}this._calculatePadding(t,n,u,c)}}this._handleMargins(),s?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,i,n){const{ticks:{align:r,padding:o},position:s}=this.options,a=0!==this.labelRotation,l="top"!==s&&"x"===this.axis;if(this.isHorizontal()){const s=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;a?l?(u=n*e.width,h=i*t.height):(u=i*e.height,h=n*t.width):"start"===r?h=t.width:"end"===r?u=e.width:"inner"!==r&&(u=e.width/2,h=t.width/2),this.paddingLeft=Math.max((u-s+o)*this.width/(this.width-s),0),this.paddingRight=Math.max((h-c+o)*this.width/(this.width-c),0)}else{let i=t.height/2,n=e.height/2;"start"===r?(i=0,n=e.height):"end"===r&&(i=t.height,n=0),this.paddingTop=i+o,this.paddingBottom=n+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Zl(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,i=e.length;t<i;t++)Ul(e[t].label)&&(e.splice(t,1),i--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let i=this.ticks;t<i.length&&(i=Hd(i,t)),this._labelSizes=e=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,i){const{ctx:n,_longestTextCache:r}=this,o=[],s=[],a=Math.floor(t/Zd(t,i));let l,c,u,h,d,p,f,m,g,_,y,x=0,v=0;for(l=0;l<t;l+=a){if(h=e[l].label,d=this._resolveTickFontOptions(l),n.font=p=d.string,f=r[p]=r[p]||{data:{},gc:[]},m=d.lineHeight,g=_=0,Ul(h)||$l(h)){if($l(h))for(c=0,u=h.length;c<u;++c)y=h[c],Ul(y)||$l(y)||(g=uu(n,f.data,f.gc,g,y),_+=m)}else g=uu(n,f.data,f.gc,g,h),_=m;o.push(g),s.push(_),x=Math.max(g,x),v=Math.max(_,v)}!function(e,t){Hl(e,(e=>{const i=e.gc,n=i.length/2;let r;if(n>t){for(r=0;r<n;++r)delete e.data[i[r]];i.splice(0,n)}}))}(r,t);const b=o.indexOf(x),w=s.indexOf(v),S=e=>({width:o[e]||0,height:s[e]||0});return{first:S(0),last:S(t-1),widest:S(b),highest:S(w),widths:o,heights:s}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return Ic(this._alignToPixels?du(this.chart,t,0):t,-32768,32767)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const i=t[e];return i.$context||(i.$context=function(e,t,i){return Ru(e,{tick:i,index:t,type:"tick"})}(this.getContext(),e,i))}return this.$context||(this.$context=Ru(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const e=this.options.ticks,t=Sc(this.labelRotation),i=Math.abs(Math.cos(t)),n=Math.abs(Math.sin(t)),r=this._getLabelSizes(),o=e.autoSkipPadding||0,s=r?r.widest.width+o:0,a=r?r.highest.height+o:0;return this.isHorizontal()?a*i>s*n?s/i:a/n:a*n<s*i?a/i:s/n}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,i=this.chart,n=this.options,{grid:r,position:o,border:s}=n,a=r.offset,l=this.isHorizontal(),c=this.ticks.length+(a?1:0),u=Kd(r),h=[],d=s.setContext(this.getContext()),p=d.display?d.width:0,f=p/2,m=function(e){return du(i,e,p)};let g,_,y,x,v,b,w,S,T,E,C,k;if("top"===o)g=m(this.bottom),b=this.bottom-u,S=g-f,E=m(e.top)+f,k=e.bottom;else if("bottom"===o)g=m(this.top),E=e.top,k=m(e.bottom)-f,b=g+f,S=this.top+u;else if("left"===o)g=m(this.right),v=this.right-u,w=g-f,T=m(e.left)+f,C=e.right;else if("right"===o)g=m(this.left),T=e.left,C=m(e.right)-f,v=g+f,w=this.left+u;else if("x"===t){if("center"===o)g=m((e.top+e.bottom)/2+.5);else if(Vl(o)){const e=Object.keys(o)[0],t=o[e];g=m(this.chart.scales[e].getPixelForValue(t))}E=e.top,k=e.bottom,b=g+f,S=b+u}else if("y"===t){if("center"===o)g=m((e.left+e.right)/2);else if(Vl(o)){const e=Object.keys(o)[0],t=o[e];g=m(this.chart.scales[e].getPixelForValue(t))}v=g-f,w=v-u,T=e.left,C=e.right}const M=ql(n.ticks.maxTicksLimit,c),A=Math.max(1,Math.ceil(c/M));for(_=0;_<c;_+=A){const e=this.getContext(_),t=r.setContext(e),n=s.setContext(e),o=t.lineWidth,c=t.color,u=n.dash||[],d=n.dashOffset,p=t.tickWidth,f=t.tickColor,m=t.tickBorderDash||[],g=t.tickBorderDashOffset;y=Yd(this,_,a),void 0!==y&&(x=du(i,y,o),l?v=w=T=C=x:b=S=E=k=x,h.push({tx1:v,ty1:b,tx2:w,ty2:S,x1:T,y1:E,x2:C,y2:k,width:o,color:c,borderDash:u,borderDashOffset:d,tickWidth:p,tickColor:f,tickBorderDash:m,tickBorderDashOffset:g}))}return this._ticksLength=c,this._borderValue=g,h}_computeLabelItems(e){const t=this.axis,i=this.options,{position:n,ticks:r}=i,o=this.isHorizontal(),s=this.ticks,{align:a,crossAlign:l,padding:c,mirror:u}=r,h=Kd(i.grid),d=h+c,p=u?-c:d,f=-Sc(this.labelRotation),m=[];let g,_,y,x,v,b,w,S,T,E,C,k,M="middle";if("top"===n)b=this.bottom-p,w=this._getXAxisLabelAlignment();else if("bottom"===n)b=this.top+p,w=this._getXAxisLabelAlignment();else if("left"===n){const e=this._getYAxisLabelAlignment(h);w=e.textAlign,v=e.x}else if("right"===n){const e=this._getYAxisLabelAlignment(h);w=e.textAlign,v=e.x}else if("x"===t){if("center"===n)b=(e.top+e.bottom)/2+d;else if(Vl(n)){const e=Object.keys(n)[0],t=n[e];b=this.chart.scales[e].getPixelForValue(t)+d}w=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===n)v=(e.left+e.right)/2-d;else if(Vl(n)){const e=Object.keys(n)[0],t=n[e];v=this.chart.scales[e].getPixelForValue(t)}w=this._getYAxisLabelAlignment(h).textAlign}"y"===t&&("start"===a?M="top":"end"===a&&(M="bottom"));const A=this._getLabelSizes();for(g=0,_=s.length;g<_;++g){y=s[g],x=y.label;const e=r.setContext(this.getContext(g));S=this.getPixelForTick(g)+r.labelOffset,T=this._resolveTickFontOptions(g),E=T.lineHeight,C=$l(x)?x.length:1;const t=C/2,i=e.color,a=e.textStrokeColor,c=e.textStrokeWidth;let h,d=w;if(o?(v=S,"inner"===w&&(d=g===_-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),k="top"===n?"near"===l||0!==f?-C*E+E/2:"center"===l?-A.highest.height/2-t*E+E:-A.highest.height+E/2:"near"===l||0!==f?E/2:"center"===l?A.highest.height/2-t*E:A.highest.height-C*E,u&&(k*=-1),0===f||e.showLabelBackdrop||(v+=E/2*Math.sin(f))):(b=S,k=(1-C)*E/2),e.showLabelBackdrop){const t=zu(e.backdropPadding),i=A.heights[g],n=A.widths[g];let r=k-t.top,o=0-t.left;switch(M){case"middle":r-=i/2;break;case"bottom":r-=i}switch(w){case"center":o-=n/2;break;case"right":o-=n}h={left:o,top:r,width:n+t.width,height:i+t.height,color:e.backdropColor}}m.push({label:x,font:T,textOffset:k,options:{rotation:f,color:i,strokeColor:a,strokeWidth:c,textAlign:d,textBaseline:M,translation:[v,b],backdrop:h}})}return m}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Sc(this.labelRotation))return"top"===e?"left":"right";let i="center";return"start"===t.align?i="left":"end"===t.align?i="right":"inner"===t.align&&(i="inner"),i}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:i,mirror:n,padding:r}}=this.options,o=e+r,s=this._getLabelSizes().widest.width;let a,l;return"left"===t?n?(l=this.right+r,"near"===i?a="left":"center"===i?(a="center",l+=s/2):(a="right",l+=s)):(l=this.right-o,"near"===i?a="right":"center"===i?(a="center",l-=s/2):(a="left",l=this.left)):"right"===t?n?(l=this.left+r,"near"===i?a="right":"center"===i?(a="center",l-=s/2):(a="left",l-=s)):(l=this.left+o,"near"===i?a="left":"center"===i?(a="center",l+=s/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:i,top:n,width:r,height:o}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(i,n,r,o),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const i=this.ticks.findIndex((t=>t.value===e));if(i>=0){return t.setContext(this.getContext(i)).lineWidth}return 0}drawGrid(e){const t=this.options.grid,i=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let r,o;const s=(e,t,n)=>{n.width&&n.color&&(i.save(),i.lineWidth=n.width,i.strokeStyle=n.color,i.setLineDash(n.borderDash||[]),i.lineDashOffset=n.borderDashOffset,i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.stroke(),i.restore())};if(t.display)for(r=0,o=n.length;r<o;++r){const e=n[r];t.drawOnChartArea&&s({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},e),t.drawTicks&&s({x:e.tx1,y:e.ty1},{x:e.tx2,y:e.ty2},{color:e.tickColor,width:e.tickWidth,borderDash:e.tickBorderDash,borderDashOffset:e.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:i,grid:n}}=this,r=i.setContext(this.getContext()),o=i.display?r.width:0;if(!o)return;const s=n.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let l,c,u,h;this.isHorizontal()?(l=du(e,this.left,o)-o/2,c=du(e,this.right,s)+s/2,u=h=a):(u=du(e,this.top,o)-o/2,h=du(e,this.bottom,s)+s/2,l=c=a),t.save(),t.lineWidth=r.width,t.strokeStyle=r.color,t.beginPath(),t.moveTo(l,u),t.lineTo(c,h),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const t=this.ctx,i=this._computeLabelArea();i&&_u(t,i);const n=this.getLabelItems(e);for(const e of n){const i=e.options,n=e.font;Su(t,e.label,0,e.textOffset,n,i)}i&&yu(t)}drawTitle(){const{ctx:e,options:{position:t,title:i,reverse:n}}=this;if(!i.display)return;const r=Du(i.font),o=zu(i.padding),s=i.align;let a=r.lineHeight/2;"bottom"===t||"center"===t||Vl(t)?(a+=o.bottom,$l(i.text)&&(a+=r.lineHeight*(i.text.length-1))):a+=o.top;const{titleX:l,titleY:c,maxWidth:u,rotation:h}=function(e,t,i,n){const{top:r,left:o,bottom:s,right:a,chart:l}=e,{chartArea:c,scales:u}=l;let h,d,p,f=0;const m=s-r,g=a-o;if(e.isHorizontal()){if(d=$c(n,o,a),Vl(i)){const e=Object.keys(i)[0],n=i[e];p=u[e].getPixelForValue(n)+m-t}else p="center"===i?(c.bottom+c.top)/2+m-t:Xd(e,i,t);h=a-o}else{if(Vl(i)){const e=Object.keys(i)[0],n=i[e];d=u[e].getPixelForValue(n)-g+t}else d="center"===i?(c.left+c.right)/2-g+t:Xd(e,i,t);p=$c(n,s,r),f="left"===i?-fc:fc}return{titleX:d,titleY:p,maxWidth:h,rotation:f}}(this,a,t,s);Su(e,i.text,0,0,r,{color:i.color,maxWidth:u,rotation:h,textAlign:Qd(s,t,n),textBaseline:"middle",translation:[l,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,i=ql(e.grid&&e.grid.z,-1),n=ql(e.border&&e.border.z,0);return this._isVisible()&&this.draw===ep.prototype.draw?[{z:i,draw:e=>{this.drawBackground(),this.drawGrid(e),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:t,draw:e=>{this.drawLabels(e)}}]:[{z:t,draw:e=>{this.draw(e)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",n=[];let r,o;for(r=0,o=t.length;r<o;++r){const o=t[r];o[i]!==this.id||e&&o.type!==e||n.push(o)}return n}_resolveTickFontOptions(e){return Du(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class tp{constructor(e,t,i){this.type=e,this.scope=t,this.override=i,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let i;(function(e){return"id"in e&&"defaults"in e})(t)&&(i=this.register(t));const n=this.items,r=e.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+e);return r in n||(n[r]=e,function(e,t,i){const n=ec(Object.create(null),[i?cu.get(i):{},cu.get(t),e.defaults]);cu.set(t,n),e.defaultRoutes&&function(e,t){Object.keys(t).forEach((i=>{const n=i.split("."),r=n.pop(),o=[e].concat(n).join("."),s=t[i].split("."),a=s.pop(),l=s.join(".");cu.route(o,r,l,a)}))}(t,e.defaultRoutes);e.descriptors&&cu.describe(t,e.descriptors)}(e,o,i),this.override&&cu.override(e.id,e.overrides)),o}get(e){return this.items[e]}unregister(e){const t=this.items,i=e.id,n=this.scope;i in t&&delete t[i],n&&i in cu[n]&&(delete cu[n][i],this.override&&delete ru[i])}}class ip{constructor(){this.controllers=new tp(qh,"datasets",!0),this.elements=new tp(Gd,"elements"),this.plugins=new tp(Object,"plugins"),this.scales=new tp(ep,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,i){[...t].forEach((t=>{const n=i||this._getRegistryForType(t);i||n.isForType(t)||n===this.plugins&&t.id?this._exec(e,n,t):Hl(t,(t=>{const n=i||this._getRegistryForType(t);this._exec(e,n,t)}))}))}_exec(e,t,i){const n=oc(e);Zl(i["before"+n],[],i),t[e](i),Zl(i["after"+n],[],i)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const i=this._typedRegistries[t];if(i.isForType(e))return i}return this.plugins}_get(e,t,i){const n=t.get(e);if(void 0===n)throw new Error('"'+e+'" is not a registered '+i+".");return n}}var np=new ip;class rp{constructor(){this._init=[]}notify(e,t,i,n){"beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const r=n?this._descriptors(e).filter(n):this._descriptors(e),o=this._notify(r,e,t,i);return"afterDestroy"===t&&(this._notify(r,e,"stop"),this._notify(this._init,e,"uninstall")),o}_notify(e,t,i,n){n=n||{};for(const r of e){const e=r.plugin;if(!1===Zl(e[i],[t,n,r.options],e)&&n.cancelable)return!1}return!0}invalidate(){Ul(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const i=e&&e.config,n=ql(i.options&&i.options.plugins,{}),r=function(e){const t={},i=[],n=Object.keys(np.plugins.items);for(let e=0;e<n.length;e++)i.push(np.getPlugin(n[e]));const r=e.plugins||[];for(let e=0;e<r.length;e++){const n=r[e];-1===i.indexOf(n)&&(i.push(n),t[n.id]=!0)}return{plugins:i,localIds:t}}(i);return!1!==n||t?function(e,{plugins:t,localIds:i},n,r){const o=[],s=e.getContext();for(const a of t){const t=a.id,l=op(n[t],r);null!==l&&o.push({plugin:a,options:sp(e.config,{plugin:a,local:i[t]},l,s)})}return o}(e,r,n,t):[]}_notifyStateChanges(e){const t=this._oldCache||[],i=this._cache,n=(e,t)=>e.filter((e=>!t.some((t=>e.plugin.id===t.plugin.id))));this._notify(n(t,i),e,"stop"),this._notify(n(i,t),e,"start")}}function op(e,t){return t||!1!==e?!0===e?{}:e:null}function sp(e,{plugin:t,local:i},n,r){const o=e.pluginScopeKeys(t),s=e.getOptionScopes(n,o);return i&&t.defaults&&s.push(t.defaults),e.createResolver(s,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function ap(e,t){const i=cu.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||i.indexAxis||"x"}function lp(e){if("x"===e||"y"===e||"r"===e)return e}function cp(e){return"top"===e||"bottom"===e?"x":"left"===e||"right"===e?"y":void 0}function up(e,...t){if(lp(e))return e;for(const i of t){const t=i.axis||cp(i.position)||e.length>1&&lp(e[0].toLowerCase());if(t)return t}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function hp(e,t,i){if(i[t+"AxisID"]===e)return{axis:t}}function dp(e,t){const i=ru[e.type]||{scales:{}},n=t.scales||{},r=ap(e.type,t),o=Object.create(null);return Object.keys(n).forEach((t=>{const s=n[t];if(!Vl(s))return console.error(`Invalid scale configuration for scale: ${t}`);if(s._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const a=up(t,s,function(e,t){if(t.data&&t.data.datasets){const i=t.data.datasets.filter((t=>t.xAxisID===e||t.yAxisID===e));if(i.length)return hp(e,"x",i[0])||hp(e,"y",i[0])}return{}}(t,e),cu.scales[s.type]),l=function(e,t){return e===t?"_index_":"_value_"}(a,r),c=i.scales||{};o[t]=tc(Object.create(null),[{axis:a},s,c[a],c[l]])})),e.data.datasets.forEach((i=>{const r=i.type||e.type,s=i.indexAxis||ap(r,t),a=(ru[r]||{}).scales||{};Object.keys(a).forEach((e=>{const t=function(e,t){let i=e;return"_index_"===e?i=t:"_value_"===e&&(i="x"===t?"y":"x"),i}(e,s),r=i[t+"AxisID"]||t;o[r]=o[r]||Object.create(null),tc(o[r],[{axis:t},n[r],a[e]])}))})),Object.keys(o).forEach((e=>{const t=o[e];tc(t,[cu.scales[t.type],cu.scale])})),o}function pp(e){const t=e.options||(e.options={});t.plugins=ql(t.plugins,{}),t.scales=dp(e,t)}function fp(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const mp=new Map,gp=new Set;function _p(e,t){let i=mp.get(e);return i||(i=t(),mp.set(e,i),gp.add(i)),i}const yp=(e,t,i)=>{const n=rc(t,i);void 0!==n&&e.add(n)};class xp{constructor(e){this._config=function(e){return(e=e||{}).data=fp(e.data),pp(e),e}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=fp(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),pp(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return _p(e,(()=>[[`datasets.${e}`,""]]))}datasetAnimationScopeKeys(e,t){return _p(`${e}.transition.${t}`,(()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]]))}datasetElementScopeKeys(e,t){return _p(`${e}-${t}`,(()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]]))}pluginScopeKeys(e){const t=e.id;return _p(`${this.type}-plugin-${t}`,(()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]]))}_cachedScopes(e,t){const i=this._scopeCache;let n=i.get(e);return n&&!t||(n=new Map,i.set(e,n)),n}getOptionScopes(e,t,i){const{options:n,type:r}=this,o=this._cachedScopes(e,i),s=o.get(t);if(s)return s;const a=new Set;t.forEach((t=>{e&&(a.add(e),t.forEach((t=>yp(a,e,t)))),t.forEach((e=>yp(a,n,e))),t.forEach((e=>yp(a,ru[r]||{},e))),t.forEach((e=>yp(a,cu,e))),t.forEach((e=>yp(a,ou,e)))}));const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),gp.has(t)&&o.set(t,l),l}chartOptionScopes(){const{options:e,type:t}=this;return[e,ru[t]||{},cu.datasets[t]||{},{type:t},cu,ou]}resolveNamedOptions(e,t,i,n=[""]){const r={$shared:!0},{resolver:o,subPrefixes:s}=vp(this._resolverCache,e,n);let a=o;if(function(e,t){const{isScriptable:i,isIndexable:n}=Fu(e);for(const r of t){const t=i(r),o=n(r),s=(o||t)&&e[r];if(t&&(ac(s)||bp(s))||o&&$l(s))return!0}return!1}(o,t)){r.$shared=!1;a=Bu(o,i=ac(i)?i():i,this.createResolver(e,i,s))}for(const e of t)r[e]=a[e];return r}createResolver(e,t,i=[""],n){const{resolver:r}=vp(this._resolverCache,e,i);return Vl(t)?Bu(r,t,void 0,n):r}}function vp(e,t,i){let n=e.get(t);n||(n=new Map,e.set(t,n));const r=i.join();let o=n.get(r);if(!o){o={resolver:Ou(t,i),subPrefixes:i.filter((e=>!e.toLowerCase().includes("hover")))},n.set(r,o)}return o}const bp=e=>Vl(e)&&Object.getOwnPropertyNames(e).reduce(((t,i)=>t||ac(e[i])),!1);const wp=["top","bottom","left","right","chartArea"];function Sp(e,t){return"top"===e||"bottom"===e||-1===wp.indexOf(e)&&"x"===t}function Tp(e,t){return function(i,n){return i[e]===n[e]?i[t]-n[t]:i[e]-n[e]}}function Ep(e){const t=e.chart,i=t.options.animation;t.notifyPlugins("afterRender"),Zl(i&&i.onComplete,[e],t)}function Cp(e){const t=e.chart,i=t.options.animation;Zl(i&&i.onProgress,[e],t)}function kp(e){return nh()&&"string"==typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const Mp={},Ap=e=>{const t=kp(e);return Object.values(Mp).filter((e=>e.canvas===t)).pop()};function Pp(e,t,i){const n=Object.keys(e);for(const r of n){const n=+r;if(n>=t){const o=e[r];delete e[r],(i>0||n>t)&&(e[n+i]=o)}}}function Ip(e,t,i){return e.options.clip?e[i]:t[i]}class zp{static defaults=cu;static instances=Mp;static overrides=ru;static registry=np;static version="4.4.0";static getChart=Ap;static register(...e){np.add(...e),Dp()}static unregister(...e){np.remove(...e),Dp()}constructor(e,t){const i=this.config=new xp(t),n=kp(e),r=Ap(n);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||function(e){return!nh()||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?Md:Vd}(n)),this.platform.updateConfig(i);const s=this.platform.acquireContext(n,o.aspectRatio),a=s&&s.canvas,l=a&&a.height,c=a&&a.width;this.id=jl(),this.ctx=s,this.canvas=a,this.width=c,this.height=l,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new rp,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(e,t){let i;return function(...n){return t?(clearTimeout(i),i=setTimeout(e,t,n)):e.apply(this,n),t}}((e=>this.update(e)),o.resizeDelay||0),this._dataChanges=[],Mp[this.id]=this,s&&a?(Ph.listen(this,"complete",Ep),Ph.listen(this,"progress",Cp),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:i,height:n,_aspectRatio:r}=this;return Ul(e)?t&&r?r:n?i/n:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return np}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ph(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return pu(this.canvas,this.ctx),this}stop(){return Ph.stop(this),this}resize(e,t){Ph.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const i=this.options,n=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(n,e,t,r),s=i.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,ph(this,s,!0)&&(this.notifyPlugins("resize",{size:o}),Zl(i.onResize,[this,o],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){Hl(this.options.scales||{},((e,t)=>{e.id=t}))}buildOrUpdateScales(){const e=this.options,t=e.scales,i=this.scales,n=Object.keys(i).reduce(((e,t)=>(e[t]=!1,e)),{});let r=[];t&&(r=r.concat(Object.keys(t).map((e=>{const i=t[e],n=up(e,i),r="r"===n,o="x"===n;return{options:i,dposition:r?"chartArea":o?"bottom":"left",dtype:r?"radialLinear":o?"category":"linear"}})))),Hl(r,(t=>{const r=t.options,o=r.id,s=up(o,r),a=ql(r.type,t.dtype);void 0!==r.position&&Sp(r.position,s)===Sp(t.dposition)||(r.position=t.dposition),n[o]=!0;let l=null;if(o in i&&i[o].type===a)l=i[o];else{l=new(np.getScale(a))({id:o,type:a,ctx:this.ctx,chart:this}),i[l.id]=l}l.init(r,e)})),Hl(n,((e,t)=>{e||delete i[t]})),Hl(i,(e=>{Cd.configure(this,e,e.options),Cd.addBox(this,e)}))}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,i=e.length;if(e.sort(((e,t)=>e.index-t.index)),i>t){for(let e=t;e<i;++e)this._destroyDatasetMeta(e);e.splice(t,i-t)}this._sortedMetasets=e.slice(0).sort(Tp("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach(((e,i)=>{0===t.filter((t=>t===e._dataset)).length&&this._destroyDatasetMeta(i)}))}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let i,n;for(this._removeUnreferencedMetasets(),i=0,n=t.length;i<n;i++){const n=t[i];let r=this.getDatasetMeta(i);const o=n.type||this.config.type;if(r.type&&r.type!==o&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=o,r.indexAxis=n.indexAxis||ap(o,this.options),r.order=n.order||0,r.index=i,r.label=""+n.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const t=np.getController(o),{datasetElementType:n,dataElementType:s}=cu.datasets[o];Object.assign(t,{dataElementType:np.getElement(s),datasetElementType:n&&np.getElement(n)}),r.controller=new t(this,i),e.push(r.controller)}}return this._updateMetasets(),e}_resetElements(){Hl(this.data.datasets,((e,t)=>{this.getDatasetMeta(t).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const i=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let e=0,t=this.data.datasets.length;e<t;e++){const{controller:t}=this.getDatasetMeta(e),i=!n&&-1===r.indexOf(t);t.buildOrUpdateElements(i),o=Math.max(+t.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),n||Hl(r,(e=>{e.reset()})),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(Tp("z","_idx"));const{_active:s,_lastEvent:a}=this;a?this._eventHandler(a,!0):s.length&&this._updateHoverStyles(s,s,!0),this.render()}_updateScales(){Hl(this.scales,(e=>{Cd.removeBox(this,e)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),i=new Set(e.events);lc(t,i)&&!!this._responsiveListeners===e.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:i,start:n,count:r}of t){Pp(e,n,"_removeElements"===i?-r:r)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,i=t=>new Set(e.filter((e=>e[0]===t)).map(((e,t)=>t+","+e.splice(1).join(",")))),n=i(0);for(let e=1;e<t;e++)if(!lc(n,i(e)))return;return Array.from(n).map((e=>e.split(","))).map((e=>({method:e[1],start:+e[2],count:+e[3]})))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Cd.update(this,this.width,this.height,e);const t=this.chartArea,i=t.width<=0||t.height<=0;this._layers=[],Hl(this.boxes,(e=>{i&&"chartArea"===e.position||(e.configure&&e.configure(),this._layers.push(...e._layers()))}),this),this._layers.forEach(((e,t)=>{e._idx=t})),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let e=0,t=this.data.datasets.length;e<t;++e)this.getDatasetMeta(e).controller.configure();for(let t=0,i=this.data.datasets.length;t<i;++t)this._updateDataset(t,ac(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const i=this.getDatasetMeta(e),n={meta:i,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",n)&&(i.controller._update(t),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Ph.has(this)?this.attached&&!Ph.running(this)&&Ph.start(this):(this.draw(),Ep({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:e,height:t}=this._resizeBeforeDraw;this._resize(e,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,i=[];let n,r;for(n=0,r=t.length;n<r;++n){const r=t[n];e&&!r.visible||i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,i=e._clip,n=!i.disabled,r=function(e,t){const{xScale:i,yScale:n}=e;return i&&n?{left:Ip(i,t,"left"),right:Ip(i,t,"right"),top:Ip(n,t,"top"),bottom:Ip(n,t,"bottom")}:t}(e,this.chartArea),o={meta:e,index:e.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",o)&&(n&&_u(t,{left:!1===i.left?0:r.left-i.left,right:!1===i.right?this.width:r.right+i.right,top:!1===i.top?0:r.top-i.top,bottom:!1===i.bottom?this.height:r.bottom+i.bottom}),e.controller.draw(),n&&yu(t),o.cancelable=!1,this.notifyPlugins("afterDatasetDraw",o))}isPointInArea(e){return gu(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,i,n){const r=pd.modes[t];return"function"==typeof r?r(this,e,i,n):[]}getDatasetMeta(e){const t=this.data.datasets[e],i=this._metasets;let n=i.filter((e=>e&&e._dataset===t)).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},i.push(n)),n}getContext(){return this.$context||(this.$context=Ru(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const i=this.getDatasetMeta(e);return"boolean"==typeof i.hidden?!i.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,i){const n=i?"show":"hide",r=this.getDatasetMeta(e),o=r.controller._resolveAnimations(void 0,n);sc(t)?(r.data[t].hidden=!i,this.update()):(this.setDatasetVisibility(e,i),o.update(r,{visible:i}),this.update((t=>t.datasetIndex===e?n:void 0)))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),Ph.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),pu(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete Mp[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,i=(i,n)=>{t.addEventListener(this,i,n),e[i]=n},n=(e,t,i)=>{e.offsetX=t,e.offsetY=i,this._eventHandler(e)};Hl(this.options.events,(e=>i(e,n)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,i=(i,n)=>{t.addEventListener(this,i,n),e[i]=n},n=(i,n)=>{e[i]&&(t.removeEventListener(this,i,n),delete e[i])},r=(e,t)=>{this.canvas&&this.resize(e,t)};let o;const s=()=>{n("attach",s),this.attached=!0,this.resize(),i("resize",r),i("detach",o)};o=()=>{this.attached=!1,n("resize",r),this._stop(),this._resize(0,0),i("attach",s)},t.isAttached(this.canvas)?s():o()}unbindEvents(){Hl(this._listeners,((e,t)=>{this.platform.removeEventListener(this,t,e)})),this._listeners={},Hl(this._responsiveListeners,((e,t)=>{this.platform.removeEventListener(this,t,e)})),this._responsiveListeners=void 0}updateHoverStyle(e,t,i){const n=i?"set":"remove";let r,o,s,a;for("dataset"===t&&(r=this.getDatasetMeta(e[0].datasetIndex),r.controller["_"+n+"DatasetHoverStyle"]()),s=0,a=e.length;s<a;++s){o=e[s];const t=o&&this.getDatasetMeta(o.datasetIndex).controller;t&&t[n+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],i=e.map((({datasetIndex:e,index:t})=>{const i=this.getDatasetMeta(e);if(!i)throw new Error("No dataset found at index "+e);return{datasetIndex:e,element:i.data[t],index:t}}));!Yl(i,t)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,t))}notifyPlugins(e,t,i){return this._plugins.notify(this,e,t,i)}isPluginEnabled(e){return 1===this._plugins._cache.filter((t=>t.plugin.id===e)).length}_updateHoverStyles(e,t,i){const n=this.options.hover,r=(e,t)=>e.filter((e=>!t.some((t=>e.datasetIndex===t.datasetIndex&&e.index===t.index)))),o=r(t,e),s=i?e:r(e,t);o.length&&this.updateHoverStyle(o,n.mode,!1),s.length&&n.mode&&this.updateHoverStyle(s,n.mode,!0)}_eventHandler(e,t){const i={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},n=t=>(t.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",i,n))return;const r=this._handleEvent(e,t,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,n),(r||i.changed)&&this.render(),this}_handleEvent(e,t,i){const{_active:n=[],options:r}=this,o=t,s=this._getActiveElements(e,n,i,o),a=function(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(e),l=function(e,t,i,n){return i&&"mouseout"!==e.type?n?t:e:null}(e,this._lastEvent,i,a);i&&(this._lastEvent=null,Zl(r.onHover,[e,s,this],this),a&&Zl(r.onClick,[e,s,this],this));const c=!Yl(s,n);return(c||t)&&(this._active=s,this._updateHoverStyles(s,n,t)),this._lastEvent=l,c}_getActiveElements(e,t,i,n){if("mouseout"===e.type)return[];if(!i)return t;const r=this.options.hover;return this.getElementsAtEventForMode(e,r.mode,r,n)}}function Dp(){return Hl(zp.instances,(e=>e._plugins.invalidate()))}function Lp(e,t,i,n){const r=Au(e.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const o=(i-t)/2,s=Math.min(o,n*t/2),a=e=>{const t=(i-Math.min(o,e))*n/2;return Ic(e,0,Math.min(o,t))};return{outerStart:a(r.outerStart),outerEnd:a(r.outerEnd),innerStart:Ic(r.innerStart,0,s),innerEnd:Ic(r.innerEnd,0,s)}}function Rp(e,t,i,n){return{x:i+e*Math.cos(t),y:n+e*Math.sin(t)}}function Op(e,t,i,n,r,o){const{x:s,y:a,startAngle:l,pixelMargin:c,innerRadius:u}=t,h=Math.max(t.outerRadius+n+i-c,0),d=u>0?u+n+i+c:0;let p=0;const f=r-l;if(n){const e=((u>0?u-n:0)+(h>0?h-n:0))/2;p=(f-(0!==e?f*e/(e+n):f))/2}const m=(f-Math.max(.001,f*h-i/cc)/h)/2,g=l+m+p,_=r-m-p,{outerStart:y,outerEnd:x,innerStart:v,innerEnd:b}=Lp(t,d,h,_-g),w=h-y,S=h-x,T=g+y/w,E=_-x/S,C=d+v,k=d+b,M=g+v/C,A=_-b/k;if(e.beginPath(),o){const t=(T+E)/2;if(e.arc(s,a,h,T,t),e.arc(s,a,h,t,E),x>0){const t=Rp(S,E,s,a);e.arc(t.x,t.y,x,E,_+fc)}const i=Rp(k,_,s,a);if(e.lineTo(i.x,i.y),b>0){const t=Rp(k,A,s,a);e.arc(t.x,t.y,b,_+fc,A+Math.PI)}const n=(_-b/d+(g+v/d))/2;if(e.arc(s,a,d,_-b/d,n,!0),e.arc(s,a,d,n,g+v/d,!0),v>0){const t=Rp(C,M,s,a);e.arc(t.x,t.y,v,M+Math.PI,g-fc)}const r=Rp(w,g,s,a);if(e.lineTo(r.x,r.y),y>0){const t=Rp(w,T,s,a);e.arc(t.x,t.y,y,g-fc,T)}}else{e.moveTo(s,a);const t=Math.cos(T)*h+s,i=Math.sin(T)*h+a;e.lineTo(t,i);const n=Math.cos(E)*h+s,r=Math.sin(E)*h+a;e.lineTo(n,r)}e.closePath()}function Bp(e,t,i,n,r){const{fullCircles:o,startAngle:s,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:u,borderDash:h,borderDashOffset:d}=l,p="inner"===l.borderAlign;if(!c)return;e.setLineDash(h||[]),e.lineDashOffset=d,p?(e.lineWidth=2*c,e.lineJoin=u||"round"):(e.lineWidth=c,e.lineJoin=u||"bevel");let f=t.endAngle;if(o){Op(e,t,i,n,f,r);for(let t=0;t<o;++t)e.stroke();isNaN(a)||(f=s+(a%uc||uc))}p&&function(e,t,i){const{startAngle:n,pixelMargin:r,x:o,y:s,outerRadius:a,innerRadius:l}=t;let c=r/a;e.beginPath(),e.arc(o,s,a,n-c,i+c),l>r?(c=r/l,e.arc(o,s,l,i+c,n-c,!0)):e.arc(o,s,r,i+fc,n-fc),e.closePath(),e.clip()}(e,t,f),o||(Op(e,t,i,n,f,r),e.stroke())}function Fp(e,t,i=t){e.lineCap=ql(i.borderCapStyle,t.borderCapStyle),e.setLineDash(ql(i.borderDash,t.borderDash)),e.lineDashOffset=ql(i.borderDashOffset,t.borderDashOffset),e.lineJoin=ql(i.borderJoinStyle,t.borderJoinStyle),e.lineWidth=ql(i.borderWidth,t.borderWidth),e.strokeStyle=ql(i.borderColor,t.borderColor)}function Np(e,t,i){e.lineTo(i.x,i.y)}function jp(e,t,i={}){const n=e.length,{start:r=0,end:o=n-1}=i,{start:s,end:a}=t,l=Math.max(r,s),c=Math.min(o,a),u=r<s&&o<s||r>a&&o>a;return{count:n,start:l,loop:t.loop,ilen:c<l&&!u?n+c-l:c-l}}function Up(e,t,i,n){const{points:r,options:o}=t,{count:s,start:a,loop:l,ilen:c}=jp(r,i,n),u=function(e){return e.stepped?xu:e.tension||"monotone"===e.cubicInterpolationMode?vu:Np}(o);let h,d,p,{move:f=!0,reverse:m}=n||{};for(h=0;h<=c;++h)d=r[(a+(m?c-h:h))%s],d.skip||(f?(e.moveTo(d.x,d.y),f=!1):u(e,p,d,m,o.stepped),p=d);return l&&(d=r[(a+(m?c:0))%s],u(e,p,d,m,o.stepped)),!!l}function $p(e,t,i,n){const r=t.points,{count:o,start:s,ilen:a}=jp(r,i,n),{move:l=!0,reverse:c}=n||{};let u,h,d,p,f,m,g=0,_=0;const y=e=>(s+(c?a-e:e))%o,x=()=>{p!==f&&(e.lineTo(g,f),e.lineTo(g,p),e.lineTo(g,m))};for(l&&(h=r[y(0)],e.moveTo(h.x,h.y)),u=0;u<=a;++u){if(h=r[y(u)],h.skip)continue;const t=h.x,i=h.y,n=0|t;n===d?(i<p?p=i:i>f&&(f=i),g=(_*g+t)/++_):(x(),e.lineTo(t,i),d=n,_=0,p=f=i),m=i}x()}function Vp(e){const t=e.options,i=t.borderDash&&t.borderDash.length;return!(e._decimated||e._loop||t.tension||"monotone"===t.cubicInterpolationMode||t.stepped||i)?$p:Up}const Gp="function"==typeof Path2D;function Wp(e,t,i,n){Gp&&!t.options.segment?function(e,t,i,n){let r=t._path;r||(r=t._path=new Path2D,t.path(r,i,n)&&r.closePath()),Fp(e,t.options),e.stroke(r)}(e,t,i,n):function(e,t,i,n){const{segments:r,options:o}=t,s=Vp(t);for(const a of r)Fp(e,o,a.style),e.beginPath(),s(e,t,a,{start:i,end:i+n-1})&&e.closePath(),e.stroke()}(e,t,i,n)}class qp extends Gd{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const i=this.options;if((i.tension||"monotone"===i.cubicInterpolationMode)&&!i.stepped&&!this._pointsUpdated){const n=i.spanGaps?this._loop:this._fullLoop;ih(this._points,i,e,n,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(e,t){const i=e.points,n=e.options.spanGaps,r=i.length;if(!r)return[];const o=!!e._loop,{start:s,end:a}=function(e,t,i,n){let r=0,o=t-1;if(i&&!n)for(;r<t&&!e[r].skip;)r++;for(;r<t&&e[r].skip;)r++;for(r%=t,i&&(o+=r);o>r&&e[o%t].skip;)o--;return o%=t,{start:r,end:o}}(i,r,o,n);return Ch(e,!0===n?[{start:s,end:a,loop:o}]:function(e,t,i,n){const r=e.length,o=[];let s,a=t,l=e[t];for(s=t+1;s<=i;++s){const i=e[s%r];i.skip||i.stop?l.skip||(n=!1,o.push({start:t%r,end:(s-1)%r,loop:n}),t=a=i.stop?s:null):(a=s,l.skip&&(t=s)),l=i}return null!==a&&o.push({start:t%r,end:a%r,loop:n}),o}(i,s,a<s?a+r:a,!!e._fullLoop&&0===s&&a===r-1),i,t)}(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,i=e.length;return i&&t[e[i-1].end]}interpolate(e,t){const i=this.options,n=e[t],r=this.points,o=Eh(this,{property:t,start:n,end:n});if(!o.length)return;const s=[],a=function(e){return e.stepped?_h:e.tension||"monotone"===e.cubicInterpolationMode?yh:gh}(i);let l,c;for(l=0,c=o.length;l<c;++l){const{start:c,end:u}=o[l],h=r[c],d=r[u];if(h===d){s.push(h);continue}const p=a(h,d,Math.abs((n-h[t])/(d[t]-h[t])),i.stepped);p[t]=e[t],s.push(p)}return 1===s.length?s[0]:s}pathSegment(e,t,i){return Vp(this)(e,this,t,i)}path(e,t,i){const n=this.segments,r=Vp(this);let o=this._loop;t=t||0,i=i||this.points.length-t;for(const s of n)o&=r(e,this,s,{start:t,end:t+i-1});return!!o}draw(e,t,i,n){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(e.save(),Wp(e,this,i,n),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Xp(e,t,i,n){const r=e.options,{[i]:o}=e.getProps([i],n);return Math.abs(t-o)<r.radius+r.hitRadius}function Zp(e,t){const{x:i,y:n,base:r,width:o,height:s}=e.getProps(["x","y","base","width","height"],t);let a,l,c,u,h;return e.horizontal?(h=s/2,a=Math.min(i,r),l=Math.max(i,r),c=n-h,u=n+h):(h=o/2,a=i-h,l=i+h,c=Math.min(n,r),u=Math.max(n,r)),{left:a,top:c,right:l,bottom:u}}function Hp(e,t,i,n){return e?0:Ic(t,i,n)}function Yp(e){const t=Zp(e),i=t.right-t.left,n=t.bottom-t.top,r=function(e,t,i){const n=e.options.borderWidth,r=e.borderSkipped,o=Pu(n);return{t:Hp(r.top,o.top,0,i),r:Hp(r.right,o.right,0,t),b:Hp(r.bottom,o.bottom,0,i),l:Hp(r.left,o.left,0,t)}}(e,i/2,n/2),o=function(e,t,i){const{enableBorderRadius:n}=e.getProps(["enableBorderRadius"]),r=e.options.borderRadius,o=Iu(r),s=Math.min(t,i),a=e.borderSkipped,l=n||Vl(r);return{topLeft:Hp(!l||a.top||a.left,o.topLeft,0,s),topRight:Hp(!l||a.top||a.right,o.topRight,0,s),bottomLeft:Hp(!l||a.bottom||a.left,o.bottomLeft,0,s),bottomRight:Hp(!l||a.bottom||a.right,o.bottomRight,0,s)}}(e,i/2,n/2);return{outer:{x:t.left,y:t.top,w:i,h:n,radius:o},inner:{x:t.left+r.l,y:t.top+r.t,w:i-r.l-r.r,h:n-r.t-r.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,o.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(r.b,r.r))}}}}function Kp(e,t,i,n){const r=null===t,o=null===i,s=e&&!(r&&o)&&Zp(e,n);return s&&(r||zc(t,s.left,s.right))&&(o||zc(i,s.top,s.bottom))}function Jp(e,t){e.rect(t.x,t.y,t.w,t.h)}function Qp(e,t,i={}){const n=e.x!==i.x?-t:0,r=e.y!==i.y?-t:0,o=(e.x+e.w!==i.x+i.w?t:0)-n,s=(e.y+e.h!==i.y+i.h?t:0)-r;return{x:e.x+n,y:e.y+r,w:e.w+o,h:e.h+s,radius:e.radius}}var ef=Object.freeze({__proto__:null,ArcElement:class extends Gd{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,i){const n=this.getProps(["x","y"],i),{angle:r,distance:o}=Cc(n,{x:e,y:t}),{startAngle:s,endAngle:a,innerRadius:l,outerRadius:c,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),h=(this.options.spacing+this.options.borderWidth)/2,d=ql(u,a-s)>=uc||Pc(r,s,a),p=zc(o,l+h,c+h);return d&&p}getCenterPoint(e){const{x:t,y:i,startAngle:n,endAngle:r,innerRadius:o,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:a,spacing:l}=this.options,c=(n+r)/2,u=(o+s+l+a)/2;return{x:t+Math.cos(c)*u,y:i+Math.sin(c)*u}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:i}=this,n=(t.offset||0)/4,r=(t.spacing||0)/2,o=t.circular;if(this.pixelMargin="inner"===t.borderAlign?.33:0,this.fullCircles=i>uc?Math.floor(i/uc):0,0===i||this.innerRadius<0||this.outerRadius<0)return;e.save();const s=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(s)*n,Math.sin(s)*n);const a=n*(1-Math.sin(Math.min(cc,i||0)));e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,function(e,t,i,n,r){const{fullCircles:o,startAngle:s,circumference:a}=t;let l=t.endAngle;if(o){Op(e,t,i,n,l,r);for(let t=0;t<o;++t)e.fill();isNaN(a)||(l=s+(a%uc||uc))}Op(e,t,i,n,l,r),e.fill()}(e,this,a,r,o),Bp(e,this,a,r,o),e.restore()}},BarElement:class extends Gd{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:i,backgroundColor:n}}=this,{inner:r,outer:o}=Yp(this),s=(a=o.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?Tu:Jp;var a;e.save(),o.w===r.w&&o.h===r.h||(e.beginPath(),s(e,Qp(o,t,r)),e.clip(),s(e,Qp(r,-t,o)),e.fillStyle=i,e.fill("evenodd")),e.beginPath(),s(e,Qp(r,t)),e.fillStyle=n,e.fill(),e.restore()}inRange(e,t,i){return Kp(this,e,t,i)}inXRange(e,t){return Kp(this,e,null,t)}inYRange(e,t){return Kp(this,null,e,t)}getCenterPoint(e){const{x:t,y:i,base:n,horizontal:r}=this.getProps(["x","y","base","horizontal"],e);return{x:r?(t+n)/2:t,y:r?i:(i+n)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}},LineElement:qp,PointElement:class extends Gd{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,i){const n=this.options,{x:r,y:o}=this.getProps(["x","y"],i);return Math.pow(e-r,2)+Math.pow(t-o,2)<Math.pow(n.hitRadius+n.radius,2)}inXRange(e,t){return Xp(this,e,"x",t)}inYRange(e,t){return Xp(this,e,"y",t)}getCenterPoint(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}size(e){let t=(e=e||this.options||{}).radius||0;t=Math.max(t,t&&e.hoverRadius||0);return 2*(t+(t&&e.borderWidth||0))}draw(e,t){const i=this.options;this.skip||i.radius<.1||!gu(this,t,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,fu(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}});const tf=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],nf=tf.map((e=>e.replace("rgb(","rgba(").replace(")",", 0.5)")));function rf(e){return tf[e%tf.length]}function of(e){return nf[e%nf.length]}function sf(e){let t=0;return(i,n)=>{const r=e.getDatasetMeta(n).controller;r instanceof td?t=function(e,t){return e.backgroundColor=e.data.map((()=>rf(t++))),t}(i,t):r instanceof id?t=function(e,t){return e.backgroundColor=e.data.map((()=>of(t++))),t}(i,t):r&&(t=function(e,t){return e.borderColor=rf(t),e.backgroundColor=of(t),++t}(i,t))}}function af(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}var lf={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,i){if(!i.enabled)return;const{data:{datasets:n},options:r}=e.config,{elements:o}=r;if(!i.forceOverride&&(af(n)||(s=r)&&(s.borderColor||s.backgroundColor)||o&&af(o)))return;var s;const a=sf(e);n.forEach(a)}};function cf(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function uf(e){e.data.datasets.forEach((e=>{cf(e)}))}var hf={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,i)=>{if(!i.enabled)return void uf(e);const n=e.width;e.data.datasets.forEach(((t,r)=>{const{_data:o,indexAxis:s}=t,a=e.getDatasetMeta(r),l=o||t.data;if("y"===Lu([s,e.options.indexAxis]))return;if(!a.controller.supportsDecimation)return;const c=e.scales[a.xAxisID];if("linear"!==c.type&&"time"!==c.type)return;if(e.options.parsing)return;let{start:u,count:h}=function(e,t){const i=t.length;let n,r=0;const{iScale:o}=e,{min:s,max:a,minDefined:l,maxDefined:c}=o.getUserBounds();return l&&(r=Ic(Lc(t,o.axis,s).lo,0,i-1)),n=c?Ic(Lc(t,o.axis,a).hi+1,r,i)-r:i-r,{start:r,count:n}}(a,l);if(h<=(i.threshold||4*n))return void cf(t);let d;switch(Ul(o)&&(t._data=l,delete t.data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(e){this._data=e}})),i.algorithm){case"lttb":d=function(e,t,i,n,r){const o=r.samples||n;if(o>=i)return e.slice(t,t+i);const s=[],a=(i-2)/(o-2);let l=0;const c=t+i-1;let u,h,d,p,f,m=t;for(s[l++]=e[m],u=0;u<o-2;u++){let n,r=0,o=0;const c=Math.floor((u+1)*a)+1+t,g=Math.min(Math.floor((u+2)*a)+1,i)+t,_=g-c;for(n=c;n<g;n++)r+=e[n].x,o+=e[n].y;r/=_,o/=_;const y=Math.floor(u*a)+1+t,x=Math.min(Math.floor((u+1)*a)+1,i)+t,{x:v,y:b}=e[m];for(d=p=-1,n=y;n<x;n++)p=.5*Math.abs((v-r)*(e[n].y-b)-(v-e[n].x)*(o-b)),p>d&&(d=p,h=e[n],f=n);s[l++]=h,m=f}return s[l++]=e[c],s}(l,u,h,n,i);break;case"min-max":d=function(e,t,i,n){let r,o,s,a,l,c,u,h,d,p,f=0,m=0;const g=[],_=t+i-1,y=e[t].x,x=e[_].x-y;for(r=t;r<t+i;++r){o=e[r],s=(o.x-y)/x*n,a=o.y;const t=0|s;if(t===l)a<d?(d=a,c=r):a>p&&(p=a,u=r),f=(m*f+o.x)/++m;else{const i=r-1;if(!Ul(c)&&!Ul(u)){const t=Math.min(c,u),n=Math.max(c,u);t!==h&&t!==i&&g.push({...e[t],x:f}),n!==h&&n!==i&&g.push({...e[n],x:f})}r>0&&i!==h&&g.push(e[i]),g.push(o),l=t,m=0,d=p=a,c=u=h=r}}return g}(l,u,h,n);break;default:throw new Error(`Unsupported decimation algorithm '${i.algorithm}'`)}t._decimated=d}))},destroy(e){uf(e)}};function df(e,t,i,n){if(n)return;let r=t[e],o=i[e];return"angle"===e&&(r=Ac(r),o=Ac(o)),{property:e,start:r,end:o}}function pf(e,t,i){for(;t>e;t--){const e=i[t];if(!isNaN(e.x)&&!isNaN(e.y))break}return t}function ff(e,t,i,n){return e&&t?n(e[i],t[i]):e?e[i]:t?t[i]:0}function mf(e,t){let i=[],n=!1;return $l(e)?(n=!0,i=e):i=function(e,t){const{x:i=null,y:n=null}=e||{},r=t.points,o=[];return t.segments.forEach((({start:e,end:t})=>{t=pf(e,t,r);const s=r[e],a=r[t];null!==n?(o.push({x:s.x,y:n}),o.push({x:a.x,y:n})):null!==i&&(o.push({x:i,y:s.y}),o.push({x:i,y:a.y}))})),o}(e,t),i.length?new qp({points:i,options:{tension:0},_loop:n,_fullLoop:n}):null}function gf(e){return e&&!1!==e.fill}function _f(e,t,i){let n=e[t].fill;const r=[t];let o;if(!i)return n;for(;!1!==n&&-1===r.indexOf(n);){if(!Gl(n))return n;if(o=e[n],!o)return!1;if(o.visible)return n;r.push(n),n=o.fill}return!1}function yf(e,t,i){const n=function(e){const t=e.options,i=t.fill;let n=ql(i&&i.target,i);void 0===n&&(n=!!t.backgroundColor);if(!1===n||null===n)return!1;if(!0===n)return"origin";return n}(e);if(Vl(n))return!isNaN(n.value)&&n;let r=parseFloat(n);return Gl(r)&&Math.floor(r)===r?function(e,t,i,n){"-"!==e&&"+"!==e||(i=t+i);if(i===t||i<0||i>=n)return!1;return i}(n[0],t,r,i):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function xf(e,t,i){const n=[];for(let r=0;r<i.length;r++){const o=i[r],{first:s,last:a,point:l}=vf(o,t,"x");if(!(!l||s&&a))if(s)n.unshift(l);else if(e.push(l),!a)break}e.push(...n)}function vf(e,t,i){const n=e.interpolate(t,i);if(!n)return{};const r=n[i],o=e.segments,s=e.points;let a=!1,l=!1;for(let e=0;e<o.length;e++){const t=o[e],n=s[t.start][i],c=s[t.end][i];if(zc(r,n,c)){a=r===n,l=r===c;break}}return{first:a,last:l,point:n}}class bf{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,i){const{x:n,y:r,radius:o}=this;return t=t||{start:0,end:uc},e.arc(n,r,o,t.end,t.start,!0),!i.bounds}interpolate(e){const{x:t,y:i,radius:n}=this,r=e.angle;return{x:t+Math.cos(r)*n,y:i+Math.sin(r)*n,angle:r}}}function wf(e){const{chart:t,fill:i,line:n}=e;if(Gl(i))return function(e,t){const i=e.getDatasetMeta(t),n=i&&e.isDatasetVisible(t);return n?i.dataset:null}(t,i);if("stack"===i)return function(e){const{scale:t,index:i,line:n}=e,r=[],o=n.segments,s=n.points,a=function(e,t){const i=[],n=e.getMatchingVisibleMetas("line");for(let e=0;e<n.length;e++){const r=n[e];if(r.index===t)break;r.hidden||i.unshift(r.dataset)}return i}(t,i);a.push(mf({x:null,y:t.bottom},n));for(let e=0;e<o.length;e++){const t=o[e];for(let e=t.start;e<=t.end;e++)xf(r,s[e],a)}return new qp({points:r,options:{}})}(e);if("shape"===i)return!0;const r=function(e){const t=e.scale||{};if(t.getPointPositionForValue)return function(e){const{scale:t,fill:i}=e,n=t.options,r=t.getLabels().length,o=n.reverse?t.max:t.min,s=function(e,t,i){let n;return n="start"===e?i:"end"===e?t.options.reverse?t.min:t.max:Vl(e)?e.value:t.getBaseValue(),n}(i,t,o),a=[];if(n.grid.circular){const e=t.getPointPositionForValue(0,o);return new bf({x:e.x,y:e.y,radius:t.getDistanceFromCenterForValue(s)})}for(let e=0;e<r;++e)a.push(t.getPointPositionForValue(e,s));return a}(e);return function(e){const{scale:t={},fill:i}=e,n=function(e,t){let i=null;return"start"===e?i=t.bottom:"end"===e?i=t.top:Vl(e)?i=t.getPixelForValue(e.value):t.getBasePixel&&(i=t.getBasePixel()),i}(i,t);if(Gl(n)){const e=t.isHorizontal();return{x:e?n:null,y:e?null:n}}return null}(e)}(e);return r instanceof bf?r:mf(r,n)}function Sf(e,t,i){const n=wf(t),{line:r,scale:o,axis:s}=t,a=r.options,l=a.fill,c=a.backgroundColor,{above:u=c,below:h=c}=l||{};n&&r.points.length&&(_u(e,i),function(e,t){const{line:i,target:n,above:r,below:o,area:s,scale:a}=t,l=i._loop?"angle":t.axis;e.save(),"x"===l&&o!==r&&(Tf(e,n,s.top),Ef(e,{line:i,target:n,color:r,scale:a,property:l}),e.restore(),e.save(),Tf(e,n,s.bottom));Ef(e,{line:i,target:n,color:o,scale:a,property:l}),e.restore()}(e,{line:r,target:n,above:u,below:h,area:i,scale:o,axis:s}),yu(e))}function Tf(e,t,i){const{segments:n,points:r}=t;let o=!0,s=!1;e.beginPath();for(const a of n){const{start:n,end:l}=a,c=r[n],u=r[pf(n,l,r)];o?(e.moveTo(c.x,c.y),o=!1):(e.lineTo(c.x,i),e.lineTo(c.x,c.y)),s=!!t.pathSegment(e,a,{move:s}),s?e.closePath():e.lineTo(u.x,i)}e.lineTo(t.first().x,i),e.closePath(),e.clip()}function Ef(e,t){const{line:i,target:n,property:r,color:o,scale:s}=t,a=function(e,t,i){const n=e.segments,r=e.points,o=t.points,s=[];for(const e of n){let{start:n,end:a}=e;a=pf(n,a,r);const l=df(i,r[n],r[a],e.loop);if(!t.segments){s.push({source:e,target:l,start:r[n],end:r[a]});continue}const c=Eh(t,l);for(const t of c){const n=df(i,o[t.start],o[t.end],t.loop),a=Th(e,r,n);for(const e of a)s.push({source:e,target:t,start:{[i]:ff(l,n,"start",Math.max)},end:{[i]:ff(l,n,"end",Math.min)}})}}return s}(i,n,r);for(const{source:t,target:l,start:c,end:u}of a){const{style:{backgroundColor:a=o}={}}=t,h=!0!==n;e.save(),e.fillStyle=a,Cf(e,s,h&&df(r,c,u)),e.beginPath();const d=!!i.pathSegment(e,t);let p;if(h){d?e.closePath():kf(e,n,u,r);const t=!!n.pathSegment(e,l,{move:d,reverse:!0});p=d&&t,p||kf(e,n,c,r)}e.closePath(),e.fill(p?"evenodd":"nonzero"),e.restore()}}function Cf(e,t,i){const{top:n,bottom:r}=t.chart.chartArea,{property:o,start:s,end:a}=i||{};"x"===o&&(e.beginPath(),e.rect(s,n,a-s,r-n),e.clip())}function kf(e,t,i,n){const r=t.interpolate(i,n);r&&e.lineTo(r.x,r.y)}var Mf={id:"filler",afterDatasetsUpdate(e,t,i){const n=(e.data.datasets||[]).length,r=[];let o,s,a,l;for(s=0;s<n;++s)o=e.getDatasetMeta(s),a=o.dataset,l=null,a&&a.options&&a instanceof qp&&(l={visible:e.isDatasetVisible(s),index:s,fill:yf(a,s,n),chart:e,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=l,r.push(l);for(s=0;s<n;++s)l=r[s],l&&!1!==l.fill&&(l.fill=_f(r,s,i.propagate))},beforeDraw(e,t,i){const n="beforeDraw"===i.drawTime,r=e.getSortedVisibleDatasetMetas(),o=e.chartArea;for(let t=r.length-1;t>=0;--t){const i=r[t].$filler;i&&(i.line.updateControlPoints(o,i.axis),n&&i.fill&&Sf(e.ctx,i,o))}},beforeDatasetsDraw(e,t,i){if("beforeDatasetsDraw"!==i.drawTime)return;const n=e.getSortedVisibleDatasetMetas();for(let t=n.length-1;t>=0;--t){const i=n[t].$filler;gf(i)&&Sf(e.ctx,i,e.chartArea)}},beforeDatasetDraw(e,t,i){const n=t.meta.$filler;gf(n)&&"beforeDatasetDraw"===i.drawTime&&Sf(e.ctx,n,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Af=(e,t)=>{let{boxHeight:i=t,boxWidth:n=t}=e;return e.usePointStyle&&(i=Math.min(i,t),n=e.pointStyleWidth||Math.min(n,t)),{boxWidth:n,boxHeight:i,itemHeight:Math.max(t,i)}};class Pf extends Gd{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,i){this.maxWidth=e,this.maxHeight=t,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=Zl(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter((t=>e.filter(t,this.chart.data)))),e.sort&&(t=t.sort(((t,i)=>e.sort(t,i,this.chart.data)))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display)return void(this.width=this.height=0);const i=e.labels,n=Du(i.font),r=n.size,o=this._computeTitleHeight(),{boxWidth:s,itemHeight:a}=Af(i,r);let l,c;t.font=n.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(o,r,s,a)+10):(c=this.maxHeight,l=this._fitCols(o,n,s,a)+10),this.width=Math.min(l,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,i,n){const{ctx:r,maxWidth:o,options:{labels:{padding:s}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],c=n+s;let u=e;r.textAlign="left",r.textBaseline="middle";let h=-1,d=-c;return this.legendItems.forEach(((e,p)=>{const f=i+t/2+r.measureText(e.text).width;(0===p||l[l.length-1]+f+2*s>o)&&(u+=c,l[l.length-(p>0?0:1)]=0,d+=c,h++),a[p]={left:0,top:d,row:h,width:f,height:n},l[l.length-1]+=f+s})),u}_fitCols(e,t,i,n){const{ctx:r,maxHeight:o,options:{labels:{padding:s}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],c=o-e;let u=s,h=0,d=0,p=0,f=0;return this.legendItems.forEach(((e,o)=>{const{itemWidth:m,itemHeight:g}=function(e,t,i,n,r){const o=function(e,t,i,n){let r=e.text;r&&"string"!=typeof r&&(r=r.reduce(((e,t)=>e.length>t.length?e:t)));return t+i.size/2+n.measureText(r).width}(n,e,t,i),s=function(e,t,i){let n=e;"string"!=typeof t.text&&(n=If(t,i));return n}(r,n,t.lineHeight);return{itemWidth:o,itemHeight:s}}(i,t,r,e,n);o>0&&d+g+2*s>c&&(u+=h+s,l.push({width:h,height:d}),p+=h+s,f++,h=d=0),a[o]={left:p,top:d,col:f,width:m,height:g},h=Math.max(h,m),d+=g+s})),u+=h,l.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:i,labels:{padding:n},rtl:r}}=this,o=xh(r,this.left,this.width);if(this.isHorizontal()){let r=0,s=$c(i,this.left+n,this.right-this.lineWidths[r]);for(const a of t)r!==a.row&&(r=a.row,s=$c(i,this.left+n,this.right-this.lineWidths[r])),a.top+=this.top+e+n,a.left=o.leftForLtr(o.x(s),a.width),s+=a.width+n}else{let r=0,s=$c(i,this.top+e+n,this.bottom-this.columnSizes[r].height);for(const a of t)a.col!==r&&(r=a.col,s=$c(i,this.top+e+n,this.bottom-this.columnSizes[r].height)),a.top=s,a.left+=this.left+n,a.left=o.leftForLtr(o.x(a.left),a.width),s+=a.height+n}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;_u(e,this),this._draw(),yu(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:i,ctx:n}=this,{align:r,labels:o}=e,s=cu.color,a=xh(e.rtl,this.left,this.width),l=Du(o.font),{padding:c}=o,u=l.size,h=u/2;let d;this.drawTitle(),n.textAlign=a.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=l.string;const{boxWidth:p,boxHeight:f,itemHeight:m}=Af(o,u),g=this.isHorizontal(),_=this._computeTitleHeight();d=g?{x:$c(r,this.left+c,this.right-i[0]),y:this.top+c+_,line:0}:{x:this.left+c,y:$c(r,this.top+_+c,this.bottom-t[0].height),line:0},vh(this.ctx,e.textDirection);const y=m+c;this.legendItems.forEach(((x,v)=>{n.strokeStyle=x.fontColor,n.fillStyle=x.fontColor;const b=n.measureText(x.text).width,w=a.textAlign(x.textAlign||(x.textAlign=o.textAlign)),S=p+h+b;let T=d.x,E=d.y;a.setWidth(this.width),g?v>0&&T+S+c>this.right&&(E=d.y+=y,d.line++,T=d.x=$c(r,this.left+c,this.right-i[d.line])):v>0&&E+y>this.bottom&&(T=d.x=T+t[d.line].width+c,d.line++,E=d.y=$c(r,this.top+_+c,this.bottom-t[d.line].height));if(function(e,t,i){if(isNaN(p)||p<=0||isNaN(f)||f<0)return;n.save();const r=ql(i.lineWidth,1);if(n.fillStyle=ql(i.fillStyle,s),n.lineCap=ql(i.lineCap,"butt"),n.lineDashOffset=ql(i.lineDashOffset,0),n.lineJoin=ql(i.lineJoin,"miter"),n.lineWidth=r,n.strokeStyle=ql(i.strokeStyle,s),n.setLineDash(ql(i.lineDash,[])),o.usePointStyle){const s={radius:f*Math.SQRT2/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:r},l=a.xPlus(e,p/2);mu(n,s,l,t+h,o.pointStyleWidth&&p)}else{const o=t+Math.max((u-f)/2,0),s=a.leftForLtr(e,p),l=Iu(i.borderRadius);n.beginPath(),Object.values(l).some((e=>0!==e))?Tu(n,{x:s,y:o,w:p,h:f,radius:l}):n.rect(s,o,p,f),n.fill(),0!==r&&n.stroke()}n.restore()}(a.x(T),E,x),T=((e,t,i,n)=>e===(n?"left":"right")?i:"center"===e?(t+i)/2:t)(w,T+p+h,g?T+S:this.right,e.rtl),function(e,t,i){Su(n,i.text,e,t+m/2,l,{strikethrough:i.hidden,textAlign:a.textAlign(i.textAlign)})}(a.x(T),E,x),g)d.x+=S+c;else if("string"!=typeof x.text){const e=l.lineHeight;d.y+=If(x,e)+c}else d.y+=y})),bh(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,i=Du(t.font),n=zu(t.padding);if(!t.display)return;const r=xh(e.rtl,this.left,this.width),o=this.ctx,s=t.position,a=i.size/2,l=n.top+a;let c,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+l,u=$c(e.align,u,this.right-h);else{const t=this.columnSizes.reduce(((e,t)=>Math.max(e,t.height)),0);c=l+$c(e.align,this.top,this.bottom-t-e.labels.padding-this._computeTitleHeight())}const d=$c(s,u,u+h);o.textAlign=r.textAlign(Uc(s)),o.textBaseline="middle",o.strokeStyle=t.color,o.fillStyle=t.color,o.font=i.string,Su(o,t.text,d,c,i)}_computeTitleHeight(){const e=this.options.title,t=Du(e.font),i=zu(e.padding);return e.display?t.lineHeight+i.height:0}_getLegendItemAt(e,t){let i,n,r;if(zc(e,this.left,this.right)&&zc(t,this.top,this.bottom))for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(n=r[i],zc(e,n.left,n.left+n.width)&&zc(t,n.top,n.top+n.height))return this.legendItems[i];return null}handleEvent(e){const t=this.options;if(!function(e,t){if(("mousemove"===e||"mouseout"===e)&&(t.onHover||t.onLeave))return!0;if(t.onClick&&("click"===e||"mouseup"===e))return!0;return!1}(e.type,t))return;const i=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type||"mouseout"===e.type){const n=this._hoveredItem,r=((e,t)=>null!==e&&null!==t&&e.datasetIndex===t.datasetIndex&&e.index===t.index)(n,i);n&&!r&&Zl(t.onLeave,[e,n,this],this),this._hoveredItem=i,i&&!r&&Zl(t.onHover,[e,i,this],this)}else i&&Zl(t.onClick,[e,i,this],this)}}function If(e,t){return t*(e.text?e.text.length:0)}var zf={id:"legend",_element:Pf,start(e,t,i){const n=e.legend=new Pf({ctx:e.ctx,options:i,chart:e});Cd.configure(e,n,i),Cd.addBox(e,n)},stop(e){Cd.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,i){const n=e.legend;Cd.configure(e,n,i),n.options=i},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,i){const n=t.datasetIndex,r=i.chart;r.isDatasetVisible(n)?(r.hide(n),t.hidden=!0):(r.show(n),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:i,pointStyle:n,textAlign:r,color:o,useBorderRadius:s,borderRadius:a}}=e.legend.options;return e._getSortedDatasetMetas().map((e=>{const l=e.controller.getStyle(i?0:void 0),c=zu(l.borderWidth);return{text:t[e.index].label,fillStyle:l.backgroundColor,fontColor:o,hidden:!e.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:n||l.pointStyle,rotation:l.rotation,textAlign:r||l.textAlign,borderRadius:s&&(a||l.borderRadius),datasetIndex:e.index}}),this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class Df extends Gd{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=t;const n=$l(i.text)?i.text.length:1;this._padding=zu(i.padding);const r=n*Du(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:t,left:i,bottom:n,right:r,options:o}=this,s=o.align;let a,l,c,u=0;return this.isHorizontal()?(l=$c(s,i,r),c=t+e,a=r-i):("left"===o.position?(l=i+e,c=$c(s,n,t),u=-.5*cc):(l=r-e,c=$c(s,t,n),u=.5*cc),a=n-t),{titleX:l,titleY:c,maxWidth:a,rotation:u}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const i=Du(t.font),n=i.lineHeight/2+this._padding.top,{titleX:r,titleY:o,maxWidth:s,rotation:a}=this._drawArgs(n);Su(e,t.text,0,0,i,{color:t.color,maxWidth:s,rotation:a,textAlign:Uc(t.align),textBaseline:"middle",translation:[r,o]})}}var Lf={id:"title",_element:Df,start(e,t,i){!function(e,t){const i=new Df({ctx:e.ctx,options:t,chart:e});Cd.configure(e,i,t),Cd.addBox(e,i),e.titleBlock=i}(e,i)},stop(e){const t=e.titleBlock;Cd.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,i){const n=e.titleBlock;Cd.configure(e,n,i),n.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Rf=new WeakMap;var Of={id:"subtitle",start(e,t,i){const n=new Df({ctx:e.ctx,options:i,chart:e});Cd.configure(e,n,i),Cd.addBox(e,n),Rf.set(e,n)},stop(e){Cd.removeBox(e,Rf.get(e)),Rf.delete(e)},beforeUpdate(e,t,i){const n=Rf.get(e);Cd.configure(e,n,i),n.options=i},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Bf={average(e){if(!e.length)return!1;let t,i,n=0,r=0,o=0;for(t=0,i=e.length;t<i;++t){const i=e[t].element;if(i&&i.hasValue()){const e=i.tooltipPosition();n+=e.x,r+=e.y,++o}}return{x:n/o,y:r/o}},nearest(e,t){if(!e.length)return!1;let i,n,r,o=t.x,s=t.y,a=Number.POSITIVE_INFINITY;for(i=0,n=e.length;i<n;++i){const n=e[i].element;if(n&&n.hasValue()){const e=kc(t,n.getCenterPoint());e<a&&(a=e,r=n)}}if(r){const e=r.tooltipPosition();o=e.x,s=e.y}return{x:o,y:s}}};function Ff(e,t){return t&&($l(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function Nf(e){return("string"==typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function jf(e,t){const{element:i,datasetIndex:n,index:r}=t,o=e.getDatasetMeta(n).controller,{label:s,value:a}=o.getLabelAndValue(r);return{chart:e,label:s,parsed:o.getParsed(r),raw:e.data.datasets[n].data[r],formattedValue:a,dataset:o.getDataset(),dataIndex:r,datasetIndex:n,element:i}}function Uf(e,t){const i=e.chart.ctx,{body:n,footer:r,title:o}=e,{boxWidth:s,boxHeight:a}=t,l=Du(t.bodyFont),c=Du(t.titleFont),u=Du(t.footerFont),h=o.length,d=r.length,p=n.length,f=zu(t.padding);let m=f.height,g=0,_=n.reduce(((e,t)=>e+t.before.length+t.lines.length+t.after.length),0);if(_+=e.beforeBody.length+e.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*t.titleSpacing+t.titleMarginBottom),_){m+=p*(t.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(_-p)*l.lineHeight+(_-1)*t.bodySpacing}d&&(m+=t.footerMarginTop+d*u.lineHeight+(d-1)*t.footerSpacing);let y=0;const x=function(e){g=Math.max(g,i.measureText(e).width+y)};return i.save(),i.font=c.string,Hl(e.title,x),i.font=l.string,Hl(e.beforeBody.concat(e.afterBody),x),y=t.displayColors?s+2+t.boxPadding:0,Hl(n,(e=>{Hl(e.before,x),Hl(e.lines,x),Hl(e.after,x)})),y=0,i.font=u.string,Hl(e.footer,x),i.restore(),g+=f.width,{width:g,height:m}}function $f(e,t,i,n){const{x:r,width:o}=i,{width:s,chartArea:{left:a,right:l}}=e;let c="center";return"center"===n?c=r<=(a+l)/2?"left":"right":r<=o/2?c="left":r>=s-o/2&&(c="right"),function(e,t,i,n){const{x:r,width:o}=n,s=i.caretSize+i.caretPadding;return"left"===e&&r+o+s>t.width||"right"===e&&r-o-s<0||void 0}(c,e,t,i)&&(c="center"),c}function Vf(e,t,i){const n=i.yAlign||t.yAlign||function(e,t){const{y:i,height:n}=t;return i<n/2?"top":i>e.height-n/2?"bottom":"center"}(e,i);return{xAlign:i.xAlign||t.xAlign||$f(e,t,i,n),yAlign:n}}function Gf(e,t,i,n){const{caretSize:r,caretPadding:o,cornerRadius:s}=e,{xAlign:a,yAlign:l}=i,c=r+o,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=Iu(s);let f=function(e,t){let{x:i,width:n}=e;return"right"===t?i-=n:"center"===t&&(i-=n/2),i}(t,a);const m=function(e,t,i){let{y:n,height:r}=e;return"top"===t?n+=i:n-="bottom"===t?r+i:r/2,n}(t,l,c);return"center"===l?"left"===a?f+=c:"right"===a&&(f-=c):"left"===a?f-=Math.max(u,d)+r:"right"===a&&(f+=Math.max(h,p)+r),{x:Ic(f,0,n.width-t.width),y:Ic(m,0,n.height-t.height)}}function Wf(e,t,i){const n=zu(i.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-n.right:e.x+n.left}function qf(e){return Ff([],Nf(e))}function Xf(e,t){const i=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return i?e.override(i):e}const Zf={beforeTitle:Nl,title(e){if(e.length>0){const t=e[0],i=t.chart.data.labels,n=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(n>0&&t.dataIndex<n)return i[t.dataIndex]}return""},afterTitle:Nl,beforeBody:Nl,beforeLabel:Nl,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const i=e.formattedValue;return Ul(i)||(t+=i),t},labelColor(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:Nl,afterBody:Nl,beforeFooter:Nl,footer:Nl,afterFooter:Nl};function Hf(e,t,i,n){const r=e[t].call(i,n);return void 0===r?Zf[t].call(i,n):r}class Yf extends Gd{static positioners=Bf;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,i=this.options.setContext(this.getContext()),n=i.enabled&&t.options.animation&&i.animations,r=new Lh(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=(e=this.chart.getContext(),t=this,i=this._tooltipItems,Ru(e,{tooltip:t,tooltipItems:i,type:"tooltip"})));var e,t,i}getTitle(e,t){const{callbacks:i}=t,n=Hf(i,"beforeTitle",this,e),r=Hf(i,"title",this,e),o=Hf(i,"afterTitle",this,e);let s=[];return s=Ff(s,Nf(n)),s=Ff(s,Nf(r)),s=Ff(s,Nf(o)),s}getBeforeBody(e,t){return qf(Hf(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:i}=t,n=[];return Hl(e,(e=>{const t={before:[],lines:[],after:[]},r=Xf(i,e);Ff(t.before,Nf(Hf(r,"beforeLabel",this,e))),Ff(t.lines,Hf(r,"label",this,e)),Ff(t.after,Nf(Hf(r,"afterLabel",this,e))),n.push(t)})),n}getAfterBody(e,t){return qf(Hf(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:i}=t,n=Hf(i,"beforeFooter",this,e),r=Hf(i,"footer",this,e),o=Hf(i,"afterFooter",this,e);let s=[];return s=Ff(s,Nf(n)),s=Ff(s,Nf(r)),s=Ff(s,Nf(o)),s}_createItems(e){const t=this._active,i=this.chart.data,n=[],r=[],o=[];let s,a,l=[];for(s=0,a=t.length;s<a;++s)l.push(jf(this.chart,t[s]));return e.filter&&(l=l.filter(((t,n,r)=>e.filter(t,n,r,i)))),e.itemSort&&(l=l.sort(((t,n)=>e.itemSort(t,n,i)))),Hl(l,(t=>{const i=Xf(e.callbacks,t);n.push(Hf(i,"labelColor",this,t)),r.push(Hf(i,"labelPointStyle",this,t)),o.push(Hf(i,"labelTextColor",this,t))})),this.labelColors=n,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=l,l}update(e,t){const i=this.options.setContext(this.getContext()),n=this._active;let r,o=[];if(n.length){const e=Bf[i.position].call(this,n,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const t=this._size=Uf(this,i),s=Object.assign({},e,t),a=Vf(this.chart,i,s),l=Gf(i,s,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,r={opacity:1,x:l.x,y:l.y,width:t.width,height:t.height,caretX:e.x,caretY:e.y}}else 0!==this.opacity&&(r={opacity:0});this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),e&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,i,n){const r=this.getCaretPosition(e,i,n);t.lineTo(r.x1,r.y1),t.lineTo(r.x2,r.y2),t.lineTo(r.x3,r.y3)}getCaretPosition(e,t,i){const{xAlign:n,yAlign:r}=this,{caretSize:o,cornerRadius:s}=i,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:u}=Iu(s),{x:h,y:d}=e,{width:p,height:f}=t;let m,g,_,y,x,v;return"center"===r?(x=d+f/2,"left"===n?(m=h,g=m-o,y=x+o,v=x-o):(m=h+p,g=m+o,y=x-o,v=x+o),_=m):(g="left"===n?h+Math.max(a,c)+o:"right"===n?h+p-Math.max(l,u)-o:this.caretX,"top"===r?(y=d,x=y-o,m=g-o,_=g+o):(y=d+f,x=y+o,m=g+o,_=g-o),v=y),{x1:m,x2:g,x3:_,y1:y,y2:x,y3:v}}drawTitle(e,t,i){const n=this.title,r=n.length;let o,s,a;if(r){const l=xh(i.rtl,this.x,this.width);for(e.x=Wf(this,i.titleAlign,i),t.textAlign=l.textAlign(i.titleAlign),t.textBaseline="middle",o=Du(i.titleFont),s=i.titleSpacing,t.fillStyle=i.titleColor,t.font=o.string,a=0;a<r;++a)t.fillText(n[a],l.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+s,a+1===r&&(e.y+=i.titleMarginBottom-s)}}_drawColorBox(e,t,i,n,r){const o=this.labelColors[i],s=this.labelPointStyles[i],{boxHeight:a,boxWidth:l}=r,c=Du(r.bodyFont),u=Wf(this,"left",r),h=n.x(u),d=a<c.lineHeight?(c.lineHeight-a)/2:0,p=t.y+d;if(r.usePointStyle){const t={radius:Math.min(l,a)/2,pointStyle:s.pointStyle,rotation:s.rotation,borderWidth:1},i=n.leftForLtr(h,l)+l/2,c=p+a/2;e.strokeStyle=r.multiKeyBackground,e.fillStyle=r.multiKeyBackground,fu(e,t,i,c),e.strokeStyle=o.borderColor,e.fillStyle=o.backgroundColor,fu(e,t,i,c)}else{e.lineWidth=Vl(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,e.strokeStyle=o.borderColor,e.setLineDash(o.borderDash||[]),e.lineDashOffset=o.borderDashOffset||0;const t=n.leftForLtr(h,l),i=n.leftForLtr(n.xPlus(h,1),l-2),s=Iu(o.borderRadius);Object.values(s).some((e=>0!==e))?(e.beginPath(),e.fillStyle=r.multiKeyBackground,Tu(e,{x:t,y:p,w:l,h:a,radius:s}),e.fill(),e.stroke(),e.fillStyle=o.backgroundColor,e.beginPath(),Tu(e,{x:i,y:p+1,w:l-2,h:a-2,radius:s}),e.fill()):(e.fillStyle=r.multiKeyBackground,e.fillRect(t,p,l,a),e.strokeRect(t,p,l,a),e.fillStyle=o.backgroundColor,e.fillRect(i,p+1,l-2,a-2))}e.fillStyle=this.labelTextColors[i]}drawBody(e,t,i){const{body:n}=this,{bodySpacing:r,bodyAlign:o,displayColors:s,boxHeight:a,boxWidth:l,boxPadding:c}=i,u=Du(i.bodyFont);let h=u.lineHeight,d=0;const p=xh(i.rtl,this.x,this.width),f=function(i){t.fillText(i,p.x(e.x+d),e.y+h/2),e.y+=h+r},m=p.textAlign(o);let g,_,y,x,v,b,w;for(t.textAlign=o,t.textBaseline="middle",t.font=u.string,e.x=Wf(this,m,i),t.fillStyle=i.bodyColor,Hl(this.beforeBody,f),d=s&&"right"!==m?"center"===o?l/2+c:l+2+c:0,x=0,b=n.length;x<b;++x){for(g=n[x],_=this.labelTextColors[x],t.fillStyle=_,Hl(g.before,f),y=g.lines,s&&y.length&&(this._drawColorBox(t,e,x,p,i),h=Math.max(u.lineHeight,a)),v=0,w=y.length;v<w;++v)f(y[v]),h=u.lineHeight;Hl(g.after,f)}d=0,h=u.lineHeight,Hl(this.afterBody,f),e.y-=r}drawFooter(e,t,i){const n=this.footer,r=n.length;let o,s;if(r){const a=xh(i.rtl,this.x,this.width);for(e.x=Wf(this,i.footerAlign,i),e.y+=i.footerMarginTop,t.textAlign=a.textAlign(i.footerAlign),t.textBaseline="middle",o=Du(i.footerFont),t.fillStyle=i.footerColor,t.font=o.string,s=0;s<r;++s)t.fillText(n[s],a.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+i.footerSpacing}}drawBackground(e,t,i,n){const{xAlign:r,yAlign:o}=this,{x:s,y:a}=e,{width:l,height:c}=i,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=Iu(n.cornerRadius);t.fillStyle=n.backgroundColor,t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.beginPath(),t.moveTo(s+u,a),"top"===o&&this.drawCaret(e,t,i,n),t.lineTo(s+l-h,a),t.quadraticCurveTo(s+l,a,s+l,a+h),"center"===o&&"right"===r&&this.drawCaret(e,t,i,n),t.lineTo(s+l,a+c-p),t.quadraticCurveTo(s+l,a+c,s+l-p,a+c),"bottom"===o&&this.drawCaret(e,t,i,n),t.lineTo(s+d,a+c),t.quadraticCurveTo(s,a+c,s,a+c-d),"center"===o&&"left"===r&&this.drawCaret(e,t,i,n),t.lineTo(s,a+u),t.quadraticCurveTo(s,a,s+u,a),t.closePath(),t.fill(),n.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,i=this.$animations,n=i&&i.x,r=i&&i.y;if(n||r){const i=Bf[e.position].call(this,this._active,this._eventPosition);if(!i)return;const o=this._size=Uf(this,e),s=Object.assign({},i,this._size),a=Vf(t,e,s),l=Gf(e,s,a,t);n._to===l.x&&r._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=o.width,this.height=o.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(t);const n={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=zu(t.padding),s=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&s&&(e.save(),e.globalAlpha=i,this.drawBackground(r,e,n,t),vh(e,t.textDirection),r.y+=o.top,this.drawTitle(r,e,t),this.drawBody(r,e,t),this.drawFooter(r,e,t),bh(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const i=this._active,n=e.map((({datasetIndex:e,index:t})=>{const i=this.chart.getDatasetMeta(e);if(!i)throw new Error("Cannot find a dataset at index "+e);return{datasetIndex:e,element:i.data[t],index:t}})),r=!Yl(i,n),o=this._positionChanged(n,t);(r||o)&&(this._active=n,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,i=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,r=this._active||[],o=this._getActiveElements(e,r,t,i),s=this._positionChanged(o,e),a=t||!Yl(o,r)||s;return a&&(this._active=o,(n.enabled||n.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),a}_getActiveElements(e,t,i,n){const r=this.options;if("mouseout"===e.type)return[];if(!n)return t;const o=this.chart.getElementsAtEventForMode(e,r.mode,r,i);return r.reverse&&o.reverse(),o}_positionChanged(e,t){const{caretX:i,caretY:n,options:r}=this,o=Bf[r.position].call(this,e,t);return!1!==o&&(i!==o.x||n!==o.y)}}var Kf={id:"tooltip",_element:Yf,positioners:Bf,afterInit(e,t,i){i&&(e.tooltip=new Yf({chart:e,options:i}))},beforeUpdate(e,t,i){e.tooltip&&e.tooltip.initialize(i)},reset(e,t,i){e.tooltip&&e.tooltip.initialize(i)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const i={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",{...i,cancelable:!0}))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",i)}},afterEvent(e,t){if(e.tooltip){const i=t.replay;e.tooltip.handleEvent(t.event,i,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Zf},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Jf=Object.freeze({__proto__:null,Colors:lf,Decimation:hf,Filler:Mf,Legend:zf,SubTitle:Of,Title:Lf,Tooltip:Kf});function Qf(e,t,i,n){const r=e.indexOf(t);if(-1===r)return((e,t,i,n)=>("string"==typeof t?(i=e.push(t)-1,n.unshift({index:i,label:t})):isNaN(t)&&(i=null),i))(e,t,i,n);return r!==e.lastIndexOf(t)?i:r}function em(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}function tm(e,t){const i=[],{bounds:n,step:r,min:o,max:s,precision:a,count:l,maxTicks:c,maxDigits:u,includeBounds:h}=e,d=r||1,p=c-1,{min:f,max:m}=t,g=!Ul(o),_=!Ul(s),y=!Ul(l),x=(m-f)/(u+1);let v,b,w,S,T=vc((m-f)/p/d)*d;if(T<1e-14&&!g&&!_)return[{value:f},{value:m}];S=Math.ceil(m/T)-Math.floor(f/T),S>p&&(T=vc(S*T/p/d)*d),Ul(a)||(v=Math.pow(10,a),T=Math.ceil(T*v)/v),"ticks"===n?(b=Math.floor(f/T)*T,w=Math.ceil(m/T)*T):(b=f,w=m),g&&_&&r&&function(e,t){const i=Math.round(e);return i-t<=e&&i+t>=e}((s-o)/r,T/1e3)?(S=Math.round(Math.min((s-o)/T,c)),T=(s-o)/S,b=o,w=s):y?(b=g?o:b,w=_?s:w,S=l-1,T=(w-b)/S):(S=(w-b)/T,S=xc(S,Math.round(S),T/1e3)?Math.round(S):Math.ceil(S));const E=Math.max(Ec(T),Ec(b));v=Math.pow(10,Ul(a)?E:a),b=Math.round(b*v)/v,w=Math.round(w*v)/v;let C=0;for(g&&(h&&b!==o?(i.push({value:o}),b<o&&C++,xc(Math.round((b+C*T)*v)/v,o,im(o,x,e))&&C++):b<o&&C++);C<S;++C){const e=Math.round((b+C*T)*v)/v;if(_&&e>s)break;i.push({value:e})}return _&&h&&w!==s?i.length&&xc(i[i.length-1].value,s,im(s,x,e))?i[i.length-1].value=s:i.push({value:s}):_&&w!==s||i.push({value:w}),i}function im(e,t,{horizontal:i,minRotation:n}){const r=Sc(n),o=(i?Math.sin(r):Math.cos(r))||.001,s=.75*t*(""+e).length;return Math.min(t/o,s)}class nm extends ep{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Ul(e)||("number"==typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:i}=this.getUserBounds();let{min:n,max:r}=this;const o=e=>n=t?n:e,s=e=>r=i?r:e;if(e){const e=yc(n),t=yc(r);e<0&&t<0?s(0):e>0&&t>0&&o(0)}if(n===r){let t=0===r?1:Math.abs(.05*r);s(r+t),e||o(n-t)}this.min=n,this.max=r}getTickLimit(){const e=this.options.ticks;let t,{maxTicksLimit:i,stepSize:n}=e;return n?(t=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,t>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${t} ticks. Limiting to 1000.`),t=1e3)):(t=this.computeTickLimit(),i=i||11),i&&(t=Math.min(i,t)),t}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n=tm({maxTicks:i,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&wc(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}configure(){const e=this.ticks;let t=this.min,i=this.max;if(super.configure(),this.options.offset&&e.length){const n=(i-t)/Math.max(e.length-1,1)/2;t-=n,i+=n}this._startValue=t,this._endValue=i,this._valueRange=i-t}getLabelForValue(e){return tu(e,this.chart.options.locale,this.options.ticks.format)}}class rm extends nm{static id="linear";static defaults={ticks:{callback:nu.formatters.numeric}};determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Gl(e)?e:0,this.max=Gl(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,i=Sc(this.options.ticks.minRotation),n=(e?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,r.lineHeight/n))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const om=e=>Math.floor(_c(e)),sm=(e,t)=>Math.pow(10,om(e)+t);function am(e){return 1===e/Math.pow(10,om(e))}function lm(e,t,i){const n=Math.pow(10,i),r=Math.floor(e/n);return Math.ceil(t/n)-r}function cm(e,{min:t,max:i}){t=Wl(e.min,t);const n=[],r=om(t);let o=function(e,t){let i=om(t-e);for(;lm(e,t,i)>10;)i++;for(;lm(e,t,i)<10;)i--;return Math.min(i,om(e))}(t,i),s=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),l=r>o?Math.pow(10,r):0,c=Math.round((t-l)*s)/s,u=Math.floor((t-l)/a/10)*a*10;let h=Math.floor((c-u)/Math.pow(10,o)),d=Wl(e.min,Math.round((l+u+h*Math.pow(10,o))*s)/s);for(;d<i;)n.push({value:d,major:am(d),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(o++,h=2,s=o>=0?1:s),d=Math.round((l+u+h*Math.pow(10,o))*s)/s;const p=Wl(e.max,d);return n.push({value:p,major:am(p),significand:h}),n}class um extends ep{static id="logarithmic";static defaults={ticks:{callback:nu.formatters.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const i=nm.prototype.parse.apply(this,[e,t]);if(0!==i)return Gl(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Gl(e)?Math.max(0,e):null,this.max=Gl(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Gl(this._userMin)&&(this.min=e===sm(this.min,0)?sm(this.min,-1):sm(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let i=this.min,n=this.max;const r=t=>i=e?i:t,o=e=>n=t?n:e;i===n&&(i<=0?(r(1),o(10)):(r(sm(i,-1)),o(sm(n,1)))),i<=0&&r(sm(n,-1)),n<=0&&o(sm(i,1)),this.min=i,this.max=n}buildTicks(){const e=this.options,t=cm({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&wc(t,this,"value"),e.reverse?(t.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),t}getLabelForValue(e){return void 0===e?"0":tu(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=_c(e),this._valueRange=_c(this.max)-_c(e)}getPixelForValue(e){return void 0!==e&&0!==e||(e=this.min),null===e||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(_c(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function hm(e){const t=e.ticks;if(t.display&&e.display){const e=zu(t.backdropPadding);return ql(t.font&&t.font.size,cu.font.size)+e.height}return 0}function dm(e,t,i,n,r){return e===n||e===r?{start:t-i/2,end:t+i/2}:e<n||e>r?{start:t-i,end:t}:{start:t,end:t+i}}function pm(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},i=Object.assign({},t),n=[],r=[],o=e._pointLabels.length,s=e.options.pointLabels,a=s.centerPointLabels?cc/o:0;for(let h=0;h<o;h++){const o=s.setContext(e.getPointLabelContext(h));r[h]=o.padding;const d=e.getPointPosition(h,e.drawingArea+r[h],a),p=Du(o.font),f=(l=e.ctx,c=p,u=$l(u=e._pointLabels[h])?u:[u],{w:hu(l,c.string,u),h:u.length*c.lineHeight});n[h]=f;const m=Ac(e.getIndexAngle(h)+a),g=Math.round(Tc(m));fm(i,t,m,dm(g,d.x,f.w,0,180),dm(g,d.y,f.h,90,270))}var l,c,u;e.setCenterPoint(t.l-i.l,i.r-t.r,t.t-i.t,i.b-t.b),e._pointLabelItems=function(e,t,i){const n=[],r=e._pointLabels.length,o=e.options,{centerPointLabels:s,display:a}=o.pointLabels,l={extra:hm(o)/2,additionalAngle:s?cc/r:0};let c;for(let o=0;o<r;o++){l.padding=i[o],l.size=t[o];const r=mm(e,o,l);n.push(r),"auto"===a&&(r.visible=gm(r,c),r.visible&&(c=r))}return n}(e,n,r)}function fm(e,t,i,n,r){const o=Math.abs(Math.sin(i)),s=Math.abs(Math.cos(i));let a=0,l=0;n.start<t.l?(a=(t.l-n.start)/o,e.l=Math.min(e.l,t.l-a)):n.end>t.r&&(a=(n.end-t.r)/o,e.r=Math.max(e.r,t.r+a)),r.start<t.t?(l=(t.t-r.start)/s,e.t=Math.min(e.t,t.t-l)):r.end>t.b&&(l=(r.end-t.b)/s,e.b=Math.max(e.b,t.b+l))}function mm(e,t,i){const n=e.drawingArea,{extra:r,additionalAngle:o,padding:s,size:a}=i,l=e.getPointPosition(t,n+r+s,o),c=Math.round(Tc(Ac(l.angle+fc))),u=function(e,t,i){90===i||270===i?e-=t/2:(i>270||i<90)&&(e-=t);return e}(l.y,a.h,c),h=function(e){if(0===e||180===e)return"center";if(e<180)return"left";return"right"}(c),d=function(e,t,i){"right"===i?e-=t:"center"===i&&(e-=t/2);return e}(l.x,a.w,h);return{visible:!0,x:l.x,y:u,textAlign:h,left:d,top:u,right:d+a.w,bottom:u+a.h}}function gm(e,t){if(!t)return!0;const{left:i,top:n,right:r,bottom:o}=e;return!(gu({x:i,y:n},t)||gu({x:i,y:o},t)||gu({x:r,y:n},t)||gu({x:r,y:o},t))}function _m(e,t,i){const{left:n,top:r,right:o,bottom:s}=i,{backdropColor:a}=t;if(!Ul(a)){const i=Iu(t.borderRadius),l=zu(t.backdropPadding);e.fillStyle=a;const c=n-l.left,u=r-l.top,h=o-n+l.width,d=s-r+l.height;Object.values(i).some((e=>0!==e))?(e.beginPath(),Tu(e,{x:c,y:u,w:h,h:d,radius:i}),e.fill()):e.fillRect(c,u,h,d)}}function ym(e,t,i,n){const{ctx:r}=e;if(i)r.arc(e.xCenter,e.yCenter,t,0,uc);else{let i=e.getPointPosition(0,t);r.moveTo(i.x,i.y);for(let o=1;o<n;o++)i=e.getPointPosition(o,t),r.lineTo(i.x,i.y)}}class xm extends nm{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:nu.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=zu(hm(this.options)/2),t=this.width=this.maxWidth-e.width,i=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+i/2+e.top),this.drawingArea=Math.floor(Math.min(t,i)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=Gl(e)&&!isNaN(e)?e:0,this.max=Gl(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/hm(this.options))}generateTickLabels(e){nm.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map(((e,t)=>{const i=Zl(this.options.pointLabels.callback,[e,t],this);return i||0===i?i:""})).filter(((e,t)=>this.chart.getDataVisibility(t)))}fit(){const e=this.options;e.display&&e.pointLabels.display?pm(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,i,n){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((i-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,i,n))}getIndexAngle(e){return Ac(e*(uc/(this._pointLabels.length||1))+Sc(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(Ul(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Ul(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const i=t[e];return function(e,t,i){return Ru(e,{label:i,index:t,type:"pointLabel"})}(this.getContext(),e,i)}}getPointPosition(e,t,i=0){const n=this.getIndexAngle(e)-fc+i;return{x:Math.cos(n)*t+this.xCenter,y:Math.sin(n)*t+this.yCenter,angle:n}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:i,right:n,bottom:r}=this._pointLabelItems[e];return{left:t,top:i,right:n,bottom:r}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const i=this.ctx;i.save(),i.beginPath(),ym(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),i.closePath(),i.fillStyle=e,i.fill(),i.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:i,grid:n,border:r}=t,o=this._pointLabels.length;let s,a,l;if(t.pointLabels.display&&function(e,t){const{ctx:i,options:{pointLabels:n}}=e;for(let r=t-1;r>=0;r--){const t=e._pointLabelItems[r];if(!t.visible)continue;const o=n.setContext(e.getPointLabelContext(r));_m(i,o,t);const s=Du(o.font),{x:a,y:l,textAlign:c}=t;Su(i,e._pointLabels[r],a,l+s.lineHeight/2,s,{color:o.color,textAlign:c,textBaseline:"middle"})}}(this,o),n.display&&this.ticks.forEach(((e,t)=>{if(0!==t){a=this.getDistanceFromCenterForValue(e.value);const i=this.getContext(t),s=n.setContext(i),l=r.setContext(i);!function(e,t,i,n,r){const o=e.ctx,s=t.circular,{color:a,lineWidth:l}=t;!s&&!n||!a||!l||i<0||(o.save(),o.strokeStyle=a,o.lineWidth=l,o.setLineDash(r.dash),o.lineDashOffset=r.dashOffset,o.beginPath(),ym(e,i,s,n),o.closePath(),o.stroke(),o.restore())}(this,s,a,o,l)}})),i.display){for(e.save(),s=o-1;s>=0;s--){const n=i.setContext(this.getPointLabelContext(s)),{color:r,lineWidth:o}=n;o&&r&&(e.lineWidth=o,e.strokeStyle=r,e.setLineDash(n.borderDash),e.lineDashOffset=n.borderDashOffset,a=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),l=this.getPointPosition(s,a),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(l.x,l.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,i=t.ticks;if(!i.display)return;const n=this.getIndexAngle(0);let r,o;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(n),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach(((n,s)=>{if(0===s&&!t.reverse)return;const a=i.setContext(this.getContext(s)),l=Du(a.font);if(r=this.getDistanceFromCenterForValue(this.ticks[s].value),a.showLabelBackdrop){e.font=l.string,o=e.measureText(n.label).width,e.fillStyle=a.backdropColor;const t=zu(a.backdropPadding);e.fillRect(-o/2-t.left,-r-l.size/2-t.top,o+t.width,l.size+t.height)}Su(e,n.label,0,-r,l,{color:a.color,strokeColor:a.textStrokeColor,strokeWidth:a.textStrokeWidth})})),e.restore()}drawTitle(){}}const vm={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},bm=Object.keys(vm);function wm(e,t){return e-t}function Sm(e,t){if(Ul(t))return null;const i=e._adapter,{parser:n,round:r,isoWeekday:o}=e._parseOpts;let s=t;return"function"==typeof n&&(s=n(s)),Gl(s)||(s="string"==typeof n?i.parse(s,n):i.parse(s)),null===s?null:(r&&(s="week"!==r||!bc(o)&&!0!==o?i.startOf(s,r):i.startOf(s,"isoWeek",o)),+s)}function Tm(e,t,i,n){const r=bm.length;for(let o=bm.indexOf(e);o<r-1;++o){const e=vm[bm[o]],r=e.steps?e.steps:Number.MAX_SAFE_INTEGER;if(e.common&&Math.ceil((i-t)/(r*e.size))<=n)return bm[o]}return bm[r-1]}function Em(e,t,i){if(i){if(i.length){const{lo:n,hi:r}=Dc(i,t);e[i[n]>=t?i[n]:i[r]]=!0}}else e[t]=!0}function Cm(e,t,i){const n=[],r={},o=t.length;let s,a;for(s=0;s<o;++s)a=t[s],r[a]=s,n.push({value:a,major:!1});return 0!==o&&i?function(e,t,i,n){const r=e._adapter,o=+r.startOf(t[0].value,n),s=t[t.length-1].value;let a,l;for(a=o;a<=s;a=+r.add(a,1,n))l=i[a],l>=0&&(t[l].major=!0);return t}(e,n,r,i):n}class km extends ep{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const i=e.time||(e.time={}),n=this._adapter=new sd(e.adapters.date);n.init(t),tc(i.displayFormats,n.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return void 0===e?null:Sm(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,i=e.time.unit||"day";let{min:n,max:r,minDefined:o,maxDefined:s}=this.getUserBounds();function a(e){o||isNaN(e.min)||(n=Math.min(n,e.min)),s||isNaN(e.max)||(r=Math.max(r,e.max))}o&&s||(a(this._getLabelBounds()),"ticks"===e.bounds&&"labels"===e.ticks.source||a(this.getMinMax(!1))),n=Gl(n)&&!isNaN(n)?n:+t.startOf(Date.now(),i),r=Gl(r)&&!isNaN(r)?r:+t.endOf(Date.now(),i)+1,this.min=Math.min(n,r-1),this.max=Math.max(n+1,r)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],i=e[e.length-1]),{min:t,max:i}}buildTicks(){const e=this.options,t=e.time,i=e.ticks,n="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const r=this.min,o=function(e,t,i){let n=0,r=e.length;for(;n<r&&e[n]<t;)n++;for(;r>n&&e[r-1]>i;)r--;return n>0||r<e.length?e.slice(n,r):e}(n,r,this.max);return this._unit=t.unit||(i.autoSkip?Tm(t.minUnit,this.min,this.max,this._getLabelCapacity(r)):function(e,t,i,n,r){for(let o=bm.length-1;o>=bm.indexOf(i);o--){const i=bm[o];if(vm[i].common&&e._adapter.diff(r,n,i)>=t-1)return i}return bm[i?bm.indexOf(i):0]}(this,o.length,t.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(e){for(let t=bm.indexOf(e)+1,i=bm.length;t<i;++t)if(vm[bm[t]].common)return bm[t]}(this._unit):void 0,this.initOffsets(n),e.reverse&&o.reverse(),Cm(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((e=>+e.value)))}initOffsets(e=[]){let t,i,n=0,r=0;this.options.offset&&e.length&&(t=this.getDecimalForValue(e[0]),n=1===e.length?1-t:(this.getDecimalForValue(e[1])-t)/2,i=this.getDecimalForValue(e[e.length-1]),r=1===e.length?i:(i-this.getDecimalForValue(e[e.length-2]))/2);const o=e.length<3?.5:.25;n=Ic(n,0,o),r=Ic(r,0,o),this._offsets={start:n,end:r,factor:1/(n+1+r)}}_generate(){const e=this._adapter,t=this.min,i=this.max,n=this.options,r=n.time,o=r.unit||Tm(r.minUnit,t,i,this._getLabelCapacity(t)),s=ql(n.ticks.stepSize,1),a="week"===o&&r.isoWeekday,l=bc(a)||!0===a,c={};let u,h,d=t;if(l&&(d=+e.startOf(d,"isoWeek",a)),d=+e.startOf(d,l?"day":o),e.diff(i,t,o)>1e5*s)throw new Error(t+" and "+i+" are too far apart with stepSize of "+s+" "+o);const p="data"===n.ticks.source&&this.getDataTimestamps();for(u=d,h=0;u<i;u=+e.add(u,s,o),h++)Em(c,u,p);return u!==i&&"ticks"!==n.bounds&&1!==h||Em(c,u,p),Object.keys(c).sort(wm).map((e=>+e))}getLabelForValue(e){const t=this._adapter,i=this.options.time;return i.tooltipFormat?t.format(e,i.tooltipFormat):t.format(e,i.displayFormats.datetime)}format(e,t){const i=this.options.time.displayFormats,n=this._unit,r=t||i[n];return this._adapter.format(e,r)}_tickFormatFunction(e,t,i,n){const r=this.options,o=r.ticks.callback;if(o)return Zl(o,[e,t,i],this);const s=r.time.displayFormats,a=this._unit,l=this._majorUnit,c=a&&s[a],u=l&&s[l],h=i[t],d=l&&u&&h&&h.major;return this._adapter.format(e,n||(d?u:c))}generateTickLabels(e){let t,i,n;for(t=0,i=e.length;t<i;++t)n=e[t],n.label=this._tickFormatFunction(n.value,t,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,i=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+i)*t.factor)}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+i*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,i=this.ctx.measureText(e).width,n=Sc(this.isHorizontal()?t.maxRotation:t.minRotation),r=Math.cos(n),o=Math.sin(n),s=this._resolveTickFontOptions(0).size;return{w:i*r+s*o,h:i*o+s*r}}_getLabelCapacity(e){const t=this.options.time,i=t.displayFormats,n=i[t.unit]||i.millisecond,r=this._tickFormatFunction(e,0,Cm(this,[e],this._majorUnit),n),o=this._getLabelSize(r),s=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return s>0?s:1}getDataTimestamps(){let e,t,i=this._cache.data||[];if(i.length)return i;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(e=0,t=n.length;e<t;++e)i=i.concat(n[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const e=this._cache.labels||[];let t,i;if(e.length)return e;const n=this.getLabels();for(t=0,i=n.length;t<i;++t)e.push(Sm(this,n[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return Fc(e.sort(wm))}}function Mm(e,t,i){let n,r,o,s,a=0,l=e.length-1;i?(t>=e[a].pos&&t<=e[l].pos&&({lo:a,hi:l}=Lc(e,"pos",t)),({pos:n,time:o}=e[a]),({pos:r,time:s}=e[l])):(t>=e[a].time&&t<=e[l].time&&({lo:a,hi:l}=Lc(e,"time",t)),({time:n,pos:o}=e[a]),({time:r,pos:s}=e[l]));const c=r-n;return c?o+(s-o)*(t-n)/c:o}var Am=Object.freeze({__proto__:null,CategoryScale:class extends ep{static id="category";static defaults={ticks:{callback:em}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const e=this.getLabels();for(const{index:i,label:n}of t)e[i]===n&&e.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(Ul(e))return null;const i=this.getLabels();return((e,t)=>null===e?null:Ic(Math.round(e),0,t))(t=isFinite(t)&&i[t]===e?t:Qf(i,e,ql(t,e),this._addedLabels),i.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:i,max:n}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(i=0),t||(n=this.getLabels().length-1)),this.min=i,this.max=n}buildTicks(){const e=this.min,t=this.max,i=this.options.offset,n=[];let r=this.getLabels();r=0===e&&t===r.length-1?r:r.slice(e,t+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let i=e;i<=t;i++)n.push({value:i});return n}getLabelForValue(e){return em.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!=typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}},LinearScale:rm,LogarithmicScale:um,RadialLinearScale:xm,TimeScale:km,TimeSeriesScale:class extends km{static id="timeseries";static defaults=km.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=Mm(t,this.min),this._tableRange=Mm(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:i}=this,n=[],r=[];let o,s,a,l,c;for(o=0,s=e.length;o<s;++o)l=e[o],l>=t&&l<=i&&n.push(l);if(n.length<2)return[{time:t,pos:0},{time:i,pos:1}];for(o=0,s=n.length;o<s;++o)c=n[o+1],a=n[o-1],l=n[o],Math.round((c+a)/2)!==l&&r.push({time:l,pos:o/(s-1)});return r}_generate(){const e=this.min,t=this.max;let i=super.getDataTimestamps();return i.includes(e)&&i.length||i.splice(0,0,e),i.includes(t)&&1!==i.length||i.push(t),i.sort(((e,t)=>e-t))}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),i=this.getLabelTimestamps();return e=t.length&&i.length?this.normalize(t.concat(i)):t.length?t:i,e=this._cache.all=e,e}getDecimalForValue(e){return(Mm(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return Mm(this._table,i*this._tableRange+this._minPos,!0)}}});const Pm=[nd,ef,Jf,Am];zp.register(...Pm);const Im=e=>e.map(((e,t,i)=>0===t||i[t-1].openPrice<e.closePrice?Zt.successGreen:Zt.errorRed)),zm={type:"bar",parsing:{xAxisKey:"x",yAxisKey:"s"},scales:{x:{title:{display:!0,text:"Date"},grid:{color:Zt.darkGray,borderWidth:1},ticks:{autoSkip:!0,maxTicksLimit:10,maxRotation:0,minRotation:0}},y:{title:{display:!0,text:"Values"},grid:{color:Zt.darkGray,borderWidth:1},beginAtZero:!0,grace:10}},plugins:{tooltip:{callbacks:{label:e=>{const t=e.dataset.data[e.dataIndex];return`Open: ${t.o},  High: ${t.h}, Low: ${t.l}, Close: ${t.c}`}}},legend:{display:!1}}},Dm={id:"candlestick",beforeDatasetsDraw(e){const{ctx:t,data:i,scales:{y:n}}=e;t.save(),t.lineWidth=2,i.datasets[0].data.forEach(((r,o)=>{const s=i.datasets[0].borderColor[o];t.strokeStyle=s,t.beginPath(),t.moveTo(e.getDatasetMeta(0).data[o].x,e.getDatasetMeta(0).data[o].y),t.lineTo(e.getDatasetMeta(0).data[o].x,n.getPixelForValue(i.datasets[0].data[o].h)),t.stroke(),t.beginPath(),t.moveTo(e.getDatasetMeta(0).data[o].x,e.getDatasetMeta(0).data[o].y),t.lineTo(e.getDatasetMeta(0).data[o].x,n.getPixelForValue(i.datasets[0].data[o].l)),t.stroke()}))}},Lm=Vt.div`
  overflow: auto;
  width: 100%;
  height: 100%;
`,Rm=Vt.canvas`
  min-width: 840px;
  min-height: 540px;
`;class Om extends n.Component{chartRef=n.createRef();chart=null;createChart(e,t){const i=this.chartRef.current.getContext("2d"),n={labels:Object.keys(e),datasets:[{backgroundColor:t,borderColor:t,data:Object.keys(e).map((t=>{const i=e[t];return{x:t,o:i.openPrice,h:i.highPrice,l:i.lowPrice,c:i.closePrice,s:[i.openPrice,i.closePrice]}}))}]};this.chart&&this.chart.destroy(),this.chart=new zp(i,{type:"bar",data:n,options:zm,plugins:[Dm]})}componentDidMount(){const{id:e}=this.props,t=(0,ui.lJ)(e),i=Im(Object.values(t));this.createChart(t,i)}componentDidUpdate(e){if(e.id!==this.props.id){const e=(0,ui.lJ)(this.props.id),t=Im(Object.values(e));this.createChart(e,t)}}render(){return(0,Kt.jsx)(Lm,{children:(0,Kt.jsx)(Rm,{ref:this.chartRef})})}}Om.propTypes={id:pn().string.isRequired};const Bm=Om,Fm=[{label:"Open price",name:"openPriceInput"},{label:"High price",name:"highPriceInput"},{label:"Low price",name:"lowPriceInput"},{label:"Close price",name:"closePriceInput"}],Nm={openPriceInput:"0",highPriceInput:"0",lowPriceInput:"0",closePriceInput:"0"},jm=1e6,Um={prevDate:"prevDate",nextDate:"nextDate"},$m=Vt.div`
  ${fi}
  gap: ${({theme:e})=>e.space.XS}px;
  align-items: center;
  justify-content: center;
`,Vm=Vt.button`
  color: ${Zt.white};
  background-color: transparent;
  cursor: pointer;
  height: 25px;
  width: 25px;
  border: none;
  border-radius: 25px;
  font-weight: bold;

  &:hover {
    background-color: ${({theme:e})=>e.colors.darkGray};
  }
`,Gm=Vt.p`
  color: ${Zt.white};
  font-size: ${({theme:e})=>e.font.fontSize.M}px;
  margin: ${({theme:e})=>e.space.XXS}px 0;
`;class Wm extends n.Component{handleUpdateDate=e=>()=>{this.props.onChange(e)};render(){const{prevDate:e,nextDate:t}=Um;return(0,Kt.jsxs)($m,{"data-cy":"date-picker",children:[(0,Kt.jsx)(Vm,{"data-cy":"prev-date",onClick:this.handleUpdateDate(e),children:"<"}),(0,Kt.jsx)(Gm,{children:rn(this.props.currentDate)}),(0,Kt.jsx)(Vm,{"data-cy":"next-date",onClick:this.handleUpdateDate(t),children:">"})]})}}Wm.propTypes={currentDate:pn().instanceOf(Date).isRequired,onChange:pn().func.isRequired};const qm=Wm,Xm=Vt.label`
  padding-left: ${({theme:e})=>e.space.M}px;
  color: ${Zt.white};
`,Zm=Vt.div`
  ${fi}
  color: ${Zt.white};
  border-bottom: 1px solid ${({theme:e})=>e.colors.darkGray};
  margin-left: ${({theme:e})=>e.space.M}px;
  margin-bottom: ${({theme:e})=>e.space.XS}px;
  margin-right: ${({theme:e})=>e.space.M}px;
  align-items: center;
  height: 50px;
`,Hm=Vt.input`
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  color: ${Zt.white};
  height: 50px;
  background: transparent;
  border: none;
  outline: none;

  &::-webkit-inner-spin-button,
  &::-webkit-outer-spin-button {
    margin: ${({theme:e})=>e.space.XXS0};
    -webkit-appearance: none;
    -moz-appearance: textfield;
    appearance: none;
  }
`;class Ym extends n.Component{handleInputChange=e=>{this.props.onChange(e)};render(){const{label:e,name:t,value:i,onBlur:n}=this.props;return(0,Kt.jsxs)(Kt.Fragment,{children:[(0,Kt.jsx)(Xm,{children:e}),(0,Kt.jsx)(Zm,{children:(0,Kt.jsx)(Hm,{name:t,type:"number",value:i,onChange:this.handleInputChange,onBlur:n})})]})}}Ym.propTypes={label:pn().string.isRequired,name:pn().string.isRequired,value:pn().string.isRequired,onChange:pn().func.isRequired,onBlur:pn().func.isRequired};const Km=Ym,Jm="#EA3943",Qm="#16C782",eg=Vt.button`
  background-color: ${({theme:e})=>e.colors.darkGreen};
  color: ${Zt.white};
  margin: ${({theme:e})=>e.space.S}px;
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  border-radius: 25px;
  border: none;
  height: 50px;
  cursor: pointer;

  &:hover {
    background-color: ${({theme:e})=>e.colors.yellow};
  }
`,tg=Vt.p`
  margin-bottom: ${({theme:e})=>e.space.XXS}px;
  color: ${Zt.white};
  align-self: center;
  width: 250px;
  text-align: center;
`,ig=Vt(tg)`
  color: ${({theme:e})=>e.colors.red};
`;class ng extends n.Component{state={currentDate:new Date,inputValue:Nm,remainingChartItems:0};loadCachedData(e){const t=rn(e),i=(0,ui.lJ)(this.props.id)[t];i?this.setState({inputValue:{openPriceInput:i.openPrice,highPriceInput:i.highPrice,lowPriceInput:i.lowPrice,closePriceInput:i.closePrice},isError:!1}):this.setState({inputValue:Nm})}calculateRemainingChartItems(){const e=this.props.id,t=(0,ui.lJ)(e),i=30-Object.keys(t).length;return Math.max(0,i)}componentDidMount(){this.loadCachedData(this.state.currentDate);const e=this.calculateRemainingChartItems();this.setState({remainingChartItems:e})}handleCloseModal=()=>{this.props.onClose()};handleUpdateDate=e=>{const{prevDate:t}=Um,{currentDate:i}=this.state,n=e===t?-1:1,r=new Date(i);r.setDate(r.getDate()+n),this.setState({currentDate:r}),this.loadCachedData(r)};handleInputChange=e=>{const{name:t,value:i}=e.target;this.setState((e=>({inputValue:{...e.inputValue,[t]:i},isError:!1})))};handleBlur=e=>{const{name:t,value:i}=e.target;(isNaN(i)||i<0||i>jm||""===i.trim())&&this.setState((e=>({inputValue:{...e.inputValue,[t]:"0"},isError:!0})))};handleAddPriceButtonClick=()=>{const{currentDate:e,inputValue:t}=this.state;this.props.onAddPrice(e,t);const i=this.calculateRemainingChartItems();this.setState({remainingChartItems:i})};render(){const{currentDate:e,inputValue:t,isError:i,remainingChartItems:n}=this.state;return(0,Kt.jsxs)(nr,{onClose:this.handleCloseModal,children:[(0,Kt.jsx)(tg,{children:"There are {remainingChartItems} values left before the chart can be built.".replace("{remainingChartItems}",n)}),(0,Kt.jsx)(qm,{currentDate:e,onChange:this.handleUpdateDate}),i&&(0,Kt.jsx)(ig,{children:"The price must be more then 0 and less then 1000000."}),Fm.map((e=>(0,Kt.jsx)(Km,{label:e.label,name:e.name,value:t[e.name],onChange:this.handleInputChange,onBlur:this.handleBlur},e.name))),(0,Kt.jsx)(eg,{"data-cy":"add-price-button",onClick:this.handleAddPriceButtonClick,children:"Add Price"})]})}}ng.propTypes={id:pn().string.isRequired,onClose:pn().func.isRequired,onAddPrice:pn().func.isRequired};const rg=ng,og=Vt.span`
  background-color: ${e=>e.color};
  color: ${({theme:e})=>e.textColor};
  padding: ${({theme:e})=>e.space.XS}px 0;
  z-index: 1;
  text-align: center;
  transition: transform 0.3s ease-in-out;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
`;class sg extends n.PureComponent{render(){const{color:e,message:t}=this.props;return(0,Kt.jsx)(og,{color:e,"data-cy":"notification",children:t})}}sg.propTypes={color:pn().string.isRequired,message:pn().string.isRequired};const ag=sg;function lg({isModalOpen:e,selectedCurrency:t,handleAddPrice:i,handleCloseModal:n,showNotification:r,notification:o}){const s=da(),a=da("notification-portal-wrapper");return(0,Kt.jsxs)(Kt.Fragment,{children:[e&&s((0,Kt.jsx)(rg,{id:t.id,onAddPrice:i,onClose:n})),r&&a((0,Kt.jsx)(ag,{color:o.backgroundColor,message:o.message}))]})}lg.propTypes={isModalOpen:pn().bool.isRequired,selectedCurrency:pn().object.isRequired,handleAddPrice:pn().func.isRequired,handleCloseModal:pn().func.isRequired,showNotification:pn().bool.isRequired,notification:pn().shape({backgroundColor:pn().string.isRequired,message:pn().string.isRequired}).isRequired};const cg=lg,ug=Vt.main`
  ${mi}
  align-items: center;
`,hg=Vt.section`
  margin-bottom: ${({theme:e})=>e.space.XL}px;
  padding: 0 ${({theme:e})=>e.space.L}px;
  width: 100%;
  max-width: 1140px;
`,dg=Vt.div`
  ${fi}
  margin-bottom: ${({theme:e})=>e.space.XL}px;

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    flex-direction: column;
  }
`,pg=Vt.button`
  background-color: ${({theme:e})=>e.colors.darkGreen};
  color: ${({theme:e})=>e.textColor};
  margin: ${({theme:e})=>e.space.S}px;
  font-size: ${({theme:e})=>e.font.fontSize.S}px;
  border-radius: 25px;
  border: none;
  cursor: pointer;
  height: 50px;
  width: 100%;
  max-width: 230px;

  &:hover {
    background-color: ${({theme:e})=>e.colors.yellow};
  }

  @media (max-width: ${({theme:e})=>e.media.XXS}px) {
    margin-bottom: ${({theme:e})=>e.space.S}px;
  }
`;class fg extends n.Component{state={selectedCurrency:Ir,isModalOpen:!1,isChartCanBuild:!1,showNotification:!1,notification:{message:"",backgroundColor:""},showChart:!1};update(){this.setState({showNotification:!0}),setTimeout((()=>{this.setState({showNotification:!1})}),3e3)}componentDidMount(){ol.subscribe(this),this.checkChartBuildStatus()}componentWillUnmount(){ol.unsubscribe(this)}handleCurrencyChange=e=>{this.setState({showChart:!1,selectedCurrency:e},(()=>{this.checkChartBuildStatus()}))};handleOpenModal=()=>{this.setState({isModalOpen:!0})};handleCloseModal=()=>{this.setState({isModalOpen:!1})};handleAddPrice=(e,t)=>{const i=rn(e),n=this.state.selectedCurrency.id,r=(0,ui.lJ)(n),o=Number(t.highPriceInput),s=Number(t.lowPriceInput),a=Number(t.openPriceInput),l=Number(t.closePriceInput);if(o<s||o<a||o<l||s>a||s>l)return this.setState({notification:{message:"The high price value cannot be less than the low.",backgroundColor:Jm}}),void ol.notifySubscribers();r[i]={openPrice:t.openPriceInput,highPrice:t.highPriceInput,lowPrice:t.lowPriceInput,closePrice:t.closePriceInput},(0,ui.fv)(n,r),this.checkChartBuildStatus()};handleBuildChartButtonClick=()=>{this.setState({showChart:!0})};handleClearChartDataButtonClick=()=>{this.setState({showChart:!1}),(0,ui.TC)(this.state.selectedCurrency.id),this.checkChartBuildStatus()};checkChartBuildStatus(){const e=this.state.selectedCurrency.id,t=(0,ui.lJ)(e);Object.keys(t).length>=30?(this.handleCloseModal(),this.setState({notification:{message:"The chart can be successfully built!",backgroundColor:Qm},isChartCanBuild:!0},(()=>{ol.notifySubscribers()}))):this.setState({isChartCanBuild:!1})}render(){const{selectedCurrency:e,isChartCanBuild:t,isModalOpen:i,showNotification:n,notification:r,showChart:o}=this.state;return(0,Kt.jsxs)(ug,{children:[(0,Kt.jsxs)(hg,{children:[(0,Kt.jsx)(Ka,{selectedCurrency:e,onCurrencyChange:this.handleCurrencyChange}),(0,Kt.jsx)(rl,{isChartCanBuild:t,selectedCurrency:e,onClick:this.handleOpenModal}),t&&(0,Kt.jsxs)(dg,{children:[(0,Kt.jsx)(pg,{"data-cy":"build-chart-button",onClick:this.handleBuildChartButtonClick,children:"Build chart"}),(0,Kt.jsx)(pg,{"data-cy":"clear-chart-data-button",onClick:this.handleClearChartDataButtonClick,children:"Clear chart data"})]})]}),o&&(0,Kt.jsx)(hg,{children:(0,Kt.jsx)(Bm,{id:e.id})}),(0,Kt.jsx)(cg,{isModalOpen:i,selectedCurrency:e,handleAddPrice:this.handleAddPrice,handleCloseModal:this.handleCloseModal,showNotification:n,notification:r}),i&&(0,Kt.jsx)(or,{})]})}}const mg=fg;var gg=i(250);const _g=()=>(0,Kt.jsxs)(Kt.Fragment,{children:[(0,Kt.jsx)(rr,{}),(0,Kt.jsx)(Wi,{}),(0,Kt.jsx)(tn,{}),(0,Kt.jsx)(hn,{}),(0,Kt.jsx)(gg.j3,{}),(0,Kt.jsx)(Wn,{})]}),yg=()=>(0,Kt.jsx)(n.Suspense,{fallback:(0,Kt.jsx)(Hn,{}),children:(0,Kt.jsxs)(gg.Z5,{children:[(0,Kt.jsx)(gg.AW,{element:(0,Kt.jsx)(_g,{}),children:Object.keys(ci).map((e=>{const{path:t,element:i}=ci[e];return(0,Kt.jsx)(gg.AW,{element:i,path:t},t)}))}),(0,Kt.jsx)(gg.AW,{element:(0,Kt.jsx)(xr,{}),path:ri})]})})},545:(e,t,i)=>{"use strict";i.d(t,{T:()=>n});const n={mapboxAccessToken:"pk.eyJ1IjoibGt2YXNpa2wiLCJhIjoiY2xuMnpuajFhMGVyeDJxbXVvZ3p2bHVxcSJ9.ZIXSOffwNkeBV4FAtr8eXQ",cacheLifetime:Number("86400000"),cacheCurrencyRatesKey:"currencyRates",cacheLastUpdateKey:"lastUpdated",cacheThemeKey:"theme",currencyApiKey:"cur_live_dpsrCthUi3VEostV1BQj10XwbHELUgbaZqgwz9Xk",currencyApiUrl:"https://api.currencyapi.com/v3/latest",splitter:",",decimalPlaces:"5"}},200:(e,t,i)=>{"use strict";i.d(t,{N:()=>c,p:()=>u});var n=i(294),r=i(697),o=i.n(r),s=i(998),a=i(545),l=i(893);const c=(0,n.createContext)({theme:"dark"}),u=({children:e})=>{const[t,i]=(0,n.useState)("dark");return(0,n.useEffect)((()=>{const e=(0,s.lJ)(a.T.cacheThemeKey);0!==Object.entries(e).length?i(e):(0,s.fv)(a.T.cacheThemeKey,"dark")}),[]),(0,l.jsx)(c.Provider,{value:{theme:t,setTheme:i},children:e})};u.propTypes={children:o().node.isRequired}},998:(e,t,i)=>{"use strict";function n(e){return JSON.parse(localStorage.getItem(e))||{}}function r(e,t){localStorage.setItem(e,JSON.stringify(t))}function o(e){localStorage.removeItem(e)}function s(e){return e.expirationDate>(new Date).getTime()}i.d(t,{TC:()=>o,fv:()=>r,kI:()=>s,lJ:()=>n})},158:function(e){e.exports=function(){"use strict";var e,t,i;function n(n,r){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),i=r(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=r;else e=r}return n(["exports"],(function(e){var t="undefined"!=typeof self?self:{},i="2.15.0";let n;const r={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==n){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{n=null!="MISSING_ENV_VAR".API_URL_REGEX?new RegExp("MISSING_ENV_VAR".API_URL_REGEX):e}catch(t){n=e}}return n},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!r.API_URL)return null;try{const e=new URL(r.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},o={supported:!1,testSupport:function(e){!l&&a&&(c?u(e):s=e)}};let s,a,l=!1,c=!1;function u(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.isContextLost())return;o.supported=!0}catch(e){}e.deleteTexture(t),l=!0}t.document&&(a=t.document.createElement("img"),a.onload=function(){s&&u(s),s=null,c=!0},a.onerror=function(){l=!0,s=null},a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const h="01";function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=f;function f(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=n}f.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,n=0;n<8;n++){var r=this.sampleCurveX(i)-e;if(Math.abs(r)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=r/o}var s=0,a=1;for(i=e,n=0;n<20&&(r=this.sampleCurveX(i),!(Math.abs(r-e)<t));n++)e>r?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var m=d(p),g=_;function _(e,t){this.x=e,this.y=t}_.prototype={clone:function(){return new _(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),n=Math.sin(e),r=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-n*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_.convert=function(e){return e instanceof _?e:Array.isArray(e)?new _(e[0],e[1]):e};var y=d(g);const x=Math.PI/180,v=180/Math.PI;function b(e){return e*x}function w(e){return e*v}const S=[[0,0],[1,0],[1,1],[0,1]];function T(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function E(e,t,i,n){const r=new m(e,t,i,n);return function(e){return r.solve(e)}}const C=E(.25,.1,.25,1);function k(e,t,i){return Math.min(i,Math.max(t,e))}function M(e,t,i){return(i=k((i-e)/(t-e),0,1))*i*(3-2*i)}function A(e,t,i){const n=i-t,r=((e-t)%n+n)%n+t;return r===t?i:r}function P(e,t,i){if(!e.length)return i(null,[]);let n=e.length;const r=new Array(e.length);let o=null;e.forEach(((e,s)=>{t(e,((e,t)=>{e&&(o=e),r[s]=t,0==--n&&i(o,r)}))}))}function I(e){const t=[];for(const i in e)t.push(e[i]);return t}function z(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let D=1;function L(){return D++}function R(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function O(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function B(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function F(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function N(e,t){return-1!==e.indexOf(t,e.length-t.length)}function j(e,t,i){const n={};for(const r in e)n[r]=t.call(i||this,e[r],r,e);return n}function U(e,t,i){const n={};for(const r in e)t.call(i||this,e[r],r,e)&&(n[r]=e[r]);return n}function $(e){return Array.isArray(e)?e.map($):"object"==typeof e&&e?j(e,$):e}const V={};function G(e){V[e]||("undefined"!=typeof console&&console.warn(e),V[e]=!0)}function W(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function q(e){let t=0;for(let i,n,r=0,o=e.length,s=o-1;r<o;s=r++)i=e[r],n=e[s],t+=(n.x-i.x)*(i.y+n.y);return t}function X(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Z(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,n,r)=>{const o=n||r;return t[i]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let H=null;function Y(e){if(null==H){const t=e.navigator?e.navigator.userAgent:null;H=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return H}function K(e){try{const i=t[e];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function J(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const Q="mapbox-tiles";let ee,te,ie=500,ne=50;function re(){try{return t.caches}catch(e){}}function oe(){re()&&!ee&&(ee=t.caches.open(Q))}function se(e){const t=e.indexOf("?");if(t<0)return e;const i=function(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}(e),n=i.filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return n.length?`${e.slice(0,t)}?${n.join("&")}`:e.slice(0,t)}let ae=1/0;const le={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(le);class ce extends Error{constructor(e,t,i){401===t&&ve(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ue=X()?()=>self.worker&&self.worker.referrer:()=>("blob:"===t.location.protocol?t.parent:t).location.href,he=function(e,i){if(!(/^file:/.test(n=e.url)||/^file:/.test(ue())&&!/^\w+:/.test(n))){if(t.fetch&&t.Request&&t.AbortController&&t.Request.prototype.hasOwnProperty("signal"))return function(e,i){const n=new t.AbortController,r=new t.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:ue(),referrerPolicy:e.referrerPolicy,signal:n.signal});let o=!1,s=!1;const a=(l=r.url).indexOf("sku=")>0&&ve(l);var l;"json"===e.type&&r.headers.set("Accept","application/json");const c=(n,o,l)=>{if(s)return;if(n&&"SecurityError"!==n.message&&G(n.toString()),o&&l)return u(o);const c=Date.now();t.fetch(r).then((t=>{if(t.ok){const e=a?t.clone():null;return u(t,e,c)}return i(new ce(t.statusText,t.status,e.url))})).catch((t=>{"AbortError"!==t.name&&i(new Error(`${t.message} ${e.url}`))}))},u=(n,a,l)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((e=>{s||(a&&l&&function(e,i,n){if(oe(),!ee)return;const r={status:i.status,statusText:i.statusText,headers:new t.Headers};i.headers.forEach(((e,t)=>r.headers.set(t,e)));const o=Z(i.headers.get("Cache-Control")||"");if(o["no-store"])return;o["max-age"]&&r.headers.set("Expires",new Date(n+1e3*o["max-age"]).toUTCString());const s=r.headers.get("Expires");s&&(new Date(s).getTime()-n<42e4||function(e,t){if(void 0===te)try{new Response(new ReadableStream),te=!0}catch(e){te=!1}te?t(e.body):e.blob().then(t)}(i,(i=>{const n=new t.Response(i,r);oe(),ee&&ee.then((t=>t.put(se(e.url),n))).catch((e=>G(e.message)))})))}(r,a,l),o=!0,i(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((e=>{s||i(new Error(e.message))}))};return a?function(e,t){if(oe(),!ee)return t(null);const i=se(e.url);ee.then((e=>{e.match(i).then((n=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),i=Z(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(n);e.delete(i),r&&e.put(i,n.clone()),t(null,n,r)})).catch(t)})).catch(t)}(r,c):c(null,null),{cancel:()=>{s=!0,o||n.abort()}}}(e,i);if(X()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,i,void 0,!0)}var n;return function(e,i){const n=new t.XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const t in e.headers)n.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{i(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let t=n.response;if("json"===e.type)try{t=JSON.parse(n.response)}catch(e){return i(e)}i(null,t,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else i(new ce(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,i)},de=function(e,t){return he(z(e,{type:"arrayBuffer"}),t)};function pe(e){const i=t.document.createElement("a");return i.href=e,i.protocol===t.document.location.protocol&&i.host===t.document.location.host}const fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let me,ge;me=[],ge=0;const _e=function(e,i){if(o.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),ge>=r.MAX_PARALLEL_IMAGE_REQUESTS){const t={requestParameters:e,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return me.push(t),t}ge++;let n=!1;const s=()=>{if(!n)for(n=!0,ge--;me.length&&ge<r.MAX_PARALLEL_IMAGE_REQUESTS;){const e=me.shift(),{requestParameters:t,callback:i,cancelled:n}=e;n||(e.cancel=_e(t,i).cancel)}},a=de(e,((e,n,r,o)=>{s(),e?i(e):n&&(t.createImageBitmap?function(e,i){const n=new t.Blob([new Uint8Array(e)],{type:"image/png"});t.createImageBitmap(n).then((e=>{i(null,e)})).catch((e=>{i(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(n,((e,t)=>i(e,t,r,o))):function(e,i){const n=new t.Image,r=t.URL;n.onload=()=>{i(null,n),r.revokeObjectURL(n.src),n.onload=null,t.requestAnimationFrame((()=>{n.src=fe}))},n.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new t.Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(o):fe}(n,((e,t)=>i(e,t,r,o))))}));return{cancel:()=>{a.cancel(),s()}}},ye="NO_ACCESS_TOKEN";function xe(e){return 0===e.indexOf("mapbox:")}function ve(e){return r.API_URL_REGEX.test(e)}function be(e){return r.API_CDN_URL_REGEX.test(e)}function we(e){return r.API_STYLE_REGEX.test(e)&&!Se(e)}function Se(e){return r.API_SPRITE_REGEX.test(e)}const Te=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ee(e){const t=e.match(Te);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ce(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const ke="mapbox.eventData";function Me(e){if(!e)return null;const i=e.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(t.atob(i[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class Ae{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Me(r.ACCESS_TOKEN);let n="";return n=i&&i.u?t.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):r.ACCESS_TOKEN||"",e?`${ke}.${e}:${n}`:`${ke}:${n}`}fetchEventData(){const e=K("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const e=t.localStorage.getItem(i);e&&(this.eventData=JSON.parse(e));const r=t.localStorage.getItem(n);r&&(this.anonId=r)}catch(e){G("Unable to read from LocalStorage")}}saveEventData(){const e=K("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{t.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&t.localStorage.setItem(i,JSON.stringify(this.eventData))}catch(e){G("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,i,n){if(!r.EVENTS_URL)return;const o=Ee(r.EVENTS_URL);o.params.push(`access_token=${n||r.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(e).toISOString()},a=t?z(s,t):s,l={url:Ce(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(e,t){return he(z(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Pe=new class extends Ae{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){r.EVENTS_URL&&r.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>xe(e)||ve(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Me(r.ACCESS_TOKEN),n=t?t.u:r.ACCESS_TOKEN;let o=n!==this.eventData.tokenU;B(this.anonId)||(this.anonId=R(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(s),i=(s-this.eventData.lastSuccess)/864e5;o=o||i>=1||i<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:i,skuId:h,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)}),e):this.processRequests()}},Ie=Pe.postTurnstileEvent.bind(Pe),ze=new class extends Ae{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,n){this.skuToken=t,this.errorCb=n,r.EVENTS_URL&&(i||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(ye)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),B(this.anonId)||(this.anonId=R()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:i,skuId:h,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},De=ze.postMapLoadEvent.bind(ze),Le=new class extends Ae{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){r.EVENTS_URL&&(e||r.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:n,performanceData:r}=this.queue.shift(),o=function(e){const n=t.performance.getEntriesByType("resource"),r=t.performance.getEntriesByType("mark"),o=function(e){const t={};if(e)for(const i in e)if("other"!==i)for(const n of e[i]){const e=`${i}ResolveRangeMin`,r=`${i}ResolveRangeMax`,o=`${i}RequestCount`,s=`${i}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,n.startTime),t[r]=Math.max(t[r]||-1/0,n.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==n.transferSize&&0===n.transferSize&&a(s),a(o)}return t}(function(e,t){const i={};if(e)for(const n of e){const e=t(n);void 0===i[e]&&(i[e]=[]),i[e].push(n)}return i}(n,Ue)),s=t.devicePixelRatio,a=t.navigator.connection||t.navigator.mozConnection||t.navigator.webkitConnection,l={counters:[],metadata:[],attributes:[]},c=(e,t,i)=>{null!=i&&e.push({name:t,value:i.toString()})};for(const e in o)c(l.counters,e,o[e]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(c(l.counters,"interactionRangeMin",e.interactionRange[0]),c(l.counters,"interactionRangeMax",e.interactionRange[1])),r)for(const e of Object.keys(Ne)){const t=Ne[e],i=r.find((e=>e.name===t));i&&c(l.counters,t,i.startTime)}return c(l.counters,"visibilityHidden",e.visibilityHidden),c(l.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(we(e)){const t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/${t[1]}`}}}(n)),c(l.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),c(l.attributes,"fogEnabled",e.fogEnabled?"true":"false"),c(l.attributes,"projection",e.projection),c(l.attributes,"zoom",e.zoom),c(l.metadata,"devicePixelRatio",s),c(l.metadata,"connectionEffectiveType",a?a.effectiveType:void 0),c(l.metadata,"navigatorUserAgent",t.navigator.userAgent),c(l.metadata,"screenWidth",t.screen.width),c(l.metadata,"screenHeight",t.screen.height),c(l.metadata,"windowWidth",t.innerWidth),c(l.metadata,"windowHeight",t.innerHeight),c(l.metadata,"mapWidth",e.width/s),c(l.metadata,"mapHeight",e.height/s),c(l.metadata,"webglRenderer",e.renderer),c(l.metadata,"webglVendor",e.vendor),c(l.metadata,"sdkVersion",i),c(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(r);for(const e of o.metadata);for(const e of o.counters);for(const e of o.attributes);this.postEvent(n,o,(()=>{}),e)}},Re=Le.postPerformanceEvent.bind(Le),Oe=new class extends Ae{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,n){if(!r.API_URL||!r.SESSION_PATH)return;const o=Ee(r.API_URL+r.SESSION_PATH);o.params.push(`sku=${t||""}`),o.params.push(`access_token=${n||r.ACCESS_TOKEN||""}`);const s={url:Ce(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return he(z(e,{method:"GET"}),t)}(s,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,i,n){this.skuToken=t,this.errorCb=n,r.SESSION_PATH&&r.API_URL&&(i||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(ye)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},Be=Oe.getSessionAPI.bind(Oe),Fe=new Set,Ne={create:"create",load:"load",fullLoad:"fullLoad"},je={mark(e){t.performance.mark(e)},measure(e,i,n){t.performance.measure(e,i,n)}};function Ue(e){const t=e.name.split("?")[0];return be(t)&&t.includes("mapbox-gl.js")?"javascript":be(t)&&t.includes("mapbox-gl.css")?"css":function(e){return r.API_FONTS_REGEX.test(e)}(t)?"fontRange":Se(t)?"sprite":we(t)?"style":function(e){return r.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}const $e=t.performance;function Ve(e){const t=e?e.url.toString():void 0;return $e.getEntriesByName(t)}let Ge,We,qe,Xe;const Ze={now:()=>void 0!==qe?qe:t.performance.now(),setNow(e){qe=e},restoreNow(){qe=void 0},frame(e){const i=t.requestAnimationFrame(e);return{cancel:()=>t.cancelAnimationFrame(i)}},getImageData(e,i=0){const{width:n,height:r}=e;Xe||(Xe=t.document.createElement("canvas"));const o=Xe.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(n>Xe.width||r>Xe.height)&&(Xe.width=n,Xe.height=r),o.clearRect(-i,-i,n+2*i,r+2*i),o.drawImage(e,0,0,n,r),o.getImageData(-i,-i,n+2*i,r+2*i)},resolveURL:e=>(Ge||(Ge=t.document.createElement("a")),Ge.href=e,Ge.href),get devicePixelRatio(){return t.devicePixelRatio},get prefersReducedMotion(){return!!t.matchMedia&&(null==We&&(We=t.matchMedia("(prefers-reduced-motion: reduce)")),We.matches)}};function He(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function Ye(e,t,i){if(i&&i[e]){const n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1)}}class Ke{constructor(e,t={}){z(this,t),this.type=e}}class Je extends Ke{constructor(e,t={}){super("error",z({error:e},t))}}class Qe{on(e,t){return this._listeners=this._listeners||{},He(e,t,this._listeners),this}off(e,t){return Ye(e,t,this._listeners),Ye(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},He(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Ke(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of n)Ye(i,t,this._oneTimeListeners),t.call(this,e);const r=this._eventedParent;r&&(z(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof Je&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var et=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function tt(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}function it(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function nt(e){if(Array.isArray(e))return e.map(nt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=nt(e[i]);return t}return it(e)}class rt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var ot=rt;class st{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new st(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var at=st;const lt={kind:"null"},ct={kind:"number"},ut={kind:"string"},ht={kind:"boolean"},dt={kind:"color"},pt={kind:"object"},ft={kind:"value"},mt={kind:"collator"},gt={kind:"formatted"},_t={kind:"resolvedImage"};function yt(e,t){return{kind:"array",itemType:e,N:t}}function xt(e){if("array"===e.kind){const t=xt(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const vt=[lt,ct,ut,ht,dt,gt,pt,yt(ft),_t];function bt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!bt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of vt)if(!bt(e,t))return null}return`Expected ${xt(e)} but found ${xt(t)} instead.`}function wt(e,t){return t.some((t=>t.kind===e.kind))}function St(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var Tt,Et={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ct(e){return(e=Math.round(e))<0?0:e>255?255:e}function kt(e){return Ct("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function Mt(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function At(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{Tt={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in Et)return Et[i].slice();if("#"===i[0])return 4===i.length?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===i.length&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var n=i.indexOf("("),r=i.indexOf(")");if(-1!==n&&r+1===i.length){var o=i.substr(0,n),s=i.substr(n+1,r-(n+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=Mt(s.pop());case"rgb":return 3!==s.length?null:[kt(s[0]),kt(s[1]),kt(s[2]),a];case"hsla":if(4!==s.length)return null;a=Mt(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=Mt(s[1]),u=Mt(s[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[Ct(255*At(d,h,l+1/3)),Ct(255*At(d,h,l)),Ct(255*At(d,h,l-1/3)),a];default:return null}}return null}}catch(e){}class Pt{constructor(e,t,i,n=1){this.r=e,this.g=t,this.b=i,this.a=n}static parse(e){if(!e)return;if(e instanceof Pt)return e;if("string"!=typeof e)return;const t=Tt(e);return t?new Pt(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,i,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${n})`}toArray(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*i/n,n]}toArray01(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,i/n,n]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:n}=this;return[e,t,i,n]}}Pt.black=new Pt(0,0,0,1),Pt.white=new Pt(1,1,1,1),Pt.transparent=new Pt(0,0,0,0),Pt.red=new Pt(1,0,0,1),Pt.blue=new Pt(0,0,1,1);var It=Pt;class zt{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Dt{constructor(e,t,i,n,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=n,this.textColor=r}}class Lt{constructor(e){this.sections=e}static fromString(e){return new Lt([new Dt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Lt?e:Lt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class Rt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Rt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ot(e,t,i,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,i,n]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof It)return!0;if(e instanceof zt)return!0;if(e instanceof Lt)return!0;if(e instanceof Rt)return!0;if(Array.isArray(e)){for(const t of e)if(!Bt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Bt(e[t]))return!1;return!0}return!1}function Ft(e){if(null===e)return lt;if("string"==typeof e)return ut;if("boolean"==typeof e)return ht;if("number"==typeof e)return ct;if(e instanceof It)return dt;if(e instanceof zt)return mt;if(e instanceof Lt)return gt;if(e instanceof Rt)return _t;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=Ft(t);if(i){if(i===e)continue;i=ft;break}i=e}return yt(i||ft,t)}return pt}function Nt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof It||e instanceof Lt||e instanceof Rt?e.toString():JSON.stringify(e)}class jt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Bt(e[1]))return t.error("invalid value");const i=e[1];let n=Ft(i);const r=t.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new jt(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof It?["rgba"].concat(this.value.toArray()):this.value instanceof Lt?this.value.serialize():this.value}}var Ut=jt,$t=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Vt={string:ut,number:ct,boolean:ht,object:pt};class Gt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,n=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in Vt)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=Vt[i],n++}else r=ft;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],n++}i=yt(r,o)}else i=Vt[r];const o=[];for(;n<e.length;n++){const i=t.parse(e[n],n,ft);if(!i)return null;o.push(i)}return new Gt(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!bt(this.type,Ft(i)))return i;if(t===this.args.length-1)throw new $t(`Expected value to be of type ${xt(this.type)}, but found ${xt(Ft(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}var Wt=Gt;class qt{constructor(e){this.type=gt,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,ct),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,yt(ut)),!i))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,dt),!s))return null;const a=n[n.length-1];a.scale=e,a.font=i,a.textColor=s}else{const o=t.parse(e[i],1,ft);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new qt(n)}evaluate(e){return new Lt(this.sections.map((t=>{const i=t.content.evaluate(e);return Ft(i)===_t?new Dt("",i,null,null,null):new Dt(Nt(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class Xt{constructor(e){this.type=_t,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,ut);return i?new Xt(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=Rt.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Zt={"to-boolean":ht,"to-color":dt,"to-number":ct,"to-string":ut};class Ht{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const n=Zt[i],r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],i,ft);if(!n)return null;r.push(n)}return new Ht(n,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const n of this.args){if(t=n.evaluate(e),i=null,t instanceof It)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Ot(t[0],t[1],t[2],t[3]),!i))return new It(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new $t(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new $t(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Lt.fromString(Nt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Rt.fromString(Nt(this.args[0].evaluate(e))):Nt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new qt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Xt(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Yt=Ht;const Kt=["Unknown","Point","LineString","Polygon"];var Jt=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Kt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=It.parse(e)),t}};class Qt{constructor(e,t,i,n){this.name=e,this.type=t,this._evaluate=i,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],n=Qt.definitions[i];if(!n)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[n,o]of s){a=new Ci(t.registry,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],r=Array.isArray(n)?n[t-1]:n.type,o=a.parse(i,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(n)?n[e]:n.type,i=s[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new Qt(i,r,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const i=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(xt).join(", ")})`:`(${xt(t.type)}...)`;var t})).join(" | "),n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],1+n.length);if(!r)return null;n.push(xt(r.type))}t.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){Qt.definitions=t;for(const i in t)e[i]=Qt}}var ei=Qt;class ti{constructor(e,t,i){this.type=mt,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ht);if(!n)return null;const r=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ht);if(!r)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,ut),!o)?null:new ti(n,r,o)}evaluate(e){return new zt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ii=8192;function ni(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ri(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function oi(e,t){const i=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(i*r*ii),Math.round(n*r*ii)]}function si(e,t,i){const n=e[0]-t[0],r=e[1]-t[1],o=e[0]-i[0],s=e[1]-i[1];return n*s-o*r==0&&n*o<=0&&r*s<=0}function ai(e,t){let i=!1;for(let s=0,a=t.length;s<a;s++){const a=t[s];for(let t=0,s=a.length;t<s-1;t++){if(si(e,a[t],a[t+1]))return!1;(r=a[t])[1]>(n=e)[1]!=(o=a[t+1])[1]>n[1]&&n[0]<(o[0]-r[0])*(n[1]-r[1])/(o[1]-r[1])+r[0]&&(i=!i)}}var n,r,o;return i}function li(e,t){for(let i=0;i<t.length;i++)if(ai(e,t[i]))return!0;return!1}function ci(e,t,i,n){const r=n[0]-i[0],o=n[1]-i[1],s=(e[0]-i[0])*o-r*(e[1]-i[1]),a=(t[0]-i[0])*o-r*(t[1]-i[1]);return s>0&&a<0||s<0&&a>0}function ui(e,t,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(a=[(s=c[i+1])[0]-(o=c[i])[0],s[1]-o[1]])[0]*(l=[(r=t)[0]-(n=e)[0],r[1]-n[1]])[1]-a[1]*l[0]&&ci(n,r,o,s)&&ci(o,s,n,r))return!0;var n,r,o,s,a,l;return!1}function hi(e,t){for(let i=0;i<e.length;++i)if(!ai(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(ui(e[i],e[i+1],t))return!1;return!0}function di(e,t){for(let i=0;i<t.length;i++)if(hi(e,t[i]))return!0;return!1}function pi(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=[];for(let n=0;n<e[r].length;n++){const s=oi(e[r][n],i);ni(t,s),o.push(s)}n.push(o)}return n}function fi(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=pi(e[r],t,i);n.push(o)}return n}function mi(e,t,i,n){if(e[0]<i[0]||e[0]>i[2]){const t=.5*n;let r=e[0]-i[0]>t?-n:i[0]-e[0]>t?n:0;0===r&&(r=e[0]-i[2]>t?-n:i[2]-e[0]>t?n:0),e[0]+=r}ni(t,e)}function gi(e,t,i,n){const r=Math.pow(2,n.z)*ii,o=[n.x*ii,n.y*ii],s=[];if(!e)return s;for(const n of e)for(const e of n){const n=[e.x+o[0],e.y+o[1]];mi(n,t,i,r),s.push(n)}return s}function _i(e,t,i,n){const r=Math.pow(2,n.z)*ii,o=[n.x*ii,n.y*ii],s=[];if(!e)return s;for(const i of e){const e=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];ni(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const n of e)mi(n,t,i,r)}var a;return s}class yi{constructor(e,t){this.type=ht,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Bt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new yi(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new yi(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new yi(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=pi(t.coordinates,n,r),s=gi(e.geometry(),i,n,r);if(!ri(i,n))return!1;for(const e of s)if(!ai(e,o))return!1}if("MultiPolygon"===t.type){const o=fi(t.coordinates,n,r),s=gi(e.geometry(),i,n,r);if(!ri(i,n))return!1;for(const e of s)if(!li(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=pi(t.coordinates,n,r),s=_i(e.geometry(),i,n,r);if(!ri(i,n))return!1;for(const e of s)if(!hi(e,o))return!1}if("MultiPolygon"===t.type){const o=fi(t.coordinates,n,r),s=_i(e.geometry(),i,n,r);if(!ri(i,n))return!1;for(const e of s)if(!di(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var xi=yi;function vi(e){if(e instanceof ei){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof xi)return!1;let t=!0;return e.eachChild((e=>{t&&!vi(e)&&(t=!1)})),t}function bi(e){if(e instanceof ei&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!bi(e)&&(t=!1)})),t}function wi(e,t){if(e instanceof ei&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!wi(e,t)&&(i=!1)})),i}class Si{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new Si(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ti=Si;class Ei{constructor(e,t=[],i,n=new at,r=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i}parse(e,t,i,n,r={}){return t?this.concat(t,i,n)._parse(e,r):this._parse(e,r)}_parse(e,t){function i(e,t,i){return"assert"===i?new Wt(t,[e]):"coerce"===i?new Yt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,r=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else n=i(n,e,t.typeAnnotation||"coerce");else n=i(n,e,t.typeAnnotation||"assert")}if(!(n instanceof Ut)&&"resolvedImage"!==n.type.kind&&ki(n)){const t=new Jt;try{n=new Ut(n.type,n.evaluate(t))}catch(e){return this.error(e.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const n="number"==typeof e?this.path.concat(e):this.path,r=i?this.scope.concat(i):this.scope;return new Ei(this.registry,n,t||null,r,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new ot(i,e))}checkSubtype(e,t){const i=bt(e,t);return i&&this.error(i),i}}var Ci=Ei;function ki(e){if(e instanceof Ti)return ki(e.boundExpression);if(e instanceof ei&&"error"===e.name)return!1;if(e instanceof ti)return!1;if(e instanceof xi)return!1;const t=e instanceof Yt||e instanceof Wt;let i=!0;return e.eachChild((e=>{i=t?i&&ki(e):i&&e instanceof Ut})),!!i&&vi(e)&&wi(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Mi(e,t){const i=e.length-1;let n,r,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=e[a],r=e[a+1],n<=t){if(a===i||t<r)return a;o=a+1}else{if(!(n>t))throw new $t("Input is not a number.");s=a-1}return 0}class Ai{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,ct);if(!i)return null;const n=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],s=e[i+1],a=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,r);if(!c)return null;r=r||c.type,n.push([o,c])}return new Ai(r,i,n)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;return n>=t[r-1]?i[r-1].evaluate(e):i[Mi(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Pi=Ai;function Ii(e,t,i){return e*(1-i)+t*i}var zi=Object.freeze({__proto__:null,array:function(e,t,i){return e.map(((e,n)=>Ii(e,t[n],i)))},color:function(e,t,i){return new It(Ii(e.r,t.r,i),Ii(e.g,t.g,i),Ii(e.b,t.b,i),Ii(e.a,t.a,i))},number:Ii});const Di=.95047,Li=1.08883,Ri=4/29,Oi=6/29,Bi=3*Oi*Oi,Fi=Oi*Oi*Oi,Ni=Math.PI/180,ji=180/Math.PI;function Ui(e){return e>Fi?Math.pow(e,1/3):e/Bi+Ri}function $i(e){return e>Oi?e*e*e:Bi*(e-Ri)}function Vi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Gi(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Wi(e){const t=Gi(e.r),i=Gi(e.g),n=Gi(e.b),r=Ui((.4124564*t+.3575761*i+.1804375*n)/Di),o=Ui((.2126729*t+.7151522*i+.072175*n)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Ui((.0193339*t+.119192*i+.9503041*n)/Li)),alpha:e.a}}function qi(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*$i(t),i=Di*$i(i),n=Li*$i(n),new It(Vi(3.2404542*i-1.5371385*t-.4985314*n),Vi(-.969266*i+1.8760108*t+.041556*n),Vi(.0556434*i-.2040259*t+1.0572252*n),e.alpha)}function Xi(e,t,i){const n=t-e;return e+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const Zi={forward:Wi,reverse:qi,interpolate:function(e,t,i){return{l:Ii(e.l,t.l,i),a:Ii(e.a,t.a,i),b:Ii(e.b,t.b,i),alpha:Ii(e.alpha,t.alpha,i)}}},Hi={forward:function(e){const{l:t,a:i,b:n}=Wi(e),r=Math.atan2(n,i)*ji;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Ni,i=e.c;return qi({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Xi(e.h,t.h,i),c:Ii(e.c,t.c,i),l:Ii(e.l,t.l,i),alpha:Ii(e.alpha,t.alpha,i)}}};var Yi=Object.freeze({__proto__:null,hcl:Hi,lab:Zi});class Ki{constructor(e,t,i,n,r){this.type=e,this.operator=t,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,n){let r=0;if("exponential"===e.name)r=Ji(t,e.base,i,n);else if("linear"===e.name)r=Ji(t,1,i,n);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new m(o[0],o[1],o[2],o[3]).solve(Ji(t,1,i,n))}return r}static parse(e,t){let[i,n,r,...o]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,ct),!r)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=dt:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],n=o[e+1],r=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(n,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Ki(a,i,n,r,s):t.error(`Type ${xt(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;if(n>=t[r-1])return i[r-1].evaluate(e);const o=Mi(t,n),s=Ki.interpolationFactor(this.interpolation,n,t[o],t[o+1]),a=i[o].evaluate(e),l=i[o+1].evaluate(e);return"interpolate"===this.operator?zi[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?Hi.reverse(Hi.interpolate(Hi.forward(a),Hi.forward(l),s)):Zi.reverse(Zi.interpolate(Zi.forward(a),Zi.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Ji(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}var Qi=Ki;class en{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const n=t.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of e.slice(1)){const e=t.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,r.push(e)}const o=n&&r.some((e=>bt(n,e.type)));return new en(o?ft:i,r)}evaluate(e){let t,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(e),i&&i instanceof Rt&&!i.available&&(t||(t=i),i=null,n===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var tn=en;class nn{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let n=1;n<e.length-1;n+=2){const r=e[n];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=t.parse(e[n+1],n+1);if(!o)return null;i.push([r,o])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return n?new nn(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}var rn=nn;class on{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ct),n=t.parse(e[2],2,yt(t.expectedType||ft));return i&&n?new on(n.type.itemType,i,n):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new $t(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new $t(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new $t(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var sn=on;class an{constructor(e,t){this.type=ht,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ft),n=t.parse(e[2],2,ft);return i&&n?wt(i.type,[ht,ut,ct,lt,ft])?new an(i,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${xt(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!St(t,["boolean","string","number","null"]))throw new $t(`Expected first argument to be of type boolean, string, number or null, but found ${xt(Ft(t))} instead.`);if(!St(i,["string","array"]))throw new $t(`Expected second argument to be of type array or string, but found ${xt(Ft(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ln=an;class cn{constructor(e,t,i){this.type=ct,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ft),n=t.parse(e[2],2,ft);if(!i||!n)return null;if(!wt(i.type,[ht,ut,ct,lt,ft]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${xt(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,ct);return r?new cn(i,n,r):null}return new cn(i,n)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!St(t,["boolean","string","number","null"]))throw new $t(`Expected first argument to be of type boolean, string, number or null, but found ${xt(Ft(t))} instead.`);if(!St(i,["string","array"]))throw new $t(`Expected second argument to be of type array or string, but found ${xt(Ft(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return i.indexOf(t,n)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var un=cn;class hn{constructor(e,t,i,n,r,o){this.inputType=e,this.type=t,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,Ft(e)))return null}else i=Ft(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(l,s,n);if(!u)return null;n=n||u.type,o.push(u)}const s=t.parse(e[1],1,ft);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,n);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(i,s.type)?null:new hn(i,n,s,r,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(Ft(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of i)e.push(1===n.length?r(n[0]):n.map(r)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}var dn=hn;class pn{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const n=[];for(let r=1;r<e.length-1;r+=2){const o=t.parse(e[r],r,ht);if(!o)return null;const s=t.parse(e[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const r=t.parse(e[e.length-1],e.length-1,i);return r?new pn(i,n,r):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var fn=pn;class mn{constructor(e,t,i,n){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ft),n=t.parse(e[2],2,ct);if(!i||!n)return null;if(!wt(i.type,[yt(ft),ut,ft]))return t.error(`Expected first argument to be of type array or string, but found ${xt(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,ct);return r?new mn(i.type,i,n,r):null}return new mn(i.type,i,n)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!St(t,["string","array"]))throw new $t(`Expected first argument to be of type array or string, but found ${xt(Ft(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(i,n)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var gn=mn;function _n(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function yn(e,t,i,n){return 0===n.compare(t,i)}function xn(e,t,i){const n="=="!==e&&"!="!==e;return class r{constructor(e,t,i){this.type=ht,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,ft);if(!o)return null;if(!_n(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${xt(o.type)}'.`);let s=t.parse(e[2],2,ft);if(!s)return null;if(!_n(i,s.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${xt(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${xt(o.type)}' and '${xt(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Wt(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Wt(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,mt),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const t=Ft(o),i=Ft(s);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new $t(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=Ft(o),i=Ft(s);if("string"!==e.kind||"string"!==i.kind)return t(r,o,s)}return this.collator?i(r,o,s,this.collator.evaluate(r)):t(r,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const vn=xn("==",(function(e,t,i){return t===i}),yn),bn=xn("!=",(function(e,t,i){return t!==i}),(function(e,t,i,n){return!yn(0,t,i,n)})),wn=xn("<",(function(e,t,i){return t<i}),(function(e,t,i,n){return n.compare(t,i)<0})),Sn=xn(">",(function(e,t,i){return t>i}),(function(e,t,i,n){return n.compare(t,i)>0})),Tn=xn("<=",(function(e,t,i){return t<=i}),(function(e,t,i,n){return n.compare(t,i)<=0})),En=xn(">=",(function(e,t,i){return t>=i}),(function(e,t,i,n){return n.compare(t,i)>=0}));class Cn{constructor(e,t,i,n,r,o){this.type=ut,this.number=e,this.locale=t,this.currency=i,this.unit=n,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,ct);if(!i)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=t.parse(n.locale,1,ut),!r))return null;let o=null;if(n.currency&&(o=t.parse(n.currency,1,ut),!o))return null;let s=null;if(n.unit&&(s=t.parse(n.unit,1,ut),!s))return null;let a=null;if(n["min-fraction-digits"]&&(a=t.parse(n["min-fraction-digits"],1,ct),!a))return null;let l=null;return n["max-fraction-digits"]&&(l=t.parse(n["max-fraction-digits"],1,ct),!l)?null:new Cn(i,r,o,s,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class kn{constructor(e){this.type=ct,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${xt(i.type)} instead.`):new kn(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new $t(`Expected value to be of type string or array, but found ${xt(Ft(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Mn={"==":vn,"!=":bn,">":Sn,"<":wn,">=":En,"<=":Tn,array:Wt,at:sn,boolean:Wt,case:fn,coalesce:tn,collator:ti,format:qt,image:Xt,in:ln,"index-of":un,interpolate:Qi,"interpolate-hcl":Qi,"interpolate-lab":Qi,length:kn,let:rn,literal:Ut,match:dn,number:Wt,"number-format":Cn,object:Wt,slice:gn,step:Pi,string:Wt,"to-boolean":Yt,"to-color":Yt,"to-number":Yt,"to-string":Yt,var:Ti,within:xi};function An(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);const o=r?r.evaluate(e):1,s=Ot(t,i,n,o);if(s)throw new $t(s);return new It(t/255*o,i/255*o,n/255*o,o)}function Pn(e,t){return e in t}function In(e,t){const i=t[e];return void 0===i?null:i}function zn(e){return{type:e}}ei.register(Mn,{error:[{kind:"error"},[ut],(e,[t])=>{throw new $t(t.evaluate(e))}],typeof:[ut,[ft],(e,[t])=>xt(Ft(t.evaluate(e)))],"to-rgba":[yt(ct,4),[dt],(e,[t])=>t.evaluate(e).toArray()],rgb:[dt,[ct,ct,ct],An],rgba:[dt,[ct,ct,ct,ct],An],has:{type:ht,overloads:[[[ut],(e,[t])=>Pn(t.evaluate(e),e.properties())],[[ut,pt],(e,[t,i])=>Pn(t.evaluate(e),i.evaluate(e))]]},get:{type:ft,overloads:[[[ut],(e,[t])=>In(t.evaluate(e),e.properties())],[[ut,pt],(e,[t,i])=>In(t.evaluate(e),i.evaluate(e))]]},"feature-state":[ft,[ut],(e,[t])=>In(t.evaluate(e),e.featureState||{})],properties:[pt,[],e=>e.properties()],"geometry-type":[ut,[],e=>e.geometryType()],id:[ft,[],e=>e.id()],zoom:[ct,[],e=>e.globals.zoom],pitch:[ct,[],e=>e.globals.pitch||0],"distance-from-center":[ct,[],e=>e.distanceFromCenter()],"heatmap-density":[ct,[],e=>e.globals.heatmapDensity||0],"line-progress":[ct,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[ct,[],e=>e.globals.skyRadialProgress||0],accumulated:[ft,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[ct,zn(ct),(e,t)=>{let i=0;for(const n of t)i+=n.evaluate(e);return i}],"*":[ct,zn(ct),(e,t)=>{let i=1;for(const n of t)i*=n.evaluate(e);return i}],"-":{type:ct,overloads:[[[ct,ct],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[ct],(e,[t])=>-t.evaluate(e)]]},"/":[ct,[ct,ct],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[ct,[ct,ct],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[ct,[ct],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ct,[ct],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ct,[ct],(e,[t])=>Math.log(t.evaluate(e))],log2:[ct,[ct],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ct,[ct],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ct,[ct],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ct,[ct],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ct,[ct],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ct,[ct],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ct,[ct],(e,[t])=>Math.atan(t.evaluate(e))],min:[ct,zn(ct),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[ct,zn(ct),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[ct,[ct],(e,[t])=>Math.abs(t.evaluate(e))],round:[ct,[ct],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[ct,[ct],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ct,[ct],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[ht,[ut,ft],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[ht,[ft],(e,[t])=>e.id()===t.value],"filter-type-==":[ht,[ut],(e,[t])=>e.geometryType()===t.value],"filter-<":[ht,[ut,ft],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[ht,[ft],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[ht,[ut,ft],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[ht,[ft],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[ht,[ut,ft],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[ht,[ft],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[ht,[ut,ft],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[ht,[ft],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-has":[ht,[ft],(e,[t])=>t.value in e.properties()],"filter-has-id":[ht,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[ht,[yt(ut)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[ht,[yt(ft)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[ht,[ut,yt(ft)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[ht,[ut,yt(ft)],(e,[t,i])=>function(e,t,i,n){for(;i<=n;){const r=i+n>>1;if(t[r]===e)return!0;t[r]>e?n=r-1:i=r+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:ht,overloads:[[[ht,ht],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[zn(ht),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:ht,overloads:[[[ht,ht],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[zn(ht),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[ht,[ht],(e,[t])=>!t.evaluate(e)],"is-supported-script":[ht,[ut],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[ut,[ut],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[ut,[ut],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[ut,zn(ft),(e,t)=>t.map((t=>Nt(t.evaluate(e)))).join("")],"resolved-locale":[ut,[mt],(e,[t])=>t.evaluate(e).resolvedLocale()]});var Dn=Mn;function Ln(e){return{result:"success",value:e}}function Rn(e){return{result:"error",value:e}}function On(e){return"data-driven"===e["property-type"]}function Bn(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Fn(e){return!!e.expression&&e.expression.interpolated}function Nn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function jn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Un(e){return e}function $n(e,t){const i="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],r=n||!(n||void 0!==e.property),o=e.type||(Fn(t)?"exponential":"interval");if(i&&((e=tt({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],It.parse(e[1])]))),e.default=It.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Yi[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,l;if("exponential"===o)s=qn;else if("interval"===o)s=Wn;else if("categorical"===o){s=Gn,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=Xn}if(n){const i={},n=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},n.push(o)),i[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of n)r.push([i[e].zoom,$n(i[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Qi.interpolationFactor.bind(void 0,o),zoomStops:r.map((e=>e[0])),evaluate:({zoom:i},n)=>qn({stops:r,base:e.base},t,i).evaluate(i,n)}}if(r){const i="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Qi.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>s(e,t,i,a,l)}}return{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[e.property]:void 0;return void 0===r?Vn(e.default,t.default):s(e,t,r,a,l)}}}function Vn(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Gn(e,t,i,n,r){return Vn(typeof i===r?n[i]:void 0,e.default,t.default)}function Wn(e,t,i){if("number"!==Nn(i))return Vn(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const r=Mi(e.stops.map((e=>e[0])),i);return e.stops[r][1]}function qn(e,t,i){const n=void 0!==e.base?e.base:1;if("number"!==Nn(i))return Vn(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const o=Mi(e.stops.map((e=>e[0])),i),s=function(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(i,n,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=zi[t.type]||Un;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Yi[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return c(t,i,s)}}:c(a,l,s)}function Xn(e,t,i){return"color"===t.type?i=It.parse(i):"formatted"===t.type?i=Lt.fromString(i.toString()):"resolvedImage"===t.type?i=Rt.fromString(i.toString()):Nn(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Vn(i,e.default,t.default)}class Zn{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Jt,this._defaultValue=t?function(e){return"color"===e.type&&(jn(e.default)||Array.isArray(e.default))?new It(0,0,0,0):"color"===e.type?It.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,n,r,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,n,r,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new $t(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Hn(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Dn}function Yn(e,t){const i=new Ci(Dn,[],t?function(e){const t={color:dt,string:ut,number:ct,enum:ut,boolean:ht,formatted:gt,resolvedImage:_t};return"array"===e.type?yt(t[e.value]||ft,e.length):t[e.type]}(t):void 0),n=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?Ln(new Zn(n,t)):Rn(i.errors)}class Kn{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!bi(t.expression)}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}}class Jn{constructor(e,t,i,n){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!bi(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}interpolationFactor(e,t,i){return this.interpolationType?Qi.interpolationFactor(this.interpolationType,e,t,i):0}}function Qn(e,t){if("error"===(e=Yn(e,t)).result)return e;const i=e.value.expression,n=vi(i);if(!n&&!On(t))return Rn([new ot("","data expressions not supported")]);const r=wi(i,["zoom","pitch","distance-from-center"]);if(!r&&!Bn(t))return Rn([new ot("","zoom expressions not supported")]);const o=tr(i);return o||r?o instanceof ot?Rn([o]):o instanceof Qi&&!Fn(t)?Rn([new ot("",'"interpolate" expressions cannot be used with this property')]):Ln(o?new Jn(n?"camera":"composite",e.value,o.labels,o instanceof Qi?o.interpolation:void 0):new Kn(n?"constant":"source",e.value)):Rn([new ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class er{constructor(e,t){this._parameters=e,this._specification=t,tt(this,$n(this._parameters,this._specification))}static deserialize(e){return new er(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function tr(e){let t=null;if(e instanceof rn)t=tr(e.result);else if(e instanceof tn){for(const i of e.args)if(t=tr(i),t)break}else(e instanceof Pi||e instanceof Qi)&&e.input instanceof ei&&"zoom"===e.input.name&&(t=e);return t instanceof ot||e.eachChild((e=>{const i=tr(e);i instanceof ot?t=i:!t&&i?t=new ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new ot("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}class ir{constructor(e,t,i,n){this.message=(e?`${e}: `:"")+i,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function nr(e){const t=e.key,i=e.value,n=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const l=Nn(i);if("object"!==l)return[new ir(t,i,`object expected, ${l} found`)];for(const e in i){const l=e.split(".")[0];let c;r[l]?c=r[l]:n[l]?c=Br:r["*"]?c=r["*"]:n["*"]&&(c=Br),c?a=a.concat(c({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:n[l]||n["*"],style:o,styleSpec:s,object:i,objectKey:e},i)):a.push(new ir(t,i[e],`unknown property "${e}"`))}for(const e in n)r[e]||n[e].required&&void 0===n[e].default&&void 0===i[e]&&a.push(new ir(t,i,`missing required property "${e}"`));return a}function rr(e){const t=e.value,i=e.valueSpec,n=e.style,r=e.styleSpec,o=e.key,s=e.arrayElementValidator||Br;if("array"!==Nn(t))return[new ir(o,t,`array expected, ${Nn(t)} found`)];if(i.length&&t.length!==i.length)return[new ir(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new ir(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};r.$version<7&&(a.function=i.function),"object"===Nn(i.value)&&(a=i.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(s({array:t,arrayIndex:e,value:t[e],valueSpec:a,style:n,styleSpec:r,key:`${o}[${e}]`}));return l}function or(e){const t=e.key,i=e.value,n=e.valueSpec;let r=Nn(i);if("number"===r&&i!=i&&(r="NaN"),"number"!==r)return[new ir(t,i,`number expected, ${r} found`)];if("minimum"in n){let r=n.minimum;if("array"===Nn(n.minimum)&&(r=n.minimum[e.arrayIndex]),i<r)return[new ir(t,i,`${i} is less than the minimum value ${r}`)]}if("maximum"in n){let r=n.maximum;if("array"===Nn(n.maximum)&&(r=n.maximum[e.arrayIndex]),i>r)return[new ir(t,i,`${i} is greater than the maximum value ${r}`)]}return[]}function sr(e){const t=e.valueSpec,i=it(e.value.type);let n,r,o,s={};const a="categorical"!==i&&void 0===e.value.property,l=!a,c="array"===Nn(e.value.stops)&&"array"===Nn(e.value.stops[0])&&"object"===Nn(e.value.stops[0][0]),u=nr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new ir(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;return t=t.concat(rr({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Nn(n)&&0===n.length&&t.push(new ir(e.key,n,"array must have at least one stop")),t},default:function(e){return Br({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&a&&u.push(new ir(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||u.push(new ir(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!Fn(e.valueSpec)&&u.push(new ir(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!On(e.valueSpec)?u.push(new ir(e.key,e.value,"property functions not supported")):a&&!Bn(e.valueSpec)&&u.push(new ir(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||u.push(new ir(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const n=e.value,a=e.key;if("array"!==Nn(n))return[new ir(a,n,`array expected, ${Nn(n)} found`)];if(2!==n.length)return[new ir(a,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==Nn(n[0]))return[new ir(a,n,`object expected, ${Nn(n[0])} found`)];if(void 0===n[0].zoom)return[new ir(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new ir(a,n,"object stop key must have value")];const t=it(n[0].zoom);if("number"!=typeof t)return[new ir(a,n[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new ir(a,n[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,r=void 0,s={}),i=i.concat(nr({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:or,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return Hn(nt(n[1]))?i.concat([new ir(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(Br({key:`${a}[1]`,value:n[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=Nn(e.value),l=it(e.value),c=null!==e.value?e.value:o;if(n){if(a!==n)return[new ir(e.key,c,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new ir(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let n=`number expected, ${a} found`;return On(t)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ir(e.key,c,n)]}return"categorical"!==i||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&"number"==typeof l&&"number"==typeof r&&void 0!==r&&l<r?[new ir(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in s?[new ir(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new ir(e.key,c,`integer expected, found ${String(l)}`)]}}function ar(e){const t=("property"===e.expressionContext?Qn:Yn)(nt(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new ir(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new ir(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!bi(i))return[new ir(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return lr(i,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!wi(i,["zoom","feature-state"]))return[new ir(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!vi(i))return[new ir(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lr(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const n=[];return e instanceof ei&&i.has(e.name)?[new ir(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{n.push(...lr(e,t))})),n)}function cr(e){const t=e.key,i=e.value,n=e.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(it(i))&&r.push(new ir(t,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(it(i))&&r.push(new ir(t,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function ur(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!ur(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function hr(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ur(e)||(e=yr(e));const i=e;let n=!0;try{n=function(e){if(!fr(e))return e;let t=nt(e);return pr(t),t=dr(t),t}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const r=et[`filter_${t}`],o=Yn(n,r);let s=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(e,t,i)=>o.value.evaluate(e,t,{},i);let a=null,l=null;if(n!==i){const e=Yn(i,r);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(t,i,n,r,o)=>e.value.evaluate(t,i,{},n,void 0,void 0,r,o),l=!vi(e.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:_r(n),needFeature:!!l}}function dr(e){if(!Array.isArray(e))return e;const t=function(e){if(mr.has(e[0]))for(let t=1;t<e.length;t++)if(fr(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>dr(e)))}function pr(e){let t=!1;const i=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||fr(e[n]),i.push(e[n+1]);i.push(e[e.length-1])}else if("match"===e[0]){t=t||fr(e[1]);for(let t=2;t<e.length-1;t+=2)i.push(e[t+1]);i.push(e[e.length-1])}else if("step"===e[0]){t=t||fr(e[1]);for(let t=1;t<e.length-1;t+=2)i.push(e[t+1])}t&&(e.length=0,e.push("any",...i));for(let t=1;t<e.length;t++)pr(e[t])}function fr(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(fr(e[t]))return!0;return!1}const mr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function gr(e,t){return e<t?-1:e>t?1:0}function _r(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(_r(e[t]))return!0;return!1}function yr(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?xr(e[1],e[2],"=="):"!="===t?wr(xr(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?xr(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(yr))):"all"===t?["all"].concat(e.slice(1).map(yr)):"none"===t?["all"].concat(e.slice(1).map(yr).map(wr)):"in"===t?vr(e[1],e.slice(2)):"!in"===t?wr(vr(e[1],e.slice(2))):"has"===t?br(e[1]):"!has"===t?wr(br(e[1])):"within"!==t||e;var i}function xr(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function vr(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(gr)]]:["filter-in-small",e,["literal",t]]}}function br(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function wr(e){return["!",e]}function Sr(e){return ur(nt(e.value))?ar(tt({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):Tr(e)}function Tr(e){const t=e.value,i=e.key;if("array"!==Nn(t))return[new ir(i,t,`array expected, ${Nn(t)} found`)];const n=e.styleSpec;let r,o=[];if(t.length<1)return[new ir(i,t,"filter array must have at least 1 element")];switch(o=o.concat(cr({key:`${i}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),it(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===it(t[1])&&o.push(new ir(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new ir(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=Nn(t[1]),"string"!==r&&o.push(new ir(`${i}[1]`,t[1],`string expected, ${r} found`)));for(let s=2;s<t.length;s++)r=Nn(t[s]),"$type"===it(t[1])?o=o.concat(cr({key:`${i}[${s}]`,value:t[s],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new ir(`${i}[${s}]`,t[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)o=o.concat(Tr({key:`${i}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Nn(t[1]),2!==t.length?o.push(new ir(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new ir(`${i}[1]`,t[1],`string expected, ${r} found`));break;case"within":r=Nn(t[1]),2!==t.length?o.push(new ir(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new ir(`${i}[1]`,t[1],`object expected, ${r} found`))}return o}function Er(e,t){const i=e.key,n=e.style,r=e.styleSpec,o=e.value,s=e.objectKey,a=r[`${t}_${e.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===t&&l&&a[l[1]]&&a[l[1]].transition)return Br({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});const c=e.valueSpec||a[s];if(!c)return[new ir(i,o,`unknown property "${s}"`)];let u;if("string"===Nn(o)&&On(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o))){const e=`\`{ "type": "identity", "property": ${u?JSON.stringify(u[1]):'"_"'} }\``;return[new ir(i,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: ${e}.`)]}const h=[];return"symbol"===e.layerType&&("text-field"===s&&n&&!n.glyphs&&h.push(new ir(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&jn(nt(o))&&"identity"===it(o.type)&&h.push(new ir(i,o,'"text-font" does not support identity functions'))),h.concat(Br({key:e.key,value:o,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:s}))}function Cr(e){return Er(e,"paint")}function kr(e){return Er(e,"layout")}function Mr(e){let t=[];const i=e.value,n=e.key,r=e.style,o=e.styleSpec;i.type||i.ref||t.push(new ir(n,i,'either "type" or "ref" is required'));let s=it(i.type);const a=it(i.ref);if(i.id){const o=it(i.id);for(let s=0;s<e.arrayIndex;s++){const e=r.layers[s];it(e.id)===o&&t.push(new ir(n,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new ir(n,i[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((t=>{it(t.id)===a&&(e=t)})),e?e.ref?t.push(new ir(n,i.ref,"ref cannot reference another ref layer")):s=it(e.type):"string"==typeof a&&t.push(new ir(n,i.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(i.source){const e=r.sources&&r.sources[i.source],o=e&&it(e.type);e?"vector"===o&&"raster"===s?t.push(new ir(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==s?t.push(new ir(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new ir(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===o&&e.lineMetrics||t.push(new ir(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ir(n,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new ir(n,i.source,`source "${i.source}" not found`))}else t.push(new ir(n,i,'missing required property "source"'));return t=t.concat(nr({key:n,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Br({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:e=>Sr(tt({layerType:s},e)),layout:e=>nr({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>kr(tt({layerType:s},e))}}),paint:e=>nr({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Cr(tt({layerType:s},e))}})}})),t}function Ar(e){const t=e.value,i=e.key,n=Nn(t);return"string"!==n?[new ir(i,t,`string expected, ${n} found`)]:[]}const Pr={promoteId:function({key:e,value:t}){if("string"===Nn(t))return Ar({key:e,value:t});{const i=[];for(const n in t)i.push(...Ar({key:`${e}.${n}`,value:t[n]}));return i}}};function Ir(e){const t=e.value,i=e.key,n=e.styleSpec,r=e.style;if(!t.type)return[new ir(i,t,'"type" is required')];const o=it(t.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=nr({key:i,value:t,valueSpec:n[`source_${o.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:Pr}),s;case"geojson":if(s=nr({key:i,value:t,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:Pr}),t.cluster)for(const e in t.clusterProperties){const[n,r]=t.clusterProperties[e],o="string"==typeof n?[n,["accumulated"],["get",e]]:n;s.push(...ar({key:`${i}.${e}.map`,value:r,expressionContext:"cluster-map"})),s.push(...ar({key:`${i}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return nr({key:i,value:t,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return nr({key:i,value:t,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return[new ir(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cr({key:`${i}.type`,value:t.type,valueSpec:{values:zr(n)},style:r,styleSpec:n})}}function zr(e){return e.source.reduce(((t,i)=>{const n=e[i];return"enum"===n.type.type&&(t=t.concat(Object.keys(n.type.values))),t}),[])}function Dr(e){const t=e.value,i=e.styleSpec,n=i.light,r=e.style;let o=[];const s=Nn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new ir("light",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&n[s[1]]&&n[s[1]].transition?Br({key:e,value:t[e],valueSpec:i.transition,style:r,styleSpec:i}):n[e]?Br({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}):[new ir(e,t[e],`unknown property "${e}"`)])}return o}function Lr(e){const t=e.value,i=e.key,n=e.style,r=e.styleSpec,o=r.terrain;let s=[];const a=Nn(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new ir("terrain",t,`object expected, ${a} found`)]),s;for(const e in t){const i=e.match(/^(.*)-transition$/);s=s.concat(i&&o[i[1]]&&o[i[1]].transition?Br({key:e,value:t[e],valueSpec:r.transition,style:n,styleSpec:r}):o[e]?Br({key:e,value:t[e],valueSpec:o[e],style:n,styleSpec:r}):[new ir(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=n.sources&&n.sources[t.source],r=e&&it(e.type);e?"raster-dem"!==r&&s.push(new ir(i,t.source,`terrain cannot be used with a source of type ${String(r)}, it only be used with a "raster-dem" source type`)):s.push(new ir(i,t.source,`source "${t.source}" not found`))}else s.push(new ir(i,t,'terrain is missing required property "source"'));return s}function Rr(e){const t=e.value,i=e.style,n=e.styleSpec,r=n.fog;let o=[];const s=Nn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new ir("fog",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&r[s[1]]&&r[s[1]].transition?Br({key:e,value:t[e],valueSpec:n.transition,style:i,styleSpec:n}):r[e]?Br({key:e,value:t[e],valueSpec:r[e],style:i,styleSpec:n}):[new ir(e,t[e],`unknown property "${e}"`)])}return o}const Or={"*":()=>[],array:rr,boolean:function(e){const t=e.value,i=e.key,n=Nn(t);return"boolean"!==n?[new ir(i,t,`boolean expected, ${n} found`)]:[]},number:or,color:function(e){const t=e.key,i=e.value,n=Nn(i);return"string"!==n?[new ir(t,i,`color expected, ${n} found`)]:null===Tt(i)?[new ir(t,i,`color expected, "${i}" found`)]:[]},enum:cr,filter:Sr,function:sr,layer:Mr,object:nr,source:Ir,light:Dr,terrain:Lr,fog:Rr,string:Ar,formatted:function(e){return 0===Ar(e).length?[]:ar(e)},resolvedImage:function(e){return 0===Ar(e).length?[]:ar(e)},projection:function(e){const t=e.value,i=e.styleSpec,n=i.projection,r=e.style;let o=[];const s=Nn(t);if("object"===s)for(const e in t)o=o.concat(Br({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}));else"string"!==s&&(o=o.concat([new ir("projection",t,`object or string expected, ${s} found`)]));return o}};function Br(e){const t=e.value,i=e.valueSpec,n=e.styleSpec;return i.expression&&jn(it(t))?sr(e):i.expression&&Hn(nt(t))?ar(e):i.type&&Or[i.type]?Or[i.type](e):nr(tt({},e,{valueSpec:i.type?n[i.type]:i}))}function Fr(e){const t=e.value,i=e.key,n=Ar(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new ir(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new ir(i,t,'"glyphs" url must include a "{range}" token'))),n}function Nr(e,t=et){return $r(Br({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Fr,"*":()=>[]}}))}const jr=e=>$r(Cr(e)),Ur=e=>$r(kr(e));function $r(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function Vr(e,t){let i=!1;if(t&&t.length)for(const n of t)e.fire(new Je(new Error(n.message))),i=!0;return i}var Gr=qr,Wr=3;function qr(e,t,i){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(i=r[2]);for(var o=0;o<this.d*this.d;o++){var s=r[Wr+o],a=r[Wr+o+1];n.push(s===a?null:r.subarray(s,a))}var l=r[Wr+n.length+1];this.keys=r.subarray(r[Wr+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var u=i/t*e;this.min=-u,this.max=e+u}qr.prototype.insert=function(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},qr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qr.prototype._insertCell=function(e,t,i,n,r,o){this.cells[r].push(o)},qr.prototype.query=function(e,t,i,n,r){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=i&&s<=n&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,i,n,this._queryCell,a,{},r),a},qr.prototype._queryCell=function(e,t,i,n,r,o,s,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&i>=u[p+0]&&n>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},qr.prototype._forEachCell=function(e,t,i,n,r,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,i,n,f,o,s,a))return}},qr.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},qr.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},qr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Wr+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(t+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];r[Wr+s]=o,r.set(a,o),o+=a.length}return r[Wr+e.length]=o,r.set(this.keys,o),r[Wr+e.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};var Xr=d(Gr);const Zr={};function Hr(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Zr[t]={klass:e,omit:i.omit||[]}}Hr(Object,"Object"),Xr.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}},Xr.deserialize=function(e){return new Xr(e.buffer)},Object.defineProperty(Xr,"name",{value:"Grid"}),Hr(Xr,"Grid"),Hr(It,"Color"),Hr(Error,"Error"),Hr(ce,"AJAXError"),Hr(Rt,"ResolvedImage"),Hr(er,"StylePropertyFunction"),Hr(Zn,"StyleExpression",{omit:["_evaluator"]}),Hr(Jn,"ZoomDependentExpression"),Hr(Kn,"ZoomConstantExpression"),Hr(ei,"CompoundExpression",{omit:["_evaluate"]});for(const e in Dn)Zr[Dn[e]._classRegistryKey]||Hr(Dn[e],`Expression${e}`);function Yr(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Kr(e){return t.ImageBitmap&&e instanceof t.ImageBitmap}function Jr(e,i){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Yr(e)||Kr(e))return i&&i.push(e),e;if(ArrayBuffer.isView(e)){const t=e;return i&&i.push(t.buffer),t}if(e instanceof t.ImageData)return i&&i.push(e.data.buffer),e;if(Array.isArray(e)){const t=[];for(const n of e)t.push(Jr(n,i));return t}if("object"==typeof e){const t=e.constructor,n=t._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const r=t.serialize?t.serialize(e,i):{};if(!t.serialize){for(const t in e)e.hasOwnProperty(t)&&(Zr[n].omit.indexOf(t)>=0||(r[t]=Jr(e[t],i)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}throw new Error("can't serialize object of type "+typeof e)}function Qr(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Yr(e)||Kr(e)||ArrayBuffer.isView(e)||e instanceof t.ImageData)return e;if(Array.isArray(e))return e.map(Qr);if("object"==typeof e){const t=e.$name||"Object",{klass:i}=Zr[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const n=Object.create(i.prototype);for(const t of Object.keys(e))"$name"!==t&&(n[t]=Qr(e[t]));return n}throw new Error("can't deserialize object of type "+typeof e)}const eo={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function to(e){for(const t of e)if(ro(t.charCodeAt(0)))return!0;return!1}function io(e){for(const t of e)if(!no(t.charCodeAt(0)))return!1;return!0}function no(e){return!(eo.Arabic(e)||eo["Arabic Supplement"](e)||eo["Arabic Extended-A"](e)||eo["Arabic Presentation Forms-A"](e)||eo["Arabic Presentation Forms-B"](e))}function ro(e){return!(746!==e&&747!==e&&(e<4352||!(eo["Bopomofo Extended"](e)||eo.Bopomofo(e)||eo["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||eo["CJK Compatibility Ideographs"](e)||eo["CJK Compatibility"](e)||eo["CJK Radicals Supplement"](e)||eo["CJK Strokes"](e)||!(!eo["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||eo["CJK Unified Ideographs Extension A"](e)||eo["CJK Unified Ideographs"](e)||eo["Enclosed CJK Letters and Months"](e)||eo["Hangul Compatibility Jamo"](e)||eo["Hangul Jamo Extended-A"](e)||eo["Hangul Jamo Extended-B"](e)||eo["Hangul Jamo"](e)||eo["Hangul Syllables"](e)||eo.Hiragana(e)||eo["Ideographic Description Characters"](e)||eo.Kanbun(e)||eo["Kangxi Radicals"](e)||eo["Katakana Phonetic Extensions"](e)||eo.Katakana(e)&&12540!==e||!(!eo["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!eo["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||eo["Unified Canadian Aboriginal Syllabics"](e)||eo["Unified Canadian Aboriginal Syllabics Extended"](e)||eo["Vertical Forms"](e)||eo["Yijing Hexagram Symbols"](e)||eo["Yi Syllables"](e)||eo["Yi Radicals"](e))))}function oo(e){return!(ro(e)||function(e){return!!(eo["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||eo["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||eo["Letterlike Symbols"](e)||eo["Number Forms"](e)||eo["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||eo["Control Pictures"](e)&&9251!==e||eo["Optical Character Recognition"](e)||eo["Enclosed Alphanumerics"](e)||eo["Geometric Shapes"](e)||eo["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||eo["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||eo["CJK Symbols and Punctuation"](e)||eo.Katakana(e)||eo["Private Use Area"](e)||eo["CJK Compatibility Forms"](e)||eo["Small Form Variants"](e)||eo["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function so(e){return e>=1424&&e<=2303||eo["Arabic Presentation Forms-A"](e)||eo["Arabic Presentation Forms-B"](e)}function ao(e,t){return!(!t&&so(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||eo.Khmer(e))}function lo(e){for(const t of e)if(so(t.charCodeAt(0)))return!0;return!1}const co="deferred",uo="loading",ho="loaded";let po=null,fo="unavailable",mo=null;const go=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(fo="error"),po&&po(e)};function _o(){yo.fire(new Ke("pluginStateChange",{pluginStatus:fo,pluginURL:mo}))}const yo=new Qe,xo=function(){return fo},vo=function(){if(fo!==co||!mo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fo=uo,_o(),mo&&de({url:mo},(e=>{e?go(e):(fo=ho,_o())}))},bo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fo===ho||null!=bo.applyArabicShaping,isLoading:()=>fo===uo,setState(e){fo=e.pluginStatus,mo=e.pluginURL},isParsed:()=>null!=bo.applyArabicShaping&&null!=bo.processBidirectionalText&&null!=bo.processStyledBidirectionalText,getPluginURL:()=>mo};class wo{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(e,t){for(const i of e)if(!ao(i.charCodeAt(0),t))return!1;return!0}(e,bo.isLoaded())}}class So{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(jn(e))return new er(e,t);if(Hn(e)){const i=Qn(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=It.parse(e)),{kind:"constant",evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class To{constructor(e){this.property=e,this.value=new So(e,void 0)}transitioned(e,t){return new Co(this.property,this.value,t,z({},e.transition,this.transition),e.now)}untransitioned(){return new Co(this.property,this.value,null,{},0)}}class Eo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return $(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new To(this._values[e].property)),this._values[e].value=new So(this._values[e].property,null===t?void 0:$(t))}getTransition(e){return $(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new To(this._values[e].property)),this._values[e].transition=$(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n)}return e}transitioned(e,t){const i=new ko(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(e,t._values[n]);return i}untransitioned(){const e=new ko(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Co{constructor(e,t,i,n,r){const o=n.delay||0,s=n.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+o,this.end=this.begin+s,e.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const n=e.now||0,r=this.value.possiblyEvaluate(e,t,i),o=this.prior;if(o){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return o.possiblyEvaluate(e,t,i);{const s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,i),r,T(s))}}return r}}class ko{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const n=new Po(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Mo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return $(this._values[e].value)}setValue(e,t){this._values[e]=new So(this._values[e].property,null===t?void 0:$(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const n=new Po(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}}class Ao{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,n){return this.property.evaluate(this.value,this.parameters,e,t,i,n)}}class Po{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Io{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const n=zi[this.specification.type];return n?n(e,t,i):e}}class zo{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,n){return new Ao(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,n)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Ao(this,{kind:"constant",value:void 0},e.parameters);const n=zi[this.specification.type];return n?new Ao(this,{kind:"constant",value:n(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,n,r,o){return"constant"===e.kind?e.value:e.evaluate(t,i,n,r,o)}}class Do{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,n){return!!e.expression.evaluate(t,null,{},i,n)}interpolate(){return!1}}class Lo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new wo(0,{});for(const i in e){const n=e[i];n.specification.overridable&&this.overridableProperties.push(i);const r=this.defaultPropertyValues[i]=new So(n,void 0),o=this.defaultTransitionablePropertyValues[i]=new To(n);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=r.possiblyEvaluate(t)}}}function Ro(e,t){return 256*(e=k(Math.floor(e),0,255))+k(Math.floor(t),0,255)}Hr(zo,"DataDrivenProperty"),Hr(Io,"DataConstantProperty"),Hr(Do,"ColorRampProperty");const Oo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bo{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function No(e,t=1){let i=0,n=0;return{members:e.map((e=>{const r=Oo[e.type].BYTES_PER_ELEMENT,o=i=jo(i,Math.max(t,r)),s=e.components||1;return n=Math.max(n,r),i+=r*s,{name:e.name,type:e.type,components:s,offset:o}})),size:jo(i,Math.max(n,t)),alignment:t}}function jo(e,t){return Math.ceil(e/t)*t}class Uo extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=i,e}}Uo.prototype.bytesPerElement=4,Hr(Uo,"StructArrayLayout2i4");class $o extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=i,this.int16[r+2]=n,e}}$o.prototype.bytesPerElement=6,Hr($o,"StructArrayLayout3i6");class Vo extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,e}}Vo.prototype.bytesPerElement=8,Hr(Vo,"StructArrayLayout4i8");class Go extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,o,s)}emplace(e,t,i,n,r,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.uint8[c+4]=n,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}Go.prototype.bytesPerElement=12,Hr(Go,"StructArrayLayout2i4ub1f12");class Wo extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,e}}Wo.prototype.bytesPerElement=16,Hr(Wo,"StructArrayLayout4f16");class qo extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r)}emplace(e,t,i,n,r,o){const s=6*e,a=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=i,this.uint16[s+2]=n,this.uint16[s+3]=r,this.float32[a+2]=o,e}}qo.prototype.bytesPerElement=12,Hr(qo,"StructArrayLayout4ui1f12");class Xo extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=i,this.uint16[o+2]=n,this.uint16[o+3]=r,e}}Xo.prototype.bytesPerElement=8,Hr(Xo,"StructArrayLayout4ui8");class Zo extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r,o)}emplace(e,t,i,n,r,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,e}}Zo.prototype.bytesPerElement=12,Hr(Zo,"StructArrayLayout6i12");class Ho extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,n,r,o,s,a,l,c,u,h)}emplace(e,t,i,n,r,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=n,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}Ho.prototype.bytesPerElement=24,Hr(Ho,"StructArrayLayout4i4ui4i24");class Yo extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r,o)}emplace(e,t,i,n,r,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=n,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=s,e}}Yo.prototype.bytesPerElement=20,Hr(Yo,"StructArrayLayout3i3f20");class Ko extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Ko.prototype.bytesPerElement=4,Hr(Ko,"StructArrayLayout1ul4");class Jo extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,n,r,o,s,a,l,c,u,h,d)}emplace(e,t,i,n,r,o,s,a,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=i,this.int16[f+2]=n,this.int16[f+3]=r,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}Jo.prototype.bytesPerElement=40,Hr(Jo,"StructArrayLayout5i4f1i1ul2ui40");class Qo extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,o,s)}emplace(e,t,i,n,r,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.int16[l+2]=n,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}Qo.prototype.bytesPerElement=16,Hr(Qo,"StructArrayLayout3i2i2i16");class es extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r)}emplace(e,t,i,n,r,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=n,this.int16[a+6]=r,this.int16[a+7]=o,e}}es.prototype.bytesPerElement=16,Hr(es,"StructArrayLayout2f1f2i16");class ts extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=12*e,s=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=i,this.float32[s+1]=n,this.float32[s+2]=r,e}}ts.prototype.bytesPerElement=12,Hr(ts,"StructArrayLayout2ub2f12");class is extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=i,this.float32[r+2]=n,e}}is.prototype.bytesPerElement=12,Hr(is,"StructArrayLayout3f12");class ns extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,this.uint16[r+2]=n,e}}ns.prototype.bytesPerElement=6,Hr(ns,"StructArrayLayout3ui6");class rs extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,x,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,x,v)}emplace(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,x,v,b){const w=30*e,S=15*e,T=60*e;return this.int16[w+0]=t,this.int16[w+1]=i,this.int16[w+2]=n,this.float32[S+2]=r,this.float32[S+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[S+5]=l,this.uint32[S+6]=c,this.uint32[S+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[S+10]=f,this.float32[S+11]=m,this.uint8[T+48]=g,this.uint8[T+49]=_,this.uint8[T+50]=y,this.uint32[S+13]=x,this.int16[w+28]=v,this.uint8[T+58]=b,e}}rs.prototype.bytesPerElement=60,Hr(rs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class os extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,x,v,b,w,S,T,E,C,k,M,A){const P=this.length;return this.resize(P+1),this.emplace(P,e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,x,v,b,w,S,T,E,C,k,M,A)}emplace(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,x,v,b,w,S,T,E,C,k,M,A,P){const I=38*e,z=19*e;return this.int16[I+0]=t,this.int16[I+1]=i,this.int16[I+2]=n,this.float32[z+2]=r,this.float32[z+3]=o,this.int16[I+8]=s,this.int16[I+9]=a,this.int16[I+10]=l,this.int16[I+11]=c,this.int16[I+12]=u,this.int16[I+13]=h,this.uint16[I+14]=d,this.uint16[I+15]=p,this.uint16[I+16]=f,this.uint16[I+17]=m,this.uint16[I+18]=g,this.uint16[I+19]=_,this.uint16[I+20]=y,this.uint16[I+21]=x,this.uint16[I+22]=v,this.uint16[I+23]=b,this.uint16[I+24]=w,this.uint16[I+25]=S,this.uint16[I+26]=T,this.uint16[I+27]=E,this.uint16[I+28]=C,this.uint32[z+15]=k,this.float32[z+16]=M,this.float32[z+17]=A,this.float32[z+18]=P,e}}os.prototype.bytesPerElement=76,Hr(os,"StructArrayLayout3i2f6i15ui1ul3f76");class ss extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ss.prototype.bytesPerElement=4,Hr(ss,"StructArrayLayout1f4");class as extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r)}emplace(e,t,i,n,r,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=n,this.float32[s+3]=r,this.float32[s+4]=o,e}}as.prototype.bytesPerElement=20,Hr(as,"StructArrayLayout5f20");class ls extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=i,this.uint16[o+3]=n,this.uint16[o+4]=r,e}}ls.prototype.bytesPerElement=12,Hr(ls,"StructArrayLayout1ul3ui12");class cs extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,e}}cs.prototype.bytesPerElement=4,Hr(cs,"StructArrayLayout2ui4");class us extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}us.prototype.bytesPerElement=2,Hr(us,"StructArrayLayout1ui2");class hs extends Fo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=i,e}}hs.prototype.bytesPerElement=8,Hr(hs,"StructArrayLayout2f8");class ds extends Bo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ds.prototype.size=40;class ps extends Jo{get(e){return new ds(this,e)}}Hr(ps,"CollisionBoxArray");class fs extends Bo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}fs.prototype.size=60;class ms extends rs{get(e){return new fs(this,e)}}Hr(ms,"PlacedSymbolArray");class gs extends Bo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}gs.prototype.size=76;class _s extends os{get(e){return new gs(this,e)}}Hr(_s,"SymbolInstanceArray");class ys extends ss{getoffsetX(e){return this.float32[1*e+0]}}Hr(ys,"GlyphOffsetArray");class xs extends Uo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Hr(xs,"SymbolLineVertexArray");class vs extends Bo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}vs.prototype.size=12;class bs extends ls{get(e){return new vs(this,e)}}Hr(bs,"FeatureIndexArray");class ws extends cs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Hr(ws,"FillExtrusionCentroidArray");const Ss=No([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ts=No([{name:"a_dash",components:4,type:"Uint16"}]);var Es={exports:{}},Cs={exports:function(e,t){var i,n,r,o,s,a,l,c;for(n=e.length-(i=3&e.length),r=t,s=3432918353,a=461845907,c=0;c<n;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}},ks={exports:function(e,t){for(var i,n=e.length,r=t^n,o=0;n>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}},Ms=Cs.exports,As=ks.exports;Es.exports=Ms,Es.exports.murmur3=Ms,Es.exports.murmur2=As;var Ps=d(Es.exports);class Is{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,i,n){this.ids.push(zs(e)),this.positions.push(t,i,n)}getPositions(e){const t=zs(e);let i=0,n=this.ids.length-1;for(;i<n;){const e=i+n>>1;this.ids[e]>=t?n=e:i=e+1}const r=[];for(;this.ids[i]===t;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(e,t){const i=new Float64Array(e.ids),n=new Uint32Array(e.positions);return Ds(i,n,0,i.length-1),t&&t.push(i.buffer,n.buffer),{ids:i,positions:n}}static deserialize(e){const t=new Is;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function zs(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Ps(String(e))}function Ds(e,t,i,n){for(;i<n;){const r=e[i+n>>1];let o=i-1,s=n+1;for(;;){do{o++}while(e[o]<r);do{s--}while(e[s]>r);if(o>=s)break;Ls(e,o,s),Ls(t,3*o,3*s),Ls(t,3*o+1,3*s+1),Ls(t,3*o+2,3*s+2)}s-i<n-s?(Ds(e,t,i,s),i=s+1):(Ds(e,t,s+1,n),n=s)}}function Ls(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}Hr(Is,"FeaturePositionMap");class Rs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Os extends Rs{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Bs extends Rs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class Fs extends Rs{constructor(e){super(e),this.current=It.transparent}set(e,t,i){this.fetchUniformLocation(e,t)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Ns=new Float32Array(16),js=new Float32Array(9),Us=new Float32Array(4);function $s(e){return[Ro(255*e.r,255*e.g),Ro(255*e.b,255*e.a)]}class Vs{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i}setUniform(e,t,i,n,r){t.set(e,r,n.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Fs(e):new Os(e)}}class Gs{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,i,n,r){const o="u_pattern"===r||"u_dash"===r?this.pattern:"u_pixel_ratio"===r?this.pixelRatio:null;o&&t.set(e,r,o)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new Bs(e):new Os(e)}}class Ws{constructor(e,t,i,n){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(e,t,i,n,r,o){const s=this.paintVertexArray.length,a=this.expression.evaluate(new wo(0),t,{},r,n,o);this.paintVertexArray.resize(e),this._setPaintValue(s,e,a)}updatePaintArray(e,t,i,n,r){const o=this.expression.evaluate({zoom:0},i,n,void 0,r);this._setPaintValue(e,t,o)}_setPaintValue(e,t,i){if("color"===this.type){const n=$s(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qs{constructor(e,t,i,n,r,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,i,n,r,o){const s=this.expression.evaluate(new wo(this.zoom),t,{},r,n,o),a=this.expression.evaluate(new wo(this.zoom+1),t,{},r,n,o),l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(l,e,s,a)}updatePaintArray(e,t,i,n,r){const o=this.expression.evaluate({zoom:this.zoom},i,n,void 0,r),s=this.expression.evaluate({zoom:this.zoom+1},i,n,void 0,r);this._setPaintValue(e,t,o,s)}_setPaintValue(e,t,i,n){if("color"===this.type){const r=$s(i),o=$s(n);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,i,n,r){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,s=k(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(e,r,s)}getBinding(e,t){return new Os(e)}}class Xs{constructor(e,t,i,n,r){this.expression=e,this.layerId=r,this.paintVertexAttributes=("array"===i?Ts:Ss).members;for(let e=0;e<t.length;++e);this.paintVertexArray=new n}populatePaintArray(e,t,i){const n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,n,r,o){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(e,t,i,n){if(!n||!i)return;const r=n[i];if(!r)return;const{tl:o,br:s,pixelRatio:a}=r;for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,o[0],o[1],s[0],s[1],a)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zs{constructor(e,t,i=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const r in e.paint._values){if(!i(r))continue;const o=e.paint.get(r);if(!(o instanceof Ao&&On(o.property.specification)))continue;const s=Ks(r,e.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===r||r.endsWith("pattern"),h="line-dasharray"===r&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const t=ea(r,l,"source");this.binders[r]=u?new Xs(a,s,l,t,e.id):new Ws(a,s,l,t),n.push(`/a_${r}`)}else{const e=ea(r,l,"composite");this.binders[r]=new qs(a,s,l,c,t,e),n.push(`/z_${r}`)}else this.binders[r]=u?new Gs(a.value,s):new Vs(a.value,s,l),n.push(`/u_${r}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Ws||t instanceof qs?t.maxValue:0}populatePaintArrays(e,t,i,n,r,o){for(const s in this.binders){const a=this.binders[s];(a instanceof Ws||a instanceof qs||a instanceof Xs)&&a.populatePaintArray(e,t,i,n,r,o)}}setConstantPatternPositions(e){for(const t in this.binders){const i=this.binders[t];i instanceof Gs&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,t,i,n,r,o){let s=!1;for(const a in e){const l=t.getPositions(a);for(const t of l){const l=i.feature(t.index);for(const i in this.binders){const c=this.binders[i];if((c instanceof Ws||c instanceof qs||c instanceof Xs)&&!0===c.expression.isStateDependent){const u=n.paint.get(i);c.expression=u.value,c.updatePaintArray(t.start,t.end,l,e[a],r,o),s=!0}}}}return s}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Vs||i instanceof Gs)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Ws||i instanceof qs||i instanceof Xs)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Vs||i instanceof Gs||i instanceof qs)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof Vs||n instanceof Gs||n instanceof qs)for(const r of n.uniformNames)t.push({name:r,property:i,binding:n.getBinding(e,r)})}return t}setUniforms(e,t,i,n,r){for(const{name:t,property:o,binding:s}of i)this.binders[o].setUniform(e,s,r,n.get(o),t)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Ws||t instanceof qs||t instanceof Xs)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof Ws||i instanceof qs||i instanceof Xs)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Ws||t instanceof qs||t instanceof Xs)&&t.destroy()}}}class Hs{constructor(e,t,i=(()=>!0)){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new Zs(n,t,i);this.needsUpload=!1,this._featureMap=new Is,this._bufferOffset=0}populatePaintArrays(e,t,i,n,r,o,s){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,n,r,o,s);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,n,r){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,t,o,n,r)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ys={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ks(e,t){return Ys[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Js={"line-pattern":{source:qo,composite:qo},"fill-pattern":{source:qo,composite:qo},"fill-extrusion-pattern":{source:qo,composite:qo},"line-dasharray":{source:Xo,composite:Xo}},Qs={color:{source:hs,composite:Wo},number:{source:ss,composite:hs}};function ea(e,t,i){const n=Js[e];return n&&n[i]||Qs[t][i]}Hr(Vs,"ConstantBinder"),Hr(Gs,"PatternConstantBinder"),Hr(Ws,"SourceExpressionBinder"),Hr(Xs,"PatternCompositeBinder"),Hr(qs,"CompositeExpressionBinder"),Hr(Zs,"ProgramConfiguration",{omit:["_buffers"]}),Hr(Hs,"ProgramConfigurationSet");const ta="-transition";class ia extends Qe{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Mo(t.layout)),t.paint)){this._transitionablePaint=new Eo(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Po(t.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,i={}){null!=t&&this._validate(Ur,`layers.${this.id}.layout.${e}`,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return N(e,ta)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,i={}){if(null!=t&&this._validate(jr,`layers.${this.id}.paint.${e}`,e,t,i))return!1;if(N(e,ta))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const i=this._transitionablePaint._values[e],n=i.value.isDataDriven(),r=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value,s=o.isDataDriven(),a=N(e,"pattern")||"line-dasharray"===e;return s||n||a||this._handleOverridablePaintPropertyUpdate(e,r,o)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),U(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,i,n,r={}){return(!r||!1!==r.validate)&&Vr(this,e.call(Nr,{key:t,layerType:this.type,objectKey:i,value:n,styleSpec:et,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Ao&&On(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=hr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const na=No([{name:"a_pos",components:2,type:"Int16"}],4),ra=No([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class oa{constructor(e=[]){this.segments=e}prepareSegment(e,t,i,n){let r=this.segments[this.segments.length-1];return e>oa.MAX_VERTEX_ARRAY_LENGTH&&G(`Max vertices per segment is ${oa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!r||r.vertexLength+e>oa.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n)&&(r={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==n&&(r.sortKey=n),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,n){return new oa([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}oa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Hr(oa,"SegmentVector");var sa=8192;class aa{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ul?new Ul(e.lng,e.lat):Ul.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ul?new Ul(e.lng,e.lat):Ul.convert(e),this}extend(e){const t=this._sw,i=this._ne;let n,r;if(e instanceof Ul)n=e,r=e;else{if(!(e instanceof aa))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(aa.convert(e)):this.extend(Ul.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Ul.convert(e)):this;if(n=e._sw,r=e._ne,!n||!r)return this}return t||i?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new Ul(n.lng,n.lat),this._ne=new Ul(r.lng,r.lat)),this}getCenter(){return new Ul((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ul(this.getWest(),this.getNorth())}getSouthEast(){return new Ul(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=Ul.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(e){return!e||e instanceof aa?e:new aa(e)}}var la=1e-6,ca="undefined"!=typeof Float32Array?Float32Array:Array;function ua(){var e=new ca(9);return ca!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ha(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],_=i[5],y=i[6],x=i[7],v=i[8];return e[0]=d*n+p*s+f*c,e[1]=d*r+p*a+f*u,e[2]=d*o+p*l+f*h,e[3]=m*n+g*s+_*c,e[4]=m*r+g*a+_*u,e[5]=m*o+g*l+_*h,e[6]=y*n+x*s+v*c,e[7]=y*r+x*a+v*u,e[8]=y*o+x*l+v*h,e}function da(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pa(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=i*a-n*s,x=i*l-r*s,v=i*c-o*s,b=n*l-r*a,w=n*c-o*a,S=r*c-o*l,T=u*m-h*f,E=u*g-d*f,C=u*_-p*f,k=h*g-d*m,M=h*_-p*m,A=d*_-p*g,P=y*A-x*M+v*k+b*C-w*E+S*T;return P?(e[0]=(a*A-l*M+c*k)*(P=1/P),e[1]=(r*M-n*A-o*k)*P,e[2]=(m*S-g*w+_*b)*P,e[3]=(d*w-h*S-p*b)*P,e[4]=(l*C-s*A-c*E)*P,e[5]=(i*A-r*C+o*E)*P,e[6]=(g*v-f*S-_*x)*P,e[7]=(u*S-d*v+p*x)*P,e[8]=(s*M-a*C+c*T)*P,e[9]=(n*C-i*M-o*T)*P,e[10]=(f*w-m*v+_*y)*P,e[11]=(h*v-u*w-p*y)*P,e[12]=(a*E-s*k-l*T)*P,e[13]=(i*k-n*E+r*T)*P,e[14]=(m*x-f*b-g*y)*P,e[15]=(u*b-h*x+d*y)*P,e):null}function fa(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],y=t[15],x=i[0],v=i[1],b=i[2],w=i[3];return e[0]=x*n+v*a+b*h+w*m,e[1]=x*r+v*l+b*d+w*g,e[2]=x*o+v*c+b*p+w*_,e[3]=x*s+v*u+b*f+w*y,e[4]=(x=i[4])*n+(v=i[5])*a+(b=i[6])*h+(w=i[7])*m,e[5]=x*r+v*l+b*d+w*g,e[6]=x*o+v*c+b*p+w*_,e[7]=x*s+v*u+b*f+w*y,e[8]=(x=i[8])*n+(v=i[9])*a+(b=i[10])*h+(w=i[11])*m,e[9]=x*r+v*l+b*d+w*g,e[10]=x*o+v*c+b*p+w*_,e[11]=x*s+v*u+b*f+w*y,e[12]=(x=i[12])*n+(v=i[13])*a+(b=i[14])*h+(w=i[15])*m,e[13]=x*r+v*l+b*d+w*g,e[14]=x*o+v*c+b*p+w*_,e[15]=x*s+v*u+b*f+w*y,e}function ma(e,t,i){var n,r,o,s,a,l,c,u,h,d,p,f,m=i[0],g=i[1],_=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=n=t[0],e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=n*m+a*g+h*_+t[12],e[13]=r*m+l*g+d*_+t[13],e[14]=o*m+c*g+p*_+t[14],e[15]=s*m+u*g+f*_+t[15]),e}function ga(e,t,i){var n=i[0],r=i[1],o=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function _a(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*n,e[5]=s*r+u*n,e[6]=a*r+h*n,e[7]=l*r+d*n,e[8]=c*r-o*n,e[9]=u*r-s*n,e[10]=h*r-a*n,e[11]=d*r-l*n,e}function ya(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*n,e[1]=s*r-u*n,e[2]=a*r-h*n,e[3]=l*r-d*n,e[8]=o*n+c*r,e[9]=s*n+u*r,e[10]=a*n+h*r,e[11]=l*n+d*r,e}function xa(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function va(e,t,i){var n,r,o,s=i[0],a=i[1],l=i[2],c=Math.hypot(s,a,l);return c<la?null:(s*=c=1/c,a*=c,l*=c,n=Math.sin(t),r=Math.cos(t),e[0]=s*s*(o=1-r)+r,e[1]=a*s*o+l*n,e[2]=l*s*o-a*n,e[3]=0,e[4]=s*a*o-l*n,e[5]=a*a*o+r,e[6]=l*a*o+s*n,e[7]=0,e[8]=s*l*o+a*n,e[9]=a*l*o-s*n,e[10]=l*l*o+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ba=fa;function wa(){var e=new ca(3);return ca!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Sa(e){var t=new ca(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ta(e){return Math.hypot(e[0],e[1],e[2])}function Ea(e,t,i){var n=new ca(3);return n[0]=e,n[1]=t,n[2]=i,n}function Ca(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function ka(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Ma(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Aa(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function Pa(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function Ia(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function za(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e}function Da(e,t){var i=t[0],n=t[1],r=t[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function La(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ra(e,t,i){var n=t[0],r=t[1],o=t[2],s=i[0],a=i[1],l=i[2];return e[0]=r*l-o*a,e[1]=o*s-n*l,e[2]=n*a-r*s,e}function Oa(e,t,i){var n=t[0],r=t[1],o=t[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];return e[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/(s=s||1),e[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,e[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s,e}function Ba(e,t,i){var n=i[0],r=i[1],o=i[2],s=t[0],a=t[1],l=t[2],c=r*l-o*a,u=o*s-n*l,h=n*a-r*s,d=r*h-o*u,p=o*c-n*h,f=n*u-r*c,m=2*i[3];return u*=m,h*=m,p*=2,f*=2,e[0]=s+(c*=m)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e}var Fa,Na=ka,ja=Ma,Ua=Ta;function $a(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Va(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=i*i+n*n+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=i*s,e[1]=n*s,e[2]=r*s,e[3]=o*s,e}function Ga(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,e[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,e[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,e[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,e}function Wa(){var e=new ca(4);return ca!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function qa(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Xa(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l+s*a,e[1]=r*l+o*a,e[2]=o*l-r*a,e[3]=s*l-n*a,e}function Za(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l-o*a,e[1]=r*l+s*a,e[2]=o*l+n*a,e[3]=s*l-r*a,e}wa(),Fa=new ca(4),ca!=Float32Array&&(Fa[0]=0,Fa[1]=0,Fa[2]=0,Fa[3]=0);var Ha=Va;wa(),Ea(1,0,0),Ea(0,1,0),Wa(),Wa(),ua();const Ya=No([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ka}=Ya,Ja=No([{name:"a_pos_3",components:3,type:"Int16"}]);var Qa=No([{name:"a_pos",type:"Int16",components:2}]);class el{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,i){const n=La(t,this.dir);if(Math.abs(n)<1e-6)return!1;const r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n;return i[0]=this.pos[0]+this.dir[0]*r,i[1]=this.pos[1]+this.dir[1]*r,i[2]=this.pos[2]+this.dir[2]*r,!0}closestPointOnSphere(e,t,i){if(function(e,t){var i=e[0],n=e[1],r=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(i-o)<=la*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=la*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=la*Math.max(1,Math.abs(r),Math.abs(a))}(this.pos,e)||0===t)return i[0]=i[1]=i[2]=0,!1;const[n,r,o]=this.dir,s=this.pos[0]-e[0],a=this.pos[1]-e[1],l=this.pos[2]-e[2],c=n*n+r*r+o*o,u=2*(s*n+a*r+l*o),h=u*u-4*c*(s*s+a*a+l*l-t*t);if(h<0){const e=Math.max(-u/2,0),c=s+n*e,h=a+r*e,d=l+o*e,p=Math.hypot(c,h,d);return i[0]=c*t/p,i[1]=h*t/p,i[2]=d*t/p,!1}{const e=(-u-Math.sqrt(h))/(2*c);if(e<0){const e=Math.hypot(s,a,l);return i[0]=s*t/e,i[1]=a*t/e,i[2]=l*t/e,!1}return i[0]=s+n*e,i[1]=a+r*e,i[2]=l+o*e,!0}}}class tl{constructor(e,t,i,n,r){this.TL=e,this.TR=t,this.BR=i,this.BL=n,this.horizon=r}static fromInvProjectionMatrix(e,t,i){const n=[-1,1,1],r=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=Oa(n,n,e),l=Oa(r,r,e),c=Oa(o,o,e),u=Oa(s,s,e);return new tl(a,l,c,u,t/i)}}class il{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,i,n){const r=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const o=Ga([],i,e),s=1/o[3]/t*r;return function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}(o,o,[s,s,n?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=Da([],Ra([],Na([],o[e[0]],o[e[1]]),Na([],o[e[2]],o[e[1]]))),i=-La(t,o[e[1]]);return t.concat(i)}));return new il(o,s)}}class nl{static fromPoints(e){const t=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const n of e)Aa(t,t,n),Pa(i,i,n);return new nl(t,i)}static applyTransform(e,t){const i=e.getCorners();for(let e=0;e<i.length;++e)Oa(i[e],i[e],t);return nl.fromPoints(i)}constructor(e,t){this.min=e,this.max=t,this.center=Ia([],Ca([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],i=Sa(this.min),n=Sa(this.max);for(let e=0;e<t.length;e++)i[e]=t[e]?this.min[e]:this.center[e],n[e]=t[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new nl(i,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let i=!0;for(let n=0;n<e.planes.length;n++){const r=e.planes[n];let o=0;for(let e=0;e<t.length;e++)o+=La(r,t[e])+r[3]>=0;if(0===o)return 0;o!==t.length&&(i=!1)}if(i)return 2;for(let t=0;t<3;t++){let i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<e.points.length;r++){const o=e.points[r][t]-this.min[t];i=Math.min(i,o),n=Math.max(n,o)}if(n<0||i>this.max[t]-this.min[t])return 0}return 1}}const rl=5,ol=6,sl=sa/Math.PI/2,al=16383,ll=64,cl=[ll,32,16],ul=-sl,hl=sl,dl=[new nl([ul,ul,ul],[hl,hl,hl]),new nl([ul,ul,ul],[0,0,hl]),new nl([0,ul,ul],[hl,0,hl]),new nl([ul,0,ul],[0,hl,hl]),new nl([0,0,ul],[hl,hl,hl])];function pl(e){return e*sl/Fl}function fl(e,t,i,n=!0){const r=Ia([],e._camera.position,e.worldSize),o=[t,i,1,1];Ga(o,o,e.pixelMatrixInverse),$a(o,o,1/o[3]);const s=Da([],Na([],o,r)),a=e.globeMatrix,l=[a[12],a[13],a[14]],c=Na([],l,r),u=Ta(c),h=Da([],c),d=e.worldSize/(2*Math.PI),p=La(h,s),f=Math.asin(d/u);if(f<Math.acos(p)){if(!n)return null;const e=[],t=[];Ia(e,s,u/p),Da(t,Na(t,e,c)),Da(s,Ca(s,c,Ia(s,t,Math.tan(f)*u)))}const m=[];new el(r,s).closestPointOnSphere(l,d,m);const g=Da([],J(a,0)),_=Da([],J(a,1)),y=Da([],J(a,2)),x=La(g,m),v=La(_,m),b=La(y,m),S=w(Math.asin(-v/d));let T=w(Math.atan2(x,b));T=e.center.lng+function(e,t){const i=(t-e+180)%360-180;return i<-180?i+360:i}(e.center.lng,T);const E=Vl(T),C=k(Gl(S),0,1);return new Kl(E,C)}class ml{constructor(e,t,i){this.a=Na([],e,i),this.b=Na([],t,i),this.center=i;const n=Da([],this.a),r=Da([],this.b);this.angle=Math.acos(La(n,r))}}function gl(e,t){if(0===e.angle)return null;let i;return i=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(e,t,i,n){const r=Math.sin(i);return e*(Math.sin((1-n)*i)/r)+t*(Math.sin(n*i)/r)}(e.a[t],e.b[t],e.angle,k(i,0,1))+e.center[t]}function _l(e){if(e.z<=1)return dl[e.z+2*e.y+e.x];const t=Sl(wl(e));return nl.fromPoints(t)}function yl(e,t,i){return Ia(e,e,1-i),za(e,e,t,i)}function xl(e,t){const i=zl(t.zoom);if(0===i)return _l(e);const n=wl(e),r=Sl(n),o=Vl(n.getWest())*t.worldSize,s=Vl(n.getEast())*t.worldSize,a=Gl(n.getNorth())*t.worldSize,l=Gl(n.getSouth())*t.worldSize,c=[o,a,0],u=[s,a,0],h=[o,l,0],d=[s,l,0],p=pa([],t.globeMatrix);return Oa(c,c,p),Oa(u,u,p),Oa(h,h,p),Oa(d,d,p),r[0]=yl(r[0],h,i),r[1]=yl(r[1],d,i),r[2]=yl(r[2],u,i),r[3]=yl(r[3],c,i),nl.fromPoints(r)}function vl(e,t,i){for(const n of e)Oa(n,n,t),Ia(n,n,i)}function bl(e,t,i){const n=t/e.worldSize,r=e.globeMatrix;if(i.z<=1){const e=_l(i).getCorners();return vl(e,r,n),nl.fromPoints(e)}const o=wl(i),s=Sl(o);vl(s,r,n);const a=Number.MAX_VALUE,l=[-a,-a,-a],c=[a,a,a];if(o.contains(e.center)){for(const e of s)Aa(c,c,e),Pa(l,l,e);l[2]=0;const t=e.point,i=[t.x*n,t.y*n,0];return Aa(c,c,i),Pa(l,l,i),new nl(c,l)}const u=[r[12]*n,r[13]*n,r[14]*n],h=o.getCenter(),d=k(e.center.lat,-Hl,Hl),p=k(h.lat,-Hl,Hl),f=Vl(e.center.lng),m=Gl(d);let g=f-Vl(h.lng);const _=m-Gl(p);g>.5?g-=1:g<-.5&&(g+=1);let y=0;Math.abs(g)>Math.abs(_)?y=g>=0?1:3:(y=_>=0?0:2,za(u,u,[r[4]*n,r[5]*n,r[6]*n],-Math.sin(b(_>=0?o.getSouth():o.getNorth()))*sl));const x=s[y],v=s[(y+1)%4],w=new ml(x,v,u),S=[gl(w,0)||x[0],gl(w,1)||x[1],gl(w,2)||x[2]],T=zl(e.zoom);if(T>0){const n=function({x:e,y:t,z:i},n,r,o,s){const a=1/(1<<i);let l=e*a,c=l+a,u=t*a,h=u+a,d=0;const p=(l+c)/2-o;return p>.5?d=-1:p<-.5&&(d=1),l=((l+d)*n-(o*=n))*r+o,c=((c+d)*n-o)*r+o,u=(u*n-(s*=n))*r+s,h=(h*n-s)*r+s,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(i,t,e._pixelsPerMercatorPixel,f,m);for(let e=0;e<s.length;e++)yl(s[e],n[e],T);const r=Ca([],n[y],n[(y+1)%4]);Ia(r,r,.5),yl(S,r,T)}for(const e of s)Aa(c,c,e),Pa(l,l,e);return c[2]=Math.min(x[2],v[2]),Aa(c,c,S),Pa(l,l,S),new nl(c,l)}function wl({x:e,y:t,z:i}){const n=1/(1<<i),r=new Ul(ql(e*n),Xl((t+1)*n)),o=new Ul(ql((e+1)*n),Xl(t*n));return new aa(r,o)}function Sl(e){const t=b(e.getNorth()),i=b(e.getSouth()),n=Math.cos(t),r=Math.cos(i),o=Math.sin(t),s=Math.sin(i),a=e.getWest(),l=e.getEast();return[Tl(r,s,a),Tl(r,s,l),Tl(n,o,l),Tl(n,o,a)]}function Tl(e,t,i,n=sl){return i=b(i),[e*Math.sin(i)*n,-t*n,e*Math.cos(i)*n]}function El(e,t,i){return Tl(Math.cos(b(e)),Math.sin(b(e)),t,i)}function Cl(e,t,i,n){const r=1<<i.z,o=(e/sa+i.x)/r;return El(Xl((t/sa+i.y)/r),ql(o),n)}function kl({min:e,max:t}){return al/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const Ml=new Float64Array(16);function Al(e){const t=kl(e),i=xa(Ml,[t,t,t]);return ma(i,i,((n=[])[0]=-(r=e.min)[0],n[1]=-r[1],n[2]=-r[2],n));var n,r}function Pl(e){const t=(n=e.min,(i=Ml)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i);var i,n;const r=1/kl(e);return ga(t,t,[r,r,r])}function Il(e,t,i,n,r){const o=function(e){const t=sa/(2*Math.PI);return e/(2*Math.PI)/t}(i),s=[e,t,-i/(2*Math.PI)],a=da(new Float64Array(16));return ma(a,a,s),ga(a,a,[o,o,o]),_a(a,a,b(-r)),ya(a,a,b(-n)),a}function zl(e){return M(rl,ol,e)}function Dl(e,t){const i=El(t.lat,t.lng),n=function(e){const t=El(e._center.lat,e._center.lng);let i=Ra([],Ea(0,1,0),t);const n=va([],-e.angle,t);i=Oa(i,i,n),va(n,-e._pitch,i);const r=Da([],t);return Ia(r,r,pl(e.cameraToCenterDistance/e.pixelsPerMeter)),Oa(r,r,n),Ca([],t,r)}(e);return s=(r=ka([],n,i))[0],a=r[1],l=r[2],c=(o=i)[0],u=o[1],h=o[2],p=(d=Math.sqrt(s*s+a*a+l*l)*Math.sqrt(c*c+u*u+h*h))&&La(r,o)/d,Math.acos(Math.min(Math.max(p,-1),1));var r,o,s,a,l,c,u,h,d,p}function Ll(e,t){return Dl(e,t)>Math.PI/2*1.01}const Rl=b(85),Ol=Math.cos(Rl),Bl=Math.sin(Rl),Fl=6371008.8,Nl=2*Math.PI*Fl;class jl{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new jl(A(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,n=e.lat*t,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return Fl*Math.acos(Math.min(r,1))}toBounds(e=0){const t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new aa(new jl(this.lng-i,this.lat-t),new jl(this.lng+i,this.lat+t))}toEcef(e){const t=pl(e);return El(this.lat,this.lng,sl+t)}static convert(e){if(e instanceof jl)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new jl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new jl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ul=jl;function $l(e){return Nl*Math.cos(e*Math.PI/180)}function Vl(e){return(180+e)/360}function Gl(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Wl(e,t){return e/$l(t)}function ql(e){return 360*e-180}function Xl(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Zl(e,t){return e*$l(Xl(t))}const Hl=85.051129;function Yl(e){return 1/Math.cos(e*Math.PI/180)}class Kl{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){const i=Ul.convert(e);return new Kl(Vl(i.lng),Gl(i.lat),Wl(t,i.lat))}toLngLat(){return new Ul(ql(this.x),Xl(this.y))}toAltitude(){return Zl(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Nl*Yl(Xl(this.y))}}function Jl(e,t,i,n,r,o,s,a,l){const c=(t+n)/2,u=(i+r)/2,h=new y(c,u);a(h),function(e,t,i,n,r,o){const s=i-r,a=n-o;return Math.abs((n-t)*s-(i-e)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(Jl(e,t,i,c,u,o,h,a,l),Jl(e,c,u,n,r,h,s,a,l)):e.push(s)}function Ql(e,t,i){let n=e[0],r=n.x,o=n.y;t(n);const s=[n];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),Jl(s,r,o,c,u,n,l,t,i),r=c,o=u,n=l}return s}function ec(e,t,i,n){if(n(t,i)){const r=t.add(i)._mult(.5);ec(e,t,r,n),ec(e,r,i,n)}else e.push(i)}function tc(e,t){let i=e[0];const n=[i];for(let r=1;r<e.length;r++){const o=e[r];ec(n,i,o,t),i=o}return n}const ic=Math.pow(2,14)-1,nc=-ic-1;function rc(e,t){const i=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=k(i,nc,ic),e.y=k(n,nc,ic),(i<e.x||i>e.x+1||n<e.y||n>e.y+1)&&G("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function oc(e,t,i){const n=e.loadGeometry(),r=e.extent,o=sa/r;if(t&&i&&i.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=i,u=e=>{const i=ql((t.x+e.x/r)/o),n=Xl((t.y+e.y/r)/o),u=c.project(i,n);e.x=(u.x*s-a)*r,e.y=(u.y*s-l)*r};for(let t=0;t<n.length;t++)if(1!==e.type)n[t]=Ql(n[t],u,1);else{const e=[];for(const i of n[t])i.x<0||i.x>=r||i.y<0||i.y>=r||(u(i),e.push(i));n[t]=e}}for(const e of n)for(const t of e)rc(t,o);return n}function sc(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?oc(e):[]}}function ac(e,t,i,n,r){e.emplaceBack(2*t+(n+1)/2,2*i+(r+1)/2)}function lc(e,t,i){const n=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*n,i[1]*n,i[2]*n)}class cc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Uo,this.indexArray=new ns,this.segments=new oa,this.programConfigurations=new Hs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,n){const r=this.layers[0],o=[];let s=null;"circle"===r.type&&(s=r.layout.get("circle-sort-key"));for(const{feature:t,id:r,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=sc(t,e);if(!this.layers[0]._featureFilter.filter(new wo(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,h={id:r,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:oc(t,i,n),patterns:{},sortKey:u};o.push(h)}s&&o.sort(((e,t)=>e.sortKey-t.sortKey));let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Zo,a=n.projection);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n,l=e[o].feature;this.addFeature(n,r,o,t.availableImages,i,a),t.featureIndex.insert(l,r,o,s,this.index)}}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,na.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ra.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,i,n,r,o){for(const i of t)for(const t of i){const i=t.x,n=t.y;if(i<0||i>=sa||n<0||n>=sa)continue;if(o){const e=o.projectTilePoint(i,n,r),t=o.upVector(r,i,n),s=this.globeExtVertexArray;lc(s,e,t),lc(s,e,t),lc(s,e,t),lc(s,e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;ac(this.layoutVertexArray,i,n,-1,-1),ac(this.layoutVertexArray,i,n,1,-1),ac(this.layoutVertexArray,i,n,1,1),ac(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},n,r)}}function uc(e,t){for(let i=0;i<e.length;i++)if(xc(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(xc(e,t[i]))return!0;return!!fc(e,t)}function hc(e,t,i){return!!xc(e,t)||!!gc(t,e,i)}function dc(e,t){if(1===e.length)return yc(t,e[0]);for(let i=0;i<t.length;i++){const n=t[i];for(let t=0;t<n.length;t++)if(xc(e,n[t]))return!0}for(let i=0;i<e.length;i++)if(yc(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(fc(e,t[i]))return!0;return!1}function pc(e,t,i){if(e.length>1){if(fc(e,t))return!0;for(let n=0;n<t.length;n++)if(gc(t[n],e,i))return!0}for(let n=0;n<e.length;n++)if(gc(e[n],t,i))return!0;return!1}function fc(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1];for(let e=0;e<t.length-1;e++)if(mc(n,r,t[e],t[e+1]))return!0}return!1}function mc(e,t,i,n){return W(e,i,n)!==W(t,i,n)&&W(e,t,i)!==W(e,t,n)}function gc(e,t,i){const n=i*i;if(1===t.length)return e.distSqr(t[0])<n;for(let i=1;i<t.length;i++)if(_c(e,t[i-1],t[i])<n)return!0;return!1}function _c(e,t,i){const n=t.distSqr(i);if(0===n)return e.distSqr(t);const r=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;return e.distSqr(r<0?t:r>1?i:i.sub(t)._mult(r)._add(t))}function yc(e,t){let i,n,r,o=!1;for(let s=0;s<e.length;s++){i=e[s];for(let e=0,s=i.length-1;e<i.length;s=e++)n=i[e],r=i[s],n.y>t.y!=r.y>t.y&&t.x<(r.x-n.x)*(t.y-n.y)/(r.y-n.y)+n.x&&(o=!o)}return o}function xc(e,t){let i=!1;for(let n=0,r=e.length-1;n<e.length;r=n++){const o=e[n],s=e[r];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function vc(e,t,i,n,r){for(const o of e)if(t<=o.x&&i<=o.y&&n>=o.x&&r>=o.y)return!0;const o=[new y(t,i),new y(t,r),new y(n,r),new y(n,i)];if(e.length>2)for(const t of o)if(xc(e,t))return!0;for(let t=0;t<e.length-1;t++)if(bc(e[t],e[t+1],o))return!0;return!1}function bc(e,t,i){const n=i[0],r=i[2];if(e.x<n.x&&t.x<n.x||e.x>r.x&&t.x>r.x||e.y<n.y&&t.y<n.y||e.y>r.y&&t.y>r.y)return!1;const o=W(e,t,i[0]);return o!==W(e,t,i[1])||o!==W(e,t,i[2])||o!==W(e,t,i[3])}function wc(e,t,i){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:i.programConfigurations.get(t.id).getMaxValue(e)}function Sc(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Tc(e,t,i,n,r){if(!t[0]&&!t[1])return e;const o=y.convert(t)._mult(r);"viewport"===i&&o._rotate(-n);const s=[];for(let t=0;t<e.length;t++)s.push(e[t].sub(o));return s}function Ec(e,t,i,n){const r=y.convert(e)._mult(n);return"viewport"===t&&r._rotate(-i),r}Hr(cc,"CircleBucket",{omit:["layers"]});const Cc=new Lo({"circle-sort-key":new zo(et.layout_circle["circle-sort-key"])});var kc={paint:new Lo({"circle-radius":new zo(et.paint_circle["circle-radius"]),"circle-color":new zo(et.paint_circle["circle-color"]),"circle-blur":new zo(et.paint_circle["circle-blur"]),"circle-opacity":new zo(et.paint_circle["circle-opacity"]),"circle-translate":new Io(et.paint_circle["circle-translate"]),"circle-translate-anchor":new Io(et.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Io(et.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Io(et.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zo(et.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zo(et.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zo(et.paint_circle["circle-stroke-opacity"])}),layout:Cc};function Mc(e,t,i,n,r,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),d=r&&i.elevation?i.elevation.exaggeration()*r.getElevationAt(h.x,h.y,!0):0,p=i.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=i.projection.upVector(c,h.x,h.y);p.x+=e[0]*u*d,p.y+=e[1]*u*d,p.z+=e[2]*u*d}const f=o?h:Ac(p.x,p.y,p.z,n),m=o?e.tilespaceRays.map((e=>zc(e,d))):e.queryGeometry.screenGeometry,g=Ga([],[p.x,p.y,p.z,1],n);if(!s&&o?l*=g[3]/i.cameraToCenterDistance:s&&!o&&(l*=i.cameraToCenterDistance/g[3]),o){const e=Xl((t.y/sa+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(e,1)/Wl(1,e)}if(hc(m,f,l))return!0}return!1}function Ac(e,t,i,n){const r=Ga([],[e,t,i,1],n);return new y(r[0]/r[3],r[1]/r[3])}const Pc=Ea(0,0,0),Ic=Ea(0,0,1);function zc(e,t){const i=wa();return Pc[2]=t,e.intersectsPlane(Pc,Ic,i),new y(i[0],i[1])}class Dc extends cc{}function Lc(e,{width:t,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(t*i*n);return e.width=t,e.height=i,e.data=r,e}function Rc(e,t,i){const{width:n,height:r}=t;n===e.width&&r===e.height||(Oc(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,r)},i),e.width=n,e.height=r,e.data=t.data)}function Oc(e,t,i,n,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let l=0;l<r.height;l++){const c=((i.y+l)*e.width+i.x)*o,u=((n.y+l)*t.width+n.x)*o;for(let e=0;e<r.width*o;e++)a[u+e]=s[c+e]}return t}Hr(Dc,"HeatmapBucket",{omit:["layers"]});class Bc{constructor(e,t){Lc(this,e,1,t)}resize(e){Rc(this,new Bc(e),1)}clone(){return new Bc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){Oc(e,t,i,n,r,1)}}class Fc{constructor(e,t){Lc(this,e,4,t)}resize(e){Rc(this,new Fc(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){Oc(e,t,i,n,r,4)}}Hr(Bc,"AlphaImage"),Hr(Fc,"RGBAImage");var Nc={paint:new Lo({"heatmap-radius":new zo(et.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zo(et.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Io(et.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Do(et.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Io(et.paint_heatmap["heatmap-opacity"])})};function jc(e){const t={},i=e.resolution||256,n=e.clips?e.clips.length:1,r=e.image||new Fc({width:i,height:n}),o=(i,n,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);r.data[i+n+0]=Math.floor(255*s.r/s.a),r.data[i+n+1]=Math.floor(255*s.g/s.a),r.data[i+n+2]=Math.floor(255*s.b/s.a),r.data[i+n+3]=Math.floor(255*s.a)};if(e.clips)for(let t=0,r=0;t<n;++t,r+=4*i)for(let n=0,s=0;n<i;n++,s+=4){const a=n/(i-1),{start:l,end:c}=e.clips[t];o(r,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<i;e++,t+=4)o(0,t,e/(i-1));return r}var Uc={paint:new Lo({"hillshade-illumination-direction":new Io(et.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Io(et.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Io(et.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Io(et.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Io(et.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Io(et.paint_hillshade["hillshade-accent-color"])})};const $c=No([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vc}=$c;var Gc={exports:{}};function Wc(e,t,i){i=i||2;var n,r,o,s,a,l,c,u=t&&t.length,h=u?t[0]*i:e.length,d=qc(e,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,i,n){var r,o,s,a=[];for(r=0,o=t.length;r<o;r++)(s=qc(e,t[r]*n,r<o-1?t[r+1]*n:e.length,n,!1))===s.next&&(s.steiner=!0),a.push(nu(s));for(a.sort(Qc),r=0;r<a.length;r++)i=eu(a[r],i);return i}(e,t,d,i)),e.length>80*i){n=o=e[0],r=s=e[1];for(var f=i;f<h;f+=i)(a=e[f])<n&&(n=a),(l=e[f+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-n,s-r))?32767/c:0}return Zc(d,p,i,n,r,c,0),p}function qc(e,t,i,n,r){var o,s;if(r===gu(e,t,i,n)>0)for(o=t;o<i;o+=n)s=pu(o,e[o],e[o+1],s);else for(o=i-n;o>=t;o-=n)s=pu(o,e[o],e[o+1],s);return s&&au(s,s.next)&&(fu(s),s=s.next),s}function Xc(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!au(n,n.next)&&0!==su(n.prev,n,n.next))n=n.next;else{if(fu(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function Zc(e,t,i,n,r,o,s){if(e){!s&&o&&function(e,t,i,n){var r=e;do{0===r.z&&(r.z=iu(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,o,s,a,l,c=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(s>1)}(r)}(e,n,r,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Yc(e,n,r,o):Hc(e))t.push(a.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),fu(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Zc(e=Kc(Xc(e),t,i),t,i,n,r,o,2):2===s&&Jc(e,t,i,n,r,o):Zc(Xc(e),t,i,n,r,o,1);break}}}function Hc(e){var t=e.prev,i=e,n=e.next;if(su(t,i,n)>=0)return!1;for(var r=t.x,o=i.x,s=n.x,a=t.y,l=i.y,c=n.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=n.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&ru(r,a,o,l,s,c,f.x,f.y)&&su(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Yc(e,t,i,n){var r=e.prev,o=e,s=e.next;if(su(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,_=iu(p,f,t,i,n),y=iu(m,g,t,i,n),x=e.prevZ,v=e.nextZ;x&&x.z>=_&&v&&v.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&ru(a,u,l,h,c,d,x.x,x.y)&&su(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&ru(a,u,l,h,c,d,v.x,v.y)&&su(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;x&&x.z>=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&ru(a,u,l,h,c,d,x.x,x.y)&&su(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;v&&v.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&ru(a,u,l,h,c,d,v.x,v.y)&&su(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Kc(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!au(r,o)&&lu(r,n,n.next,o)&&hu(r,o)&&hu(o,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(o.i/i|0),fu(n),fu(n.next),n=e=o),n=n.next}while(n!==e);return Xc(n)}function Jc(e,t,i,n,r,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&ou(s,a)){var l=du(s,a);return s=Xc(s,s.next),l=Xc(l,l.next),Zc(s,t,i,n,r,o,0),void Zc(l,t,i,n,r,o,0)}a=a.next}s=s.next}while(s!==e)}function Qc(e,t){return e.x-t.x}function eu(e,t){var i=function(e,t){var i,n=t,r=e.x,o=e.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,i=n.x<n.next.x?n:n.next,a===r))return i}n=n.next}while(n!==t);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&ru(o<h?r:s,o,u,h,o<h?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),hu(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&tu(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(e,t);if(!i)return t;var n=du(i,e);return Xc(n,n.next),Xc(i,i.next)}function tu(e,t){return su(e.prev,e,t.prev)<0&&su(t.next,e,e.next)<0}function iu(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function nu(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function ru(e,t,i,n,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(n-a)>=(i-s)*(t-a)&&(i-s)*(o-a)>=(r-s)*(n-a)}function ou(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&lu(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(hu(e,t)&&hu(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(su(e.prev,e,t.prev)||su(e,t.prev,t))||au(e,t)&&su(e.prev,e,e.next)>0&&su(t.prev,t,t.next)>0)}function su(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function au(e,t){return e.x===t.x&&e.y===t.y}function lu(e,t,i,n){var r=uu(su(e,t,i)),o=uu(su(e,t,n)),s=uu(su(i,n,e)),a=uu(su(i,n,t));return r!==o&&s!==a||!(0!==r||!cu(e,i,t))||!(0!==o||!cu(e,n,t))||!(0!==s||!cu(i,e,n))||!(0!==a||!cu(i,t,n))}function cu(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function uu(e){return e>0?1:e<0?-1:0}function hu(e,t){return su(e.prev,e,e.next)<0?su(e,t,e.next)>=0&&su(e,e.prev,t)>=0:su(e,t,e.prev)<0||su(e,e.next,t)<0}function du(e,t){var i=new mu(e.i,e.x,e.y),n=new mu(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function pu(e,t,i,n){var r=new mu(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function fu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function mu(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gu(e,t,i,n){for(var r=0,o=t,s=i-n;o<i;o+=n)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}Gc.exports=Wc,Gc.exports.default=Wc,Wc.deviation=function(e,t,i,n){var r=t&&t.length,o=Math.abs(gu(e,0,r?t[0]*i:e.length,i));if(r)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(gu(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i));var l=0;for(s=0;s<n.length;s+=3){var c=n[s]*i,u=n[s+1]*i,h=n[s+2]*i;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Wc.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[r][o][s]);r>0&&i.holes.push(n+=e[r-1].length)}return i};var _u=d(Gc.exports);function yu(e,t,i,n,r){xu(e,t,i||0,n||e.length-1,r||bu)}function xu(e,t,i,n,r){for(;n>i;){if(n-i>600){var o=n-i+1,s=t-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);xu(e,t,Math.max(i,Math.floor(t-s*l/o+c)),Math.min(n,Math.floor(t+(o-s)*l/o+c)),r)}var u=e[t],h=i,d=n;for(vu(e,i,t),r(e[n],u)>0&&vu(e,i,n);h<d;){for(vu(e,h,d),h++,d--;r(e[h],u)<0;)h++;for(;r(e[d],u)>0;)d--}0===r(e[i],u)?vu(e,i,d):vu(e,++d,n),d<=t&&(i=d+1),t<=d&&(n=d-1)}}function vu(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function bu(e,t){return e<t?-1:e>t?1:0}function wu(e,t){const i=e.length;if(i<=1)return[e];const n=[];let r,o;for(let t=0;t<i;t++){const i=q(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(r&&n.push(r),r=[e[t]]):r.push(e[t]))}if(r&&n.push(r),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(yu(n[e],t,1,n[e].length-1,Su),n[e]=n[e].slice(0,t));return n}function Su(e,t){return t.area-e.area}function Tu(e,t,i){const n=i.patternDependencies;let r=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`);t.isConstant()||(r=!0);const o=t.constantOr(null);o&&(r=!0,n[o]=!0)}return r}function Eu(e,t,i,n,r){const o=r.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n},i,{},r.availableImages);e=e&&e.name?e.name:e,o[e]=!0,i.patterns[s.id]=e}}return i}class Cu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Uo,this.indexArray=new ns,this.indexArray2=new cs,this.programConfigurations=new Hs(e.layers,e.zoom),this.segments=new oa,this.segments2=new oa,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,i,n){this.hasPattern=Tu("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=sc(s,e);if(!this.layers[0]._featureFilter.filter(new wo(this.zoom),u,i))continue;const h=r?r.evaluate(u,{},i,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:oc(s,i,n),patterns:{},sortKey:h};o.push(d)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n;if(this.hasPattern){const e=Eu("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,r,o,i,{},t.availableImages);t.featureIndex.insert(e[o].feature,r,o,s,this.index)}}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}addFeatures(e,t,i,n,r){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vc),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,n,r,o=[]){for(const e of wu(t,500)){let t=0;for(const i of e)t+=i.length;const i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=i.vertexLength,r=[],o=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&o.push(r.length/2);const i=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),n=i.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(n+t.length-1,n),r.push(t[0].x),r.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),r.push(t[e].x),r.push(t[e].y);i.vertexLength+=t.length,i.primitiveLength+=t.length}const s=_u(r,o);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(n+s[e],n+s[e+1],n+s[e+2]);i.vertexLength+=t,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,o,n)}}Hr(Cu,"FillBucket",{omit:["layers","patternFeatures"]});const ku=new Lo({"fill-sort-key":new zo(et.layout_fill["fill-sort-key"])});var Mu={paint:new Lo({"fill-antialias":new Io(et.paint_fill["fill-antialias"]),"fill-opacity":new zo(et.paint_fill["fill-opacity"]),"fill-color":new zo(et.paint_fill["fill-color"]),"fill-outline-color":new zo(et.paint_fill["fill-outline-color"]),"fill-translate":new Io(et.paint_fill["fill-translate"]),"fill-translate-anchor":new Io(et.paint_fill["fill-translate-anchor"]),"fill-pattern":new zo(et.paint_fill["fill-pattern"])}),layout:ku};const Au=No([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Pu=No([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Iu=No([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:zu}=Au;var Du={},Lu=g,Ru=Ou;function Ou(e,t,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=r,e.readFields(Bu,this,t)}function Bu(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var n=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[n]=r}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function Fu(e){for(var t,i,n=0,r=0,o=e.length,s=o-1;r<o;s=r++)n+=((i=e[s]).x-(t=e[r]).x)*(t.y+i.y);return n}Ou.types=["Unknown","Point","LineString","Polygon"],Ou.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,n=1,r=0,o=0,s=0,a=[];e.pos<i;){if(r<=0){var l=e.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)o+=e.readSVarint(),s+=e.readSVarint(),1===n&&(t&&a.push(t),t=[]),t.push(new Lu(o,s));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&a.push(t),a},Ou.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,n=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(n<=0){var u=e.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=e.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},Ou.prototype.toGeoJSON=function(e,t,i){var n,r,o=this.extent*Math.pow(2,i),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=Ou.types[this.type];function u(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];u(l=h);break;case 2:for(n=0;n<l.length;n++)u(l[n]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,n,r=[],o=0;o<t;o++){var s=Fu(e[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(i&&r.push(i),i=[e[o]]):i.push(e[o]))}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)u(l[n][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Nu=Ru,ju=Uu;function Uu(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields($u,this,t),this.length=this._features.length}function $u(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(i))}Uu.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Nu(this._pbf,t,this.extent,this._keys,this._values)};var Vu=ju;function Gu(e,t,i){if(3===e){var n=new Vu(i,i.readVarint()+i.pos);n.length&&(t[n.name]=n)}}var Wu=Du.VectorTile=function(e,t){this.layers=e.readFields(Gu,{},t)},qu=Du.VectorTileFeature=Ru;function Xu(e,t,i,n){const r=[],o=0===n?(e,t,i,n,r,o)=>{e.push(new y(o,i+(o-t)/(n-t)*(r-i)))}:(e,t,i,n,r,o)=>{e.push(new y(t+(o-i)/(r-i)*(n-t),o))};for(const s of e){const e=[];for(const r of s){if(r.length<=2)continue;const s=[];for(let e=0;e<r.length-1;e++){const a=r[e].x,l=r[e].y,c=r[e+1].x,u=r[e+1].y,h=0===n?a:l,d=0===n?c:u;h<t?d>t&&o(s,a,l,c,u,t):h>i?d<i&&o(s,a,l,c,u,i):s.push(r[e]),d<t&&h>=t&&o(s,a,l,c,u,t),d>i&&h<=i&&o(s,a,l,c,u,i)}let a=r[r.length-1];const l=0===n?a.x:a.y;l>=t&&l<=i&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),e.push(s))}e.length&&r.push(e)}return r}Du.VectorTileLayer=ju;const Zu=qu.types,Hu=Math.pow(2,13);function Yu(e,t,i,n,r,o,s,a){e.emplaceBack((t<<1)+s,(i<<1)+o,(Math.floor(n*Hu)<<1)+r,Math.round(a))}function Ku(e,t,i){const n=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*n,i[1]*n,i[2]*n)}class Ju{constructor(){this.acc=new y(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new y(e.x,e.y),this.max=new y(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const i=this.min,n=this.max;e.x<i.x?i.x=e.x:e.x>n.x&&(n.x=e.x),e.y<i.y?i.y=e.y:e.y>n.y&&(n.y=e.y),((0===e.x||e.x===sa)&&e.x===t.x)!=((0===e.y||e.y===sa)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,Ii(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>sa!=e.x>sa&&this.addBorderIntersection(1,Ii(t.y,e.y,(sa-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Ii(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>sa!=e.y>sa&&this.addBorderIntersection(3,Ii(t.x,e.x,(sa-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}centroid(){const e=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==e?this.acc.div(e)._round():new y(0,0)}span(){return new y(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class Qu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Vo,this.centroidVertexArray=new ws,this.indexArray=new ns,this.programConfigurations=new Hs(e.layers,e.zoom),this.segments=new oa,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,i,n){this.features=[],this.hasPattern=Tu("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(e){const t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/sa/(1<<e.z)}(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:r,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=sc(r,e);if(!this.layers[0]._featureFilter.filter(new wo(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:oc(r,i,n),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Eu("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,s,i,{},t.availableImages,n),t.featureIndex.insert(r,c.geometry,s,a,this.index,u)}this.sortBorders()}addFeatures(e,t,i,n,r){for(const e of this.features){const{geometry:o}=e;this.addFeature(e,o,e.index,t,i,n,r)}this.sortBorders()}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Iu.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Pu.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,n,r,o,s){const a=[new y(0,0),new y(sa,sa)],l=s.projection,c="globe"===l.name,u=this.enableTerrain&&!c?new Ju:null,h="Polygon"===Zu[e.type];c&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Zo);const d=wu(t,500);for(let e=d.length-1;e>=0;e--){const t=d[e];(0===t.length||(p=t[0]).every((e=>e.x<=0))||p.every((e=>e.x>=sa))||p.every((e=>e.y<=0))||p.every((e=>e.y>=sa)))&&d.splice(e,1)}var p;let f;if(c)f=ah(d,a,n);else{f=[];for(const e of d)f.push({polygon:e,bounds:a})}const m=h?this.edgeRadius:0;for(const{polygon:e,bounds:t}of f){let i=0,r=0;for(const t of e)h&&!t[0].equals(t[t.length-1])&&t.push(t[0]),r+=h?t.length-1:t.length;const o=this.segments.prepareSegment((h?5:4)*r,this.layoutVertexArray,this.indexArray);if(h){const t=[],r=[];i=o.vertexLength;for(const i of e){let s,a;i.length&&i!==e[0]&&r.push(t.length/2),s=i[1].sub(i[0])._perp()._unit();for(let e=1;e<i.length;e++){const r=i[e],u=i[e===i.length-1?1:e+1];let{x:h,y:d}=r;if(m){a=u.sub(r)._perp()._unit();const e=s.add(a)._unit(),t=m*Math.min(4,1/(s.x*e.x+s.y*e.y));h+=t*e.x,d+=t*e.y,s=a}Yu(this.layoutVertexArray,h,d,0,0,1,1,0),o.vertexLength++,t.push(r.x,r.y),c&&Ku(this.layoutVertexExtArray,l.projectTilePoint(h,d,n),l.upVector(n,h,d))}}const s=_u(t,r);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(i+s[e],i+s[e+2],i+s[e+1]),o.primitiveLength++}for(const r of e){u&&r.length&&u.startRing(r[0]);let e,s,a,d=r.length>4&&rh(r[r.length-2],r[0],r[1]),p=m?th(r[r.length-2],r[0],r[1],m):0;s=r[1].sub(r[0])._perp()._unit();let f=!0;for(let g=1,_=0;g<r.length;g++){let y=r[g-1],x=r[g];const v=r[g===r.length-1?1:g+1];if(u&&h&&u.currentPolyCount.top++,nh(x,y,t)){m&&(s=v.sub(x)._perp()._unit(),f=!f);continue}u&&u.append(x,y);const b=x.sub(y)._perp(),w=b.x/(Math.abs(b.x)+Math.abs(b.y)),S=b.y>0?1:0,T=y.dist(x);if(_+T>32768&&(_=0),m){a=v.sub(x)._perp()._unit();let e=ih(y,x,v,eh(s,a),m);isNaN(e)&&(e=0);const t=x.sub(y)._unit();y=y.add(t.mult(p))._round(),x=x.add(t.mult(-e))._round(),p=e,s=a}const E=o.vertexLength,C=r.length>4&&rh(y,x,v);let k=oh(_,d,f);if(Yu(this.layoutVertexArray,y.x,y.y,w,S,0,0,k),Yu(this.layoutVertexArray,y.x,y.y,w,S,0,1,k),_+=T,k=oh(_,C,!f),d=C,Yu(this.layoutVertexArray,x.x,x.y,w,S,0,0,k),Yu(this.layoutVertexArray,x.x,x.y,w,S,0,1,k),o.vertexLength+=4,this.indexArray.emplaceBack(E+0,E+1,E+2),this.indexArray.emplaceBack(E+1,E+3,E+2),o.primitiveLength+=2,m){const n=i+(1===g?r.length-2:g-2),s=1===g?i:n+1;if(this.indexArray.emplaceBack(E+1,n,E+3),this.indexArray.emplaceBack(n,s,E+3),o.primitiveLength+=2,void 0===e&&(e=E),!nh(v,r[g],t)){const t=g===r.length-1?e:o.vertexLength;this.indexArray.emplaceBack(E+2,E+3,t),this.indexArray.emplaceBack(E+3,t+1,t),this.indexArray.emplaceBack(E+3,s,t+1),o.primitiveLength+=3}f=!f}if(c){const e=this.layoutVertexExtArray,t=l.projectTilePoint(y.x,y.y,n),i=l.projectTilePoint(x.x,x.y,n),r=l.upVector(n,y.x,y.y),o=l.upVector(n,x.x,x.y);Ku(e,t,r),Ku(e,t,r),Ku(e,i,o),Ku(e,i,o)}}h&&(i+=r.length-1)}}if(u&&u.polyCount.length>0){if(u.borders){u.vertexArrayOffset=this.centroidVertexArray.length;const e=u.borders,t=this.featuresOnBorder.push(u)-1;for(let i=0;i<4;i++)e[i][0]!==Number.MAX_VALUE&&this.borders[i].push(t)}this.encodeCentroid(u.borders?void 0:u.centroid(),u)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,o,n)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,i)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}encodeCentroid(e,t,i=!0){let n,r;if(e)if(0!==e.y){const i=t.span()._mult(this.tileToMeter);n=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(i.x/10)),r=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(i.y/10))}else n=Math.ceil(7*(e.x+450)),r=0;else n=0,r=+i;let o=i?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(o++,n,r);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(o++,0,r),this.centroidVertexArray.emplace(o++,n,r)}}}function eh(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function th(e,t,i,n){const r=t.sub(e)._perp()._unit(),o=i.sub(t)._perp()._unit();return ih(e,t,i,eh(r,o),n)}function ih(e,t,i,n,r){const o=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(i)/3,r*o/n)}function nh(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function rh(e,t,i){if(e.x<0||e.x>=sa||t.x<0||t.x>=sa||i.x<0||i.x>=sa)return!1;const n=i.sub(t),r=n.perp(),o=e.sub(t);return(n.x*o.x+n.y*o.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(o.x*o.x+o.y*o.y))>-.866&&r.x*o.x+r.y*o.y<0}function oh(e,t,i){const n=t?2|e:-3&e;return i?1|n:-2&n}function sh(){const e=Math.PI/32,t=Math.tan(e),i=Fl;return i*Math.sqrt(1+2*t*t)-i}function ah(e,t,i){const n=1<<i.z,r=ql(i.x/n),o=ql((i.x+1)/n),s=Xl(i.y/n),a=Xl((i.y+1)/n);return function(e,t,i,n,r=0,o){const s=[];if(!e.length||!i||!n)return s;const a=(e,t)=>{for(const i of e)s.push({polygon:i,bounds:t})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(n)),u=l-c,h=[];for(let e=0;e<Math.abs(u);e++)h.push(u>0?0:1);for(let e=0;e<Math.min(l,c);e++)h.push(0),h.push(1);let d=e;if(d=Xu(d,t[0].y-r,t[1].y+r,1),d=Xu(d,t[0].x-r,t[1].x+r,0),!d.length)return s;const p=[];for(h.length?p.push({polygons:d,bounds:t,depth:0}):a(d,t);p.length;){const e=p.pop(),t=e.depth,i=h[t],n=e.bounds[0],s=e.bounds[1],l=0===i?n.x:n.y,c=0===i?s.x:s.y,u=o?o(i,l,c):.5*(l+c),d=Xu(e.polygons,l-r,u+r,i),f=Xu(e.polygons,u-r,c+r,i);if(d.length){const e=[n,new y(0===i?u:s.x,1===i?u:s.y)];h.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):a(d,e)}if(f.length){const e=[new y(0===i?u:n.x,1===i?u:n.y),s];h.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):a(f,e)}}return s}(e,t,Math.ceil((o-r)/11.25),Math.ceil((s-a)/11.25),1,((e,t,r)=>{if(0===e)return.5*(t+r);{const e=Xl((i.y+t/sa)/n);return(Gl(.5*(Xl((i.y+r/sa)/n)+e))*n-i.y)*sa}}))}Hr(Qu,"FillExtrusionBucket",{omit:["layers","features"]}),Hr(Ju,"PartMetadata");const lh=new Lo({"fill-extrusion-edge-radius":new Io(et["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var ch={paint:new Lo({"fill-extrusion-opacity":new Io(et["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zo(et["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Io(et["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Io(et["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zo(et["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zo(et["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zo(et["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Io(et["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Io(et["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Io(et["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Io(et["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:lh};function uh(e,t,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}class hh{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=fh(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const i=function(e,t,i){var n=uh(256*e,256*(t=Math.pow(2,i)-t-1),i),r=uh(256*(e+1),256*(t+1),i);return n[0]+","+n[1]+","+r[0]+","+r[1]}(this.x,this.y,this.z),n=function(e,t,i){let n,r="";for(let o=e;o>0;o--)n=1<<o-1,r+=(t&n?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=fh(e,t.z,t.z,t.x,t.y)}}class ph{constructor(e,t,i,n,r){this.overscaledZ=e,this.wrap=t,this.canonical=new hh(i,+n,+r),this.key=0===t&&e===i?this.canonical.key:fh(t,e,i,n,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new ph(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ph(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return fh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return fh(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new ph(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new ph(t,this.wrap,t,i,n),new ph(t,this.wrap,t,i+1,n),new ph(t,this.wrap,t,i,n+1),new ph(t,this.wrap,t,i+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ph(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ph(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function fh(e,t,i,n,r){const o=1<<Math.min(i,22);let s=o*(r%o)+n%o;return e&&i<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*s+i)+(t-i)}Hr(hh,"CanonicalTileID"),Hr(ph,"OverscaledTileID",{omit:["projMatrix"]});class mh extends y{constructor(e,t,i){super(e,t),this.z=i}}function gh(e,t){return e.x*t.x+e.y*t.y}function _h(e,t){if(1===e.length){let i=0;const n=t[i++];let r;for(;!r||n.equals(r);)if(r=t[i++],!r)return 1/0;for(;i<t.length;i++){const o=t[i],s=e[0],a=r.sub(n),l=o.sub(n),c=s.sub(n),u=gh(a,a),h=gh(a,l),d=gh(l,l),p=gh(c,a),f=gh(c,l),m=u*d-h*h,g=(d*p-h*f)/m,_=(u*f-h*p)/m,y=n.z*(1-g-_)+r.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}function yh(e,t,i,n,r,o,s,a){const l=s*r.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,i){const n=Math.floor(t[0]/8),r=Math.floor(t[1]/8),o=10*(t[0]-8*n),s=10*(t[1]-8*r),a=e.getElevationAt(n,r,!0,!0),l=e.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(n,r),d=2*c+1,p=2*u+1,f=function(e,t,i,n,r){return[e.getElevationAtPixel(t,i,!0),e.getElevationAtPixel(t+r,i,!0),e.getElevationAtPixel(t,i+r,!0),e.getElevationAtPixel(t+n,i+r,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/d),x=Math.min(.25,.5*l*_/p);return a+Math.max(y*o,x*s)}(r,o,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+n,l+i+2):l+n}}const xh=No([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:vh}=xh,bh=No([{name:"a_packed",components:4,type:"Float32"}]),{members:wh}=bh,Sh=qu.types,Th=Math.cos(Math.PI/180*37.5);class Eh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Go,this.layoutVertexArray2=new Wo,this.indexArray=new ns,this.programConfigurations=new Hs(e.layers,e.zoom),this.segments=new oa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,n){this.hasPattern=Tu("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:t,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=sc(t,e);if(!this.layers[0]._featureFilter.filter(new wo(this.zoom),c,i))continue;const u=r?r.evaluate(c,{},i):void 0,h={id:s,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:oc(t,i,n),patterns:{},sortKey:u};o.push(h)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:s,featureIndex:a}=t,l=this.addConstantDashes(s);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:c}=n;if(l&&this.addFeatureDashes(n,s),this.hasPattern){const e=Eu("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,r,o,i,s.positions,t.availableImages);a.insert(e[o].feature,r,o,c,this.index)}}addConstantDashes(e){let t=!1;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,r=i.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==r.kind)t=!0;else{const t=r.value,i=n.value;if(!i)continue;e.addDash(i,t)}}return t}addFeatureDashes(e,t){const i=this.zoom;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,o=n.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let s,a;if("constant"===r.kind){if(s=r.value,!s)continue}else s=r.evaluate({zoom:i},e);a="constant"===o.kind?o.value:o.evaluate({zoom:i},e),t.addDash(s,a),e.patterns[n.id]=t.getKey(s,a)}}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}addFeatures(e,t,i,n,r){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,wh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,n,r,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(e,{}),l=s.get("line-cap").evaluate(e,{}),c=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)this.addLine(i,e,a,l,c,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,o,n)}addLine(e,t,i,n,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Sh[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?15*sa/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=e[a-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<a;t++){if(p=t===a-1?s?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const _=f.x*m.x+f.y*m.y,y=g.x*m.x+g.y*m.y,x=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),b=y<Th&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const S=d&&p;let T=S?i:s?"butt":n;if(S&&"round"===T&&(x<o?T="miter":x<=2&&(T="fakeround")),"miter"===T&&x>r&&(T="bevel"),"bevel"===T&&(x>2&&(T="flipbevel"),x<r&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)g._mult(x),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===T){if(x>100)g=m.mult(-1);else{const e=x*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(x*x-1),t=w?e:0,i=w?0:e;if(d&&this.addCurrentVertex(h,f,t,i,u),"fakeround"===T){const e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*e*e+(.848013+_*(.215638*_-1.06021)))}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,n.x,n.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-i,u)}else if("butt"===T)this.addCurrentVertex(h,g,0,0,u);else if("square"===T){const e=d?1:-1;d||this.addCurrentVertex(h,g,e,e,u),this.addCurrentVertex(h,g,0,0,u),d&&this.addCurrentVertex(h,g,e,e,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&t<a-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,i,n,r,o=!1){const s=t.y*n-t.x,a=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,o,!1,i,r),this.addHalfVertex(e,s,a,o,!0,-n,r)}addHalfVertex({x:e,y:t},i,n,r,o,s,a){this.layoutVertexArray.emplaceBack((e<<1)+(r?1:0),(t<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Hr(Eh,"LineBucket",{omit:["layers","patternFeatures"]});const Ch=new Lo({"line-cap":new zo(et.layout_line["line-cap"]),"line-join":new zo(et.layout_line["line-join"]),"line-miter-limit":new Io(et.layout_line["line-miter-limit"]),"line-round-limit":new Io(et.layout_line["line-round-limit"]),"line-sort-key":new zo(et.layout_line["line-sort-key"])});var kh={paint:new Lo({"line-opacity":new zo(et.paint_line["line-opacity"]),"line-color":new zo(et.paint_line["line-color"]),"line-translate":new Io(et.paint_line["line-translate"]),"line-translate-anchor":new Io(et.paint_line["line-translate-anchor"]),"line-width":new zo(et.paint_line["line-width"]),"line-gap-width":new zo(et.paint_line["line-gap-width"]),"line-offset":new zo(et.paint_line["line-offset"]),"line-blur":new zo(et.paint_line["line-blur"]),"line-dasharray":new zo(et.paint_line["line-dasharray"]),"line-pattern":new zo(et.paint_line["line-pattern"]),"line-gradient":new Do(et.paint_line["line-gradient"]),"line-trim-offset":new Io(et.paint_line["line-trim-offset"])}),layout:Ch};const Mh=new class extends zo{possiblyEvaluate(e,t){return t=new wo(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=z({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(kh.paint.properties["line-width"].specification);function Ah(e,t){return t>0?t+2*e:e}Mh.useIntegerZoom=!0;const Ph=No([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ih=No([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),zh=No([{name:"a_projected_pos",components:4,type:"Float32"}],4);No([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Dh=No([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Lh=No([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);No([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Rh=No([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Oh=No([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);No([{name:"triangle",components:3,type:"Uint16"}]),No([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),No([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),No([{type:"Float32",name:"offsetX"}]),No([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Bh=24;const Fh=128;function Nh(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new wo(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:n}=i;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[r],a=t[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new wo(s)),maxSize:i.evaluate(new wo(a)),interpolationType:n}}}function jh(e,{uSize:t,uSizeT:i},{lowerSize:n,upperSize:r}){return"source"===e.kind?n/Fh:"composite"===e.kind?Ii(n/Fh,r/Fh,i):t}function Uh(e,t){let i=0,n=0;if("constant"===e.kind)n=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=e,a=r?k(Qi.interpolationFactor(r,t,o,s),0,1):0;"camera"===e.kind?n=Ii(e.minSize,e.maxSize,a):i=a}return{uSizeT:i,uSize:n}}var $h=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Fh,evaluateSizeForFeature:jh,evaluateSizeForZoom:Uh,getSizeData:Nh});function Vh(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const n=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),bo.applyArabicShaping&&(e=bo.applyArabicShaping(e)),e}(e.text,t,i)})),e}const Gh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Wh(e){return"︶"===e||"﹈"===e||"︸"===e||"﹄"===e||"﹂"===e||"︾"===e||"︼"===e||"︺"===e||"︘"===e||"﹀"===e||"︐"===e||"︓"===e||"︔"===e||"｀"===e||"￣"===e||"︑"===e||"︒"===e}function qh(e){return"︵"===e||"﹇"===e||"︷"===e||"﹃"===e||"﹁"===e||"︽"===e||"︻"===e||"︹"===e||"︗"===e||"︿"===e}var Xh=Yh,Zh=function(e,t,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},Hh=function(e,t,i,n,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[i+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[i+p]=255&s,p+=f,s/=256,c-=8);e[i+p-f]|=128*m};function Yh(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Yh.Varint=0,Yh.Fixed64=1,Yh.Bytes=2,Yh.Fixed32=5;var Kh=4294967296,Jh=1/Kh,Qh="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ed(e){return e.type===Yh.Bytes?e.readVarint()+e.pos:e.pos+1}function td(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function id(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=e;r--)i.buf[r+n]=i.buf[r]}function nd(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function rd(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function od(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function sd(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function ad(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function ld(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function cd(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function ud(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function hd(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function dd(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function pd(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function fd(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Yh.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,e(r,t,this),this.pos===o&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=dd(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=fd(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=dd(this.buf,this.pos)+dd(this.buf,this.pos+4)*Kh;return this.pos+=8,e},readSFixed64:function(){var e=dd(this.buf,this.pos)+fd(this.buf,this.pos+4)*Kh;return this.pos+=8,e},readFloat:function(){var e=Zh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Zh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(e,t,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return td(e,n,t);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return td(e,n,t);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return td(e,n,t);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return td(e,n,t);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return td(e,n,t);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return td(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Qh?function(e,t,i){return Qh.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var n="",r=t;r<i;){var o,s,a,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[r+2],128==(192&(o=e[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[r+2],a=e[r+3],128==(192&(o=e[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Yh.Bytes)return e.push(this.readVarint(t));var i=ed(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Yh.Bytes)return e.push(this.readSVarint());var t=ed(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Yh.Bytes)return e.push(this.readBoolean());var t=ed(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Yh.Bytes)return e.push(this.readFloat());var t=ed(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Yh.Bytes)return e.push(this.readDouble());var t=ed(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Yh.Bytes)return e.push(this.readFixed32());var t=ed(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Yh.Bytes)return e.push(this.readSFixed32());var t=ed(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Yh.Bytes)return e.push(this.readFixed64());var t=ed(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Yh.Bytes)return e.push(this.readSFixed64());var t=ed(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Yh.Varint)for(;this.buf[this.pos++]>127;);else if(t===Yh.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Yh.Fixed32)this.pos+=4;else{if(t!==Yh.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),pd(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),pd(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),pd(this.buf,-1&e,this.pos),pd(this.buf,Math.floor(e*Jh),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),pd(this.buf,-1&e,this.pos),pd(this.buf,Math.floor(e*Jh),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,n;if(e>=0?(i=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var n,r,o=0;o<t.length;o++){if((n=t.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):r=n;continue}if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(e[i++]=239,e[i++]=191,e[i++]=189,r=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=63&n|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&id(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Hh(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Hh(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&id(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,i){this.writeTag(e,Yh.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,nd,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,rd,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,ad,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,od,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,sd,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,ld,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,cd,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,ud,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,hd,t)},writeBytesField:function(e,t){this.writeTag(e,Yh.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Yh.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Yh.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Yh.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Yh.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Yh.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Yh.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Yh.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Yh.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Yh.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var md=d(Xh);const gd=3;function _d(e,t,i){t.glyphs=[],1===e&&i.readMessage(yd,t)}function yd(e,t,i){if(3===e){const{id:e,bitmap:n,width:r,height:o,left:s,top:a,advance:l}=i.readMessage(xd,{});t.glyphs.push({id:e,bitmap:new Bc({width:r+2*gd,height:o+2*gd},n),metrics:{width:r,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function xd(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}const vd=gd;function bd(e){let t=0,i=0;for(const n of e)t+=n.w*n.h,i=Math.max(i,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let r=0,o=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const i=n[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===i.w&&t.h===i.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(n.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}const wd=1;class Sd{constructor(e,{pixelRatio:t,version:i,stretchX:n,stretchY:r,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=r,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+wd,this.paddedRect.y+wd]}get br(){return[this.paddedRect.x+this.paddedRect.w-wd,this.paddedRect.y+this.paddedRect.h-wd]}get displaySize(){return[(this.paddedRect.w-2*wd)/this.pixelRatio,(this.paddedRect.h-2*wd)/this.pixelRatio]}}class Td{constructor(e,t){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,i,r),this.addImages(t,n,r);const{w:o,h:s}=bd(r),a=new Fc({width:o||1,height:s||1});for(const t in e){const n=e[t],r=i[t].paddedRect;Fc.copy(n.data,a,{x:0,y:0},{x:r.x+wd,y:r.y+wd},n.data)}for(const e in t){const i=t[e],r=n[e].paddedRect,o=r.x+wd,s=r.y+wd,l=i.data.width,c=i.data.height;Fc.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),Fc.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),Fc.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),Fc.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),Fc.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=n}addImages(e,t,i){for(const n in e){const r=e[n],o={x:0,y:0,w:r.data.width+2*wd,h:r.data.height+2*wd};i.push(o),t[n]=new Sd(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t))),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,r]=e.tl;i.update(t.data,void 0,{x:n,y:r})}}Hr(Sd,"ImagePosition"),Hr(Td,"ImageAtlas");const Ed={horizontal:1,vertical:2,horizontalOnly:3},Cd=-17;class kd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const i=new kd;return i.scale=e||1,i.fontStack=t,i}static forImage(e){const t=new kd;return t.imageName=e,t}}class Md{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new Md;for(let n=0;n<e.sections.length;n++){const r=e.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(e,t){let i="";for(let n=0;n<e.length;n++){const r=e.charCodeAt(n+1)||null,o=e.charCodeAt(n-1)||null;i+=!t&&(r&&oo(r)&&!Gh[e[n+1]]||o&&oo(o)&&!Gh[e[n-1]])||!Gh[e[n]]?e[n]:Gh[e[n]]}return i}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&Pd[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Pd[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new Md;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(kd.forText(e.scale,e.fontStack||t));const i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void G("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(kd.forImage(t)),this.sectionIndex.push(this.sections.length-1)):G("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ad(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f){const m=Md.fromFeature(e,r);h===Ed.vertical&&m.verticalizePunctuation(d);let g=[];const _=function(e,t,i,n,r,o){if(!e)return[];const s=[],a=function(e,t,i,n,r,o){let s=0;for(let i=0;i<e.length();i++){const a=e.getSection(i);s+=zd(e.getCharCode(i),a,n,r,t,o)}return s/Math.max(1,Math.ceil(s/i))}(e,t,i,n,r,o),l=e.text.indexOf("​")>=0;let c=0;for(let i=0;i<e.length();i++){const h=e.getSection(i),d=e.getCharCode(i);if(Pd[d]||(c+=zd(d,h,n,r,t,o)),i<e.length()-1){const t=!((u=d)<11904||!(eo["Bopomofo Extended"](u)||eo.Bopomofo(u)||eo["CJK Compatibility Forms"](u)||eo["CJK Compatibility Ideographs"](u)||eo["CJK Compatibility"](u)||eo["CJK Radicals Supplement"](u)||eo["CJK Strokes"](u)||eo["CJK Symbols and Punctuation"](u)||eo["CJK Unified Ideographs Extension A"](u)||eo["CJK Unified Ideographs"](u)||eo["Enclosed CJK Letters and Months"](u)||eo["Halfwidth and Fullwidth Forms"](u)||eo.Hiragana(u)||eo["Ideographic Description Characters"](u)||eo["Kangxi Radicals"](u)||eo["Katakana Phonetic Extensions"](u)||eo.Katakana(u)||eo["Vertical Forms"](u)||eo["Yi Radicals"](u)||eo["Yi Syllables"](u)));(Id[d]||t||h.imageName)&&s.push(Rd(i+1,c,a,s,Ld(d,e.getCharCode(i+1),t&&l),!1))}}var u;return Od(Rd(e.length(),c,a,s,0,!0))}(m,c,o,t,n,p),{processBidirectionalText:y,processStyledBidirectionalText:x}=bo;if(y&&1===m.sections.length){const e=y(m.toString(),_);for(const t of e){const e=new Md;e.text=t,e.sections=m.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);g.push(e)}}else if(x){const e=x(m.text,m.sectionIndex,_);for(const t of e){const e=new Md;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const i=[],n=e.text;let r=0;for(const n of t)i.push(e.substring(r,n)),r=n;return r<n.length&&i.push(e.substring(r,n.length)),i}(m,_);const v=[],b={positionedLines:v,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,i,n,r,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const e of r){const i=e.getSections();for(const e of i){if(e.imageName)continue;const i=t[e.fontStack];if(i&&(g=void 0!==i.ascender&&void 0!==i.descender,!g))break}if(!g)break}let _=0;for(const s of r){s.trim();const r=s.getMaxScale(),a=(r-1)*Bh,x={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=x;const v=x.positionedGlyphs;let b=0;if(!s.length()){p+=o,++_;continue}let w=0,S=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCharCode(o);let _=a.scale,x=null,T=null,E=null,C=Bh,k=0;const M=!(l===Ed.horizontal||!u&&!ro(m)||u&&(Pd[m]||(y=m,eo.Arabic(y)||eo["Arabic Supplement"](y)||eo["Arabic Extended-A"](y)||eo["Arabic Presentation Forms-A"](y)||eo["Arabic Presentation Forms-B"](y))));if(a.imageName){const t=n[a.imageName];if(!t)continue;E=a.imageName,e.iconsInText=e.iconsInText||!0,T=t.paddedRect;const i=t.displaySize;_=_*Bh/h,x={width:i[0],height:i[1],left:wd,top:-vd,advance:M?i[1]:i[0],localGlyph:!1},k=g?-x.height*_:Cd+r*Bh-i[1]*_,C=x.advance;const o=(M?i[0]:i[1])*_-Bh*r;o>0&&o>b&&(b=o)}else{const e=i[a.fontStack];if(!e)continue;e[m]&&(T=e[m]);const n=t[a.fontStack];if(!n)continue;const o=n.glyphs[m];if(!o)continue;if(x=o.metrics,C=8203!==m?Bh:0,g){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,i=(e+t)*_;w<i&&(w=i,S=(e-t)/2*_),k=-e*_}else k=Cd+(r-_)*Bh}M?(e.verticalizable=!0,v.push({glyph:m,imageName:E,x:d,y:p+k,vertical:M,scale:_,localGlyph:x.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:x,rect:T}),d+=C*_+c):(v.push({glyph:m,imageName:E,x:d,y:p+k,vertical:M,scale:_,localGlyph:x.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:x,rect:T}),d+=x.advance*_+c)}0!==v.length&&(f=Math.max(d-c,f),g?Fd(v,m,b,S,o*r/2):Fd(v,m,b,0,o/2)),d=0;const T=o*r+b;x.lineOffset=Math.max(b,a),p+=T,++_}var y;const x=p,{horizontalAlign:v,verticalAlign:b}=Bd(s);(function(e,t,i,n,r,o){const s=(t-i)*r,a=-o*n;for(const t of e)for(const e of t.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,m,v,b,f,x),e.top+=-b*x,e.bottom=e.top+x,e.left+=-v*f,e.right=e.left+f,e.hasBaseline=g}(b,t,i,n,g,s,a,l,h,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(v)&&b}const Pd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Id={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zd(e,t,i,n,r,o){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*Bh/o+r:0}{const n=i[t.fontStack],o=n&&n.glyphs[e];return o?o.metrics.advance*t.scale+r:0}}function Dd(e,t,i,n){const r=Math.pow(e-t,2);return n?e<t?r/2:2*r:r+Math.abs(i)*i}function Ld(e,t,i){let n=0;return 10===e&&(n-=1e4),i&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function Rd(e,t,i,n,r,o){let s=null,a=Dd(t,i,r,o);for(const e of n){const n=Dd(t-e.x,i,r,o)+e.badness;n<=a&&(s=e,a=n)}return{index:e,x:t,priorBreak:s,badness:a}}function Od(e){return e?Od(e.priorBreak).concat(e.index):[]}function Bd(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Fd(e,t,i,n,r){if(!(t||i||n||r))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let t=0;t<=o;t++)e[t].x-=a,e[t].y+=i+n+r}function Nd(e,t,i){const{horizontalAlign:n,verticalAlign:r}=Bd(i),o=t[0]-e.displaySize[0]*n,s=t[1]-e.displaySize[1]*r;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function jd(e,t,i,n,r,o){const s=e.image;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===i||"both"===i?(p=r[0]+l-n[3],h=r[0]+c+n[1]):(p=r[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===i||"both"===i?(u=r[1]+f-n[0],d=r[1]+m+n[2]):(u=r[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class Ud extends y{constructor(e,t,i,n,r){super(e,t),this.angle=n,this.z=i,void 0!==r&&(this.segment=r)}clone(){return new Ud(this.x,this.y,this.z,this.angle,this.segment)}}function $d(e,t,i,n,r){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const t=e[s],i=e[s+1];if(!i)return!1;let o=e[s-1].angleTo(t)-t.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=t.dist(i)}return!0}function Vd(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function Gd(e,t,i){return e?.6*t*i:0}function Wd(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function qd(e,t,i,n,r,o){const s=Gd(i,r,o),a=Wd(i,n)*o;let l=0;const c=Vd(e)/2;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1],o=n.dist(r);if(l+o>c){const u=(c-l)/o,h=Ii(n.x,r.x,u),d=Ii(n.y,r.y,u),p=new Ud(h,d,0,r.angleTo(n),i);return!s||$d(e,p,a,s,t)?p:void 0}l+=o}}function Xd(e,t,i,n,r,o,s,a,l){const c=Gd(n,o,s),u=Wd(n,r),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Zd(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,i,h,d,!1,l)}function Zd(e,t,i,n,r,o,s,a,l){const c=o/2,u=Vd(e);let h=0,d=t-i,p=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],f=s.dist(a),m=a.angleTo(s);for(;d+i<h+f;){d+=i;const g=(d-h)/f,_=Ii(s.x,a.x,g),y=Ii(s.y,a.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const i=new Ud(_,y,0,m,t);i._round(),n&&!$d(e,i,o,n,r)||p.push(i)}}h+=f}return a||p.length||s||(p=Zd(e,h/2,i,n,r,o,s,!0,l)),p}function Hd(e,t,i,n,r){const o=[];for(let s=0;s<e.length;s++){const a=e[s];let l;for(let e=0;e<a.length-1;e++){let s=a[e],c=a[e+1];s.x<t&&c.x<t||(s.x<t?s=new y(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<t&&(c=new y(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<i&&c.y<i||(s.y<i?s=new y(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round():c.y<i&&(c=new y(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round()),s.x>=n&&c.x>=n||(s.x>=n?s=new y(n,s.y+(n-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=n&&(c=new y(n,s.y+(n-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=r&&c.y>=r||(s.y>=r?s=new y(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round():c.y>=r&&(c=new y(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}Hr(Ud,"Anchor");const Yd=1e20;function Kd(e,t,i,n,r,o,s,a,l){for(let c=t;c<t+n;c++)Jd(e,i*o+c,o,r,s,a,l);for(let c=i;c<i+r;c++)Jd(e,c*o+t,1,n,s,a,l)}function Jd(e,t,i,n,r,o,s){o[0]=0,s[0]=-Yd,s[1]=Yd,r[0]=e[t];for(let a=1,l=0,c=0;a<n;a++){r[a]=e[t+a*i];const n=a*a;do{const e=o[l];c=(r[a]-r[e]+n-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=Yd}for(let a=0,l=0;a<n;a++){for(;s[l+1]<a;)l++;const n=o[l],c=a-n;e[t+a*i]=r[n]+c*c}}const Qd=2,ep={none:0,ideographs:1,all:2};class tp{constructor(e,t,i){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const i=[];for(const t in e)for(const n of e[t])i.push({stack:t,id:n});P(i,(({stack:e,id:t},i)=>{let n=this.entries[e];n||(n=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let r=n.glyphs[t];if(void 0!==r)return void i(null,{stack:e,id:t,glyph:r});if(r=this._tinySDF(n,e,t),r)return n.glyphs[t]=r,void i(null,{stack:e,id:t,glyph:r});const o=Math.floor(t/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(n.ranges[o])return void i(null,{stack:e,id:t,glyph:r});let s=n.requests[o];s||(s=n.requests[o]=[],tp.loadGlyphRange(e,o,this.url,this.requestManager,((e,t)=>{if(t){n.ascender=t.ascender,n.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=t.glyphs[+e]);n.ranges[o]=!0}for(const i of s)i(e,t);delete n.requests[o]}))),s.push(((n,r)=>{n?i(n):r&&i(null,{stack:e,id:t,glyph:r.glyphs[t]||null})}))}),((e,i)=>{if(e)t(e);else if(i){const e={};for(const{stack:t,id:n,glyph:r}of i)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[n]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ep.none&&(this.localGlyphMode===ep.all?!!this.localFontFamily:!!this.localFontFamily&&(eo["CJK Unified Ideographs"](e)||eo["Hangul Syllables"](e)||eo.Hiragana(e)||eo.Katakana(e)||eo["CJK Symbols and Punctuation"](e)))}_tinySDF(e,t,i){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(i))return;let r=e.tinySDF;if(!r){let i="400";/bold/i.test(t)?i="900":/medium/i.test(t)?i="500":/light/i.test(t)&&(i="200"),r=e.tinySDF=new tp.TinySDF({fontFamily:n,fontWeight:i,fontSize:24*Qd,buffer:3*Qd,radius:8*Qd}),r.fontWeight=i}if(this.localGlyphs[r.fontWeight][i])return this.localGlyphs[r.fontWeight][i];const o=String.fromCharCode(i),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=r.draw(o);return this.localGlyphs[r.fontWeight][i]={id:i,bitmap:new Bc({width:a,height:l},s),metrics:{width:c/Qd,height:u/Qd,left:h/Qd,top:d/Qd-27,advance:p/Qd,localGlyph:!0}}}}tp.loadGlyphRange=function(e,t,i,n,r){const o=256*t,s=o+255,a=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${o}-${s}`),le.Glyphs);de(a,((e,t)=>{if(e)r(e);else if(t){const e={},i=function(e){return new md(e).readFields(_d,{})}(t);for(const t of i.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:i.ascender,descender:i.descender})}}))},tp.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:n=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(n)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const y=f.getImageData(m,m,a,l);_.fill(Yd,0,h),g.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=y.data[4*(e*a+t)+3]/255;if(0===i)continue;const n=(e+m)*c+t+m;if(1===i)_[n]=0,g[n]=Yd;else{const e=.5-i;_[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}Kd(_,0,0,c,u,c,this.f,this.v,this.z),Kd(g,m,m,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(_[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};const ip=wd;function np(e,t,i,n){const r=[],o=e.image,s=o.pixelRatio,a=o.paddedRect.w-2*ip,l=o.paddedRect.h-2*ip,c=e.right-e.left,u=e.bottom-e.top,h=o.stretchX||[[0,a]],d=o.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),g=a-f,_=l-m;let x=0,v=f,b=0,w=m,S=0,T=g,E=0,C=_;if(o.content&&n){const e=o.content;x=rp(h,0,e[0]),b=rp(d,0,e[1]),v=rp(h,e[0],e[2]),w=rp(d,e[1],e[3]),S=e[0]-x,E=e[1]-b,T=e[2]-e[0]-v,C=e[3]-e[1]-w}const k=(n,r,a,l)=>{const h=sp(n.stretch-x,v,c,e.left),d=ap(n.fixed-S,T,n.stretch,f),p=sp(r.stretch-b,w,u,e.top),g=ap(r.fixed-E,C,r.stretch,m),_=sp(a.stretch-x,v,c,e.left),k=ap(a.fixed-S,T,a.stretch,f),M=sp(l.stretch-b,w,u,e.top),A=ap(l.fixed-E,C,l.stretch,m),P=new y(h,p),I=new y(_,p),z=new y(_,M),D=new y(h,M),L=new y(d/s,g/s),R=new y(k/s,A/s),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),i=[t,-e,e,t];P._matMult(i),I._matMult(i),D._matMult(i),z._matMult(i)}const B=n.stretch+n.fixed,F=r.stretch+r.fixed;return{tl:P,tr:I,bl:D,br:z,tex:{x:o.paddedRect.x+ip+B,y:o.paddedRect.y+ip+F,w:a.stretch+a.fixed-B,h:l.stretch+l.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:R,minFontScaleX:T/s/c,minFontScaleY:C/s/u,isSDF:i}};if(n&&(o.stretchX||o.stretchY)){const e=op(h,g,f),t=op(d,_,m);for(let i=0;i<e.length-1;i++){const n=e[i],o=e[i+1];for(let e=0;e<t.length-1;e++)r.push(k(n,t[e],o,t[e+1]))}}else r.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return r}function rp(e,t,i){let n=0;for(const r of e)n+=Math.max(t,Math.min(i,r[1]))-Math.max(t,Math.min(i,r[0]));return n}function op(e,t,i){const n=[{fixed:-ip,stretch:0}];for(const[t,i]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return n.push({fixed:t+ip,stretch:i}),n}function sp(e,t,i,n){return e/t*i+n}function ap(e,t,i,n){return e-t*i/n}function lp(e,t,i,n){const r=t+e.positionedLines[n].lineOffset;return 0===n?i+r/2:i+(r+(t+e.positionedLines[n-1].lineOffset))/2}class cp{constructor(e=[],t=up){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,n=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(i(n,o)>=0)break;t[e]=o,e=r}t[e]=n}_down(e){const{data:t,compare:i}=this,n=this.length>>1,r=t[e];for(;e<n;){let n=1+(e<<1),o=t[n];const s=n+1;if(s<this.length&&i(t[s],o)<0&&(n=s,o=t[s]),i(o,r)>=0)break;t[e]=o,e=n}t[e]=r}}function up(e,t){return e<t?-1:e>t?1:0}function hp(e,t=1,i=!1){let n=1/0,r=1/0,o=-1/0,s=-1/0;const a=e[0];for(let e=0;e<a.length;e++){const t=a[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<r)&&(r=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>s)&&(s=t.y)}const l=Math.min(o-n,s-r);let c=l/2;const u=new cp([],dp);if(0===l)return new y(n,r);for(let t=n;t<o;t+=l)for(let i=r;i<s;i+=l)u.push(new pp(t+c,i+c,c,e));let h=function(e){let t=0,i=0,n=0;const r=e[0];for(let e=0,o=r.length,s=o-1;e<o;s=e++){const o=r[e],a=r[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,n+=(o.y+a.y)*l,t+=3*l}return new pp(i/t,n/t,0,e)}(e),d=u.length;for(;u.length;){const n=u.pop();(n.d>h.d||!h.d)&&(h=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,d)),n.max-h.d<=t||(c=n.h/2,u.push(new pp(n.p.x-c,n.p.y-c,c,e)),u.push(new pp(n.p.x+c,n.p.y-c,c,e)),u.push(new pp(n.p.x-c,n.p.y+c,c,e)),u.push(new pp(n.p.x+c,n.p.y+c,c,e)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function dp(e,t){return t.max-e.max}class pp{constructor(e,t,i,n){this.p=new y(e,t),this.h=i,this.d=function(e,t){let i=!1,n=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,s=r-1;t<r;s=t++){const r=o[t],a=o[s];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(i=!i),n=Math.min(n,_c(e,r,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const fp=7,mp=Number.POSITIVE_INFINITY,gp=Math.sqrt(2);function _p(e,[t,i]){let n=0,r=0;if(i===mp){t<0&&(t=0);const i=t/gp;switch(e){case"top-right":case"top-left":r=i-fp;break;case"bottom-right":case"bottom-left":r=-i+fp;break;case"bottom":r=-t+fp;break;case"top":r=t-fp}switch(e){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=t;break;case"right":n=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":r=i-fp;break;case"bottom-right":case"bottom-left":case"bottom":r=-i+fp}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}}return[n,r]}function yp(e,t,i,n,r,o,s,a,l,c){e.createArrays(),e.tilePixelRatio=sa/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const u=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,d={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.textSizeData;d.compositeTextSizes=[h["text-size"].possiblyEvaluate(new wo(t),a),h["text-size"].possiblyEvaluate(new wo(i),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.iconSizeData;d.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new wo(t),a),h["icon-size"].possiblyEvaluate(new wo(i),a)]}d.layoutTextSize=h["text-size"].possiblyEvaluate(new wo(l+1),a),d.layoutIconSize=h["icon-size"].possiblyEvaluate(new wo(l+1),a),d.textMaxSize=h["text-size"].possiblyEvaluate(new wo(18),a);const p="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),f=u.get("text-size");for(const o of e.features){const l=u.get("text-font").evaluate(o,{},a).join(","),h=f.evaluate(o,{},a),m=d.layoutTextSize.evaluate(o,{},a),g=(d.layoutIconSize.evaluate(o,{},a),{horizontal:{},vertical:void 0}),_=o.text;let y,x=[0,0];if(_){const n=_.toString(),s=u.get("text-letter-spacing").evaluate(o,{},a)*Bh,c=u.get("text-line-height").evaluate(o,{},a)*Bh,d=io(n)?s:0,f=u.get("text-anchor").evaluate(o,{},a),y=u.get("text-variable-anchor");if(!y){const e=u.get("text-radial-offset").evaluate(o,{},a);x=e?_p(f,[e*Bh,mp]):u.get("text-offset").evaluate(o,{},a).map((e=>e*Bh))}let v=p?"center":u.get("text-justify").evaluate(o,{},a);const b="point"===u.get("symbol-placement"),w=b?u.get("text-max-width").evaluate(o,{},a)*Bh:1/0,S=o=>{e.allowVerticalPlacement&&to(n)&&(g.vertical=Ad(_,t,i,r,l,w,c,f,o,d,x,Ed.vertical,!0,m,h))};if(!p&&y){const e="auto"===v?y.map((e=>xp(e))):[v];let n=!1;for(let o=0;o<e.length;o++){const s=e[o];if(!g.horizontal[s])if(n)g.horizontal[s]=g.horizontal[0];else{const e=Ad(_,t,i,r,l,w,c,"center",s,d,x,Ed.horizontal,!1,m,h);e&&(g.horizontal[s]=e,n=1===e.positionedLines.length)}}S("left")}else{if("auto"===v&&(v=xp(f)),b||u.get("text-writing-mode").indexOf("horizontal")>=0||!to(n)){const e=Ad(_,t,i,r,l,w,c,f,v,d,x,Ed.horizontal,!1,m,h);e&&(g.horizontal[v]=e)}S(b?"left":v)}}let v=!1;if(o.icon&&o.icon.name){const t=n[o.icon.name];t&&(y=Nd(r[o.icon.name],u.get("icon-offset").evaluate(o,{},a),u.get("icon-anchor").evaluate(o,{},a)),v=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&G("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const b=Tp(g.horizontal)||g.vertical;e.iconsInText||(e.iconsInText=!!b&&b.iconsInText),(b||y)&&vp(e,o,g,y,n,d,m,0,x,v,s,a,c)}o&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function xp(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vp(e,t,i,n,r,o,s,a,l,c,u,h,d){let p=o.textMaxSize.evaluate(t,{},h);void 0===p&&(p=s);const f=e.layers[0].layout,m=f.get("icon-offset").evaluate(t,{},h),g=Tp(i.horizontal)||i.vertical,_="globe"===d.name,y=Bh,x=s/y,v=e.tilePixelRatio*p/y,w=(P=e.overscaling,e.zoom>18&&P>2&&(P>>=1),Math.max(sa/(512*P),1)*f.get("symbol-spacing")),S=f.get("text-padding")*e.tilePixelRatio,T=f.get("icon-padding")*e.tilePixelRatio,E=b(f.get("text-max-angle")),C="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),k="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),M=f.get("symbol-placement"),A=w/2;var P;const I=f.get("icon-text-fit");let z;n&&"none"!==I&&(e.allowVerticalPlacement&&i.vertical&&(z=jd(n,i.vertical,I,f.get("icon-text-fit-padding"),m,x)),g&&(n=jd(n,g,I,f.get("icon-text-fit-padding"),m,x)));const D=(s,a,p)=>{if(a.x<0||a.x>=sa||a.y<0||a.y>=sa)return;let f=null;if(_){const{x:e,y:t,z:i}=d.projectTilePoint(a.x,a.y,p);f={anchor:new Ud(e,t,i,0,void 0),up:d.upVector(p,a.x,a.y)}}!function(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,x,v,b,w,S,T){const E=e.addToLineVertexArray(t,n);let C,k,M,A,P,I,z,D=0,L=0,R=0,O=0,B=-1,F=-1;const N={};let j=Ps("");const U=i?i.anchor:t;let $=0,V=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[$,V]=l.layout.get("text-offset").evaluate(v,{},T).map((e=>e*Bh)):($=l.layout.get("text-radial-offset").evaluate(v,{},T)*Bh,V=mp),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(f)I=Cp(e),a&&(z=Cp(a));else{const i=l.layout.get("text-rotate").evaluate(v,{},T)+90;M=Ep(c,U,t,u,h,d,e,p,i,m),a&&(A=Ep(c,U,t,u,h,d,a,_,i))}}if(o){const n=l.layout.get("icon-rotate").evaluate(v,{},T),r="none"!==l.layout.get("icon-text-fit"),s=np(o,n,w,r),p=a?np(a,n,w,r):void 0;k=Ep(c,U,t,u,h,d,o,_,n),D=4*s.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[Fh*l.layout.get("icon-size").evaluate(v,{},T)],m[0]>wp&&G(`${e.layerIds[0]}: Value for "icon-size" is >= ${bp}. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Fh*b.compositeIconSizes[0].evaluate(v,{},T),Fh*b.compositeIconSizes[1].evaluate(v,{},T)],(m[0]>wp||m[1]>wp)&&G(`${e.layerIds[0]}: Value for "icon-size" is >= ${bp}. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,m,x,y,v,!1,i,t,E.lineStartIndex,E.lineLength,-1,S,T),B=e.icon.placedSymbolArray.length-1,p&&(L=4*p.length,e.addSymbols(e.icon,p,m,x,y,v,Ed.vertical,i,t,E.lineStartIndex,E.lineLength,-1,S,T),F=e.icon.placedSymbolArray.length-1)}for(const n in r.horizontal){const o=r.horizontal[n];C||(j=Ps(o.text),f?P=Cp(o):C=Ep(c,U,t,u,h,d,o,p,l.layout.get("text-rotate").evaluate(v,{},T),m));const a=1===o.positionedLines.length;if(R+=Sp(e,i,t,o,s,l,f,v,m,E,r.vertical?Ed.horizontal:Ed.horizontalOnly,a?Object.keys(r.horizontal):[n],N,B,b,S,T),a)break}r.vertical&&(O+=Sp(e,i,t,r.vertical,s,l,f,v,m,E,Ed.vertical,["vertical"],N,F,b,S,T));let W=-1;const q=(e,t)=>e?Math.max(e,t):t;W=q(P,W),W=q(I,W),W=q(z,W);const X=W>-1?1:0;e.glyphOffsetArray.length>=sf.MAX_GLYPHS&&G("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,v.sortKey),e.symbolInstances.emplaceBack(U.x,U.y,U.z,t.x,t.y,N.right>=0?N.right:-1,N.center>=0?N.center:-1,N.left>=0?N.left:-1,N.vertical>=0?N.vertical:-1,B,F,j,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==k?k:e.collisionBoxArray.length,void 0!==k?k+1:e.collisionBoxArray.length,A||e.collisionBoxArray.length,A?A+1:e.collisionBoxArray.length,u,R,O,D,L,X,0,$,V,W)}(e,a,f,s,i,n,r,z,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,S,C,l,0,T,k,m,t,o,c,u,h)};if("line"===M)for(const r of Hd(t.geometry,0,0,sa,sa)){const t=Xd(r,w,E,i.vertical||g,n,y,v,e.overscaling,sa);for(const i of t)g&&kp(e,g.text,A,i)||D(r,i,h)}else if("line-center"===M){for(const e of t.geometry)if(e.length>1){const t=qd(e,E,i.vertical||g,n,y,v);t&&D(e,t,h)}}else if("Polygon"===t.type)for(const e of wu(t.geometry,0)){const t=hp(e,16);D(e[0],new Ud(t.x,t.y,0,0,void 0),h)}else if("LineString"===t.type)for(const e of t.geometry)D(e,new Ud(e[0].x,e[0].y,0,0,void 0),h);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)D([t],new Ud(t.x,t.y,0,0,void 0),h)}const bp=255,wp=bp*Fh;function Sp(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g){const _=function(e,t,i,n,r,o,s,a){const l=[];if(0===t.positionedLines.length)return l;const c=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],i=e[1],n=t*i;return n>0?[t,-i]:n<0?[-t,i]:0===t?[i,t]:[i,-t]}(i);let h=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)h-=e.lineOffset;const d=t.positionedLines.length,p=h/d;let f=t.top-i[1];for(let e=0;e<d;++e){const n=t.positionedLines[e];f=lp(t,p,f,e);for(const e of n.positionedGlyphs){if(!e.rect)continue;const n=e.rect||{};let o=vd+1,h=!0,d=1,p=0;if(e.imageName){const t=s[e.imageName];if(!t)continue;if(t.sdf){G("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=t.pixelRatio,o=wd/d}const m=(r||a)&&e.vertical,g=e.metrics.advance*e.scale/2,_=e.metrics,x=e.rect;if(null===x)continue;a&&t.verticalizable&&(p=e.imageName?g-e.metrics.width*e.scale/2:0);const v=r?[e.x+g,e.y]:[0,0];let b=[0,0],w=[0,0],S=!1;r||(m?(w=[e.x+g+u[0],e.y+u[1]-p],S=!0):b=[e.x+g+i[0],e.y+i[1]-p]);const T=x.w*e.scale/(d*(e.localGlyph?Qd:1)),E=x.h*e.scale/(d*(e.localGlyph?Qd:1));let C,k,M,A;if(m){const t=e.y-f,i=new y(-g,g-t),n=-Math.PI/2,r=new y(...w);C=new y(-g+b[0],b[1]),C._rotateAround(n,i)._add(r),C.x+=-t+g,C.y-=(_.left-o)*e.scale;const s=e.imageName?_.advance*e.scale:Bh*e.scale,a=String.fromCharCode(e.glyph);Wh(a)?C.x+=(1-o)*e.scale:qh(a)?C.x+=s-_.height*e.scale+(-o-1)*e.scale:C.x+=e.imageName||_.width+2*o===x.w&&_.height+2*o===x.h?(s-E)/2:(s-(_.height+2*o)*e.scale)/2,k=new y(C.x,C.y-T),M=new y(C.x+E,C.y),A=new y(C.x+E,C.y-T)}else{const t=(_.left-o)*e.scale-g+b[0],i=(-_.top-o)*e.scale+b[1],n=t+T,r=i+E;C=new y(t,i),k=new y(n,i),M=new y(t,r),A=new y(n,r)}if(c){let e;e=r?new y(0,0):S?new y(u[0],u[1]):new y(i[0],i[1]),C._rotateAround(c,e),k._rotateAround(c,e),M._rotateAround(c,e),A._rotateAround(c,e)}const P=new y(0,0),I=new y(0,0);l.push({tl:C,tr:k,bl:M,br:A,tex:n,writingMode:t.writingMode,glyphOffset:v,sectionIndex:e.sectionIndex,isSDF:h,pixelOffsetTL:P,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,l,o,s,a,r,e.allowVerticalPlacement),x=e.textSizeData;let v=null;"source"===x.kind?(v=[Fh*o.layout.get("text-size").evaluate(a,{},g)],v[0]>wp&&G(`${e.layerIds[0]}: Value for "text-size" is >= ${bp}. Reduce your "text-size".`)):"composite"===x.kind&&(v=[Fh*f.compositeTextSizes[0].evaluate(a,{},g),Fh*f.compositeTextSizes[1].evaluate(a,{},g)],(v[0]>wp||v[1]>wp)&&G(`${e.layerIds[0]}: Value for "text-size" is >= ${bp}. Reduce your "text-size".`)),e.addSymbols(e.text,_,v,l,s,a,u,t,i,c.lineStartIndex,c.lineLength,p,m,g);for(const t of h)d[t]=e.text.placedSymbolArray.length-1;return 4*_.length}function Tp(e){for(const t in e)return e[t];return null}function Ep(e,t,i,n,r,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,p=s.right;const f=s.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const e=new y(d,u),t=new y(p,u),i=new y(d,h),n=new y(p,h),r=b(l);let o=new y(0,0);c&&(o=new y(c[0],c[1])),e._rotateAround(r,o),t._rotateAround(r,o),i._rotateAround(r,o),n._rotateAround(r,o),d=Math.min(e.x,t.x,i.x,n.x),p=Math.max(e.x,t.x,i.x,n.x),u=Math.min(e.y,t.y,i.y,n.y),h=Math.max(e.y,t.y,i.y,n.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,d,u,p,h,a,n,r,o),e.length-1}function Cp(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function kp(e,t,i,n){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<i)return!0}else r[t]=[];return r[t].push(n),!1}function Mp(e,t){const i=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),o=Math.sin(i)*r/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),s=Math.sin(e._pitch)*o+r;return Math.min(1.01*s,r*(1/e._horizonShift))}function Ap(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),n=e.x*i,r=(e.x+1)*i,o=e.y*i,s=(e.y+1)*i,a=ql(n),l=ql(r),c=Xl(o),u=Xl(s),h=t.project(a,c),d=t.project(l,c),p=t.project(l,u),f=t.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),_=Math.max(h.x,d.x,p.x,f.x),y=Math.max(h.y,d.y,p.y,f.y);const x=i/16;function v(e,i,n,r,o,s){const a=(n+o)/2,l=(r+s)/2,c=t.project(ql(a),Xl(l)),u=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),u>x&&(v(e,c,n,r,a,l),v(c,i,a,l,o,s))}v(h,d,n,o,r,o),v(d,p,r,o,r,s),v(p,f,r,s,n,s),v(f,h,n,s,n,o),m-=x,g-=x,_+=x,y+=x;const b=1/Math.max(_-m,y-g);return{scale:b,x:m*b,y:g*b,x2:_*b,y2:y*b,projection:t}}const Pp=da(new Float32Array(16));class Ip{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Ul(0,0)}projectTilePoint(e,t,i){return{x:e,y:t,z:0}}locationPoint(e,t,i=!0){return e._coordinatePoint(e.locationCoordinate(t),i)}pixelsPerMeter(e,t){return Wl(1,e)*t}pixelSpaceConversion(e,t,i){return 1}farthestPixelDistance(e){return Mp(e,e.pixelsPerMeter)}pointCoordinate(e,t,i,n){const r=e.horizonLineFromTop(!1),o=new y(t,Math.max(r,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,n))}pointCoordinate3D(e,t,i){const n=new y(t,i);if(e.elevation)return e.elevation.pointCoordinate(n);{const t=this.pointCoordinate(e,n.x,n.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const i=e.horizonLineFromTop();return t.y<i}createInversionMatrix(e,t){return Pp}createTileMatrix(e,t,i){let n,r,o;const s=i.canonical,a=da(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Ap(s,this);n=1,r=l.x+i.wrap*l.scale,o=l.y,ga(a,a,[n/l.scale,n/l.scale,e.pixelsPerMeter/t])}else n=t/e.zoomScale(s.z),r=(s.x+Math.pow(2,s.z)*i.wrap)*n,o=s.y*n;return ma(a,a,[r,o,0]),ga(a,a,[n/sa,n/sa,1]),a}upVector(e,t,i){return[0,0,1]}upVectorScale(e,t,i){return{metersToTile:1}}}class zp extends Ip{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,i]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(b(t));this.n=(n+Math.sin(b(i)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:i,c:n,r0:r}=this,o=b(e-this.center[0]),s=b(t),a=Math.sqrt(n-2*i*Math.sin(s))/i;return{x:a*Math.sin(o*i),y:a*Math.cos(o*i)-r,z:0}}unproject(e,t){const{n:i,c:n,r0:r}=this,o=r+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*i<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=b(this.center[0])*i;s=A(s,-Math.PI-a,Math.PI-a);const l=k(w(s/i)+this.center[0],-180,180),c=Math.asin(k((n-(e*e+o*o)*i*i)/(2*i),-1,1)),u=k(w(c),-Hl,Hl);return new Ul(l,u)}}const Dp=1.340264,Lp=-.081106,Rp=893e-6,Op=.003796,Bp=Math.sqrt(3)/2;class Fp extends Ip{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(Bp*Math.sin(t)),n=i*i,r=n*n*n;return{x:.5*(e*Math.cos(i)/(Bp*(Dp+3*Lp*n+r*(7*Rp+9*Op*n)))/Math.PI+.5),y:1-.5*(i*(Dp+Lp*n+r*(Rp+Op*n))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,n=i*i,r=n*n*n;for(let e,o,s,a=0;a<12&&(o=i*(Dp+Lp*n+r*(Rp+Op*n))-t,s=Dp+3*Lp*n+r*(7*Rp+9*Op*n),e=o/s,i=k(i-e,-Math.PI/3,Math.PI/3),n=i*i,r=n*n*n,!(Math.abs(e)<1e-12));++a);const o=Bp*e*(Dp+3*Lp*n+r*(7*Rp+9*Op*n))/Math.cos(i),s=Math.asin(Math.sin(i)/Bp),a=k(180*o/Math.PI,-180,180),l=k(180*s/Math.PI,-Hl,Hl);return new Ul(a,l)}}class Np extends Ip{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const i=360*(e-.5),n=k(360*(.5-t),-Hl,Hl);return new Ul(i,n)}}const jp=Math.PI/2;function Up(e){return Math.tan((jp+e)/2)}class $p extends Ip{constructor(e){super(e),this.center=e.center||[0,30];const[t,i]=this.parallels=e.parallels||[30,30];let n=b(t),r=b(i);this.southernCenter=n+r<0,this.southernCenter&&(n=-n,r=-r);const o=Math.cos(n),s=Up(n);this.n=n===r?Math.sin(n):Math.log(o/Math.cos(r))/Math.log(Up(r)/s),this.f=o*Math.pow(Up(n),this.n)/this.n}project(e,t){t=b(t),this.southernCenter&&(t=-t),e=b(e-this.center[0]);const i=1e-6,{n,f:r}=this;r>0?t<-jp+i&&(t=-jp+i):t>jp-i&&(t=jp-i);const o=r/Math.pow(Up(t),n);let s=o*Math.sin(n*e),a=r-o*Math.cos(n*e);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:i,f:n}=this,r=n-t,o=Math.sign(r),s=Math.sign(i)*Math.sqrt(e*e+r*r);let a=Math.atan2(e,Math.abs(r))*o;r*i<0&&(a-=Math.PI*Math.sign(e)*o);const l=k(w(a/i)+this.center[0],-180,180),c=k(w(2*Math.atan(Math.pow(n/s,1/i))-jp),-Hl,Hl);return new Ul(l,this.southernCenter?-c:c)}}class Vp extends Ip{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Vl(e),y:Gl(t),z:0}}unproject(e,t){const i=ql(e),n=Xl(t);return new Ul(i,n)}}const Gp=b(Hl);class Wp extends Ip{project(e,t){const i=(t=b(t))*t,n=i*i;return{x:.5*((e=b(e))*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,n=25,r=0,o=i*i;do{o=i*i;const e=o*o;r=(i*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),i=k(i-r,-Gp,Gp)}while(Math.abs(r)>1e-6&&--n>0);o=i*i;const s=k(w(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=w(i);return new Ul(s,a)}}const qp=b(Hl);class Xp extends Ip{project(e,t){t=b(t),e=b(e);const i=Math.cos(t),n=2/Math.PI,r=Math.acos(i*Math.cos(e/2)),o=Math.sin(r)/r,s=.5*(e*n+2*i*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let i=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,r=25;const o=1e-6;let s=0,a=0;do{const r=Math.cos(n),o=Math.sin(n),l=2*o*r,c=o*o,u=r*r,h=Math.cos(i/2),d=Math.sin(i/2),p=2*h*d,f=d*d,m=1-u*h*h,g=m?1/m:0,_=m?Math.acos(r*h)*Math.sqrt(1/m):0,y=.5*(2*_*r*d+2*i/Math.PI)-e,x=.5*(_*o+n)-t,v=.5*g*(u*f+_*r*h*c)+1/Math.PI,b=g*(p*l/4-_*o*d),w=.125*g*(l*d-_*o*u*p),S=.5*g*(c*h+_*f*r)+.5,T=b*w-S*v;s=(x*b-y*S)/T,a=(y*w-x*v)/T,i=k(i-s,-Math.PI,Math.PI),n=k(n-a,-qp,qp)}while((Math.abs(s)>o||Math.abs(a)>o)&&--r>0);return new Ul(w(i),w(n))}}class Zp extends Ip{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(b(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:i,cosPhi:n}=this;return{x:b(e)*n*i+.5,y:-Math.sin(b(t))/n*i+.5,z:0}}unproject(e,t){const{scale:i,cosPhi:n}=this,r=-(t-.5)/i,o=k(w((e-.5)/i)/n,-180,180),s=Math.asin(k(r*n,-1,1)),a=k(w(s),-Hl,Hl);return new Ul(o,a)}}class Hp extends Vp{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,i){const n=Cl(e,t,i);return Oa(n,n,Al(_l(i))),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,t){const i=El(t.lat,t.lng),n=Da([],i),r=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;za(i,i,n,Wl(1,0)*sa*r);const o=da(new Float64Array(16));return fa(o,e.pixelMatrix,e.globeMatrix),Oa(i,i,o),new y(i[0],i[1])}pixelsPerMeter(e,t){return Wl(1,0)*t}pixelSpaceConversion(e,t,i){const n=Wl(1,e)*t,r=Ii(Wl(1,45)*t,n,i);return this.pixelsPerMeter(e,t)/r}createTileMatrix(e,t,i){const n=Pl(_l(i.canonical));return fa(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,t){const{center:i}=e,n=Al(_l(t));return ya(n,n,b(i.lng)),_a(n,n,b(i.lat)),ga(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,t,i,n){return fl(e,t,i,!0)||new Kl(0,0)}pointCoordinate3D(e,t,i){const n=this.pointCoordinate(e,t,i,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,t){return!fl(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const i=e.cameraToCenterDistance,n=e._centerAltitude*t,r=e._camera,o=e._camera.forward(),s=Ca([],Ia([],o,-i),[0,0,n]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=Ia([],r.up(),u),d=Ia([],r.right(),u*c),p=Da([],Ca([],Ca([],o,h),d)),f=[];let m;if(new el(s,p).closestPointOnSphere(l,a,f)){const t=Ca([],f,l),i=Na([],t,s);m=Math.cos(e.fovAboveCenter)*Ta(i)}else{const e=Na([],s,l),t=Na([],l,s);Da(t,t);const i=Ta(e)-a;m=Math.sqrt(i*(i+2*a));const n=Math.acos(m/(a+i))-Math.acos(La(o,t));m*=Math.cos(n)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=zl(e.zoom);if(i>0){const n=Mp(e,Wl(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ii(t,n+r*(1-Math.cos(o)),Math.pow(i,10))}return t}upVector(e,t,i){return Cl(t,i,e,1)}upVectorScale(e){return{metersToTile:pl(kl(_l(e)))}}}function Yp(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Vp(e);case"equirectangular":return new Np(e);case"naturalEarth":return new Wp(e);case"equalEarth":return new Fp(e);case"winkelTripel":return new Xp(e);case"albers":return i?new Zp(e):new zp(e);case"lambertConformalConic":return i?new Zp(e):new $p(e);case"globe":return new Hp(e)}throw new Error(`Invalid projection name: ${e.name}`)}const Kp=qu.types,Jp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qp(e,t,i,n,r,o,s,a,l,c,u,h,d){const p=a?Math.min(wp,Math.round(a[0])):0,f=a?Math.min(wp,Math.round(a[1])):0;e.emplaceBack(t,i,Math.round(32*n),Math.round(32*r),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function ef(e,t,i,n,r,o,s){e.emplaceBack(t,i,n,r,o,s)}function tf(e,t,i,n,r){e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r)}function nf(e){for(const t of e.sections)if(lo(t.text))return!0;return!1}class rf{constructor(e){this.layoutVertexArray=new Ho,this.indexArray=new ns,this.programConfigurations=e,this.segments=new oa,this.dynamicLayoutVertexArray=new Wo,this.opacityVertexArray=new Ko,this.placedSymbolArray=new ms,this.globeExtVertexArray=new Yo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,i,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ph.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,zh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Jp,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ih.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Hr(rf,"SymbolBuffers");class of{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new oa,this.collisionVertexArray=new ts,this.collisionVertexArrayExt=new is}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Dh.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Lh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Hr(of,"CollisionBuffers");class sf{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=da([]),this.placementViewportMatrix=da([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nh(this.zoom,t["text-size"]),this.iconSizeData=Nh(this.zoom,t["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),r=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((e=>Ed[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new rf(new Hs(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new rf(new Hs(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new ys,this.lineVertexArray=new xs,this.symbolInstances=new _s}calculateGlyphDependencies(e,t,i,n,r){for(let i=0;i<e.length;i++)if(t[e.charCodeAt(i)]=!0,n&&r){const n=Gh[e.charAt(i)];n&&(t[n.charCodeAt(0)]=!0)}}populate(e,t,i,n){const r=this.layers[0],o=r.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof Lt&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const p=t.iconDependencies,f=t.glyphDependencies,m=t.availableImages,g=new wo(this.zoom);for(const{feature:t,id:l,index:c,sourceLayerIndex:_}of e){const e=r._featureFilter.needGeometry,y=sc(t,e);if(!r._featureFilter.filter(g,y,i))continue;if(e||(y.geometry=oc(t,i,n)),s&&1!==t.type&&i.z<=5){const e=y.geometry,t=.98078528056,n=(e,n)=>La(Cl(e.x,e.y,i,1),Cl(n.x,n.y,i,1))<t;for(let t=0;t<e.length;t++)e[t]=tc(e[t],n)}let x,v;if(u){const e=r.getValueAndResolveTokens("text-field",y,i,m),t=Lt.factory(e);nf(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===xo()||this.hasRTLText&&bo.isParsed())&&(x=Vh(t,r,y))}if(h){const e=r.getValueAndResolveTokens("icon-image",y,i,m);v=e instanceof Rt?e:Rt.fromString(e)}if(!x&&!v)continue;const b=this.sortFeaturesByKey?d.evaluate(y,{},i):void 0;if(this.features.push({id:l,text:x,icon:v,index:c,sourceLayerIndex:_,geometry:y.geometry,properties:t.properties,type:Kp[t.type],sortKey:b}),v&&(p[v.name]=!0),x){const e=a.evaluate(y,{},i).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ed.vertical)>=0;for(const i of x.sections)if(i.image)p[i.image.name]=!0;else{const n=to(x.toString()),r=i.fontStack||e,o=f[r]=f[r]||{};this.calculateGlyphDependencies(i.text,o,t,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},n=[];let r=0;function o(t){n.push(e[t]),r++}function s(e,t,r){const o=i[e];return delete i[e],i[t]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function a(e,i,r){const o=t[i];return delete t[i],t[e]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(e,t,i){const n=i?t[0][t[0].length-1]:t[0][0];return`${e}:${n.x}:${n.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=a(p,f,h),r=s(p,f,n[e].geometry);delete t[p],delete i[f],i[l(d,n[r].geometry,!0)]=r,n[e].geometry=null}else p in i?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=r-1,i[f]=r-1)}return n.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,i,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,i,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Yp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:e,y:i}of t)this.lineVertexArray.emplaceBack(e,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,n,r,o,s,a,l,c,u,h,d,p){const f=e.indexArray,m=e.layoutVertexArray,g=e.globeExtVertexArray,_=e.segments.prepareSegment(4*t.length,m,f,this.canOverlap?o.sortKey:void 0),y=this.glyphOffsetArray.length,x=_.vertexLength,v=this.allowVerticalPlacement&&s===Ed.vertical?Math.PI/2:0,b=o.text&&o.text.sections;for(let n=0;n<t.length;n++){const{tl:r,tr:s,bl:c,br:u,tex:h,pixelOffsetTL:y,pixelOffsetBR:x,minFontScaleX:w,minFontScaleY:S,glyphOffset:T,isSDF:E,sectionIndex:C}=t[n],k=_.vertexLength,M=T[1];if(Qp(m,l.x,l.y,r.x,M+r.y,h.x,h.y,i,E,y.x,y.y,w,S),Qp(m,l.x,l.y,s.x,M+s.y,h.x+h.w,h.y,i,E,x.x,y.y,w,S),Qp(m,l.x,l.y,c.x,M+c.y,h.x,h.y+h.h,i,E,y.x,x.y,w,S),Qp(m,l.x,l.y,u.x,M+u.y,h.x+h.w,h.y+h.h,i,E,x.x,x.y,w,S),a){const{x:t,y:i,z:n}=a.anchor,[r,o,s]=a.up;ef(g,t,i,n,r,o,s),ef(g,t,i,n,r,o,s),ef(g,t,i,n,r,o,s),ef(g,t,i,n,r,o,s),tf(e.dynamicLayoutVertexArray,t,i,n,v)}else tf(e.dynamicLayoutVertexArray,l.x,l.y,l.z,v);f.emplaceBack(k,k+1,k+2),f.emplaceBack(k+1,k+2,k+3),_.vertexLength+=4,_.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),n!==t.length-1&&C===t[n+1].sectionIndex||e.programConfigurations.populatePaintArrays(m.length,o,o.index,{},d,p,b&&b[C])}const w=a?a.anchor:l;e.placedSymbolArray.emplaceBack(w.x,w.y,w.z,l.x,l.y,y,this.glyphOffsetArray.length-y,x,c,u,l.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],s,0,!1,0,h,0)}_commitLayoutVertex(e,t,i,n,r,o,s){e.emplaceBack(t,i,n,r,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,i,n,r,o,s){const a=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let e=0;e<4;e++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new y(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new y(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new y(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new y(e.x1,e.y2)),a.vertexLength+=4;const h=i.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(n,r,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(n,r,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new of(Qo,Rh.members,cs),this.iconCollisionBox=new of(Qo,Rh.members,cs);const i=Uh(this.iconSizeData,e),n=Uh(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(n,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(n,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,i,n){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),o=jh(this.textSizeData,e,r)/Bh;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,i){const n=this.icon.placedSymbolArray.get(i),r=jh(this.iconSizeData,e,n);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,i){e.emplaceBack(t,-i,-i),e.emplaceBack(t,i,-i),e.emplaceBack(t,i,i),e.emplaceBack(t,-i,i)}_updateTextDebugCollisionBoxes(e,t,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,n.padding)}}_updateIconDebugCollisionBoxes(e,t,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceIconSize(e,t,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,n.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Uh(this.iconSizeData,e),n=Uh(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(n,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(n,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(i,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,i,n,r,o,s,a,l){const c={};if(t<i){const{x1:i,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:i,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(n<r){const{x1:t,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(n);c.verticalTextBox={x1:t,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<s){const{x1:t,y1:i,x2:n,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(o);c.iconBox={x1:t,y1:i,x2:n,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:t,y1:i,x2:n,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(a);c.verticalIconBox={x1:t,y1:i,x2:n,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),n=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<n;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),n=[],r=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);n.push(0|Math.round(t*s.tileAnchorX+i*s.tileAnchorY)),r.push(s.featureIndex)}return o.sort(((e,t)=>n[e]-n[t]||r[t]-r[e])),o}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=t;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),n>=0&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),r>=0&&r!==n&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Hr(sf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),sf.MAX_GLYPHS=65535,sf.addDynamicAttributes=tf;const af=new Lo({"symbol-placement":new Io(et.layout_symbol["symbol-placement"]),"symbol-spacing":new Io(et.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Io(et.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zo(et.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Io(et.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Io(et.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Io(et.layout_symbol["icon-ignore-placement"]),"icon-optional":new Io(et.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Io(et.layout_symbol["icon-rotation-alignment"]),"icon-size":new zo(et.layout_symbol["icon-size"]),"icon-text-fit":new Io(et.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Io(et.layout_symbol["icon-text-fit-padding"]),"icon-image":new zo(et.layout_symbol["icon-image"]),"icon-rotate":new zo(et.layout_symbol["icon-rotate"]),"icon-padding":new Io(et.layout_symbol["icon-padding"]),"icon-keep-upright":new Io(et.layout_symbol["icon-keep-upright"]),"icon-offset":new zo(et.layout_symbol["icon-offset"]),"icon-anchor":new zo(et.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Io(et.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Io(et.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Io(et.layout_symbol["text-rotation-alignment"]),"text-field":new zo(et.layout_symbol["text-field"]),"text-font":new zo(et.layout_symbol["text-font"]),"text-size":new zo(et.layout_symbol["text-size"]),"text-max-width":new zo(et.layout_symbol["text-max-width"]),"text-line-height":new zo(et.layout_symbol["text-line-height"]),"text-letter-spacing":new zo(et.layout_symbol["text-letter-spacing"]),"text-justify":new zo(et.layout_symbol["text-justify"]),"text-radial-offset":new zo(et.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Io(et.layout_symbol["text-variable-anchor"]),"text-anchor":new zo(et.layout_symbol["text-anchor"]),"text-max-angle":new Io(et.layout_symbol["text-max-angle"]),"text-writing-mode":new Io(et.layout_symbol["text-writing-mode"]),"text-rotate":new zo(et.layout_symbol["text-rotate"]),"text-padding":new Io(et.layout_symbol["text-padding"]),"text-keep-upright":new Io(et.layout_symbol["text-keep-upright"]),"text-transform":new zo(et.layout_symbol["text-transform"]),"text-offset":new zo(et.layout_symbol["text-offset"]),"text-allow-overlap":new Io(et.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Io(et.layout_symbol["text-ignore-placement"]),"text-optional":new Io(et.layout_symbol["text-optional"])});var lf={paint:new Lo({"icon-opacity":new zo(et.paint_symbol["icon-opacity"]),"icon-color":new zo(et.paint_symbol["icon-color"]),"icon-halo-color":new zo(et.paint_symbol["icon-halo-color"]),"icon-halo-width":new zo(et.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zo(et.paint_symbol["icon-halo-blur"]),"icon-translate":new Io(et.paint_symbol["icon-translate"]),"icon-translate-anchor":new Io(et.paint_symbol["icon-translate-anchor"]),"text-opacity":new zo(et.paint_symbol["text-opacity"]),"text-color":new zo(et.paint_symbol["text-color"],{runtimeType:dt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new zo(et.paint_symbol["text-halo-color"]),"text-halo-width":new zo(et.paint_symbol["text-halo-width"]),"text-halo-blur":new zo(et.paint_symbol["text-halo-blur"]),"text-translate":new Io(et.paint_symbol["text-translate"]),"text-translate-anchor":new Io(et.paint_symbol["text-translate-anchor"])}),layout:af};class cf{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:lt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Hr(cf,"FormatSectionOverride",{omit:["defaultValue"]});class uf extends ia{constructor(e){super(e,lf)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const e=[];for(const t of i)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,i,n){const r=this.layout.get(e).evaluate(t,{},i,n),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Hn(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}(t.properties,r)}createBucket(e){return new sf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of lf.paint.overridableProperties){if(!uf.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new cf(t),n=new Zn(i,t.property.specification);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new Kn("source",n):new Jn("composite",n,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Ao(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&uf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),n=lf.paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof Lt)o(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{r||(t instanceof Ut&&Ft(t.value)===gt?o(t.value.sections):t instanceof qt?o(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramConfiguration(e){return new Zs(this,e)}}var hf={paint:new Lo({"background-color":new Io(et.paint_background["background-color"]),"background-pattern":new Io(et.paint_background["background-pattern"]),"background-opacity":new Io(et.paint_background["background-opacity"])})},df={paint:new Lo({"raster-opacity":new Io(et.paint_raster["raster-opacity"]),"raster-hue-rotate":new Io(et.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Io(et.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Io(et.paint_raster["raster-brightness-max"]),"raster-saturation":new Io(et.paint_raster["raster-saturation"]),"raster-contrast":new Io(et.paint_raster["raster-contrast"]),"raster-resampling":new Io(et.paint_raster["raster-resampling"]),"raster-fade-duration":new Io(et.paint_raster["raster-fade-duration"])})};class pf extends ia{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var ff={paint:new Lo({"sky-type":new Io(et.paint_sky["sky-type"]),"sky-atmosphere-sun":new Io(et.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Io(et.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Io(et.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Io(et.paint_sky["sky-gradient-radius"]),"sky-gradient":new Do(et.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Io(et.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Io(et.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Io(et.paint_sky["sky-opacity"])})};function mf(e,t,i){const n=[0,0,1],r=qa([]);return Za(r,r,i?-b(e)+Math.PI:b(e)),Xa(r,r,-b(t)),Ba(n,n,r),Da(n,n)}const gf={circle:class extends ia{constructor(e){super(e,kc)}createBucket(e){return new cc(e)}queryRadius(e){const t=e;return wc("circle-radius",this,t)+wc("circle-stroke-width",this,t)+Sc(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,n,r,o,s,a){const l=Ec(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return Mc(e,n,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new Zs(this,e)}},heatmap:class extends ia{createBucket(e){return new Dc(e)}constructor(e){super(e,Nc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=jc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return wc("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,n,r,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(t,i);return Mc(e,n,o,s,a,!0,!0,new y(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new Zs(this,e)}},hillshade:class extends ia{constructor(e){super(e,Uc)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ia{constructor(e){super(e,Mu)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(e){return new Zs(this,e)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Cu(e)}queryRadius(){return Sc(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,n,r,o){return!e.queryGeometry.isAboveHorizon&&dc(Tc(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends ia{constructor(e){super(e,ch)}createBucket(e){return new Qu(e)}queryRadius(){return Sc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new Zs(this,e)}queryIntersectsFeature(e,t,i,n,r,o,s,a,l){const c=Ec(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,i),h=this.paint.get("fill-extrusion-base").evaluate(t,i),d=[0,0],p=a&&o.elevation,f=o.elevation?o.elevation.exaggeration():1,m=e.tile.getBucket(this);if(p&&m instanceof Qu){const e=m.centroidVertexArray,t=l+1;t<e.length&&(d[0]=e.geta_centroid_pos0(t),d[1]=e.geta_centroid_pos1(t))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(n=ah([n],[new y(0,0),new y(sa,sa)],e.tileID.canonical).map((e=>e.polygon)).flat());const g=p?a:null,[_,x]=function(e,t,i,n,r,o,s,a,l,c,u){return"globe"===e.projection.name?function(e,t,i,n,r,o,s,a,l,c,u){const h=[],d=[],p=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],g=(e,t,i,n)=>{e[0]=t,e[1]=i,e[2]=n,e[3]=1},_=sh();i>0&&(i+=_),n+=_;for(const _ of t){const t=[],y=[];for(const h of _){const d=h.x+r.x,_=h.y+r.y,x=e.projection.projectTilePoint(d,_,u),v=e.projection.upVector(u,h.x,h.y);let b=i,w=n;if(s){const e=yh(d,_,i,n,s,a,l,c);b+=e.base,w+=e.top}0!==i?g(f,x.x+v[0]*p*b,x.y+v[1]*p*b,x.z+v[2]*p*b):g(f,x.x,x.y,x.z),g(m,x.x+v[0]*p*w,x.y+v[1]*p*w,x.z+v[2]*p*w),Oa(f,f,o),Oa(m,m,o),t.push(new mh(f[0],f[1],f[2])),y.push(new mh(m[0],m[1],m[2]))}h.push(t),d.push(y)}return[h,d]}(e,t,i,n,r,o,s,a,l,c,u):s?function(e,t,i,n,r,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],p=[];for(const c of d){const u=c.x+n.x,d=c.y+n.y,f=yh(u,d,t,i,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,Ga(h,h,r),h[3]=Math.max(h[3],1e-5);const m=new mh(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,Ga(h,h,r),h[3]=Math.max(h[3],1e-5);const g=new mh(h[0]/h[3],h[1]/h[3],h[2]/h[3]);e.push(m),p.push(g)}c.push(e),u.push(p)}return[c,u]}(t,i,n,r,o,s,a,l,c):function(e,t,i,n,r){const o=[],s=[],a=r[8]*t,l=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const t of e){const e=[],i=[];for(const o of t){const t=o.x+n.x,s=o.y+n.y,m=r[0]*t+r[4]*s+r[12],g=r[1]*t+r[5]*s+r[13],_=r[2]*t+r[6]*s+r[14],y=r[3]*t+r[7]*s+r[15],x=m+a,v=g+l,b=_+c,w=Math.max(y+u,1e-5),S=m+h,T=g+d,E=_+p,C=Math.max(y+f,1e-5);e.push(new mh(x/w,v/w,b/w)),i.push(new mh(S/C,T/C,E/C))}o.push(e),s.push(i)}return[o,s]}(t,i,n,r,o)}(o,n,h,u,c,s,g,d,f,o.center.lat,e.tileID.canonical),v=e.queryGeometry;return function(e,t,i){let n=1/0;dc(i,t)&&(n=_h(i,t[0]));for(let r=0;r<t.length;r++){const o=t[r],s=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],s[e+1],s[e],t];uc(i,r)&&(n=Math.min(n,_h(i,r)))}}return n!==1/0&&n}(_,x,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends ia{constructor(e){super(e,kh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Mh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Eh(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new Zs(this,e)}queryRadius(e){const t=e,i=Ah(wc("line-width",this,t),wc("line-gap-width",this,t)),n=wc("line-offset",this,t);return i/2+Math.abs(n)+Sc(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,n,r,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=Tc(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Ah(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),l=this.paint.get("line-offset").evaluate(t,i);return l&&(n=function(e,t){const i=[],n=new y(0,0);for(let r=0;r<e.length;r++){const o=e[r],s=[];for(let e=0;e<o.length;e++){const i=o[e],r=o[e+1],a=0===e?n:i.sub(o[e-1])._unit()._perp(),l=e===o.length-1?n:r.sub(i)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(t)._add(i))}i.push(s)}return i}(n,l*e.pixelToTileUnitsFactor)),function(e,t,i){for(let n=0;n<t.length;n++){const r=t[n];if(e.length>=3)for(let t=0;t<r.length;t++)if(xc(e,r[t]))return!0;if(pc(e,r,i))return!0}return!1}(s,n,a)}isTileClipped(){return!0}},symbol:uf,background:class extends ia{constructor(e){super(e,hf)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ia{constructor(e){super(e,df)}getProgramIds(){return["raster"]}},sky:class extends ia{constructor(e){super(e,ff),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=jc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),n=!i,r=e.style.light,o=r.properties.get("position");return n&&"viewport"===r.properties.get("anchor")&&G("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?mf(o.azimuthal,90-o.polar,t):mf(i[0],90-i[1],t)}const i=this.paint.get("sky-gradient-center");return mf(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};class _f{constructor(e,t,i,n){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,n)}update(e,i,n){const{width:r,height:o}=e,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=t;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!i||!1!==i.premultiply)),n||this.size&&this.size[0]===r&&this.size[1]===o){const{x:t,y:i}=n||{x:0,y:0};e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d?a.texSubImage2D(a.TEXTURE_2D,0,t,i,a.RGBA,a.UNSIGNED_BYTE,e):a.texSubImage2D(a.TEXTURE_2D,0,t,i,r,o,a.RGBA,a.UNSIGNED_BYTE,e.data)}else this.size=[r,o],e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,e):a.texImage2D(a.TEXTURE_2D,0,this.format,r,o,0,this.format,a.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class yf{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class xf{constructor(){this.tasks={},this.taskQueue=[],F(["process"],this),this.invoker=new yf(this.process),this.nextId=0}add(e,t){const i=this.nextId++,n=function({type:e,isSymbolTile:t,zoom:i}){return i=i||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-i:"maybePrepare"===e&&t?400-i:500:200-i:100-i}(t);if(0===n){X();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:t,priority:n,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){X();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class vf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const bf=["tile","layer","source","sourceLayer","state"];class wf{constructor(e,t,i,n,r){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=i,this._y=n,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of bf)void 0!==this[t]&&(e[t]=this[t]);return e}}const Sf=32,Tf=33,Ef=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,n=0,r=0,o=0,s=0,a=0;for(1&t?r=o=s=Sf:i=n=a=Sf;(t>>=1)>1;){const e=i+r>>1,l=n+o>>1;1&t?(r=i,o=n,i=s,n=a):(i=r,n=o,r=s,o=a),s=e,a=l}const l=4*e;Ef[l+0]=i,Ef[l+1]=n,Ef[l+2]=r,Ef[l+3]=o}const Cf=new Uint16Array(2178),kf=new Uint8Array(1089),Mf=new Uint16Array(1089);function Af(e){return 0===e?-.03125:32===e?.03125:0}var Pf=No([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const If={type:2,extent:sa,loadGeometry:()=>[[new y(0,0),new y(sa+1,0),new y(sa+1,sa+1),new y(0,sa+1),new y(0,0)]]};class zf{constructor(e,t,i,n,r){this.tileID=e,this.uid=L(),this.uses=0,this.tileSize=t,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=r,this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Ze.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ap(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const n of e){const e=n.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.id]=n}}return i}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof sf){if(this.hasSymbolBuckets=!0,!i)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof sf&&t.hasRTLText){this.hasRTLText=!0,bo.isLoading()||bo.isLoaded()||"deferred"!==xo()||vo();break}}this.queryPadding=0;for(const e in this.buckets){const i=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(i))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ps}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _f(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _f(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new _f(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,i,n,r,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:s,transform:o,params:r,tileTransform:this.tileTransform},e,t,i):{}}querySourceFeatures(e,t){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const n=i.loadVTLayers(),r=t?t.sourceLayer:"",o=n._geojsonTileLayer||n[r];if(!o)return;const s=hr(t&&t.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let t=0;t<o.length;t++){const n=o.feature(t);if(s.needGeometry){const e=sc(n,!0);if(!s.filter(new wo(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!s.filter(new wo(this.tileID.overscaledZ),n))continue;const h=i.getId(n,r),d=new wf(n,a,l,c,h);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=Z(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let i=!1;if(this.expirationTime>e)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{const n=this.expirationTime-t;n?this.expirationTime=e+Math.max(n,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!t)return;const i=this.latestFeatureIndex.loadVTLayers(),n=t.style.listImages();for(const r in this.buckets){if(!t.style.hasLayer(r))continue;const o=this.buckets[r],s=o.layers[0].sourceLayer||"_geojsonTileLayer",a=i[s],l=e[s];if(!a||!l||0===Object.keys(l).length)continue;if(o.update(l,a,n,this.imageAtlas&&this.imageAtlas.patternPositions||{}),o instanceof Eh||o instanceof Cu){const e=t.style._getSourceCache(o.layers[0].source);t._terrain&&t._terrain.enabled&&e&&o.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const c=t&&t.style&&t.style.getLayer(r);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ze.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ze.now()+e}setTexture(e,t){const i=t.context,n=i.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new _f(i,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const i=oc(If,this.tileID.canonical,this.tileTransform)[0],n=new Uo,r=new us;for(let e=0;e<i.length;e++){const{x:t,y:o}=i[e];n.emplaceBack(t,o),r.emplaceBack(e)}r.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(r),this._tileDebugBuffer=e.createVertexBuffer(n,Qa.members),this._tileDebugSegments=oa.simpleSegment(0,0,n.length,r.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const i=oc(If,this.tileID.canonical,this.tileTransform)[0];let n,r;if(this.isRaster){const e=function(e,t){const i=Ap(e,t),n=Math.pow(2,e.z);for(let r=0;r<Tf;r++)for(let o=0;o<Tf;o++){const s=ql((e.x+(o+Af(o))/Sf)/n),a=Xl((e.y+(r+Af(r))/Sf)/n),l=t.project(s,a),c=r*Tf+o;Cf[2*c+0]=Math.round((l.x*i.scale-i.x)*sa),Cf[2*c+1]=Math.round((l.y*i.scale-i.y)*sa)}kf.fill(0),Mf.fill(0);for(let e=2045;e>=0;e--){const t=4*e,i=Ef[t+0],n=Ef[t+1],r=Ef[t+2],o=Ef[t+3],s=i+r>>1,a=n+o>>1,l=s+a-n,c=a+i-s,u=n*Tf+i,h=o*Tf+r,d=a*Tf+s,p=Math.hypot((Cf[2*u+0]+Cf[2*h+0])/2-Cf[2*d+0],(Cf[2*u+1]+Cf[2*h+1])/2-Cf[2*d+1])>=16;kf[d]=kf[d]||(p?1:0),e<1022&&(kf[d]=kf[d]||kf[(n+c>>1)*Tf+(i+l>>1)]||kf[(o+c>>1)*Tf+(r+l>>1)])}const r=new Vo,o=new ns;let s=0;function a(e,t){const i=t*Tf+e;return 0===Mf[i]&&(r.emplaceBack(Cf[2*i+0],Cf[2*i+1],e*sa/Sf,t*sa/Sf),Mf[i]=++s),Mf[i]-1}function l(e,t,i,n,r,s){const c=e+i>>1,u=t+n>>1;if(Math.abs(e-r)+Math.abs(t-s)>1&&kf[u*Tf+c])l(r,s,e,t,c,u),l(i,n,r,s,c,u);else{const l=a(e,t),c=a(i,n),u=a(r,s);o.emplaceBack(l,c,u)}}return l(0,0,Sf,Sf,Sf,0),l(Sf,Sf,0,0,0,Sf),{vertices:r,indices:o}}(this.tileID.canonical,t);n=e.vertices,r=e.indices}else{n=new Vo,r=new ns;for(const{x:e,y:t}of i)n.emplaceBack(e,t,0,0);const e=_u(n.int16,void 0,4);for(let t=0;t<e.length;t+=3)r.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,Pf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(r),this._tileBoundsSegments=oa.simpleSegment(0,0,n.length,r.length)}_makeGlobeTileDebugBuffers(e,t){const i=t.projection;if(!i||"globe"!==i.name||t.freezeTileCoverage)return;const n=this.tileID.canonical,r=Al(xl(n,t)),o=zl(t.zoom);let s;o>0&&(s=pa(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,n,t,r,s,o),this._makeGlobeTileDebugTextBuffer(e,n,t,r,s,o)}_globePoint(e,t,i,n,r,o,s){let a=Cl(e,t,i);if(o){const r=1<<i.z,l=Vl(n.center.lng),c=Gl(n.center.lat),u=(i.x+.5)/r-l;let h=0;u>.5?h=-1:u<-.5&&(h=1);let d=(e/sa+i.x)/r+h,p=(t/sa+i.y)/r;d=(d-l)*n._pixelsPerMercatorPixel+l,p=(p-c)*n._pixelsPerMercatorPixel+c;const f=[d*n.worldSize,p*n.worldSize,0];Oa(f,f,o),a=yl(a,f,s)}return Oa(a,a,r)}_makeGlobeTileDebugBorderBuffer(e,t,i,n,r,o){const s=new Uo,a=new us,l=new $o,c=(e,c,u,h,d)=>{const p=(u-e)/(d-1),f=(h-c)/(d-1),m=s.length;for(let u=0;u<d;u++){const h=e+u*p,d=c+u*f;s.emplaceBack(h,d);const g=this._globePoint(h,d,t,i,n,r,o);l.emplaceBack(g[0],g[1],g[2]),a.emplaceBack(m+u)}},u=sa;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(a),this._tileDebugBuffer=e.createVertexBuffer(s,Qa.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(l,Ja.members),this._tileDebugSegments=oa.simpleSegment(0,0,s.length,a.length)}_makeGlobeTileDebugTextBuffer(e,t,i,n,r,o){const s=sa/4,a=new Uo,l=new ns,c=new $o,u=25;l.reserve(32),a.reserve(u),c.reserve(u);const h=(e,t)=>u*e+t;for(let e=0;e<u;e++){const l=e*s;for(let e=0;e<u;e++){const u=e*s;a.emplaceBack(u,l);const h=this._globePoint(u,l,t,i,n,r,o);c.emplaceBack(h[0],h[1],h[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const i=h(e,t),n=h(e,t+1),r=h(e+1,t),o=h(e+1,t+1);l.emplaceBack(i,n,r),l.emplaceBack(r,n,o)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(a,Qa.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(c,Ja.members),this._tileDebugTextSegments=oa.simpleSegment(0,0,u,32)}}class Df{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,i){const n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},z(this.stateChanges[e][n],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])i[t]||(this.deletedStates[e][n][t]=null)}else for(const t in i)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(i in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][i]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,t){const i=String(t),n=z({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const i=this.deletedStates[e][t];if(null===i)return{};for(const e in i)delete n[e]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const i={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const i in this.stateChanges[e])this.state[e][i]||(this.state[e][i]={}),z(this.state[e][i],this.stateChanges[e][i]),t[i]=this.state[e][i];i[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const i in this.state[e])t[i]={},this.state[e][i]={};else for(const i in this.deletedStates[e]){if(null===this.deletedStates[e][i])this.state[e][i]={};else if(this.state[e][i])for(const t of Object.keys(this.deletedStates[e][i]))delete this.state[e][i][t];t[i]=this.state[e][i]}i[e]=i[e]||{},z(i[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const n in e)e[n].setFeatureState(i,t)}}class Lf{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const i=this.toIdx(e,t);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Rf(e,t,i,n){let r=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(n[s])<1e-15){if(i[s]<e[s]||i[s]>t[s])return null}else{const a=1/n[s];let l=(e[s]-i[s])*a,c=(t[s]-i[s])*a;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function Of(e,t,i,n,r,o,s,a,l,c,u){const h=n-e,d=r-t,p=o-i,f=s-e,m=a-t,g=l-i,_=u[1]*g-u[2]*m,y=u[2]*f-u[0]*g,x=u[0]*m-u[1]*f,v=h*_+d*y+p*x;if(Math.abs(v)<1e-15)return null;const b=1/v,w=c[0]-e,S=c[1]-t,T=c[2]-i,E=(w*_+S*y+T*x)*b;if(E<0||E>1)return null;const C=S*p-T*d,k=T*h-w*p,M=w*d-S*h,A=(u[0]*C+u[1]*k+u[2]*M)*b;return A<0||E+A>1?null:(f*C+m*k+g*M)*b}function Bf(e,t,i){return(e-t)/(i-t)}function Ff(e,t,i,n,r,o,s,a,l){const c=1<<i,u=o-n,h=s-r,d=(e+1)/c*u+n,p=(t+0)/c*h+r,f=(t+1)/c*h+r;a[0]=(e+0)/c*u+n,a[1]=p,l[0]=d,l[1]=f}class Nf{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let n=Math.ceil(Math.pow(2,t));const r=1/n,o=(e,t,i,n,r)=>{const o=n?1:0,s=(e+1)*i-o,a=t*i,l=(t+1)*i-o;r[0]=e*i,r[1]=a,r[2]=s,r[3]=l};let s=new Lf(n);const a=[];for(let t=0;t<n*n;t++){o(t%n,Math.floor(t/n),r,!1,a);const i=Uf(a[0],a[1],e),l=Uf(a[2],a[1],e),c=Uf(a[2],a[3],e),u=Uf(a[0],a[3],e);s.minimums.push(Math.min(i,l,c,u)),s.maximums.push(Math.max(i,l,c,u)),s.leaves.push(1)}for(i.push(s),n/=2;n>=1;n/=2){const e=i[i.length-1];s=new Lf(n);for(let t=0;t<n*n;t++){o(t%n,Math.floor(t/n),2,!0,a);const i=e.getElevation(a[0],a[1]),r=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),f=Math.min(i.min,r.min,l.min,c.min),m=Math.max(i.max,r.max,l.max,c.max),g=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}i.push(s)}return i}(this.dem),i=t.length-1,n=t[i];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(t,0,0,i,0)}raycastRoot(e,t,i,n,r,o,s=1){return Rf([e,t,-100],[i,n,this.maximums[0]*s],r,o)}raycast(e,t,i,n,r,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,i,n,r,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[a]){Ff(f,m,g,e,t,i,n,u,h);const a=1<<g,l=(f+0)/a,c=(f+1)/a,d=(m+0)/a,_=(m+1)/a,y=Uf(l,d,this.dem)*s,x=Uf(c,d,this.dem)*s,v=Uf(c,_,this.dem)*s,b=Uf(l,_,this.dem)*s,w=Of(u[0],u[1],y,h[0],u[1],x,h[0],h[1],v,r,o),S=Of(h[0],h[1],v,u[0],h[1],b,u[0],u[1],y,r,o),T=Math.min(null!==w?w:Number.MAX_VALUE,null!==S?S:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=za([],r,o,p);if(jf(y,x,b,v,Bf(e[0],u[0],h[0]),Bf(e[1],u[1],h[1]))>=e[2])return p}continue}let _=0;for(let d=0;d<this._siblingOffset.length;d++){Ff((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,i,n,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=Rf(u,h,r,o);if(null!=p){const e=p;l[d]=e;let t=!1;for(let i=0;i<_&&!t;i++)e>=l[c[i]]&&(c.splice(i,0,d),t=!0);t||(c[_]=d),_++}}for(let e=0;e<_;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,i,n,r){if(1===e[n].isLeaf(t,i))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=n-1,s=e[o];let a=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const n=2*t+this._siblingOffset[e][0],r=2*i+this._siblingOffset[e][1],o=s.getElevation(n,r),c=s.isLeaf(n,r),u=this._addNode(o.min,o.max,c);c&&(a|=1<<e),l||(l=u)}for(let n=0;n<this._siblingOffset.length;n++)a&1<<n||this._construct(e,2*t+this._siblingOffset[n][0],2*i+this._siblingOffset[n][1],o,l+n)}}function jf(e,t,i,n,r,o){return Ii(Ii(e,i,o),Ii(t,n,o),r)}function Uf(e,t,i){const n=i.dim,r=k(e*n-.5,0,n-1),o=k(t*n-.5,0,n-1),s=Math.floor(r),a=Math.floor(o),l=Math.min(s+1,n-1),c=Math.min(a+1,n-1);return jf(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),r-s,o-a)}const $f={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Vf(e,t,i){return(256*e*256+256*t+i)/10-1e4}function Gf(e,t,i){return 256*e+t+i/256-32768}class Wf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i,n=!1,r=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return G(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const o=this.dim=t.height-2,s=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=i||"mapbox",this.borderReady=n,!n){for(let e=0;e<o;e++)s[this._idx(-1,e)]=s[this._idx(0,e)],s[this._idx(o,e)]=s[this._idx(o-1,e)],s[this._idx(e,-1)]=s[this._idx(e,0)],s[this._idx(e,o)]=s[this._idx(e,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)],r&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Nf(this)}get(e,t,i=!1){i&&(e=k(e,-1,this.dim),t=k(t,-1,this.dim));const n=4*this._idx(e,t);return("terrarium"===this.encoding?Gf:Vf)(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}static getUnpackVector(e){return $f[e]}get unpackVector(){return $f[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const i=[0,0,0,0],n=Wf.getUnpackVector(t);let r=Math.floor((e+n[3])/n[2]);return i[2]=r%256,r=Math.floor(r/256),i[1]=r%256,r=Math.floor(r/256),i[0]=r,i}getPixels(){return new Fc({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=t*this.dim,r=t*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(t){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-i*this.dim;for(let t=o;t<s;t++)for(let i=n;i<r;i++){const n=4*this._idx(i,t),r=4*this._idx(i+a,t+l);this.pixels[n+0]=e.pixels[r+0],this.pixels[n+1]=e.pixels[r+1],this.pixels[n+2]=e.pixels[r+2],this.pixels[n+3]=e.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Hr(Wf,"DEMData"),Hr(Nf,"DemMinMaxQuadTree",{omit:["dem"]});class qf{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const r={value:t,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),i)),this.data[n].push(r),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,n=void 0===t?0:this.data[i].indexOf(t),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const n of this.data[i])e(n.value)||t.push(n);for(const e of t)this.remove(e.value.tileID,e)}}class Xf{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}Xf.ReadOnly=!1,Xf.ReadWrite=!0,Xf.disabled=new Xf(519,Xf.ReadOnly,[0,1]);const Zf=7680;class Hf{constructor(e,t,i,n,r,o){this.test=e,this.ref=t,this.mask=i,this.fail=n,this.depthFail=r,this.pass=o}}Hf.disabled=new Hf({func:519,mask:0},0,0,Zf,Zf,Zf);class Yf{constructor(e,t,i){this.blendFunction=e,this.blendColor=t,this.mask=i}}Yf.Replace=[1,0],Yf.disabled=new Yf(Yf.Replace,It.transparent,[!1,!1,!1,!1]),Yf.unblended=new Yf(Yf.Replace,It.transparent,[!0,!0,!0,!0]),Yf.alphaBlended=new Yf([1,771],It.transparent,[!0,!0,!0,!0]);const Kf=1029,Jf=2305;class Qf{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}Qf.disabled=new Qf(!1,Kf,Jf),Qf.backCCW=new Qf(!0,Kf,Jf),Qf.backCW=new Qf(!0,Kf,2304),Qf.frontCW=new Qf(!0,1028,2304),Qf.frontCCW=new Qf(!0,1028,Jf);class em extends Qe{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new qf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Df,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager)}}getIds(){return I(this._tiles).map((e=>e.tileID)).sort(tm).map((e=>e.key))}getRenderableIds(e){const t=[];for(const i in this._tiles)this._isIdRenderable(+i,e)&&t.push(this._tiles[i]);return e?t.sort(((e,t)=>{const i=e.tileID,n=t.tileID,r=new y(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),o=new y(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-n.overscaledZ||o.y-r.y||o.x-r.x})).map((e=>e.tileID.key)):t.map((e=>e.tileID)).sort(tm).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(e,t,i,n){if(n)if(e.state="errored",404!==n.status)this._source.fire(new Je(n,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Ze.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ke("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let n=0;n<t.length;n++){const r=t[n];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);i(e,t),i(t,e)}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const n=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,n),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,n){for(const r in this._tiles){let o=this._tiles[r];if(n[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){n[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),n=this._getLoadedTile(t);if(n)return n}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,r=Math.floor(i*n*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),e[n.tileID.key]=n}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let n;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new ph(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(n=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter((e=>this._source.hasTile(e))))):n=[];const r=this._updateRetainedTiles(n);if(im(this._source.type)&&0!==n.length){const e={},t={},i=Object.keys(r);for(const n of i){const i=r[n],o=this._tiles[n];if(!o||o.fadeEndTime&&o.fadeEndTime<=Ze.now())continue;const s=this.findLoadedParent(i,Math.max(i.overscaledZ-em.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),e[s.tileID.key]=s.tileID),t[n]=i}const o=n[n.length-1].overscaledZ;for(const e in this._tiles){const i=this._tiles[e];if(r[e]||!i.hasData())continue;let n=i.tileID;for(;n.overscaledZ>o;){n=n.scaledTo(n.overscaledZ-1);const o=this._tiles[n.key];if(o&&o.hasData()&&t[n.key]){r[e]=i.tileID;break}}}for(const t in e)r[t]||(this._coveredTiles[t]=!0,r[t]=e[t])}for(const e in r)this._tiles[e].clearFadeHold();const o=function(e,t){const i=[];for(const n in e)n in t||i.push(n);return i}(this._tiles,r);for(const e of o){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},n=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),r=e[0].overscaledZ,o=Math.max(r-em.maxOverzooming,this._source.minzoom),s=Math.max(r+em.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);t[i.key]=i,e.hasData()||n<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,n,s,t);for(const n of e){let e=this._tiles[n.key];if(e.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const e=n.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else{const e=n.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let r=e.wasRequested();for(let s=n.overscaledZ-1;s>=o;--s){const o=n.scaledTo(s);if(i[o.key])break;if(i[o.key]=!0,e=this.getTile(o),!e&&r&&(e=this._addTile(o)),e&&(t[o.key]=o,r=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}t.push(n.key);const e=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;n=e}for(const e of t)this._loadedParentTiles[e]=i}}_addTile(e){let t=this._tiles[e.key];if(t)return t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const i=Boolean(t);if(!i){const i=this.map?this.map.painter:null;t=new zf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,i||this._source.fire(new Ke("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,i){const n=[],r=this.transform;if(!r)return n;const o="globe"===r.projection.name,s=Vl(r.center.lng);for(const a in this._tiles){const l=this._tiles[a];if(i&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(k(s,...nm(e,-1))-s),Math.abs(k(s,...nm(e,1))-s)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(k(s,...nm(e,-1))-s),Math.abs(k(s,...nm(e,0))-s),Math.abs(k(s,...nm(e,1))-s)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const i of c){const o=e.containsTile(l,r,t,i);o&&n.push(o)}}return n}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(im(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=Ze.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const n=this._tiles[e];n&&n.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}_preloadTiles(e,t){if(!this._sourceLoaded){const i=()=>{this._sourceLoaded&&(this._source.off("data",i),this._preloadTiles(e,t))};return void this._source.on("data",i)}const i=new Map,n=Array.isArray(e)?e:[e],r=this.map.painter.terrain,o=this.usedForTerrain&&r?r.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)i.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}P(Array.from(i.values()),((e,t)=>{const i=new zf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i)}))}),t)}}function tm(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function im(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function nm(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}em.maxOverzooming=10,em.maxUnderzooming=3;class rm{constructor(e,t,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=i}static create(e,t,i){const n=i||e.findDEMTileFor(t);if(!n||!n.dem)return;const r=n.dem,o=n.tileID,s=1<<t.canonical.z-o.canonical.z;return new rm(n,n.tileSize/sa/s,[(t.canonical.x/s-o.canonical.x)*r.dim,(t.canonical.y/s-o.canonical.y)*r.dim])}tileCoordToPixel(e,t){const i=t*this._scale+this._offset[1],n=Math.floor(e*this._scale+this._offset[0]),r=Math.floor(i);return new y(n,r)}getElevationAt(e,t,i,n){const r=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(o),l=this._dem;return n=!!n,i?Ii(Ii(l.get(s,a,n),l.get(s,a+1,n),o-a),Ii(l.get(s+1,a,n),l.get(s+1,a+1,n),o-a),r-s):l.get(s,a,n)}getElevationAtPixel(e,t,i){return this._dem.get(e,t,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Wl(1,e)*this._dem.stride}}class om{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Xr(sa,16,0),this.featureIndexArray=new bs,this.promoteId=t}insert(e,t,i,n,r,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r,o);const a=this.grid;for(let e=0;e<t.length;e++){const i=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y)}n[0]<sa&&n[1]<sa&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Wu(new md(this.rawTileData)).layers,this.sourceLayerCoder=new vf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,i,n){this.loadVTLayers();const r=e.params||{},o=hr(r.filter),s=e.tileResult,a=e.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,i,n)=>vc(s.bufferedTilespaceGeometry,e,t,i,n)));c.sort(am);let u=null;a.elevation&&c.length>0&&(u=rm.create(a.elevation,this.tileID));const h={};let d;for(let a=0;a<c.length;a++){const l=c[a];if(l===d)continue;d=l;const p=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(h,p,o,r.layers,r.availableImages,t,i,n,((t,i,n,r=0)=>(f||(f=oc(t,this.tileID.canonical,e.tileTransform)),i.queryIntersectsFeature(s,t,n,f,this.z,e.transform,e.pixelPosMatrix,u,r))))}return h}loadMatchingFeature(e,t,i,n,r,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(n&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(n,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const e=sc(m,!0);if(!i.filter(new wo(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new wo(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let t=0;t<p.length;t++){const i=p[t];if(n&&n.indexOf(i)<0)continue;const u=o[i];if(!u)continue;let h={};void 0!==g&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=z({},s[i]);f.paint=sm(f.paint,u.paint,m,h,r),f.layout=sm(f.layout,u.layout,m,h,r);const _=!l||l(m,u,h,d);if(!_)continue;const y=new wf(m,this.z,this.x,this.y,g);y.layer=f;let x=e[i];void 0===x&&(x=e[i]=[]),x.push({featureIndex:c,feature:y,intersectionZ:_})}}lookupSymbolFeatures(e,t,i,n,r,o,s,a){const l={};this.loadVTLayers();const c=hr(r);for(const r of e)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:n,featureIndex:r,layoutVertexArrayOffset:0},c,o,s,a,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:i}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(i),r=this.vtFeatures[n];if(r[t])return r[t];const o=this.vtLayers[n].feature(t);return r[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;if(this.promoteId){const n="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=n&&(i=e.properties[n]),"boolean"==typeof i&&(i=Number(i))}return i}}function sm(e,t,i,n,r){return j(e,((e,o)=>{const s=t instanceof Po?t.get(o):null;return s&&s.evaluate?s.evaluate(i,n,r):s}))}function am(e,t){return t-e}Hr(om,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class lm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Bc({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const i=this.getKey(e,t);return this.positions[i]}trim(){const e=this.width,t=this.height=O(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,i){const n=[];let r=e.length%2==1?-e[e.length-1]*i:0,o=e[0]*i,s=!0;n.push({left:r,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];r=a*i,a+=l,o=a*i,n.push({left:r,right:o,isDash:s,zeroLength:0===l})}return n}addRoundDash(e,t,i){const n=t/2;for(let t=-i;t<=i;t++){const r=this.width*(this.nextRow+i+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/i*(n+1);if(s.isDash){const e=n-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=n-Math.sqrt(u*u+d*d);this.image.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const i=e[t],n=e[t+1];i.zeroLength?e.splice(t,1):n&&n.isDash===i.isDash&&(n.left=i.left,e.splice(t,1))}const i=e[0],n=e[e.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);const r=this.width*this.nextRow;let o=0,s=e[o];for(let i=0;i<this.width;i++){i/s.right>1&&(s=e[++o]);const n=Math.abs(i-s.left),a=Math.abs(i-s.right),l=Math.min(n,a);this.image.data[r+i]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const i=this.getKey(e,t);if(this.positions[i])return this.positions[i];const n="round"===t,r=n?7:0,o=2*r+1;if(this.nextRow+o>this.height)return G("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let t=0;t<e.length;t++)e[t]<0&&(G("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),s+=e[t];if(0!==s){const i=this.width/s,o=this.getDashRanges(e,this.width,i);n?this.addRoundDash(o,i,r):this.addRegularDash(o,"square"===t?.5*i:0)}const a=this.nextRow+r;this.nextRow+=o;const l={tl:[a,r],br:[s,0]};return this.positions[i]=l,l}}Hr(lm,"LineAtlas");const cm=1*Qd;class um{constructor(e){const t={},i=[];for(const n in e){const r=e[n],o=t[n]={};for(const e in r.glyphs){const t=r.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?cm:1,s={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};i.push(s),o[e]=s}}const{w:n,h:r}=bd(i),o=new Bc({width:n||1,height:r||1});for(const i in e){const n=e[i];for(const e in n.glyphs){const r=n.glyphs[+e];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const s=t[i][e],a=r.metrics.localGlyph?cm:1;Bc.copy(r.bitmap,o,{x:0,y:0},{x:s.x+a,y:s.y+a},r.bitmap)}}this.image=o,this.positions=t}}Hr(um,"GlyphAtlas");class hm{constructor(e){this.tileID=new ph(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ap(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,i,n,r){this.status="parsing",this.data=e,this.collisionBoxArray=new ps;const o=new vf(Object.keys(e.layers).sort()),s=new om(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new lm(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:i},u=t.familiesBySource[this.source];for(const t in u){const n=e.layers[t];if(!n)continue;let r=!1,l=!1;for(const e of u[t])"symbol"===e[0].type?r=!0:l=!0;if(!0===this.isSymbolTile&&!r)continue;if(!1===this.isSymbolTile&&!l)continue;1===n.version&&G(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const h=o.encode(t),d=[];for(let e=0;e<n.length;e++){const i=n.feature(e),r=s.getId(i,t);d.push({feature:i,id:r,index:e,sourceLayerIndex:h})}for(const e of u[t]){const t=e[0];void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(dm(e,this.zoom,i),(a[t.id]=t.createBucket({index:s.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:i})).populate(d,c,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(e.map((e=>e.id))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=()=>{if(h)return r(h);if(d&&p&&f){const e=new um(d),t=new Td(p,f);for(const n in a){const r=a[n];r instanceof sf?(dm(r.layers,this.zoom,i),yp(r,d,e.positions,p,t.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection)):r.hasPattern&&(r instanceof Eh||r instanceof Cu||r instanceof Qu)&&(dm(r.layers,this.zoom,i),r.addFeatures(c,this.tileID.canonical,t.patternPositions,i,this.tileTransform))}this.status="done",r(null,{buckets:I(a).filter((e=>!e.isEmpty())),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}},_=j(c.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(_).length?n.send("getGlyphs",{uid:this.uid,stacks:_},((e,t)=>{h||(h=e,d=t,g())}),void 0,!1,m):d={};const y=Object.keys(c.iconDependencies);y.length?n.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,p=t,g())}),void 0,!1,m):p={};const x=Object.keys(c.patternDependencies);x.length?n.send("getImages",{icons:x,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,f=t,g())}),void 0,!1,m):f={},g()}}function dm(e,t,i){const n=new wo(t);for(const t of e)t.recalculate(n,i)}class pm{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,n){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,i]=r.result;return this.scheduler?this.scheduler.add((()=>{n(e,i)}),t):n(e,i),()=>{}}return r.callbacks.push(n),r.cancel||(r.cancel=i(((i,n)=>{r.result=[i,n];for(const e of r.callbacks)this.scheduler?this.scheduler.add((()=>{e(i,n)}),t):e(i,n);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((e=>e!==n)),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}}function fm(e,t,i){const n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const n=de(e.request,((e,n,r,o)=>{e?t(e):n&&t(null,{vectorTile:i?void 0:new Wu(new md(n)),rawData:n,cacheControl:r,expires:o})}));return()=>{n.cancel(),t()}}),t)}const mm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gm{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,i]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const r=mm[15&i];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new gm(s,o,r,e)}constructor(e,t=64,i=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=mm.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return _m(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=i&&c>=t&&c<=n&&l.push(r[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=i&&f>=t&&f<=n&&l.push(r[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:n>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:o}=this,s=[0,n.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)bm(r[2*i],r[2*i+1],e,t)<=l&&a.push(n[i]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];bm(p,f,e,t)<=l&&a.push(n[d]),(0===c?e-i<=p:t-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+i>=p:t+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function _m(e,t,i,n,r,o){if(r-n<=i)return;const s=n+r>>1;ym(e,t,s,n,r,o),_m(e,t,i,n,s-1,1-o),_m(e,t,i,s+1,r,1-o)}function ym(e,t,i,n,r,o){for(;r>n;){if(r-n>600){const s=r-n+1,a=i-n+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);ym(e,t,i,Math.max(n,Math.floor(i-a*c/s+u)),Math.min(r,Math.floor(i+(s-a)*c/s+u)),o)}const s=t[2*i+o];let a=n,l=r;for(xm(e,t,n,i),t[2*r+o]>s&&xm(e,t,n,r);a<l;){for(xm(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*n+o]===s?xm(e,t,n,l):(l++,xm(e,t,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function xm(e,t,i,n){vm(e,i,n),vm(t,2*i,2*n),vm(t,2*i+1,2*n+1)}function vm(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function bm(e,t,i,n){const r=e-i,o=t-n;return r*r+o*o}e.ARRAY_TYPE=ca,e.AUTH_ERR_MSG=ye,e.Aabb=nl,e.Actor=class{constructor(e,i,n){this.target=e,this.parent=i,this.mapId=n,this.callbacks={},this.cancelCallbacks={},F(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=X()?e:t,this.scheduler=new xf}send(e,t,i,n,r=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[s]=i);const a=Y(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:e,hasCallback:!!i,targetMapId:n,mustQueue:r,sourceMapId:this.mapId,data:Jr(t,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(t.mustQueue||X()){const e=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add((()=>this.processTask(i,t)),e&&e.metadata||{type:"message"})}else this.processTask(i,t)}processTask(e,t){if("<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(Qr(t.error)):i(null,Qr(t.data)))}else{const i=Y(this.globalScope)?void 0:[],n=t.hasCallback?(t,n)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Jr(t):null,data:Jr(n,i)},i)}:e=>{},r=Qr(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,n);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],r.source)[e[1]](r,n)}else n(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},e.CanonicalTileID=hh,e.Color=It,e.ColorMode=Yf,e.CullFaceMode=Qf,e.DEMData=Wf,e.DataConstantProperty=Io,e.DedupedRequest=pm,e.DepthMode=Xf,e.EXTENT=sa,e.Elevation=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,n=1<<i,r=Math.floor(e.x),o=Math.floor((e.x-r)*n),s=Math.floor(e.y*n),a=this.findDEMTileFor(new ph(i,r,i,o,s));return!(!a||!a.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const n=this._source();if(!n)return t;if(e.y<0||e.y>1)return t;const r=n.getSource().maxzoom,o=1<<r,s=Math.floor(e.x),a=e.x-s,l=new ph(r,s,r,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*Ii(Ii(u.get(f,m),u.get(f,m+1),p-m),Ii(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,i){const n=1<<e.canonical.z;return this.getAtPointOrZero(new Kl(e.wrap+(e.canonical.x+t/sa)/n,(e.canonical.y+i/sa)/n))}getAtTileOffsetFunc(e,t,i,n){return r=>{const o=this.getAtTileOffset(e,r.x,r.y),s=n.upVector(e.canonical,r.x,r.y);return Ia(s,s,o*n.upVectorScale(e.canonical,t,i).metersToTile),s}}getForTilePoints(e,t,i,n){if(this.isUsingMockSource())return!1;const r=rm.create(this,e,n);return!!r&&(t.forEach((e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],i)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,n=t.tileID,r=1<<e.canonical.z-n.canonical.z;let o=e.canonical.x/r-n.canonical.x,s=e.canonical.y/r-n.canonical.y,a=0;for(let t=0;t<e.canonical.z-n.canonical.z&&!i.leaves[a];t++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=i.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},e.ErrorEvent=Je,e.EvaluationParameters=wo,e.Event=Ke,e.Evented=Qe,e.FillExtrusionBucket=Qu,e.Frustum=il,e.FrustumCorners=tl,e.GLOBE_RADIUS=sl,e.GLOBE_SCALE_MATCH_LATITUDE=45,e.GLOBE_ZOOM_THRESHOLD_MAX=ol,e.GLOBE_ZOOM_THRESHOLD_MIN=rl,e.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const e of this._wireframeSegments)e.destroy()}}_fillGridMeshWithLods(e,t){const i=new Uo,n=new ns,r=[],o=e+1+2,s=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,i)=>{let n=e===o-1?e-2:0===e?e:e-1;return n+=i?24575:0,[n,t]};for(let e=0;e<o;++e)i.emplaceBack(...l(e,0,!0));for(let e=0;e<s;++e)for(let t=0;t<o;++t)i.emplaceBack(...l(t,e,(0===t||t===o-1)&&!0));for(let e=0;e<t.length;++e){const n=t[e];for(let e=0;e<o;++e)i.emplaceBack(...l(e,n,!0))}for(let e=0;e<t.length;++e){const s=n.length,l=t[e]+1+2,c=new ns;for(let i=0;i<l-1;i++){const r=i===l-2,s=r?o*(a-t.length+e-i):o;for(let e=0;e<o-1;e++){const t=i*o+e;0===i||r||0===e||e===o-2?(c.emplaceBack(t+1,t,t+s),c.emplaceBack(t+s,t+s+1,t+1)):(n.emplaceBack(t+1,t,t+s),n.emplaceBack(t+s,t+s+1,t+1))}}const u=oa.simpleSegment(0,s,i.length,n.length-s);for(let e=0;e<c.uint16.length;e+=3)n.emplaceBack(c.uint16[e],c.uint16[e+1],c.uint16[e+2]);const h=oa.simpleSegment(0,s,i.length,n.length-s);r.push({withoutSkirts:u,withSkirts:h})}return{vertices:i,indices:n,segments:r}}_createGrid(e){const t=this._fillGridMeshWithLods(ll,cl);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Qa.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new ns;for(let e=0;e<=ll;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new as,n=new as;this._poleSegments=[];for(let e=0,t=0;e<rl;e++){const r=360/(1<<e);i.emplaceBack(0,-sl,0,.5,0),n.emplaceBack(0,-sl,0,.5,1);for(let e=0;e<=ll;e++){const t=e/ll,o=Ii(0,r,t),[s,a,l]=Tl(Ol,Bl,o,sl);i.emplaceBack(s,a,l,t,0),n.emplaceBack(s,a,l,t,1)}this._poleSegments.push(oa.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Ka,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,Ka,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,t){if(!this._wireframeSegments){const t=new cs,i=ll,n=i+1+2,r=1;this._wireframeSegments=[];for(let e=0,o=0;e<cl.length;e++){const s=cl[e];for(let e=r;e<s+r;e++)for(let o=r;o<i+r;o++){const i=e*n+o;t.emplaceBack(i,i+1),t.emplaceBack(i,i+n),t.emplaceBack(i,i+n+1)}const a=s*i*3;this._wireframeSegments.push(oa.simpleSegment(0,o,(s+1)*n,a)),o+=a}this._wireframeIndexBuffer=e.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},e.GlyphManager=tp,e.ImagePosition=Sd,e.KDBush=gm,e.LivePerformanceUtils=je,e.LngLat=Ul,e.LngLatBounds=aa,e.LocalGlyphMode=ep,e.MAX_MERCATOR_LATITUDE=Hl,e.MercatorCoordinate=Kl,e.ONE_EM=Bh,e.OverscaledTileID=ph,e.PerformanceMarkers=Ne,e.Point=y,e.Properties=Lo,e.RGBAImage=Fc,e.Ray=el,e.RequestManager=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",h,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!xe(e))return e;const i=Ee(e);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!xe(e))return e;const i=Ee(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,n){if(!xe(e))return e;const r=Ee(e);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),i&&r.params.push(`language=${i}`),n&&r.params.push(`worldview=${n}`),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,n){const r=Ee(e);return xe(e)?(r.path=`/styles/v1${r.path}/sprite${t}${i}`,this._makeAPIURL(r,this._customAccessToken||n)):(r.path+=`${t}${i}`,Ce(r))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!xe(e))return e;const n=Ee(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&"raster"!==n.authority&&512===i?"@2x":""}${o.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${r.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${r.TILE_URL_VERSION}${n.path}`);const s=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||r.ACCESS_TOKEN;return r.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,s)}canonicalizeTileURL(e,t){const i=Ee(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${r.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${r.TILE_URL_VERSION}/`,"")}`;let o=i.params;return t&&(o=o.filter((e=>!e.match(/^access_token=/)))),o.length&&(n+=`?${o.join("&")}`),n}canonicalizeTileset(e,t){const i=!!t&&xe(t),n=[];for(const t of e.tiles||[])ve(t)?n.push(this.canonicalizeTileURL(t,i)):n.push(t);return n}_makeAPIURL(e,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=Ee(r.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==n.path&&(e.path=`${n.path}${e.path}`),!r.REQUIRE_ACCESS_TOKEN)return Ce(e);if(t=t||r.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),Ce(e)}},e.ResourceType=le,e.SegmentVector=oa,e.SourceCache=em,e.StencilMode=Hf,e.StructArrayLayout1ui2=us,e.StructArrayLayout2f1f2i16=es,e.StructArrayLayout2i4=Uo,e.StructArrayLayout2ui4=cs,e.StructArrayLayout3f12=is,e.StructArrayLayout3ui6=ns,e.StructArrayLayout4i8=Vo,e.StructArrayLayout5f20=as,e.Texture=_f,e.Tile=zf,e.Transitionable=Eo,e.Uniform1f=Os,e.Uniform1i=class extends Rs{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},e.Uniform2f=class extends Rs{constructor(e){super(e),this.current=[0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},e.Uniform3f=class extends Rs{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},e.Uniform4f=Bs,e.UniformColor=Fs,e.UniformMatrix2f=class extends Rs{constructor(e){super(e),this.current=Us}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},e.UniformMatrix3f=class extends Rs{constructor(e){super(e),this.current=js}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},e.UniformMatrix4f=class extends Rs{constructor(e){super(e),this.current=Ns}set(e,t,i){if(this.fetchUniformLocation(e,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},e.UnwrappedTileID=dh,e.ValidationError=ir,e.VectorTileFeature=qu,e.VectorTileWorkerSource=class extends Qe{constructor(e,t,i,n,r){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=r||fm,this.loading={},this.loaded={},this.deduped=new pm(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler}loadTile(e,t){const i=e.uid,n=e&&e.request,r=n&&n.collectResourceTiming,o=this.loading[i]=new hm(e);o.abort=this.loadVectorData(e,((s,a)=>{const l=!this.loading[i];if(delete this.loading[i],l||s||!a)return o.status="done",l||(this.loaded[i]=o),t(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new Wu(new md(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,i)=>{if(e||!i)return t(e);const o={};if(r){const e=Ve(n);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,z({rawTileData:c.slice(0)},i,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[i]=o}))}reloadTile(e,t){const i=this.loaded,n=e.uid,r=this;if(i&&i[n]){const o=i[n];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain,o.projection=e.projection,o.tileTransform=Ap(e.tileID.canonical,e.projection);const s=(e,i)=>{const n=o.reloadCallback;n&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,n)),t(e,i)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(e,t){const i=e.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,n=e.uid;i&&i[n]&&delete i[n],t()}},e.WritingMode=Ed,e.ZoomDependentExpression=Jn,e.add=Ca,e.addDynamicAttributes=tf,e.adjoint=function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=r*c-n*u,e[2]=n*a-r*s,e[3]=a*l-o*u,e[4]=i*u-r*l,e[5]=r*o-i*a,e[6]=o*c-s*l,e[7]=n*l-i*c,e[8]=i*s-n*o,e},e.asyncAll=P,e.bezier=E,e.bindAll=F,e.boundsAttributes=Pf,e.bufferConvexPolygon=function(e,t){const i=[];for(let n=0;n<e.length;n++){const r=A(n-1,-1,e.length-1),o=A(n+1,-1,e.length-1),s=e[n],a=e[o],l=e[r].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));i.push(s.add(h))}return i},e.cacheEntryPossiblyAdded=function(e){ae++,ae>ne&&(e.getActor().send("enforceCacheSizeLimit",ie),ae=0)},e.calculateGlobeLabelMatrix=function(e,t){const{x:i,y:n}=e.point,r=Il(i,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return fa(r,r,Pl(_l(t)))},e.calculateGlobeMatrix=function(e){const{x:t,y:i}=e.point,{lng:n,lat:r}=e._center;return Il(t,i,e.worldSize,n,r)},e.calculateGlobeMercatorMatrix=function(e){const t=e.pixelsPerMeter,i=t/Wl(1,e.center.lat),n=da(new Float64Array(16));return ma(n,n,[e.point.x,e.point.y,0]),ga(n,n,[i,i,t]),Float32Array.from(n)},e.circumferenceAtLatitude=$l,e.clamp=k,e.clearTileCache=function(e){if(!re())return;const i=t.caches.delete(Q);e&&i.catch(e).then((()=>e()))},e.clipLine=Hd,e.clone=function(e){var t=new ca(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=$,e.collisionCircleLayout=Oh,e.config=r,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.create=function(){var e=new ca(16);return ca!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=ua,e.createExpression=Yn,e.createLayout=No,e.createStyleLayer=function(e){return"custom"===e.type?new pf(e):new gf[e.type](e)},e.cross=Ra,e.degToRad=b,e.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},e.div=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},e.dot=La,e.earthRadius=Fl,e.ease=C,e.easeCubicInOut=T,e.ecefToLatLng=function([e,t,i]){const n=Math.hypot(e,t,i),r=Math.atan2(e,i),o=.5*Math.PI-Math.acos(-t/n);return new Ul(w(r),w(o))},e.emitValidationErrors=Vr,e.endsWith=N,e.enforceCacheSizeLimit=function(e){oe(),ee&&ee.then((t=>{t.keys().then((i=>{for(let n=0;n<i.length-e;n++)t.delete(i[n])}))}))},e.evaluateSizeForFeature=jh,e.evaluateSizeForZoom=Uh,e.evaluateVariableOffset=_p,e.evented=yo,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.exported=Ze,e.exported$1=o,e.extend=z,e.extend$1=tt,e.fillExtrusionHeightLift=sh,e.filterObject=U,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=i+i,a=n+n,l=r+r,c=i*s,u=n*s,h=n*a,d=r*s,p=r*a,f=r*l,m=o*s,g=o*a,_=o*l;return e[0]=1-h-f,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=0,e[3]=-i,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromScaling=xa,e.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return S[t]},e.getAABBPointSquareDist=function(e,t,i){let n=0;for(let r=0;r<2;++r){const o=i?i[r]:0;e[r]>o&&(n+=(e[r]-o)*(e[r]-o)),t[r]<o&&(n+=(o-t[r])*(o-t[r]))}return n},e.getAnchorAlignment=Bd,e.getAnchorJustification=xp,e.getBounds=function(e){let t=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);return{min:new y(t,i),max:new y(n,r)}},e.getColumn=J,e.getDefaultExportFromCjs=d,e.getGridMatrix=function(e,t,i,n){const r=t.getNorth(),o=t.getSouth(),s=t.getWest(),a=t.getEast(),l=1<<e.z,c=a-s,u=r-o,h=c/ll,d=-u/cl[i],p=[0,h,0,d,0,0,r,s,0];if(e.z>0){const e=180/n;ha(p,p,[e/c+1,0,0,0,e/u+1,0,-.5*e/h,.5*e/d,1])}return p[2]=l,p[5]=e.x,p[8]=e.y,p},e.getImage=_e,e.getJSON=function(e,t){return he(z(e,{type:"json"}),t)},e.getLatitudinalLod=function(e){const t=Hl-5;e=k(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(b(e))),3);return Math.round(i*(cl.length-1))},e.getMapSessionAPI=Be,e.getPerformanceMeasurement=Ve,e.getProjection=Yp,e.getRTLTextPluginStatus=xo,e.getReferrer=ue,e.getTilePoint=function(e,{x:t,y:i},n=0){return new y(((t-n)*e.scale-e.x)*sa,(i*e.scale-e.y)*sa)},e.getTileVec3=function(e,t,i=0){return Ea(((t.x-i)*e.scale-e.x)*sa,(t.y*e.scale-e.y)*sa,Zl(t.z,t.y))},e.getVideo=function(e,i){const n=t.document.createElement("video");n.muted=!0,n.onloadstart=function(){i(null,n)};for(let i=0;i<e.length;i++){const r=t.document.createElement("source");pe(e[i])||(n.crossOrigin="Anonymous"),r.src=e[i],n.appendChild(r)}return{cancel:()=>{}}},e.globeCenterToScreenPoint=function(e){const t=[0,0,0],i=da(new Float64Array(16));return fa(i,e.pixelMatrix,e.globeMatrix),Oa(t,t,i),new y(t[0],t[1])},e.globeDenormalizeECEF=Pl,e.globeECEFOrigin=function(e,t){const i=[0,0,0];return Oa(i,i,Al(_l(t.canonical))),Oa(i,i,e),i},e.globeMetersToEcef=pl,e.globeNormalizeECEF=Al,e.globePixelsToTileUnits=function(e,t){return sa/(512*Math.pow(2,e))*kl(_l(t))},e.globePoleMatrixForTile=function(e,t,i){const n=da(new Float64Array(16)),r=(t/(1<<e)-.5)*Math.PI*2;return ya(n,i.globeMatrix,r),Float32Array.from(n)},e.globeTileBounds=_l,e.globeTiltAtLngLat=Dl,e.globeToMercatorTransition=zl,e.globeUseCustomAntiAliasing=function(e,t,i){const n=zl(i.zoom),r=e.style.map._antialias,o=!!t.extStandardDerivatives,s=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===n&&!r&&!s&&o},e.identity=da,e.identity$1=qa,e.invert=pa,e.isFullscreen=function(){return!!t.document.fullscreenElement||!!t.document.webkitFullscreenElement},e.isLngLatBehindGlobe=Ll,e.isMapAuthenticated=function(e){return Fe.has(e)},e.isMapboxURL=xe,e.isSafariWithAntialiasingBug=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!Y(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.latFromMercatorY=Xl,e.latLngToECEF=El,e.len=Ua,e.length=Ta,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.lngFromMercatorX=ql,e.loadVectorTile=fm,e.makeRequest=he,e.mapValue=function(e,t,i,n,r){return k((e-t)/(i-t)*(r-n)+n,n,r)},e.mercatorScale=Yl,e.mercatorXfromLng=Vl,e.mercatorYfromLat=Gl,e.mercatorZfromAltitude=Wl,e.mul=ba,e.mul$1=ja,e.multiply=fa,e.multiply$1=ha,e.multiply$2=Ma,e.nextPowerOfTwo=O,e.normalize=Da,e.normalize$1=Ha,e.normalize$2=Va,e.number=Ii,e.ortho=function(e,t,i,n,r,o,s){var a=1/(t-i),l=1/(n-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(r+n)*l,e[14]=(s+o)*c,e[15]=1,e},e.pbf=Xh,e.perspective=function(e,t,i,n,r){var o,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+n)*(o=1/(n-r)),e[14]=2*r*n*o):(e[10]=-1,e[14]=-2*n),e},e.pick=function(e,t){const i={};for(let n=0;n<t.length;n++){const r=t[n];r in e&&(i[r]=e[r])}return i},e.plugin=bo,e.pointGeometry=g,e.polesInViewport=function(e){const t=da(new Float64Array(16));fa(t,e.pixelMatrix,e.globeMatrix);const i=[0,ul,0],n=[0,hl,0];return Oa(i,i,t),Oa(n,n,t),[i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!Ll(e,new Ul(e.center.lat,90)),n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!Ll(e,new Ul(e.center.lat,-90))]},e.polygonContainsPoint=xc,e.polygonIntersectsBox=vc,e.polygonIntersectsPolygon=uc,e.polygonizeBounds=function(e,t,i=0,n=!0){const r=new y(i,i),o=e.sub(r),s=t.add(r),a=[o,new y(s.x,o.y),s,new y(o.x,s.y)];return n&&a.push(o.clone()),a},e.posAttributes=Qa,e.postMapLoadEvent=De,e.postPerformanceEvent=Re,e.postTurnstileEvent=Ie,e.potpack=bd,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=w,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:fo,pluginURL:mo}),yo.on("pluginStateChange",e),e},e.removeAuthState=function(e){Fe.delete(e)},e.renderColorRamp=jc,e.resample=Ql,e.rotateX=_a,e.rotateX$1=Xa,e.rotateY=ya,e.rotateY$1=Za,e.rotateZ=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*n,e[1]=s*r+u*n,e[2]=a*r+h*n,e[3]=l*r+d*n,e[4]=c*r-o*n,e[5]=u*r-s*n,e[6]=h*r-a*n,e[7]=d*r-l*n,e},e.rotateZ$1=function(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l+r*a,e[1]=r*l-n*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},e.scale=ga,e.scale$1=$a,e.scale$2=Ia,e.scaleAndAdd=za,e.set=function(e,t,i,n){return e[0]=t,e[1]=i,e[2]=n,e},e.setCacheLimits=function(e,t){ie=e,ne=t},e.setColumn=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},e.setRTLTextPlugin=function(e,t,i=!1){if(fo===co||fo===uo||fo===ho)throw new Error("setRTLTextPlugin cannot be called multiple times.");mo=Ze.resolveURL(e),fo=co,po=t,_o(),i||vo()},e.smoothstep=M,e.spec=et,e.squaredLength=function(e){var t=e[0],i=e[1],n=e[2];return t*t+i*i+n*n},e.storeAuthState=function(e,t){t?Fe.add(e):Fe.delete(e)},e.sub=Na,e.subtract=ka,e.symbolSize=$h,e.tileAABB=function(e,t,i,n,r,o,s,a,l){if("globe"===l.name)return bl(e,t,new hh(i,n,r));const c=Ap({z:i,x:n,y:r},l);return new nl([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])},e.tileCornersToBounds=wl,e.tileTransform=Ap,e.transformMat3=function(e,t,i){var n=t[0],r=t[1],o=t[2];return e[0]=n*i[0]+r*i[3]+o*i[6],e[1]=n*i[1]+r*i[4]+o*i[7],e[2]=n*i[2]+r*i[5]+o*i[8],e},e.transformMat4=Oa,e.transformMat4$1=Ga,e.transformQuat=Ba,e.transitionTileAABBinECEF=xl,e.translate=ma,e.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},e.triggerPluginCompletionEvent=go,e.uniqueId=L,e.updateGlobeVertexNormal=function(e,t,i,n,r){const o=5*t+2;e.float32[o+0]=i,e.float32[o+1]=n,e.float32[o+2]=r},e.validateCustomStyleLayer=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.validateFilter=e=>$r(Sr(e)),e.validateFog=e=>$r(Rr(e)),e.validateLayer=e=>$r(Mr(e)),e.validateLight=e=>$r(Dr(e)),e.validateSource=e=>$r(Ir(e)),e.validateStyle=Nr,e.validateTerrain=e=>$r(Lr(e)),e.values=I,e.vectorTile=Du,e.version=i,e.warnOnce=G,e.window=t,e.wrap=A})),n(["./shared"],(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let i="[";for(const n of e)i+=`${t(n)},`;return`${i}]`}let i="{";for(const n of Object.keys(e).sort())i+=`${n}:${t(e[n])},`;return`${i}}`}function i(i){let n="";for(const r of e.refProperties)n+=`/${t(i[r])}`;return n}class n{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,n){for(const i of t)this._layerConfigs[i.id]=i,(this._layers[i.id]=e.createStyleLayer(i)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const r=function(e,t){const n={};for(let r=0;r<e.length;r++){const o=t&&t[e[r].id]||i(e[r]);t&&(t[e[r].id]=o);let s=n[o];s||(s=n[o]=[]),s.push(e[r])}const r=[];for(const e in n)r.push(n[e]);return r}(e.values(this._layerConfigs),this.keyCache);for(const e of r){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const n=i.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(t)}}}class r{loadTile(t,i){const{uid:n,encoding:r,rawImageData:o,padding:s,buildQuadTree:a}=t,l=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap?this.getImageData(o,s):o;i(null,new e.DEMData(n,l,r,s<1,a))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const i=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}function o(e,t){if(0!==e.length){s(e[0],t);for(var i=1;i<e.length;i++)s(e[i],!t)}}function s(e,t){for(var i=0,n=0,r=0,o=e.length,s=o-1;r<o;s=r++){var a=(e[r][0]-e[s][0])*(e[s][1]+e[r][1]),l=i+a;n+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+n>=0!=!!t&&e.reverse()}var a=e.getDefaultExportFromCjs((function e(t,i){var n,r=t&&t.type;if("FeatureCollection"===r)for(n=0;n<t.features.length;n++)e(t.features[n],i);else if("GeometryCollection"===r)for(n=0;n<t.geometries.length;n++)e(t.geometries[n],i);else if("Feature"===r)e(t.geometry,i);else if("Polygon"===r)o(t.coordinates,i);else if("MultiPolygon"===r)for(n=0;n<t.coordinates.length;n++)o(t.coordinates[n],i);return t}));const l=e.VectorTileFeature.prototype.toGeoJSON;var c={exports:{}},u=e.pointGeometry,h=e.vectorTile.VectorTileFeature,d=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function f(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new f(this.features[e],this.options.extent)},f.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var i=e[t],n=[],r=0;r<i.length;r++)n.push(new u(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[t,n,i,r]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=e.pbf,g=d;function _(e){var t=new m;return function(e,t){for(var i in e.layers)t.writeMessage(3,y,e.layers[i])}(e,t),t.finish()}function y(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)n.feature=e.feature(i),t.writeMessage(2,x,n);var r=n.keys;for(i=0;i<r.length;i++)t.writeStringField(3,r[i]);var o=n.values;for(i=0;i<o.length;i++)t.writeMessage(4,T,o[i])}function x(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,v,e),t.writeVarintField(3,i.type),t.writeMessage(4,S,i)}function v(e,t){var i=e.feature,n=e.keys,r=e.values,o=e.keycache,s=e.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(n.push(a),o[a]=c=n.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(r.push(l),s[h]=d=r.length-1),t.writeVarint(d)}}}function b(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function S(e,t){for(var i=e.loadGeometry(),n=e.type,r=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===n&&(c=l.length),t.writeVarint(b(1,c));for(var u=3===n?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==n&&t.writeVarint(b(2,u-1));var d=l[h].x-r,p=l[h].y-o;t.writeVarint(w(d)),t.writeVarint(w(p)),r+=d,o+=p}3===n&&t.writeVarint(b(7,1))}}function T(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}c.exports=_,c.exports.fromVectorTileJs=_,c.exports.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var n in e)i[n]=new g(e[n].features,t),i[n].name=n,i[n].version=t.version,i[n].extent=t.extent;return _({layers:i})},c.exports.GeoJSONWrapper=g;var E=e.getDefaultExportFromCjs(c.exports);const C={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},k=Math.fround||(M=new Float32Array(1),e=>(M[0]=+e,M[0]));var M;const A=3,P=5,I=6;class z{constructor(e){this.options=Object.assign(Object.create(C),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:i,maxZoom:n}=this.options;t&&console.time("total time");const r=`prepare ${e.length} points`;t&&console.time(r),this.points=e;const o=[];for(let t=0;t<e.length;t++){const i=e[t];if(!i.geometry)continue;const[n,r]=i.geometry.coordinates,s=k(R(n)),a=k(O(r));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[n+1]=this._createTree(o);t&&console.timeEnd(r);for(let e=n;e>=i;e--){const i=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,r=180;else if(i>r){const e=this.getClusters([i,n,180,o],t),s=this.getClusters([-180,n,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(R(i),O(o),R(r),O(n)),l=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+P]>1?D(l,t,this.clusterProps):this.points[l[t+A]])}return c}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);const o=r.data;if(t*this.stride>=o.length)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=r.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const t of a){const i=t*this.stride;o[i+4]===e&&l.push(o[i+P]>1?D(o,i,this.clusterProps):this.points[o[i+A]])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,i){const n=[];return this._appendLeaves(n,e,t=t||10,i=i||0,0),n}getTile(e,t,i){const n=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/r,c=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((t-a)/r,l,(t+1+a)/r,c),n.data,t,i,r,u),0===t&&this._addTileFeatures(n.range(1-a/r,l,1,c),n.data,r,i,r,u),t===r-1&&this._addTileFeatures(n.range(0,l,a/r,c),n.data,-1,i,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,n,r){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?r+o.point_count<=n?r+=o.point_count:r=this._appendLeaves(e,o.cluster_id,i,n,r):r<n?r++:e.push(t),e.length===i)break}return r}_createTree(t){const i=new e.KDBush(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)i.add(t[e],t[e+1]);return i.finish(),i.data=t,i}_addTileFeatures(e,t,i,n,r,o){for(const s of e){const e=s*this.stride,a=t[e+P]>1;let l,c,u;if(a)l=L(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const i=this.points[t[e+A]];l=i.properties;const[n,r]=i.geometry.coordinates;c=R(n),u=O(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-i)),Math.round(this.options.extent*(u*r-n))]],tags:l};let d;d=a||this.options.generateId?t[e+A]:this.points[t[e+A]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:i,extent:n,reduce:r,minPoints:o}=this.options,s=i/(n*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=t)continue;a[i+2]=t;const n=a[i],u=a[i+1],h=e.within(a[i],a[i+1],s),d=a[i+P];let p=d;for(const e of h){const i=e*c;a[i+2]>t&&(p+=a[i+P])}if(p>d&&p>=o){let e,o=n*d,s=u*d,f=-1;const m=((i/c|0)<<5)+(t+1)+this.points.length;for(const n of h){const l=n*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+P];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,r&&(e||(e=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(a,l)))}a[i+4]=m,l.push(o/p,s/p,1/0,m,-1,p),r&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[i+e]);if(p>1)for(const e of h){const i=e*c;if(!(a[i+2]<=t)){a[i+2]=t;for(let e=0;e<c;e++)l.push(a[i+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,i){if(e[t+P]>1){const n=this.clusterProps[e[t+I]];return i?Object.assign({},n):n}const n=this.points[e[t+A]].properties,r=this.options.map(n);return i&&r===n?Object.assign({},r):r}}function D(e,t,i){return{type:"Feature",id:e[t+A],properties:L(e,t,i),geometry:{type:"Point",coordinates:[(n=e[t],360*(n-.5)),B(e[t+1])]}};var n}function L(e,t,i){const n=e[t+P],r=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,o=e[t+I],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+A],point_count:n,point_count_abbreviated:r})}function R(e){return e/360+.5}function O(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function B(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function F(e,t,i,n){for(var r,o=n,s=i-t>>1,a=i-t,l=e[t],c=e[t+1],u=e[i],h=e[i+1],d=t+3;d<i;d+=3){var p=N(e[d],e[d+1],l,c,u,h);if(p>o)r=d,o=p;else if(p===o){var f=Math.abs(d-s);f<a&&(r=d,a=f)}}o>n&&(r-t>3&&F(e,t,r,n),e[r+2]=o,i-r>3&&F(e,r,i,n))}function N(e,t,i,n,r,o){var s=r-i,a=o-n;if(0!==s||0!==a){var l=((e-i)*s+(t-n)*a)/(s*s+a*a);l>1?(i=r,n=o):l>0&&(i+=s*l,n+=a*l)}return(s=e-i)*s+(a=t-n)*a}function j(e,t,i,n){var r={id:void 0===e?null:e,type:t,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)U(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<t.length;n++)U(e,t[n]);else if("MultiPolygon"===i)for(n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)U(e,t[n][r])}(r),r}function U(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function $(e,t,i,n){if(t.geometry){var r=t.geometry.coordinates,o=t.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===o)V(r,a);else if("MultiPoint"===o)for(var c=0;c<r.length;c++)V(r[c],a);else if("LineString"===o)G(r,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<r.length;c++)G(r[c],a=[],s,!1),e.push(j(l,"LineString",a,t.properties));return}W(r,a,s,!1)}else if("Polygon"===o)W(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<t.geometry.geometries.length;c++)$(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];W(r[c],u,s,!0),a.push(u)}}e.push(j(l,o,a,t.properties))}}function V(e,t){t.push(q(e[0])),t.push(X(e[1])),t.push(0)}function G(e,t,i,n){for(var r,o,s=0,a=0;a<e.length;a++){var l=q(e[a][0]),c=X(e[a][1]);t.push(l),t.push(c),t.push(0),a>0&&(s+=n?(r*c-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-o,2))),r=l,o=c}var u=t.length-3;t[2]=1,F(t,0,u,i),t[u+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function W(e,t,i,n){for(var r=0;r<e.length;r++){var o=[];G(e[r],o,i,n),t.push(o)}}function q(e){return e/360+.5}function X(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function Z(e,t,i,n,r,o,s,a){if(n/=t,o>=(i/=t)&&s<n)return e;if(s<i||o>=n)return null;for(var l=[],c=0;c<e.length;c++){var u=e[c],h=u.geometry,d=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=i&&f<n)l.push(u);else if(!(f<i||p>=n)){var m=[];if("Point"===d||"MultiPoint"===d)H(h,m,i,n,r);else if("LineString"===d)Y(h,m,i,n,r,!1,a.lineMetrics);else if("MultiLineString"===d)J(h,m,i,n,r,!1);else if("Polygon"===d)J(h,m,i,n,r,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var _=[];J(h[g],_,i,n,r,!0),_.length&&m.push(_)}if(m.length){if(a.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(j(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(j(u.id,d,m,u.tags))}}}return l.length?l:null}function H(e,t,i,n,r){for(var o=0;o<e.length;o+=3){var s=e[o+r];s>=i&&s<=n&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function Y(e,t,i,n,r,o,s){for(var a,l,c=K(e),u=0===r?ee:te,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],_=e[d+4],y=0===r?p:f,x=0===r?g:_,v=!1;s&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-_,2))),y<i?x>i&&(l=u(c,p,f,g,_,i),s&&(c.start=h+a*l)):y>n?x<n&&(l=u(c,p,f,g,_,n),s&&(c.start=h+a*l)):Q(c,p,f,m),x<i&&y>=i&&(l=u(c,p,f,g,_,i),v=!0),x>n&&y<=n&&(l=u(c,p,f,g,_,n),v=!0),!o&&v&&(s&&(c.end=h+a*l),t.push(c),c=K(e)),s&&(h+=a)}var b=e.length-3;p=e[b],f=e[b+1],m=e[b+2],(y=0===r?p:f)>=i&&y<=n&&Q(c,p,f,m),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&Q(c,c[0],c[1],c[2]),c.length&&t.push(c)}function K(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function J(e,t,i,n,r,o){for(var s=0;s<e.length;s++)Y(e[s],t,i,n,r,o,!1)}function Q(e,t,i,n){e.push(t),e.push(i),e.push(n)}function ee(e,t,i,n,r,o){var s=(o-t)/(n-t);return e.push(o),e.push(i+(r-i)*s),e.push(1),s}function te(e,t,i,n,r,o){var s=(o-i)/(r-i);return e.push(t+(n-t)*s),e.push(o),e.push(1),s}function ie(e,t){for(var i=[],n=0;n<e.length;n++){var r,o=e[n],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)r=ne(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){r=[];for(var a=0;a<o.geometry.length;a++)r.push(ne(o.geometry[a],t))}else if("MultiPolygon"===s)for(r=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(ne(o.geometry[a][c],t));r.push(l)}i.push(j(o.id,s,r,o.tags))}return i}function ne(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var n=0;n<e.length;n+=3)i.push(e[n]+t,e[n+1],e[n+2]);return i}function re(e,t){if(e.transformed)return e;var i,n,r,o=1<<e.z,s=e.x,a=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(n=0;n<c.length;n+=2)l.geometry.push(oe(c[n],c[n+1],t,o,s,a));else for(n=0;n<c.length;n++){var h=[];for(r=0;r<c[n].length;r+=2)h.push(oe(c[n][r],c[n][r+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function oe(e,t,i,n,r,o){return[Math.round(i*(e*n-r)),Math.round(i*(t*n-o))]}function se(e,t,i,n,r){for(var o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,ae(s,e[a],o,r);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function ae(e,t,i,n){var r=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)le(s,r,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<r.length;a++)le(s,r[a],e,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)le(s,c[a],e,i,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function le(e,t,i,n,r,o){var s=n*n;if(n>0&&t.size<(r?s:n))i.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>s)&&(i.numSimplified++,a.push(t[l]),a.push(t[l+1])),i.numPoints++;r&&function(e,t){for(var i=0,n=0,r=e.length,o=r-2;n<r;o=n,n+=2)i+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(i>0===t)for(n=0,r=e.length;n<r/2;n+=2){var s=e[n],a=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=s,e[r-1-n]=a}}(a,o),e.push(a)}}function ce(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)$(i,e.features[n],t,n);else $(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(e,t){var i=t.buffer/t.extent,n=e,r=Z(e,1,-1-i,i,0,-1,2,t),o=Z(e,1,1-i,2+i,0,-1,2,t);return(r||o)&&(n=Z(e,1,-i,1+i,0,-1,2,t)||[],r&&(n=ie(r,1).concat(n)),o&&(n=n.concat(ie(o,-1)))),n}(n,t),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ue(e,t,i){return 32*((1<<e)*i+t)+e}function he(t,i){const n=t.tileID.canonical;if(!this._geoJSONIndex)return i(null,null);const r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return i(null,null);const o=new class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t}feature(t){return new class{constructor(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.Point(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const n=[];for(const t of i)n.push(new e.Point(t[0],t[1]));t.push(n)}return t}}toGeoJSON(e,t,i){return l.call(this,e,t,i)}}(this._features[t])}}(r.features);let s=E(o);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),i(null,{vectorTile:o,rawData:s.buffer})}ce.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ce.prototype.splitTile=function(e,t,i,n,r,o,s){for(var a=[e,t,i,n],l=this.options,c=l.debug;a.length;){n=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();var u=1<<t,h=ue(t,i,n),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=se(e,t,i,n,l),this.tileCoords.push({z:t,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,r){if(t===l.maxZoom||t===r)continue;var f=1<<r-t;if(i!==Math.floor(o/f)||n!==Math.floor(s/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var m,g,_,y,x,v,b=.5*l.buffer/l.extent,w=.5-b,S=.5+b,T=1+b;m=g=_=y=null,x=Z(e,u,i-b,i+S,0,d.minX,d.maxX,l),v=Z(e,u,i+w,i+T,0,d.minX,d.maxX,l),e=null,x&&(m=Z(x,u,n-b,n+S,1,d.minY,d.maxY,l),g=Z(x,u,n+w,n+T,1,d.minY,d.maxY,l),x=null),v&&(_=Z(v,u,n-b,n+S,1,d.minY,d.maxY,l),y=Z(v,u,n+w,n+T,1,d.minY,d.maxY,l),v=null),c>1&&console.timeEnd("clipping"),a.push(m||[],t+1,2*i,2*n),a.push(g||[],t+1,2*i,2*n+1),a.push(_||[],t+1,2*i+1,2*n),a.push(y||[],t+1,2*i+1,2*n+1)}}},ce.prototype.getTile=function(e,t,i){var n=this.options,r=n.extent,o=n.debug;if(e<0||e>24)return null;var s=1<<e,a=ue(e,t=(t%s+s)%s,i);if(this.tiles[a])return re(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,u=t,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[ue(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?re(this.tiles[a],r):null):null};class de extends e.VectorTileWorkerSource{constructor(e,t,i,n,r){super(e,t,i,n,he),r&&(this.loadGeoJSON=r)}loadData(t,i){const n=t&&t.request,r=n&&n.collectResourceTiming;this.loadGeoJSON(t,((o,s)=>{if(o||!s)return i(o);if("object"!=typeof s)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{a(s,!0);try{if(t.filter){const i=e.createExpression(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const n=s.features.filter((e=>i.value.evaluate({zoom:0},e)));s={type:"FeatureCollection",features:n}}this._geoJSONIndex=t.cluster?new z(function({superclusterOptions:t,clusterProperties:i}){if(!i||!t)return t;const n={},r={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const t of a){const[o,s]=i[t],a=e.createExpression(s),l=e.createExpression("string"==typeof o?[o,["accumulated"],["get",t]]:o);n[t]=a.value,r[t]=l.value}return t.map=e=>{s.properties=e;const t={};for(const e of a)t[e]=n[e].evaluate(o,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const t of a)o.accumulated=e[t],e[t]=r[t].evaluate(o,s)},t}(t)).load(s.features):function(e,t){return new ce(e,t)}(s,t.geojsonVtOptions)}catch(o){return i(o)}this.loaded={};const l={};if(r){const i=e.getPerformanceMeasurement(n);i&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(i)))}i(null,l)}}))}reloadTile(e,t){const i=this.loaded;return i&&i[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)e.getJSON(t.request,i);else{if("string"!=typeof t.data)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class pe{constructor(t){this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.getProjection({name:"mercator"}),this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:de},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,i){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],i()}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,i){this.isSpriteLoaded[t]=i;for(const n in this.workerSources[t]){const r=this.workerSources[t][n];for(const t in r)r[t]instanceof e.VectorTileWorkerSource&&(r[t].isSpriteLoaded=i,r[t].fire(new e.Event("isSpriteLoaded")))}}setImages(e,t,i){this.availableImages[e]=t;for(const i in this.workerSources[e]){const n=this.workerSources[e][i];for(const e in n)n[e].availableImages=t}i()}enableTerrain(e,t,i){this.terrain=t,i()}setProjection(t,i){this.projections[t]=e.getProjection(i)}setLayers(e,t,i){this.getLayerIndex(e).replace(t),i()}updateLayers(e,t,i){this.getLayerIndex(e).update(t.layers,t.removedIds),i()}loadTile(t,i,n){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;r.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,i.type,i.source).loadTile(r,n)}loadDEMTile(t,i,n){const r=this.enableTerrain?e.extend({buildQuadTree:this.terrain},i):i;this.getDEMWorkerSource(t,i.source).loadTile(r,n)}reloadTile(t,i,n){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;r.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,i.type,i.source).reloadTile(r,n)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source).removeTile(t,i)}removeSource(e,t,i){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const n=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,i):i()}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(t,i,n){try{e.plugin.setState(i);const t=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=t){this.self.importScripts(t);const i=e.plugin.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),i)}}catch(e){n(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new n),t}getWorkerSource(e,t,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][i]){const n={send:(t,i,n,r,o,s)=>{this.actor.send(t,i,n,e,o,s)},scheduler:this.actor.scheduler};this.workerSources[e][t][i]=new this.workerSourceTypes[t](n,this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])}return this.workerSources[e][t][i]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new r),this.demWorkerSources[e][t]}enforceCacheSizeLimit(t,i){e.enforceCacheSizeLimit(i)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new pe(self)),pe})),n(["./shared"],(function(e){function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(!t(e[n],i[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const n in e)if(!t(e[n],i[n]))return!1;return!0}return e===i}var i=n;function n(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{t=new Worker(n),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(n),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===r[t=e&&e.failIfMajorPerformanceCaveat]&&(r[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(e);if(!i)return!1;try{t=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),r[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var r={};function o(t,i,n){const r=e.window.document.createElement(t);return void 0!==i&&(r.className=i),n&&n.appendChild(r),r}function s(t,i,n){const r=e.window.document.createElementNS("http://www.w3.org/2000/svg",t);for(const e of Object.keys(i))r.setAttributeNS(null,e,i[e]);return n&&n.appendChild(r),r}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a=e.window.document&&e.window.document.documentElement.style,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){a&&l&&(c=a[l],a[l]="none")}function h(){a&&l&&(a[l]=c)}function d(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",d,!0)}function p(){e.window.addEventListener("click",d,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",d,!0)}),0)}function f(e,t){const i=e.getBoundingClientRect();return _(e,i,t)}function m(e,t){const i=e.getBoundingClientRect(),n=[];for(let r=0;r<t.length;r++)n.push(_(e,i,t[r]));return n}function g(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function _(t,i,n){const r=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.Point((n.clientX-i.left)*r,(n.clientY-i.top)*r)}function y(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=i*o-r*n;return s?(e[0]=o*(s=1/s),e[1]=-n*s,e[2]=-r*s,e[3]=i*s,e):null}function x(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class v extends e.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}hasImage(e){return!!this.getImage(e)}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(t,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),n=!1),n}_validateStretch(e,t){if(!e)return!0;let i=0;for(const n of e){if(n[0]<i||n[1]<n[0]||t<n[1])return!1;i=n[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,i){const n={};for(const i of t){this.images[i]||this.fire(new e.Event("styleimagemissing",{id:i}));const t=this.images[i];t?n[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,n)}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){const i=this.patterns[t],n=this.getImage(t);if(!n)return null;if(i&&i.position.version===n.version)return i.position;if(i)i.position.version=n.version;else{const i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},r=new e.ImagePosition(i,n);this.patterns[t]={bin:i,position:r}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,i.RGBA),this.atlasTexture&&this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:n}=e.potpack(t),r=this.atlasImage;r.resize({width:i||1,height:n||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],n=i.x+1,o=i.y+1,s=this.images[t].data,a=s.width,l=s.height;e.RGBAImage.copy(s,r,{x:0,y:0},{x:n,y:o},{width:a,height:l}),e.RGBAImage.copy(s,r,{x:0,y:l-1},{x:n,y:o-1},{width:a,height:1}),e.RGBAImage.copy(s,r,{x:0,y:0},{x:n,y:o+l},{width:a,height:1}),e.RGBAImage.copy(s,r,{x:a-1,y:0},{x:n-1,y:o},{width:1,height:l}),e.RGBAImage.copy(s,r,{x:0,y:0},{x:n+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];x(e)&&this.updateImage(t,e)}}}const b=new e.Properties({anchor:new e.DataConstantProperty(e.spec.light.anchor),position:new class{constructor(){this.specification=e.spec.light.position}possiblyEvaluate(t,i){return function([t,i,n]){const r=e.degToRad(i+90),o=e.degToRad(n);return{x:t*Math.cos(r)*Math.sin(o),y:t*Math.sin(r)*Math.sin(o),z:t*Math.cos(o),azimuthal:i,polar:n}}(t.expression.evaluate(i))}interpolate(t,i,n){return{x:e.number(t.x,i.x,n),y:e.number(t.y,i.y,n),z:e.number(t.z,i.z,n),azimuthal:e.number(t.azimuthal,i.azimuthal,n),polar:e.number(t.polar,i.polar,n)}}},color:new e.DataConstantProperty(e.spec.light.color),intensity:new e.DataConstantProperty(e.spec.light.intensity)});class w extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(b),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(e.validateLight,t,i))for(const i in t){const n=t[i];e.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),n):this._transitionable.setValue(i,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,n){return(!n||!1!==n.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}const S=new e.Properties({source:new e.DataConstantProperty(e.spec.terrain.source),exaggeration:new e.DataConstantProperty(e.spec.terrain.exaggeration)});let T=class extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(S),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(t){for(const i in t){const n=t[i];e.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),n):this._transitionable.setValue(i,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}};function E(t,i,n,r){const o=e.smoothstep(45,65,n),[s,a]=C(t,r),l=e.length(i);let c=1-Math.min(1,Math.exp((l-s)/(a-s)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*o*t.alpha}function C(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}const k=new e.Properties({range:new e.DataConstantProperty(e.spec.fog.range),color:new e.DataConstantProperty(e.spec.fog.color),"high-color":new e.DataConstantProperty(e.spec.fog["high-color"]),"space-color":new e.DataConstantProperty(e.spec.fog["space-color"]),"horizon-blend":new e.DataConstantProperty(e.spec.fog["horizon-blend"]),"star-intensity":new e.DataConstantProperty(e.spec.fog["star-intensity"])});class M extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(k),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const t=this._transform,i="globe"===t.projection.name,n=e.globeToMercatorTransition(t.zoom),r=this.properties.get("range"),o=[.5,3];return{range:i?[e.number(o[0],r[0],n),e.number(o[1],r[1],n)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i={}){if(!this._validate(e.validateFog,t,i)){for(const i of Object.keys(e.spec.fog))t&&void 0===t[i]&&(t[i]=e.spec.fog[i].default);for(const i in t){const n=t[i];e.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),n):this._transitionable.setValue(i,n)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.smoothstep(45,65,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,n){const r=e.MercatorCoordinate.fromLngLat(i),o=n.elevation?n.elevation.getAtPointOrZero(r):0,s=[r.x,r.y,o];return e.transformMat4(s,s,n.mercatorFogMatrix),E(t,s,n.pitch,n._fov)}(this.state,t,i):0}getFovAdjustedRange(e){return this._transform.projection.supportsFog?C(this.state,e):[0,1]}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,n){return(!n||!1!==n.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}class A{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const n=this.workerPool.acquire(this.id);for(let e=0;e<n.length;e++){const t=new A.Actor(n[e],i,this.id);t.name=`Worker ${e}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,i,n){e.asyncAll(this.actors,((e,n)=>{e.send(t,i,n)}),n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}function P(t,i,n){return i*(e.EXTENT/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}A.Actor=e.Actor;class I{constructor(e,t,i,n){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(t,i){let n,r;if(t instanceof e.Point||"number"==typeof t[0]){const o=e.Point.convert(t);n=[o],r=i.isPointAboveHorizon(o)}else{const o=e.Point.convert(t[0]),s=e.Point.convert(t[1]);n=[o,s],r=e.polygonizeBounds(o,s).every((e=>i.isPointAboveHorizon(e)))}return new I(n,i.getCameraPoint(),r,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.Point(1,1)):this.screenBounds[1],r=e.polygonizeBounds(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?r[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(r[3]=this.cameraPoint)),e.bufferConvexPolygon(r,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.Point(1,1)):this.screenBounds[1],r=e.polygonizeBounds(i,n,t),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>n.y))+((o.x>i.x)+(o.x>n.x))){case 0:r[0]=o,r[4]=o.clone();break;case 1:r.splice(1,0,o);break;case 2:r[1]=o;break;case 3:r.splice(4,0,o);break;case 5:r.splice(2,0,o);break;case 6:r[3]=o;break;case 7:r.splice(3,0,o);break;case 8:r[2]=o}return r}containsTile(t,i,n,r=0){const o=t.queryPadding/i._pixelsPerMercatorPixel+1,s=n?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let a=t.tileID.wrap+(s.unwrapped?r:0);const l=s.polygon.map((i=>e.getTilePoint(t.tileTransform,i,a)));if(!e.polygonIntersectsBox(l,0,0,e.EXTENT,e.EXTENT))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map((i=>e.getTileVec3(t.tileTransform,i,a))),u=c.map((t=>new e.Point(t[0],t[1]))),h=i.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),d=e.getTileVec3(t.tileTransform,h,a),p=c.map((t=>{const i=e.sub(t,t,d);return e.normalize(i,i),new e.Ray(d,i)})),f=P(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.getBounds(l),m.min.x=e.clamp(m.min.x,0,e.EXTENT),m.min.y=e.clamp(m.min.y,0,e.EXTENT),m.max.x=e.clamp(m.max.x,0,e.EXTENT),m.max.y=e.clamp(m.max.y,0,e.EXTENT),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(e,t){const i=L(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=n,n}}_bufferedCameraMercator(e,t){const i=L(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=n,n}}_projectAndResample(t,i){const n=function(t,i){const n=e.multiply([],i.pixelMatrix,i.globeMatrix),r=[0,-e.GLOBE_RADIUS,0,1],o=[0,e.GLOBE_RADIUS,0,1],s=[0,0,0,1];e.transformMat4$1(r,r,n),e.transformMat4$1(o,o,n),e.transformMat4$1(s,s,n);const a=new e.Point(r[0]/r[3],r[1]/r[3]),l=new e.Point(o[0]/o[3],o[1]/o[3]),c=e.polygonContainsPoint(t,a)&&r[3]<s[3],u=e.polygonContainsPoint(t,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(e,t,i){for(let n=1;n<e.length;n++){const r=D(t.pointCoordinate3D(e[n-1]).x),o=D(t.pointCoordinate3D(e[n]).x);if(i<0){if(r<o)return{idx:n,t:-r/(o-1-r)}}else if(o<r)return{idx:n,t:(1-r)/(o+1-r)}}return null}(t,i,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?z(t.slice(0,d),i):[],m=d<t.length?z(t.slice(d),i):[];f=f.map((t=>new e.Point(D(t.x),t.y))),m=m.map((t=>new e.Point(D(t.x),t.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const _=e.number(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,p);let y;return y=c?[new e.Point(0,_),new e.Point(0,0),new e.Point(1,0),new e.Point(1,_)]:[new e.Point(1,_),new e.Point(1,1),new e.Point(0,1),new e.Point(0,_)],g.push(...y),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:!1}}(t,i);if(n)return n;const r=function(t,i){let n=!1,r=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>r&&(r=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const i=(o+e)%(t.length-1),r=t[i],s=t[i+1];Math.abs(r.x-s.x)>.5&&(r.x<s.x?(r.x+=1,0===i&&(t[t.length-1].x+=1)):(s.x+=1,i+1===t.length-1&&(t[0].x+=1)),n=!0)}const s=e.mercatorXfromLng(i.center.lng);return n&&s<Math.abs(s-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:n}}(z(t,i).map((t=>new e.Point(D(t.x),t.y))),i);return{polygon:r.polygon.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:r.unwrapped}}}function z(t,i){return e.resample(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function D(e){return e<0?1+e%1:e%1}function L(e){return 100*e|0}function R(t,i,n,r,o){const s=function(n,r){if(n)return o(n);if(r){t.url&&r.tiles&&t.tiles&&delete t.tiles;const n=e.pick(e.extend(r,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(n.vectorLayers=r.vector_layers,n.vectorLayerIds=n.vectorLayers.map((e=>e.id))),n.tiles=i.canonicalizeTileset(n,t.url),o(null,n)}};return t.url?e.getJSON(i.transformRequest(i.normalizeSourceURL(t.url,null,n,r),e.ResourceType.Source),s):e.exported.frame((()=>s(null,t)))}class O{constructor(t,i,n){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),n=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*i),r=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*i),o=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*i),s=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*i);return t.x>=n&&t.x<o&&t.y>=r&&t.y<s}}class B{constructor(e,t,i){this.context=e;const n=e.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const F={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class N{constructor(e,t,i,n){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=n,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),e.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const n=t.attributes[this.attributes[i].name];void 0!==n&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,t,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[F[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class j{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class U extends j{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class $ extends j{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class V extends j{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class G extends j{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class W extends j{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class q extends j{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class X extends j{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Z extends j{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class H extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Y extends j{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class K extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class J extends j{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Q extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class ee extends j{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class te extends j{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ie extends j{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ne extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class re extends j{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class oe extends j{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let se,ae=class extends j{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class le extends j{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ce extends j{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ue extends j{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class he extends j{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class de extends j{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class pe extends j{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class fe extends j{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class me extends j{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class ge extends j{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class _e extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ye extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class xe extends j{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class ve extends xe{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class be extends xe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class we extends be{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Se{constructor(e,t,i,n){this.context=e,this.width=t,this.height=i;const r=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new ve(e,r),n&&(this.depthAttachment=new be(e,r))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class Te{constructor(e,t=!1){if(this.gl=e,this.isWebGL2=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),t){const t=e;this.extVertexArrayObject={createVertexArrayOES:t.createVertexArray.bind(e),deleteVertexArrayOES:t.deleteVertexArray.bind(e),bindVertexArrayOES:t.bindVertexArray.bind(e)}}this.clearColor=new U(this),this.clearDepth=new $(this),this.clearStencil=new V(this),this.colorMask=new G(this),this.depthMask=new W(this),this.stencilMask=new q(this),this.stencilFunc=new X(this),this.stencilOp=new Z(this),this.stencilTest=new H(this),this.depthRange=new Y(this),this.depthTest=new K(this),this.depthFunc=new J(this),this.blend=new Q(this),this.blendFunc=new ee(this),this.blendColor=new te(this),this.blendEquation=new ie(this),this.cullFace=new ne(this),this.cullFaceSide=new re(this),this.frontFace=new oe(this),this.program=new ae(this),this.activeTexture=new le(this),this.viewport=new ce(this),this.bindFramebuffer=new ue(this),this.bindRenderbuffer=new he(this),this.bindTexture=new de(this),this.bindVertexBuffer=new pe(this),this.bindElementBuffer=new fe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new me(this),this.pixelStoreUnpack=new ge(this),this.pixelStoreUnpackPremultiplyAlpha=new _e(this),this.pixelStoreUnpackFlipY=new ye(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),t||(this.extTextureHalfFloat=e.getExtension("OES_texture_half_float")),(t||this.extTextureHalfFloat&&e.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t||e.getExtension("OES_standard_derivatives"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new B(this,e,t)}createVertexBuffer(e,t,i){return new N(this,e,t,i)}createRenderbuffer(e,t,i){const n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,i){return new Se(this,e,t,i)}clear({color:e,depth:t,stencil:i}){const n=this.gl;let r=0;e&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(r|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(r|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(r)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(i){t(i.blendFunction,e.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ee extends e.Evented{constructor(t,i,n,r){if(super(),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(i,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.DedupedRequest}load(t){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=R(this._options,this.map._requestManager,i,n,((r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new e.ErrorEvent(r))):o&&(e.extend(this,o),o.bounds&&(this.tileBounds=new O(o.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.extend({},this._options)}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",r,o.bind(this));else if(t.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",r,o.bind(this),void 0,!0);else{const i=e.loadVectorTile.call({deduped:this._deduped},r,((e,i)=>{e||!i?o.call(this,e):(r.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",r,o.bind(this),void 0,!0))}),!0);t.request={cancel:i}}function o(n,r){return delete t.request,t.aborted?i(null):n&&404!==n.status?i(n):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ce extends e.Evented{constructor(t,i,n,r){super(),this.id=t,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},i),e.extend(this,e.pick(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=R(this._options,this.map._requestManager,null,null,((i,n)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new e.ErrorEvent(i)):n&&(e.extend(this,n),n.bounds&&(this.tileBounds=new O(n.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(n.tiles),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const n=e.exported.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),((n,r,o,s)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):n?(t.state="errored",i(n)):r?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s}),t.setTexture(r,this.map.painter),t.state="loaded",e.cacheEntryPossiblyAdded(this.dispatcher),void i(null)):i(null))))}static loadTileData(e,t,i){e.setTexture(t,i)}static unloadTileData(e,t){e.texture&&t.saveTileTexture(e.texture)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ke(t,i,n,r,o,s,a,l){const c=[t,n,o,i,r,s,1,1,1],u=[a,l,1],h=e.adjoint([],c),[d,p,f]=e.transformMat3(u,u,e.transpose(h,h));return e.multiply$1(c,[d,0,0,0,p,0,0,0,f],c)}class Me extends e.Evented{constructor(e,t,i,n){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=t,this._dirty=!1}load(t,i){this._loaded=i||!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),((i,n)=>{if(this._imageRequest=null,this._loaded=!0,i)this.fire(new e.ErrorEvent(i));else if(n){const{HTMLImageElement:i}=e.window;this.image=n instanceof i?e.exported.getImageData(n):n,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const i=t.map(e.MercatorCoordinate.fromLngLat);return this.tileID=function(t){let i=1/0,n=1/0,r=-1/0,o=-1/0;for(const e of t)i=Math.min(i,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y);const s=Math.max(r-i,o-n),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new e.CanonicalTileID(a,Math.floor((i+r)/2*l),Math.floor((n+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray)return;const i=e.tileTransform(this.tileID,this.map.transform.projection),[n,r,o,s]=this.coordinates.map((t=>{const n=i.projection.project(t[0],t[1]);return e.getTilePoint(i,n)._round()}));this.perspectiveTransform=function(t,i,n,r,o,s,a,l,c,u){const h=ke(0,0,t,0,0,i,t,i),d=ke(n,r,o,s,a,l,c,u);return e.multiply$1(d,e.adjoint(h,h),d),[d[6]/d[8]*t/e.EXTENT,d[7]/d[8]*i/e.EXTENT]}(this.width,this.height,n.x,n.y,r.x,r.y,s.x,s.y,o.x,o.y);const a=this._boundsArray=new e.StructArrayLayout4i8;a.emplaceBack(n.x,n.y,0,0),a.emplaceBack(r.x,r.y,e.EXTENT,0),a.emplaceBack(s.x,s.y,0,e.EXTENT),a.emplaceBack(o.x,o.y,e.EXTENT,e.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(a,e.boundsAttributes.members),this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new e.Texture(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ae={vector:Ee,raster:Ce,"raster-dem":class extends Ce{constructor(t,i,n,r){super(t,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,n){e&&(t.state="errored",i(e)),n&&(t.dem=n,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.getImage(this.map._requestManager.transformRequest(n,e.ResourceType.Tile),function(n,o,s,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(n)t.state="errored",i(n);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a});const i=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap&&(null==se&&(se=e.window.OffscreenCanvas&&new e.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof e.window.createImageBitmap),se),n=1-(o.width-e.prevPowerOfTwo(o.width))/2;n<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?o:e.exported.getImageData(o,n),c={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:n};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,o=0===i.x?t.wrap-1:t.wrap,s=(i.x+1+n)%n,a=i.x+1===n?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,o,i.z,r,i.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,r,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,r,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends e.Evented{constructor(t,i,n,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(r),this._data=i.data,this._options=e.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.Event("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.extend({},this.workerOptions),i=this._data;"string"==typeof i?(t.request=this.map._requestManager.transformRequest(e.exported.resolveURL(i),e.ResourceType.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((t,i)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.ErrorEvent(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(t.resourceTiming=i.resourceTiming[this.id]),this.fire(new e.Event("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,i){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(n,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((e,r)=>(delete t.request,t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===n),i(null)))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Me{constructor(e,t,i,n){super(e,t,i,n),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.ResourceType.Source).url);e.getVideo(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Me,canvas:class extends Me{constructor(t,i,n,r){super(t,i,n,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.Evented{constructor(t,i,n,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=i,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new O(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.extend(this,e.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:n}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:n})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const{x:n,y:r,z:o}=t.tileID.canonical,s=new e.window.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:n,y:r,z:o},{signal:s.signal})).then(function(n){return delete t.request,t.aborted?(t.state="unloaded",i(null)):void 0===n?(t.state="errored",i(null)):null===n?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",i(null)):function(t){return t instanceof e.window.ImageData||t instanceof e.window.HTMLCanvasElement||t instanceof e.window.ImageBitmap||t instanceof e.window.HTMLImageElement}(n)?(this.loadTileData(t,n),t.state="loaded",void i(null)):(t.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((e=>{20!==e.code&&(t.state="errored",i(e))})),t.request.cancel=()=>s.abort()}loadTileData(e,t){Ce.loadTileData(e,t,this._map.painter)}unloadTileData(e){Ce.unloadTileData(e,this._map.painter)}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:t,y:i,z:n}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:i,z:n})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Pe=function(t,i,n,r){const o=new Ae[i.type](t,i,n,r);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],o),o};function Ie(t,i){const n=e.identity([]);return e.scale(n,n,[.5*t.width,.5*-t.height,1]),e.translate(n,n,[1,-1,0]),e.multiply(n,n,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(n)}function ze(e,t,i,n,r,o,s,a=!1){const l=e.tilesIn(n,s,a);l.sort(Le);const c=[];for(const n of l)c.push({wrappedTileID:n.tile.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(t,i,e._state,n,r,o,Ie(e.transform,n.tile.tileID),a)});const u=function(e){const t={},i={};for(const n of e){const e=n.queryResults,r=n.wrappedTileID,o=i[r]=i[r]||{};for(const i in e){const n=e[i],r=o[i]=o[i]||{},s=t[i]=t[i]||[];for(const e of n)r[e.featureIndex]||(r[e.featureIndex]=!0,s.push(e))}}return t}(c);for(const t in u)u[t].forEach((t=>{const i=t.feature,n=i.layer;n&&"background"!==n.type&&"sky"!==n.type&&(i.source=n.source,n["source-layer"]&&(i.sourceLayer=n["source-layer"]),i.state=void 0!==i.id?e.getFeatureState(n["source-layer"],i.id):{})}));return u}function De(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),n=[],r={};for(let e=0;e<i.length;e++){const o=i[e],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(n,t))}return n}function Le(e,t){const i=e.tileID,n=t.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}function Re(){return null!=po.workerClass?new po.workerClass:new e.window.Worker(po.workerUrl)}const Oe="mapboxgl_preloaded_worker_pool";class Be{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Be.workerCount;)this.workers.push(new Re);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Oe]}numActive(){return Object.keys(this.active).length}}let Fe;function Ne(){return Fe||(Fe=new Be),Fe}function je(t,i){const n={};for(const e in t)"ref"!==e&&(n[e]=t[e]);return e.refProperties.forEach((e=>{e in i&&(n[e]=i[e])})),n}function Ue(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=je(e[i],t[e[i].ref]));return e}Be.workerCount=2;const $e={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ve(e,t,i){i.push({command:$e.addSource,args:[e,t[e]]})}function Ge(e,t,i){t.push({command:$e.removeSource,args:[e]}),i[e]=!0}function We(e,t,i,n){Ge(e,i,n),Ve(e,t,i)}function qe(e,i,n){let r;for(r in e[n])if(e[n].hasOwnProperty(r)&&"data"!==r&&!t(e[n][r],i[n][r]))return!1;for(r in i[n])if(i[n].hasOwnProperty(r)&&"data"!==r&&!t(e[n][r],i[n][r]))return!1;return!0}function Xe(e,i,n,r,o,s){let a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(t(e[a],i[a])||n.push({command:s,args:[r,a,i[a],o]}));for(a in i)i.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(t(e[a],i[a])||n.push({command:s,args:[r,a,i[a],o]}))}function Ze(e){return e.id}function He(e,t){return e[t.id]=t,e}class Ye{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);let i=1,n=this._distances[i];const r=t*this.paddedLength+this.padding;for(;n<r&&i<this._distances.length;)n=this._distances[++i];const o=i-1,s=this._distances[o],a=n-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class Ke{constructor(e,t,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(e,t,i,n){this._forEachCell(t-n,i-n,t+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(n)}_insertBoxCell(e,t,i,n,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,i,n,r,o){this.circleCells[r].push(o)}_query(e,t,i,n,r,o){if(i<0||e>this.width||n<0||t>this.height)return!r&&[];const s=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=n){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],n=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-n,y1:i-n,x2:t+n,y2:i+n})}return o?s.filter(o):s}return this._forEachCell(e,t,i,n,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?s.length>0:s}_queryCircle(e,t,i,n,r){const o=e-i,s=e+i,a=t-i,l=t+i;if(s<0||o>this.width||l<0||a>this.height)return!n&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:n,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},r),n?c.length>0:c}query(e,t,i,n,r){return this._query(e,t,i,n,!1,r)}hitTest(e,t,i,n,r){return this._query(e,t,i,n,!0,r)}hitTestCircle(e,t,i,n){return this._queryCircle(e,t,i,!0,n)}_queryCell(e,t,i,n,r,o,s,a){const l=s.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&i>=r[c+0]&&n>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,i,n)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=r[u],t=r[u+1],i=r[u+2];o.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,n,r,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,i,n,r,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,i,n,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,n,r,o){const s=n-e,a=r-t,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,i,n,r,o,s){const a=(o-n)/2,l=Math.abs(e-(n+a));if(l>a+i)return!1;const c=(s-r)/2,u=Math.abs(t-(r+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}const Je={unknown:0,flipRequired:1,flipNotRequired:2},Qe=Math.tan(85*Math.PI/180);function et(t,i,n,r,o,s,a){const l=e.create();if(n)if("globe"===s.name){const t=e.calculateGlobeLabelMatrix(o,i);e.multiply(l,l,t)}else{const t=y([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],r||e.rotateZ(l,l,o.angle)}else e.multiply(l,o.labelPlaneMatrix,t);return l}function tt(e,t,i,n,r,o,s){const a=et(e,t,i,n,r,o,s);return"globe"===o.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function it(t,i,n,r,o,s,a){if(n){if("globe"===s.name){const l=et(t,i,n,r,o,s,a);return e.invert(l,l),e.multiply(l,t,l),l}{const i=e.clone(t),n=e.identity([]);return n[0]=a[0],n[1]=a[1],n[4]=a[2],n[5]=a[3],e.multiply(i,i,n),r||e.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function nt(t,i,n,r){const o=[t,i,n,1];n?e.transformMat4$1(o,o,r):ft(o,o,r);const s=o[3];return o[0]/=s,o[1]/=s,o[2]/=s,o}function rt(e,t){return Math.min(.5+e/t*.5,1.5)}function ot(e,t){const i=e[0]/e[3],n=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&n>=-t[1]&&n<=t[1]}function st(t,i,n,r,o,s,a,l,c,u){const h=n.transform,d=r?t.textSizeData:t.iconSizeData,p=e.evaluateSizeForZoom(d,n.transform.zoom),f="globe"===h.projection.name,m=[256/n.width*2+1,256/n.height*2+1],g=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let _=null;f&&(_=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,x=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,v=n.transform.width/n.transform.height;let b,w=!1;for(let r=0;r<x.length;r++){const f=x.get(r),{numGlyphs:S,writingMode:T}=f;if(T!==e.WritingMode.vertical||w||b===e.WritingMode.horizontal||(w=!0),b=T,(f.hidden||T===e.WritingMode.vertical)&&!w){pt(S,g);continue}w=!1;const E=new e.Point(f.tileAnchorX,f.tileAnchorY);let{x:C,y:k,z:M}=h.projection.projectTilePoint(E.x,E.y,u.canonical);if(c){const[e,t,i]=c(E);C+=e,k+=t,M+=i}const A=[C,k,M,1];if(e.transformMat4$1(A,A,i),!ot(A,m)){pt(S,g);continue}const P=rt(n.transform.cameraToCenterDistance,A[3]),I=e.evaluateSizeForFeature(d,p,f),z=a?I/P:I*P,D=nt(C,k,M,o);if(D[3]<=0){pt(S,g);continue}let L={};const R=a?null:c,O=ct(f,z,!1,l,i,o,s,t.glyphOffsetArray,y,g,_,D,E,L,v,R,h.projection,u,a);w=O.useVertical,R&&O.needsFlipping&&(L={}),(O.notEnoughRoom||w||O.needsFlipping&&ct(f,z,!0,l,i,o,s,t.glyphOffsetArray,y,g,_,D,E,L,v,R,h.projection,u,a).notEnoughRoom)&&pt(S,g)}r?(t.text.dynamicLayoutVertexBuffer.updateData(g),_&&t.text.globeExtVertexBuffer.updateData(_)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),_&&t.icon.globeExtVertexBuffer.updateData(_))}function at(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=a,x=_+a.numGlyphs,v=g+a.lineLength,b=t.getoffsetX(_),w=t.getoffsetX(x-1),S=dt(e*b,i,n,r,o,s,y,g,v,l,c,u,h,d,!0,p,f,m);if(!S)return null;const T=dt(e*w,i,n,r,o,s,y,g,v,l,c,u,h,d,!0,p,f,m);return T?{first:S,last:T}:null}function lt(t,i,n,r){return t===e.WritingMode.horizontal&&Math.abs(r)>Math.abs(n)?{useVertical:!0}:t===e.WritingMode.vertical?r>0?{needsFlipping:!0}:null:i!==Je.unknown&&function(e,t){return 0===e||Math.abs(t/e)>Qe}(n,r)?i===Je.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function ct(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,x){const v=i/24,b=t.lineOffsetX*v,w=t.lineOffsetY*v,{lineStartIndex:S,glyphStartIndex:T,numGlyphs:E,segment:C,writingMode:k,flipState:M}=t,A=S+t.lineLength,P=t=>{if(h){const[i,n,r]=t.up,o=u.length;e.updateGlobeVertexNormal(h,o+0,i,n,r),e.updateGlobeVertexNormal(h,o+1,i,n,r),e.updateGlobeVertexNormal(h,o+2,i,n,r),e.updateGlobeVertexNormal(h,o+3,i,n,r)}const[i,n,r]=t.point;e.addDynamicAttributes(u,i,n,r,t.angle)};if(E>1){const e=at(v,l,b,w,n,d,p,t,c,s,f,g,!1,_,y,x);if(!e)return{notEnoughRoom:!0};if(r&&!n){let[i,n,r]=e.first.point,[o,s,l]=e.last.point;[i,n]=nt(i,n,r,a),[o,s]=nt(o,s,l,a);const c=lt(k,M,(o-i)*m,s-n);if(t.flipState=c&&c.needsFlipping?Je.flipRequired:Je.flipNotRequired,c)return c}P(e.first);for(let e=T+1;e<T+E-1;e++){const t=dt(v*l.getoffsetX(e),b,w,n,d,p,C,S,A,c,s,f,g,!1,!1,_,y,x);if(!t)return u.length-=4*(e-T),{notEnoughRoom:!0};P(t)}P(e.last)}else{if(r&&!n){const i=nt(p.x,p.y,0,o),n=S+C+1,r=new e.Point(c.getx(n),c.gety(n)),s=nt(r.x,r.y,0,o),a=s[3]>0?s:ht(p,r,i,1,o,void 0,_,y.canonical),l=lt(k,M,(a[0]-i[0])*m,a[1]-i[1]);if(t.flipState=l&&l.needsFlipping?Je.flipRequired:Je.flipNotRequired,l)return l}const i=dt(v*l.getoffsetX(T),b,w,n,d,p,C,S,A,c,s,f,g,!1,!1,_,y,x);if(!i)return{notEnoughRoom:!0};P(i)}return{}}function ut(e,t,i,n,r){const{x:o,y:s,z:a}=n.projectTilePoint(e.x,e.y,t);if(!r)return nt(o,s,a,i);const[l,c,u]=r(e);return nt(o+l,s+c,a+u,i)}function ht(t,i,n,r,o,s,a,l){const c=ut(t.sub(i)._unit()._add(t),l,o,a,s);return e.sub(c,n,c),e.normalize(c,c),e.scaleAndAdd(c,n,c,r)}function dt(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y){const x=r?t-i:t+i;let v=x>0?1:-1,b=0;r&&(v*=-1,b=Math.PI),v<0&&(b+=Math.PI);let w=l+a+(v>0?0:1)|0,S=o,T=o,E=0,C=0;const k=Math.abs(x),M=[],A=[];let P=s,I=P;const z=()=>ht(I,P,T,k-E+1,h,p,g,_.canonical);for(;E+C<=k;){if(w+=v,w<l||w>=c)return null;if(T=S,I=P,M.push(T),f&&A.push(I),P=new e.Point(u.getx(w),u.gety(w)),S=d[w],!S){const e=ut(P,_.canonical,h,g,p);S=e[3]>0?d[w]=e:z()}E+=C,C=e.distance(T,S)}m&&p&&(d[w]&&(S=z(),C=e.distance(T,S)),d[w]=S);const D=(k-E)/C,L=P.sub(I)._mult(D)._add(I),R=e.sub([],S,T),O=e.scaleAndAdd([],T,R,D);let B=[0,0,1],F=R[0],N=R[1];if(y&&(B=g.upVector(_.canonical,L.x,L.y),0!==B[0]||0!==B[1]||1!==B[2])){const t=[B[2],0,-B[0]],i=e.cross([],B,t);e.normalize(t,t),e.normalize(i,i),F=e.dot(R,t),N=e.dot(R,i)}if(n){const t=e.cross([],B,R);e.normalize(t,t),e.scaleAndAdd(O,O,t,n*v)}const j=b+Math.atan2(N,F);return M.push(O),f&&A.push(L),{point:O,angle:j,path:M,tilePath:A,up:B}}function pt(e,t){const i=t.length,n=i+4*e;t.resize(n),t.float32.fill(-1/0,4*i,4*n)}function ft(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e[3]=i[3]*n+i[7]*r+i[15],e}const mt=100;class gt{constructor(e,t,i=new Ke(e.width+200,e.height+200,25),n=new Ke(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+mt,this.screenBottomBoundary=e.height+mt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,n,r,o,s,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,d=i.tileID,p=e.getProjection();if(h&&d){const[e,t,n]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),r=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*r,c+=t*h*r,u+=n*h*r}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,i.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=o*f.perspectiveRatio,g=(i.x1*t+n.x-i.padding)*m+f.point.x,_=(i.y1*t+n.y-i.padding)*m+f.point.y,y=(i.x2*t+n.x+i.padding)*m+f.point.x,x=(i.y2*t+n.y+i.padding)*m+f.point.y,v=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,_,y,x)||!r&&this.grid.hitTest(g,_,y,x,a)||v?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,_,y,x],offscreen:this.isOffscreen(g,_,y,x),occluded:!1}}placeCollisionCircles(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=[],_=this.transform.elevation,y=t.getProjection(),x=_?_.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,v=new e.Point(n.tileAnchorX,n.tileAnchorY);let{x:b,y:w,z:S}=y.projectTilePoint(v.x,v.y,m.canonical);if(x){const[e,t,i]=x(v);b+=e,w+=t,S+=i}const T="globe"===y.name,E=this.projectAndGetPerspectiveRatio(a,b,w,S,m,T||!!_||this.transform.pitch>0,y),{perspectiveRatio:C}=E,k=(h?s/C:s*C)/e.ONE_EM,M=nt(b,w,S,l),A=E.signedDistanceFromCamera>0?at(k,o,n.lineOffsetX*k,n.lineOffsetY*k,!1,M,v,n,r,l,{},_&&!h?x:null,h&&!!_,y,m,h):null;let P=!1,I=!1,z=!0;if(A&&!E.occluded){const t=.5*p*C+f,n=new e.Point(-100,-100),r=new e.Point(this.screenRightBoundary,this.screenBottomBoundary),o=new Ye,{first:s,last:a}=A,l=s.path.length;let h=[];for(let e=l-1;e>=1;e--)h.push(s.path[e]);for(let e=1;e<a.path.length;e++)h.push(a.path[e]);const m=2.5*t;c&&(h=h.map((([e,t,i],n)=>(x&&!T&&(i=x(n<l-1?s.tilePath[l-1-n]:a.tilePath[n-l+2])[2]),nt(e,t,i,c)))),h.some((e=>e[3]<=0))&&(h=[]));let _=[];if(h.length>0){let t=1/0,i=-1/0,o=1/0,s=-1/0;for(const e of h)t=Math.min(t,e[0]),o=Math.min(o,e[1]),i=Math.max(i,e[0]),s=Math.max(s,e[1]);i>=n.x&&t<=r.x&&s>=n.y&&o<=r.y&&(_=[h.map((t=>new e.Point(t[0],t[1])))],(t<n.x||i>r.x||o<n.y||s>r.y)&&(_=e.clipLine(_,n.x,n.y,r.x,r.y)))}for(const e of _){o.reset(e,.25*t);let n=0;n=o.length<=.5*t?1:Math.ceil(o.paddedLength/m)+1;for(let e=0;e<n;e++){const r=e/Math.max(n-1,1),s=o.lerp(r),a=s.x+mt,l=s.y+mt;g.push(a,l,t,0);const c=a-t,h=l-t,p=a+t,f=l+t;if(z=z&&this.isOffscreen(c,h,p,f),I=I||this.isInsideGrid(c,h,p,f),!i&&this.grid.hitTestCircle(a,l,t,d)&&(P=!0,!u))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!u&&P||!I?[]:g,offscreen:z,collisionDetected:P,occluded:E.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,r=1/0,o=-1/0,s=-1/0;for(const a of t){const t=new e.Point(a.x+mt,a.y+mt);n=Math.min(n,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),i.push(t)}const a=this.grid.query(n,r,o,s).concat(this.ignoredGrid.query(n,r,o,s)),l={},c={};for(const t of a){const n=t.key;if(void 0===l[n.bucketInstanceId]&&(l[n.bucketInstanceId]={}),l[n.bucketInstanceId][n.featureIndex])continue;const r=[new e.Point(t.x1,t.y1),new e.Point(t.x2,t.y1),new e.Point(t.x2,t.y2),new e.Point(t.x1,t.y2)];e.polygonIntersectsPolygon(i,r)&&(l[n.bucketInstanceId][n.featureIndex]=!0,void 0===c[n.bucketInstanceId]&&(c[n.bucketInstanceId]=[]),c[n.bucketInstanceId].push(n.featureIndex))}return c}insertCollisionBox(e,t,i,n,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,n,r){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:n,collisionGroupID:r};for(let t=0;t<e.length;t+=4)o.insertCircle(s,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,i,n,r,o,s,a){const l=[i,n,r,1];let c=!1;if(r||this.transform.pitch>0){if(e.transformMat4$1(l,l,t),this.fogState&&o&&"globe"!==a.name){const t=function(t,i,n,r,o,s){const a=s.calculateFogTileMatrix(o),l=[i,n,r];return e.transformMat4(l,l,a),E(t,l,s.pitch,s._fov)}(this.fogState,i,n,r,o.toUnwrapped(),this.transform);c=t>.9}}else ft(l,l,t);const u=l[3];return{point:new e.Point((l[0]/u+1)/2*this.transform.width+mt,(-l[1]/u+1)/2*this.transform.height+mt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:s&&l[2]>u||c}}isOffscreen(e,t,i,n){return i<mt||e>=this.screenRightBoundary||n<mt||t>this.screenBottomBoundary}isInsideGrid(e,t,i,n){return i>=0&&e<this.gridRightBoundary&&n>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}function _t(t,i,n){const r=i.createTileMatrix(t,t.worldSize,n.toUnwrapped());return e.multiply(new Float32Array(16),t.projMatrix,r)}function yt(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const n=i.clone();return n.setProjection(t.projection),_t(n,t.getProjection(),e)}function xt(e,t,i){return t.name===i.projection.name?e.projMatrix:_t(i,t,e)}class vt{constructor(e,t,i,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class bt{constructor(e,t,i,n,r,o=!1){this.text=new vt(e?e.text:null,t,i,r),this.icon=new vt(e?e.icon:null,t,n,r),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class wt{constructor(e,t,i,n=!1){this.text=e,this.icon=t,this.skipFade=i,this.clipped=n}}class St{constructor(){this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]}}class Tt{constructor(e,t,i,n,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r}}class Et{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Ct(t,i,n,r,o){const{horizontalAlign:s,verticalAlign:a}=e.getAnchorAlignment(t),l=-(s-.5)*i,c=-(a-.5)*n,u=e.evaluateVariableOffset(t,r);return new e.Point(l+u[0]*o,c+u[1]*o)}function kt(t,i,n,r,o){const s=new e.Point(t,i);return n&&s._rotate(r?o:-o),s}class Mt{constructor(e,t,i,n,r){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new gt(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Et(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,n,r){const o=n.getBucket(i),s=n.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=o.layers[0].layout,l=n.collisionBoxArray,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/e.EXTENT,h=n.tileID.toUnwrapped();this.transform.setProjection(o.projection);const d=(p=n.tileID,f=o.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):_t(m,f,p));var p,f,m;const g="map"===a.get("text-pitch-alignment"),_="map"===a.get("text-rotation-alignment");i.compileFilter();const y=i.dynamicFilter(),x=i.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(n),b=tt(d,n.tileID.canonical,g,_,this.transform,o.getProjection(),v);let w=null;if(g){const t=it(d,n.tileID.canonical,g,_,this.transform,o.getProjection(),v);w=e.multiply([],this.transform.labelPlaneMatrix,t)}let S=null;y&&n.latestFeatureIndex&&(S={unwrappedTileID:h,dynamicFilter:y,dynamicFilterNeedsFeature:x,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new Tt(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,n.tileID);const T={bucket:o,layout:a,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:S,scale:c,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const e of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r}=e;t.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r,parameters:T})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:T})}attemptAnchorPlacement(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_){const{textOffset0:y,textOffset1:x,crossTileID:v}=h,b=[y,x],w=Ct(e,i,n,b,r),S=this.collisionIndex.placeCollisionBox(p,r,t,kt(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(_,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,kt(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(S.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[v]&&this.prevPlacement.placements[v]&&this.prevPlacement.placements[v].text&&(t=this.prevPlacement.variableOffsets[v].anchor),this.variableOffsets[v]={textOffset:b,width:i,height:n,anchor:e,textScale:r,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[v]=f),{shift:w,placedGlyphBoxes:S}}}placeLayerBucketPart(t,i,n,r){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=t.parameters,_=s.get("text-optional"),y=s.get("icon-optional"),x=s.get("text-allow-overlap"),v=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),w="map"===s.get("text-pitch-alignment"),S="none"!==s.get("icon-text-fit"),T="viewport-y"===s.get("symbol-z-order");this.transform.setProjection(o.projection);let E=x&&(v||!o.hasIconData()||y),C=v&&(x||!o.hasTextData()||_);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),n&&r&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const k=(t,r,p)=>{const{crossTileID:T,numVerticalGlyphVertices:k}=t;if(u){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let r=null;if(u.dynamicFilterNeedsFeature){const e=this.retainedQueryData[o.bucketInstanceId];r=u.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(n,r,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new e.Point(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[T]=new wt(!1,!1,!1,!0),void i.add(T)}if(i.has(T))return;if(d)return void(this.placements[T]=new wt(!1,!1,!1));let M=!1,A=!1,P=!0,I=!1,z=!1,D=null,L={box:null,offscreen:null,occluded:null},R={box:null,offscreen:null,occluded:null},O=null,B=null,F=null,N=0,j=0,U=0;p.textFeatureIndex?N=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(N=t.featureIndex),p.verticalTextFeatureIndex&&(j=p.verticalTextFeatureIndex);const $=e=>{e.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const t=this.transform.elevation;(t||e.elevation)&&(e.elevation=t?t.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},V=p.textBox;if(V){$(V);const i=i=>{let n=e.WritingMode.horizontal;if(o.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[T];e&&(this.placedOrientations[T]=e,n=e,this.markUsedOrientation(o,n,t))}return n},n=(t,i)=>{if(o.allowVerticalPlacement&&k>0&&p.verticalTextBox){for(const n of o.writingModes)if(n===e.WritingMode.vertical?(L=i(),R=L):L=t(),L&&L.box&&L.box.length)break}else L=t()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[T]){const e=this.prevPlacement.variableOffsets[T];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,i,n)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),c=(e.x2-e.x1)*s+2*e.padding,u=(e.y2-e.y1)*s+2*e.padding,d=S&&!v?i:null;d&&$(d);let p={box:[],offscreen:!1,occluded:!1};const _=x?2*l.length:l.length;for(let i=0;i<_;++i){const _=this.attemptAnchorPlacement(l[i%l.length],e,c,u,s,b,w,h,a,g,i>=l.length,t,r,o,n,d,f,m);if(_&&(p=_.placedGlyphBoxes,p&&p.box&&p.box.length)){M=!0,D=_.shift;break}}return p};n((()=>c(V,p.iconBox,e.WritingMode.horizontal)),(()=>{const t=p.verticalTextBox;return t&&$(t),o.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&k>0&&t?c(t,p.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),L&&(M=L.box,P=L.offscreen,I=L.occluded);const u=i(!(!L||!L.box));if(!M&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[T];e&&(this.variableOffsets[T]=e,this.markUsedJustification(o,e.anchor,t,u))}}else{const s=(i,n)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),l=this.collisionIndex.placeCollisionBox(o,s,i,new e.Point(0,0),x,h,a,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,n,t),this.placedOrientations[T]=n),l};n((()=>s(V,e.WritingMode.horizontal)),(()=>{const t=p.verticalTextBox;return o.allowVerticalPlacement&&k>0&&t?($(t),s(t,e.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(L&&L.box&&L.box.length))}}if(O=L,M=O&&O.box&&O.box.length>0,P=O&&O.offscreen,I=O&&O.occluded,t.useRuntimeCollisionCircles){const i=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=e.evaluateSizeForFeature(o.textSizeData,f,i),u=s.get("text-padding");B=this.collisionIndex.placeCollisionCircles(o,x,i,o.lineVertexArray,o.glyphOffsetArray,r,a,l,c,n,w,g.predicate,t.collisionCircleDiameter*r/e.ONE_EM,u,this.retainedQueryData[o.bucketInstanceId].tileID),M=x||B.circles.length>0&&!B.collisionDetected,P=P&&B.offscreen,I=B.occluded}if(p.iconFeatureIndex&&(U=p.iconFeatureIndex),p.iconBox){const i=i=>{$(i);const n=S&&D?kt(D.x,D.y,b,w,this.transform.angle):new e.Point(0,0),r=o.getSymbolInstanceIconSize(m,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,r,i,n,v,h,a,g.predicate)};R&&R.box&&R.box.length&&p.verticalIconBox?(F=i(p.verticalIconBox),A=F.box.length>0):(F=i(p.iconBox),A=F.box.length>0),P=P&&F.offscreen,z=F.occluded}const G=_||0===t.numHorizontalGlyphVertices&&0===k,W=y||0===t.numIconVertices;if(G||W?W?G||(A=A&&M):M=A&&M:A=M=A&&M,M&&O&&O.box&&this.collisionIndex.insertCollisionBox(O.box,s.get("text-ignore-placement"),o.bucketInstanceId,R&&R.box&&j?j:N,g.ID),A&&F&&this.collisionIndex.insertCollisionBox(F.box,s.get("icon-ignore-placement"),o.bucketInstanceId,U,g.ID),B&&(M&&this.collisionIndex.insertCollisionCircles(B.circles,s.get("text-ignore-placement"),o.bucketInstanceId,N,g.ID),n)){const e=o.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new St);for(let e=0;e<B.circles.length;e+=4)t.circles.push(B.circles[e+0]),t.circles.push(B.circles[e+1]),t.circles.push(B.circles[e+2]),t.circles.push(B.collisionDetected?1:0)}const q="globe"!==o.projection.name;E=E&&(q||!I),C=C&&(q||!z),this.placements[T]=new wt(M||E,A||C,P||o.justReloaded),i.add(T)};if(T){const e=o.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];k(o.symbolInstances.get(i),i,o.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)k(o.symbolInstances.get(e),e,o.collisionArrays[e]);if(n&&o.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[o.bucketInstanceId];e.invert(t.invProjMatrix,a),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,i,n,r){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=n,u=e.getAnchorJustification(i),h=r===e.WritingMode.vertical?l:"left"===u?o:"center"===u?s:"right"===u?a:-1;o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(t,i,n){const r=i===e.WritingMode.horizontal||i===e.WritingMode.horizontalOnly?i:0,o=i===e.WritingMode.vertical?i:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=n,u=t.text.placedSymbolArray;s>=0&&(u.get(s).placedOrientation=r),a>=0&&(u.get(a).placedOrientation=r),l>=0&&(u.get(l).placedOrientation=r),c>=0&&(u.get(c).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const n=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=r[e];o?(this.opacities[e]=new bt(o,n,t.text,t.icon,null,t.clipped),i=i||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new bt(null,n,t.text,t.icon,t.skipFade,t.clipped),i=i||t.text||t.icon)}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new bt(t,n,!1,!1);r.isHidden()||(this.opacities[e]=r,i=i||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i=new Set;for(const n of t){const t=n.getBucket(e);t&&n.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i,n.collisionBoxArray)}}updateBucketOpacities(t,i,n){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const r=t.layers[0].layout,o=!!t.layers[0].dynamicFilter(),s=new bt(null,0,!1,!1,!0),a=r.get("text-allow-overlap"),l=r.get("icon-allow-overlap"),c=r.get("text-variable-anchor"),u="map"===r.get("text-rotation-alignment"),h="map"===r.get("text-pitch-alignment"),d="none"!==r.get("icon-text-fit"),p=new bt(null,0,a&&(l||!t.hasIconData()||r.get("icon-optional")),l&&(a||!t.hasTextData()||r.get("text-optional")),!0);!t.collisionArrays&&n&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(n);const f=(e,t,i)=>{for(let n=0;n<t/4;n++)e.opacityVertexArray.emplaceBack(i)};let m=0;for(let n=0;n<t.symbolInstances.length;n++){const r=t.symbolInstances.get(n),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,crossTileID:g,numIconVertices:_}=r,y=i.has(g);let x=this.opacities[g];y?x=s:x||(x=p,this.opacities[g]=x),i.add(g);const v=a>0||l>0,b=_>0,w=this.placedOrientations[g],S=w===e.WritingMode.vertical,T=w===e.WritingMode.horizontal||w===e.WritingMode.horizontalOnly;if(!v&&!b||x.isHidden()||m++,v){const e=Bt(x.text);f(t.text,a,S?Ft:e),f(t.text,l,T?Ft:e);const i=x.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:c}=r,u=t.text.placedSymbolArray,h=i||S?1:0;n>=0&&(u.get(n).hidden=h),o>=0&&(u.get(o).hidden=h),s>=0&&(u.get(s).hidden=h),c>=0&&(u.get(c).hidden=i||T?1:0);const d=this.variableOffsets[g];d&&this.markUsedJustification(t,d.anchor,r,w);const p=this.placedOrientations[g];p&&(this.markUsedJustification(t,"left",r,p),this.markUsedOrientation(t,p,r))}if(b){const e=Bt(x.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:n}=r,o=t.icon.placedSymbolArray,s=x.icon.isHidden()?1:0;i>=0&&(f(t.icon,_,S?Ft:e),o.get(i).hidden=s),n>=0&&(f(t.icon,r.numVerticalIconVertices,T?Ft:e),o.get(n).hidden=s)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[n];if(i){let n=new e.Point(0,0),r=!0;if(i.textBox||i.verticalTextBox){if(c){const e=this.variableOffsets[g];e?(n=Ct(e.anchor,e.width,e.height,e.textOffset,e.textScale),u&&n._rotate(h?this.transform.angle:-this.transform.angle)):r=!1}o&&(r=!x.clipped),i.textBox&&At(t.textCollisionBox.collisionVertexArray,x.text.placed,!r||S,n.x,n.y),i.verticalTextBox&&At(t.textCollisionBox.collisionVertexArray,x.text.placed,!r||T,n.x,n.y)}const s=r&&Boolean(!T&&i.verticalIconBox);i.iconBox&&At(t.iconCollisionBox.collisionVertexArray,x.icon.placed,s,d?n.x:0,d?n.y:0),i.verticalIconBox&&At(t.iconCollisionBox.collisionVertexArray,x.icon.placed,!s,d?n.x:0,d?n.y:0)}}}if(t.fullyClipped=0===m,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function At(e,t,i,n,r){e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0)}const Pt=Math.pow(2,25),It=Math.pow(2,24),zt=Math.pow(2,17),Dt=Math.pow(2,16),Lt=Math.pow(2,9),Rt=Math.pow(2,8),Ot=Math.pow(2,1);function Bt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*Pt+t*It+i*zt+t*Dt+i*Lt+t*Rt+i*Ot+t}const Ft=0;class Nt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,i,n,r){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,n,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class jt{constructor(e,t,i,n,r,o,s,a){this.placement=new Mt(e,r,o,s,a),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(t,i,n){const r=e.exported.now(),o=()=>{const t=e.exported.now()-r;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=i[t[this._currentPlacementIndex]],r=this.placement.collisionIndex.transform.zoom;if("symbol"===e.type&&(!e.minzoom||e.minzoom<=r)&&(!e.maxzoom||e.maxzoom>r)){if(this._inProgressLayer||(this._inProgressLayer=new Nt(e)),this._inProgressLayer.continuePlacement(n[e.source],this.placement,this._showCollisionBoxes,e,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Ut=512/e.EXTENT/2;class $t{constructor(t,i,n){this.tileID=t,this.bucketInstanceId=n,this.index=new e.KDBush(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const r=t.canonical.x*e.EXTENT,o=t.canonical.y*e.EXTENT;for(let e=0;e<i.length;e++){const{key:t,crossTileID:n,tileAnchorX:s,tileAnchorY:a}=i.get(e),l=Math.floor((r+s)*Ut),c=Math.floor((o+a)*Ut);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(n)}this.index.finish()}findMatches(t,i,n){const r=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),o=Ut/Math.pow(2,i.canonical.z-this.tileID.canonical.z),s=i.canonical.x*e.EXTENT,a=i.canonical.y*e.EXTENT;for(let e=0;e<t.length;e++){const i=t.get(e);if(i.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=i,h=Math.floor((s+c)*o),d=Math.floor((a+u)*o),p=this.index.range(h-r,d-r,h+r,d+r);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!n.has(t)){n.add(t),i.crossTileID=t;break}}}}}class Vt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],n={};for(const e in i){const r=i[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),n[r.tileID.key]=r}this.indexes[e]=n}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const n=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in r){const o=r[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,n)}else{const o=r[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,n)}}for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances.get(e);r.crossTileID||(r.crossTileID=i.generate(),n.add(r.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new $t(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i of t.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const n=this.indexes[i];for(const r in n)e[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],t=!0)}return t}}class Wt{constructor(){this.layerIndexes={},this.crossTileIDs=new Vt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,n){let r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new Gt);let o=!1;const s={};"globe"!==n.name&&r.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const qt=(t,i)=>e.emitValidationErrors(t,i&&i.filter((e=>"source.canvas"!==e.identifier))),Xt=e.pick($e,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Zt=e.pick($e,["setCenter","setZoom","setBearing","setPitch"]),Ht={version:8,layers:[],sources:{}},Yt={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Kt extends e.Evented{constructor(t,i={}){super(),this.map=t,this.dispatcher=new A(Ne(),this),this.imageManager=new v,this.imageManager.setEventedParent(this),this.glyphManager=new e.GlyphManager(t._requestManager,i.localFontFamily?e.LocalGlyphMode.all:i.localIdeographFontFamily?e.LocalGlyphMode.ideographs:e.LocalGlyphMode.none,i.localFontFamily||i.localIdeographFontFamily),this.crossTileSymbolIndex=new Wt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const n=this;this._rtlTextPluginCallback=Kt.registerForPluginStateChange((t=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.triggerPluginCompletionEvent(t),i&&i.every((e=>e)))for(const e in n._sourceCaches){const t=n._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const i=this._layers[e];i.source===t.id&&this._validateLayer(i)}}))}loadURL(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"}));const n="boolean"==typeof i.validate?i.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken);const r=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(r,((t,i)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):i&&this._load(i,n)}))}loadJSON(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(Ht,!1)}_updateLayerCount(e,t){const i=t?1:-1;e.is3D()&&(this._num3DLayers+=i),"circle"===e.type&&(this._numCircleLayers+=i),"symbol"===e.type&&(this._numSymbolLayers+=i)}_load(t,i){if(i&&qt(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=e.clone$1(t),this._updateMapProjection();for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const n=Ue(this.stylesheet.layers);this._order=n.map((e=>e.id)),this._layers={},this._serializedLayers={};for(const t of n){const i=e.createStyleLayer(t);i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize(),this._updateLayerCount(i,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(t){this._spriteRequest=function(t,i,n){let r,o,s;const a=e.exported.devicePixelRatio>1?"@2x":"";let l=e.getJSON(i.transformRequest(i.normalizeSpriteURL(t,a,".json"),e.ResourceType.SpriteJSON),((e,t)=>{l=null,s||(s=e,r=t,u())})),c=e.getImage(i.transformRequest(i.normalizeSpriteURL(t,a,".png"),e.ResourceType.SpriteImage),((e,t)=>{c=null,s||(s=e,o=t,u())}));function u(){if(s)n(s);else if(r&&o){const t=e.exported.getImageData(o),i={};for(const n in r){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=r[n],f=new e.RGBAImage({width:o,height:s});e.RGBAImage.copy(t,f,{x:a,y:l},{x:0,y:0},{width:o,height:s}),i[n]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}n(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(i)for(const e in i)this.imageManager.addImage(e,i[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}))}))}_validateLayer(t){const i=this.getSource(t.source);if(!i)return;const n=t.sourceLayer;n&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${n}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped():Yt[e.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const i=this._changed;if(this._changed){const e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(e.length||i.length)&&this._updateWorkerLayers(e,i);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const n={};for(const e in this._sourceCaches){const t=this._sourceCaches[e];n[e]=t.used,t.used=!1}for(const e of this._order){const i=this._layers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this._getLayerSourceCache(i);e&&(e.used=!0)}const n=this.map.painter;if(n){const e=i.getProgramIds();if(!e)continue;const r=i.getProgramConfiguration(t.zoom);for(const t of e)n.useProgram(t,r)}}for(const t in n){const i=this._sourceCaches[t];n[t]!==i.used&&i.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new e.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),qt(this,e.validateStyle(i)))return!1;(i=e.clone$1(i)).layers=Ue(i.layers);const n=function(e,i){if(!e)return[{command:$e.setStyle,args:[i]}];let n=[];try{if(!t(e.version,i.version))return[{command:$e.setStyle,args:[i]}];t(e.center,i.center)||n.push({command:$e.setCenter,args:[i.center]}),t(e.zoom,i.zoom)||n.push({command:$e.setZoom,args:[i.zoom]}),t(e.bearing,i.bearing)||n.push({command:$e.setBearing,args:[i.bearing]}),t(e.pitch,i.pitch)||n.push({command:$e.setPitch,args:[i.pitch]}),t(e.sprite,i.sprite)||n.push({command:$e.setSprite,args:[i.sprite]}),t(e.glyphs,i.glyphs)||n.push({command:$e.setGlyphs,args:[i.glyphs]}),t(e.transition,i.transition)||n.push({command:$e.setTransition,args:[i.transition]}),t(e.light,i.light)||n.push({command:$e.setLight,args:[i.light]}),t(e.fog,i.fog)||n.push({command:$e.setFog,args:[i.fog]}),t(e.projection,i.projection)||n.push({command:$e.setProjection,args:[i.projection]});const r={},o=[];!function(e,i,n,r){let o;for(o in i=i||{},e=e||{})e.hasOwnProperty(o)&&(i.hasOwnProperty(o)||Ge(o,n,r));for(o in i){if(!i.hasOwnProperty(o))continue;const s=i[o];e.hasOwnProperty(o)?t(e[o],s)||("geojson"===e[o].type&&"geojson"===s.type&&qe(e,i,o)?n.push({command:$e.setGeoJSONSourceData,args:[o,s.data]}):We(o,i,n,r)):Ve(o,i,n)}}(e.sources,i.sources,o,r);const s=[];e.layers&&e.layers.forEach((e=>{e.source&&r[e.source]?n.push({command:$e.removeLayer,args:[e.id]}):s.push(e)}));let a=e.terrain;a&&r[a.source]&&(n.push({command:$e.setTerrain,args:[void 0]}),a=void 0),n=n.concat(o),t(a,i.terrain)||n.push({command:$e.setTerrain,args:[i.terrain]}),function(e,i,n){i=i||[];const r=(e=e||[]).map(Ze),o=i.map(Ze),s=e.reduce(He,{}),a=i.reduce(He,{}),l=r.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<r.length;u++)d=r[u],a.hasOwnProperty(d)?h++:(n.push({command:$e.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(n.push({command:$e.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],n.push({command:$e.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=s[d],f=a[d],!c[d]&&!t(p,f))if(t(p.source,f.source)&&t(p["source-layer"],f["source-layer"])&&t(p.type,f.type)){for(g in Xe(p.layout,f.layout,n,d,null,$e.setLayoutProperty),Xe(p.paint,f.paint,n,d,null,$e.setPaintProperty),t(p.filter,f.filter)||n.push({command:$e.setFilter,args:[d,f.filter]}),t(p.minzoom,f.minzoom)&&t(p.maxzoom,f.maxzoom)||n.push({command:$e.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xe(p[g],f[g],n,d,g.slice(6),$e.setPaintProperty):t(p[g],f[g])||n.push({command:$e.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xe(p[g],f[g],n,d,g.slice(6),$e.setPaintProperty):t(p[g],f[g])||n.push({command:$e.setLayerProperty,args:[d,g,f[g]]}))}else n.push({command:$e.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],n.push({command:$e.addLayer,args:[f,m]})}(s,i.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:$e.setStyle,args:[i]}]}return n}(this.serialize(),i).filter((e=>!(e.command in Zt)));if(0===n.length)return!1;const r=n.filter((e=>!(e.command in Xt)));if(r.length>0)throw new Error(`Unimplemented: ${r.map((e=>e.command)).join(", ")}.`);return n.forEach((e=>{"setTransition"!==e.command&&"setProjection"!==e.command&&this[e.command].apply(this,e.args)})),this.stylesheet=i,this._updateMapProjection(),!0}addImage(t,i){return this.getImage(t)?this.fire(new e.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,i),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new e.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,i,n={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.validateSource,`sources.${t}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=Pe(t,i,this.dispatcher,this);r.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:r.serialize(),sourceId:t})));const o=i=>{const n=(i?"symbol:":"other:")+t,o=this._sourceCaches[n]=new e.SourceCache(n,r,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[t]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),r.onAdd&&r.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const i=this.getSource(t);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const n=this._getSourceCaches(t);for(const t of n)delete this._sourceCaches[t.id],delete this._updatedSources[t.id],t.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){const t=this._getSourceCache(e);return t&&t.getSource()}_getSources(){const e=[];for(const t in this._otherSourceCaches){const i=this._getSourceCache(t);i&&e.push(i.getSource())}return e}addLayer(t,i,n={}){this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let o;if("custom"===t.type){if(qt(this,e.validateCustomStyleLayer(t)))return;o=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.clone$1(t),t=e.extend(t,{source:r})),this._validate(e.validateLayer,`layers.${r}`,t,{arrayIndex:-1},n))return;o=e.createStyleLayer(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o;const a=this._getLayerSourceCache(o);if(this._removedLayers[r]&&o.source&&a&&"custom"!==o.type){const e=this._removedLayers[r];delete this._removedLayers[r],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const n=this._order.indexOf(t);this._order.splice(n,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(r,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));i.setEventedParent(null),this._updateLayerCount(i,!1);const n=this._order.indexOf(t);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(t,i,n){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===i&&r.maxzoom===n||(null!=i&&(r.minzoom=i),null!=n&&(r.maxzoom=n),this._updateLayer(r)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,n,r={}){this._checkLoaded();const o=this.getLayer(i);if(o){if(!t(o.filter,n))return null==n?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(e.validateFilter,`layers.${o.id}.filter`,n,{layerType:o.type},r)||(o.filter=e.clone$1(n),this._updateLayer(o)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const i=this.getLayer(t);return i&&e.clone$1(i.filter)}setLayoutProperty(i,n,r,o={}){this._checkLoaded();const s=this.getLayer(i);s?t(s.getLayoutProperty(n),r)||(s.setLayoutProperty(n,r,o),this._updateLayer(s)):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,i){const n=this.getLayer(t);if(n)return n.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(i,n,r,o={}){this._checkLoaded();const s=this.getLayer(i);s?t(s.getPaintProperty(n),r)||(s.setPaintProperty(n,r,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){const i=this.getLayer(e);return i&&i.getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const n=t.source,r=t.sourceLayer,o=this.getSource(n);if(!o)return void this.fire(new e.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const s=o.type;if("geojson"===s&&r)return void this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!r)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(n);for(const e of a)e.setFeatureState(r,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const n=t.source,r=this.getSource(n);if(!r)return void this.fire(new e.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const o=r.type,s="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(n);for(const e of a)e.removeFeatureState(s,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,n=t.sourceLayer,r=this.getSource(i);if(r){if("vector"!==r.type||n)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(i)[0].getFeatureState(n,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0;const t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,i={},n=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];if(t(o)){i[o]=r;for(const t of e){const e=t[o];if(e)for(const t of e)n.push(t)}}}n.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const r=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(t(s))for(let e=n.length-1;e>=0;e--){const t=n[e].feature;if(i[t.layer.id]<o)break;r.push(t),n.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)r.push(t.feature)}}return r}queryRenderedFeatures(t,i,n){i&&i.filter&&this._validate(e.validateFilter,"queryRenderedFeatures.filter",i.filter,null,i);const r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];r[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=i&&i.layers?i.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),a=I.createFromScreenPoints(t,n);for(const e in this._sourceCaches){const t=this._sourceCaches[e].getSource().id;i.layers&&!r[t]||o.push(ze(this._sourceCaches[e],this._layers,this._serializedLayers,a,i,n,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(e,t,i,n,r,o,s){const a={},l=o.queryRenderedSymbols(n),c=[];for(const e of Object.keys(l).map(Number))c.push(s[e]);c.sort(Le);for(const i of c){const n=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in n){const t=a[e]=a[e]||[],r=n[e];r.sort(((e,t)=>{const n=i.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of r)t.push(e)}}for(const t in a)a[t].forEach((n=>{const r=n.feature,o=i(e[t]);if(!o)return;const s=o.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=s}));return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.validateFilter,"querySourceFeatures.filter",i.filter,null,i);const n=this._getSourceCaches(t);let r=[];for(const e of n)r=r.concat(De(e,i));return r}addSourceType(e,t,i){return Kt.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(Kt.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const n=this.light.getLight();let r=!1;for(const i in e)if(!t(e[i],n[i])){r=!0;break}if(!r)return;const o=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(e,i),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,n=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let r=i;if(1===n){if("object"==typeof r.source){const t="terrain-dem-src";this.addSource(t,r.source),r=e.clone$1(r),r=e.extend(r,{source:t})}if(this._validate(e.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&n!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,n)}else{const i=this.terrain,n=i.get();for(const t of Object.keys(e.spec.terrain))!r.hasOwnProperty(t)&&e.spec.terrain[t].default&&(r[t]=e.spec.terrain[t].default);for(const e in r)if(!t(r[e],n[e])){i.set(r),this.stylesheet.terrain=r;const e=this._setTransitionParameters({duration:0});i.updateTransitions(e);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new M(e,this.map.transform);this.stylesheet.fog=e;const i=this._setTransitionParameters({duration:0});t.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog,n=i.get();0===Object.keys(e).length&&i.set(e);for(const r in e)if(!t(e[r],n[r])){i.set(e),this.stylesheet.fog=e;const t=this._setTransitionParameters({duration:0});i.updateTransitions(t);break}}else this._createFog(e);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:e.exported.now(),transition:e.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const e=this._order.filter((e=>this.isLayerDraped(this._layers[e]))),t=this._order.filter((e=>!this.isLayerDraped(this._layers[e])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const i=this.terrain=new T(e,t);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const n=this._setTransitionParameters({duration:0});i.updateTransitions(n)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,i,n,r,o={}){return(!o||!1!==o.validate)&&qt(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:n,styleSpec:e.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles(),this._sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){const t=this._getSourceCaches(e);for(const e of t)e.clearTiles()}_reloadSource(e){const t=this._getSourceCaches(e);for(const e of t)e.resume(),e.reload()}_reloadSources(){for(const e of this._getSources())e.reload&&e.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,n,r,o=!1){let s=!1,a=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type)continue;if(!l[i.source]){const e=this._getLayerSourceCache(i);if(!e)continue;l[i.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const n=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng,t.projection);s=s||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new e.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now(),t.zoom))&&(this.pauseablePlacement=new jt(t,this._order,o,i,n,r,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.exported.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();const n=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};n(this._otherSourceCaches[t.source]),n(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i)}getResource(t,i,n){return e.makeRequest(i,n)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}_getSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this._getSourceCaches(t);return 0===i.length?(this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Kt.getSourceType=function(e){return Ae[e]},Kt.setSourceType=function(e,t){Ae[e]=t},Kt.registerForPluginStateChange=e.registerForPluginStateChange;var Jt="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Qt="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ei="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ti="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",ii="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ni={},ri={};const oi=[];ui(Jt,oi),ui(ei,oi),ui(ti,oi),ui(ii,oi),ni=hi("",ei),ri=hi(ii,ti);const si=hi("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ai=Jt,li="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var ci={background:hi("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:hi("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:hi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:hi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:hi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:hi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:hi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:hi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:hi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:hi("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:hi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:hi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:hi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:hi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:hi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:hi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:hi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:hi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:hi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:hi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Qt),skyboxGradient:hi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Qt),skyboxCapture:hi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:hi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ui(e,t){const i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let e of i)if(e=e.trim(),"#"===e[0]&&e.includes("if")&&!e.includes("endif")){e=e.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=e.split(" ");for(const e of i)t.includes(e)||t.push(e)}}function hi(e,t){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),r={},o=[...oi];return ui(e,o),ui(t,o),{fragmentSource:e=e.replace(i,((e,t,i,n,o)=>(r[o]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nvarying ${i} ${n} ${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${o}\n    ${i} ${n} ${o} = u_${o};\n#endif\n`))),vertexSource:t=t.replace(i,((e,t,i,n,o)=>{const s="float"===n?"vec2":"vec4",a=o.match(/color/)?"color":s;return r[o]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float u_${o}_t;\nattribute ${i} ${s} a_${o};\nvarying ${i} ${n} ${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = a_${o};\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = unpack_mix_${a}(a_${o}, u_${o}_t);\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float u_${o}_t;\nattribute ${i} ${s} a_${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${i} ${n} ${o} = a_${o};\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${i} ${n} ${o} = unpack_mix_${a}(a_${o}, u_${o}_t);\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`})),staticAttributes:n,usedDefines:o}}class di{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,i,n,r,o,s){this.context=e;let a=this.boundPaintVertexBuffers.length!==n.length;for(let e=0;!a&&e<n.length;e++)this.boundPaintVertexBuffers[e]!==n[e]&&(a=!0);let l=this.boundDynamicVertexBuffers.length!==s.length;for(let e=0;!l&&e<s.length;e++)this.boundDynamicVertexBuffers[e]!==s[e]&&(l=!0);if(!e.extVertexArrayObject||!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||a||l||this.boundIndexBuffer!==r||this.boundVertexOffset!==o)this.freshBind(t,i,n,r,o,s);else{e.bindVertexArrayOES.set(this.vao);for(const e of s)e&&e.bind();r&&r.dynamicDraw&&r.bind()}}freshBind(e,t,i,n,r,o){let s;const a=e.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=o;else{s=l.currentNumAttributes||0;for(let e=a;e<s;e++)c.disableVertexAttribArray(e)}t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const t of i)t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const t of o)t&&(t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r));n&&n.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function pi(t,i){const n=Math.pow(2,i.canonical.z),r=i.canonical.y;return[new e.MercatorCoordinate(0,r/n).toLngLat().lat,new e.MercatorCoordinate(0,(r+1)/n).toLngLat().lat]}function fi(t,i,n,r,o,s,a){const l=t.context,c=l.gl,u=n.fbo;if(!u)return;t.prepareDrawTile();const h=t.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((e,t,i,n)=>{const r=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=e.transform.angle);const l=!e.options.moving;return{u_matrix:n||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:pi(0,t.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:o,u_accent:s}})(t,n,r,t.terrain?i.projMatrix:null);t.prepareDrawProgram(l,h,i.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=t.getTileBoundsBuffers(n);h.draw(l,c.TRIANGLES,o,s,a,e.CullFaceMode.disabled,d,r.id,p,f,m)}function mi(t,i,n){if(!i.needsDEMTextureUpload)return;const r=t.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(n.stride);const s=n.getPixels();i.demTexture?i.demTexture.update(s,{premultiply:!1}):i.demTexture=new e.Texture(r,s,o.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function gi(t,i,n,r,o,s){const a=t.context,l=a.gl;if(!i.dem)return;const c=i.dem;if(a.activeTexture.set(l.TEXTURE1),mi(t,i,c),!i.demTexture)return;i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;a.activeTexture.set(l.TEXTURE0);let h=i.fbo;if(!h){const t=new e.Texture(a,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=i.fbo=a.createFramebuffer(u,u,!0),h.colorAttachment.set(t.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,u,u]);const{tileBoundsBuffer:d,tileBoundsIndexBuffer:p,tileBoundsSegments:f}=t.getMercatorTileBoundsBuffers();t.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,o,s,e.CullFaceMode.disabled,((t,i)=>{const n=i.stride,r=e.create();return e.ortho(r,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(r,r,[0,-e.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:t.overscaledZ,u_unpack:i.unpackVector}})(i.tileID,c),n.id,d,p,f),i.needsHillshadePrepare=!1}const _i=t=>({u_matrix:new e.UniformMatrix4f(t),u_image0:new e.Uniform1i(t),u_skirt_height:new e.Uniform1f(t)}),yi=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),xi=(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:i,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p});function vi(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const bi=new class{constructor(){this.operations={}}newMorphing(e,t,i,n,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:n,phase:0,duration:r,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},wi={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Si(e){return 6*Math.pow(1.5,22-e)}function Ti(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const Ei=e=>({u_matrix:e});function Ci(t,i,n,r,o){if(o>0){const s=e.exported.now(),a=(s-t.timeAdded)/o,l=i?(s-i.timeAdded)/o:-1,c=n.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.clamp(h?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class ki extends e.SourceCache{constructor(e){const t={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new A(Ne(),null),n=Pe("mock-dem",t,i,e.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Mi extends e.SourceCache{constructor(e){const t=Pe("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new A(Ne(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,n){if(t.freezeTileCoverage)return;this.transform=t;const r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((i,n)=>{if(i[n.key]="",!this._tiles[n.key]){const i=new e.Tile(n,this._source.tileSize*n.overscaleFactor(),t.tileZoom);i.state="loaded",this._tiles[n.key]=i}return i}),{});for(const e in this._tiles)e in r||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ai extends e.OverscaledTileID{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class Pi extends e.Elevation{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,r,o]=function(t){const i=new e.StructArrayLayout2i4,n=new e.StructArrayLayout3ui6,r=131;i.reserve(17161),n.reserve(33800);const o=e.EXTENT/128,s=e.EXTENT+o/2,a=s+o;for(let t=-o;t<a;t+=o)for(let n=-o;n<a;n+=o){const r=n<0||n>s||t<0||t>s?24575:0,o=e.clamp(Math.round(n),0,e.EXTENT),a=e.clamp(Math.round(t),0,e.EXTENT);i.emplaceBack(o+r,a)}const l=(e,t)=>{const i=t*r+e;n.emplaceBack(i+1,i,i+r),n.emplaceBack(i+r,i+r+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[i,n,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(n,e.posAttributes.members),this.gridIndexBuffer=s.createIndexBuffer(r),this.gridSegments=e.SegmentVector.simpleSegment(0,0,n.length,r.length),this.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,n.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Mi(i.map),this.orthoMatrix=e.create(),e.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.EXTENT,0,e.EXTENT,0,1);const a=s.gl;this._overlapStencilMode=new e.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ki(i.map)}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,i,n){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const r=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(r.get("source")),this._exaggeration=r.get("exaggeration");const o=()=>{this.sourceCache.used&&e.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),i.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&e.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=n.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const n=i.transform.pointCoordinate(i.transform.getCameraPoint()),r=new e.Point(n.x,n.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const n=new e.Point(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.Point(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),s=r.mult(1<<t.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(n)-s.distSqr(o)}))}(r,this.painter),this._previousZoom=n.zoom;const o=this.proxyToSource||{};this.proxyToSource={},r.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const e in s){const i=s[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],o),i.usedForTerrain)continue;const n=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[i.id]=r.map((e=>new Ai(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=e.exported.now();const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in a||(this._visibleDemTiles.push(t),a[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const n=this.terrainTileForTile[i],r=n.dem;!r||n.demTexture&&!n.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),mi(this.painter,n,r))}}_prepareDemTileUniforms(e,t,i,n){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-r.z),s=n||"";return i[`u_dem_tl${s}`]=[r.x*o%1,r.y*o%1],i[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){const n=new e.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.Texture(t,n,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const n=i.dem.tree.minimums[0];return n>0&&e++,t+n}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const n=this._getLoadedAreaMinimum(),r=new e.RGBAImage({width:1,height:1},new Uint8Array(e.DEMData.pack(n,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new e.Texture(t,r,i.RGBA,{premultiply:!1}),o}setupElevationDraw(t,i,n){const r=this.painter.context,o=r.gl,s=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var a;s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();let l=null,c=null,u=1;if(n&&n.morphing&&this._useVertexMorphing){const e=n.morphing.srcDemTile,i=n.morphing.dstDemTile;u=n.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,s,"_prev")&&(c=e),this._prepareDemTileUniforms(t,i,s)&&(l=i))}if(c&&l?(r.activeTexture.set(o.TEXTURE2),l.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),r.activeTexture.set(o.TEXTURE4),c.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=u):(l=this.terrainTileForTile[t.tileID.key],r.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(t,l,s)?l.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),r.activeTexture.set(o.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&l){const t=(1<<l.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=t}if(n&&n.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(r,s),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,n&&n.useDenormalizedUpVectorScale);i.setGlobeUniformValues(r,e)}}globeUniformValues(t,i,n){const r=t.projection;return{u_tile_tl_up:r.upVector(i,0,0),u_tile_tr_up:r.upVector(i,e.EXTENT,0),u_tile_br_up:r.upVector(i,e.EXTENT,e.EXTENT),u_tile_bl_up:r.upVector(i,0,e.EXTENT),u_tile_up_scale:n?e.globeMetersToEcef(1):r.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,n=this.painter.context;0!==t.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,n,r,o){if("globe"===t.transform.projection.name)!function(t,i,n,r,o){const s=t.context,a=s.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=t.transform,d=e.globeUseCustomAntiAliasing(t,s,h),p=(e,i)=>{if(c===e)return;const n=[wi[e],"PROJECTION_GLOBE_VIEW"];d&&n.push("CUSTOM_ANTIALIASING"),i&&n.push(wi[u]),l=t.useProgram("globeRaster",null,n),c=e},f=t.colorModeForRenderPass(),m=new e.DepthMode(a.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);bi.update(o);const g=e.calculateGlobeMercatorMatrix(h),_=[e.mercatorXfromLng(h.center.lng),e.mercatorYfromLat(h.center.lat)],y=u?[!1,!0]:[!1],x=t.globeSharedBuffers,v=[h.width*e.exported.devicePixelRatio,h.height*e.exported.devicePixelRatio],b=Float32Array.from(h.globeMatrix),w={useDenormalizedUpVectorScale:!0};if(y.forEach((u=>{const h=t.transform,d=Si(h.zoom)*i.exaggeration();c=-1;const y=u?a.LINES:a.TRIANGLES;for(const c of r){const r=n.getTile(c),S=e.StencilMode.disabled,T=i.prevTerrainTileForTile[c.key],E=i.terrainTileForTile[c.key];vi(T,E)&&bi.newMorphing(c.key,T,E,o,250),s.activeTexture.set(a.TEXTURE0),r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const C=bi.getMorphValuesForProxy(c.key),k=C?1:0;C&&e.extend$1(w,{morphing:{srcDemTile:C.from,dstDemTile:C.to,phase:e.easeCubicInOut(C.phase)}});const M=e.tileCornersToBounds(c.canonical),A=e.getLatitudinalLod(M.getCenter().lat),P=e.getGridMatrix(c.canonical,M,A,h.worldSize/h._pixelsPerMercatorPixel),I=e.globeNormalizeECEF(e.globeTileBounds(c.canonical)),z=xi(h.projMatrix,b,g,I,e.globeToMercatorTransition(h.zoom),_,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,d,P);if(p(k,u),i.setupElevationDraw(r,l,w),t.prepareDrawProgram(s,l,c.toUnwrapped()),x){const[i,n,r]=u?x.getWirefameBuffers(t.context,A):x.getGridBuffers(A,0!==d);l.draw(s,y,m,S,f,e.CullFaceMode.backCCW,z,"globe_raster",i,n,r)}}})),x){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];d&&o.push("CUSTOM_ANTIALIASING"),l=t.useProgram("globeRaster",null,o);for(const o of r){const{x:r,y:c,z:u}=o.canonical,d=0===c,p=c===(1<<u)-1,[g,y,b,S]=x.getPoleBuffers(u);if(S&&(d||p)){const c=n.getTile(o);s.activeTexture.set(a.TEXTURE0),c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let x=e.globePoleMatrixForTile(u,r,h);const T=e.globeNormalizeECEF(e.globeTileBounds(o.canonical)),E=(t,i)=>t.draw(s,a.TRIANGLES,m,e.StencilMode.disabled,f,e.CullFaceMode.disabled,xi(h.projMatrix,x,x,T,0,_,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,0),"globe_pole_raster",i,b,S);i.setupElevationDraw(c,l,w),t.prepareDrawProgram(s,l,o.toUnwrapped()),d&&E(l,g),p&&(x=e.scale(e.create(),x,[1,-1,1]),E(l,y))}}}}(t,i,n,r,o);else{const s=t.context,a=s.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=(e,i)=>{if(c===e)return;const n=[wi[e]];i&&n.push(wi[u]),l=t.useProgram("terrainRaster",null,n),c=e},d=t.colorModeForRenderPass(),p=new e.DepthMode(a.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);bi.update(o);const f=t.transform,m=Si(f.zoom)*i.exaggeration();(u?[!1,!0]:[!1]).forEach((u=>{c=-1;const g=u?a.LINES:a.TRIANGLES,[_,y]=u?i.getWirefameBuffer():[i.gridIndexBuffer,i.gridSegments];for(const c of r){const r=n.getTile(c),x=e.StencilMode.disabled,v=i.prevTerrainTileForTile[c.key],b=i.terrainTileForTile[c.key];vi(v,b)&&bi.newMorphing(c.key,v,b,o,250),s.activeTexture.set(a.TEXTURE0),r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const w=bi.getMorphValuesForProxy(c.key),S=w?1:0;let T;w&&(T={morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:e.easeCubicInOut(w.phase)}});const E=yi(c.projMatrix,Ti(c.canonical,f.renderWorldCopies)?m/10:m);h(S,u),i.setupElevationDraw(r,l,T),t.prepareDrawProgram(s,l,c.toUnwrapped()),l.draw(s,g,p,x,d,e.CullFaceMode.backCCW,E,"terrain_raster",i.gridBuffer,_,y)}}))}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],s=this._drapedRenderBatches.shift(),a=[],l=i.style.order;let c=0;for(const u of o){const o=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?r.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){a.push(o.tileID);continue}let f;n.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(n.clear({color:e.Color.transparent,stencil:0}),d.dirty=!1);for(let e=s.start;e<=s.end;++e){const t=i.style._layers[l[e]];if(t.isHidden(i.transform.zoom))continue;const r=i.style._getLayerSourceCache(t),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const s=o;n.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,o,t,r),f=r?r.id:null),i.renderLayer(i,r,t,s)}this.renderedToTile?(d.dirty=!0,a.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}renderCacheEfficiency(e){const t=e.order.length;if(0===t)return{efficiency:100};let i,n=0,r=0,o=!1;for(let s=0;s<t;++s){const t=e._layers[e.order[s]];this._style.isLayerDraped(t)?(o&&++n,++r):o||(o=!0,i=t.id)}return 0===r?{efficiency:100}:{efficiency:100*(1-n/r),firstUndrapedLayer:i}}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter((e=>e.dem)).map((n=>{const r=n.tileID,o=1<<r.overscaledZ,{x:s,y:a}=r.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:n.dem.tree.raycastRoot(l,u,c,h,e,t,i),tile:n}}));n.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const r of n){if(null==r.t)return null;const n=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,i);if(null!=n)return n}return null}_createFBO(){const t=this.painter.context,i=t.gl,n=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const r=new e.Texture(t,{width:n[0],height:n[1],data:null},i.RGBA);r.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=t.createFramebuffer(n[0],n[1],!1);return o.colorAttachment.set(r.texture),o.depthAttachment=new we(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._layers[e],i=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!i&&t.shouldRedrape():!i&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style._getSources())if(e instanceof Ee){t=!0;break}if(!t)return;const i={};for(let t=0;t<this._style.order.length;++t){const n=this._style._layers[this._style.order[t]],r=this._style._getLayerSourceCache(n);if(r&&!i[r.id]&&!n.isHidden(this.painter.transform.zoom)&&"line"===n.type&&n.widthExpression()instanceof e.ZoomDependentExpression){i[r.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t)this._clearRenderCacheForTile(r.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t]._source instanceof Ce){e=!0;break}if(!e)return;const t={};for(let e=0;e<this._style.order.length;++e){const i=this._style._layers[this._style.order[e]],n=this._style._getLayerSourceCache(i);if(!n||t[n.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const r=i.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t){const t=Ci(n.getTile(e),n.findLoadedParent(e,0),n,this.painter.transform,r);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(n.id,e)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const i=[];let n,r=0,o=this._style._layers[e[r]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++r<t;)o=this._style._layers[e[r]];for(;r<t;++r){const t=this._style._layers[e[r]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===n&&(n=r):void 0!==n&&(i.push({start:n,end:r-1}),n=void 0))}void 0!==n&&i.push({start:n,end:r-1}),this._drapedRenderBatches=i}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const n=Object.values(e[i]);t.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,n=this._tilesDirty;for(let r=i.length-1;r>=0;r--){const o=i[r];if(t.getTileByID(o.key),void 0!==t.proxyCachedFBO[o.key]){const i=e[o.key],r=this.proxyToSource[o.key];let s=0;for(const e in r){const t=r[e],o=i[e];if(!o||o.length!==t.length||t.some(((t,i)=>t!==o[i]||n[e]&&n[e].hasOwnProperty(t.key)))){s=-1;break}++s}for(const e in t.proxyCachedFBO[o.key])t.renderCache[t.proxyCachedFBO[o.key][e]].dirty=s<0||s!==Object.values(i).length}}const r=[...this._drapedRenderBatches];r.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of r)for(const n of i){if(t.proxyCachedFBO[n.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[n.key]={},t.proxyCachedFBO[n.key][e.start]=i,t.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,i,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}_renderTileClippingMasks(t,i){const n=this.painter,r=this.painter.context,o=r.gl;n._tileClippingMaskIDs={},r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const s=n.useProgram("clippingMask");for(const a of t){const t=n._tileClippingMaskIDs[a.key]=--i;s.draw(r,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,Ei(a.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const n=[t.x,t.y,1,1];e.transformMat4$1(n,n,i.pixelMatrixInverse),e.scale$1(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;const r=i._camera.position,o=e.mercatorZfromAltitude(1,i.center.lat),s=[r[0],r[1],r[2]/o,0],a=e.subtract([],n.slice(0,3),s);e.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const t=this.painter,i=t.context,n=this.proxySourceCache,r=Math.ceil(t.width),o=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=i.gl,n=i.createFramebuffer(r,o,!0);i.activeTexture.set(t.TEXTURE0);const s=new e.Texture(i,{width:r,height:o,data:null},t.RGBA);s.bind(t.NEAREST,t.CLAMP_TO_EDGE),n.colorAttachment.set(s.texture);const a=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,r,o);n.depthAttachment.set(a),this._depthFBO=n,this._depthTexture=s}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,r,o]),function(t,i,n,r){if("globe"===t.transform.projection.name)return;const o=t.context,s=o.gl;o.clear({depth:1});const a=t.useProgram("terrainDepth"),l=new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D);for(const t of r){const r=n.getTile(t),c=yi(t.projMatrix,0);i.setupElevationDraw(r,a),a.draw(o,s.TRIANGLES,l,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,c,"terrain_depth",i.gridBuffer,i.gridIndexBuffer,i.gridNoSkirtSegments)}}(t,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,i){if(e.getSource()instanceof Me)return this._setupProxiedCoordsForImageSource(e,t,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const n=this.proxiedCoords[e.id]=[],r=this.proxyCoords;for(let t=0;t<r.length;t++){const o=r[t],s=this._findTileCoveringTileID(o,e);if(s){const t=this._createProxiedId(o,s,i[o.key]&&i[o.key][e.id]);n.push(t),this.proxyToSource[o.key][e.id]=[t]}}let o=!1;for(let r=0;r<t.length;r++){const s=e.getTile(t[r]);if(!s||!s.hasData())continue;const a=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==s.tileID.canonical.z){const t=this.proxyToSource[a.tileID.key][e.id],r=this._createProxiedId(a.tileID,s,i[a.tileID.key]&&i[a.tileID.key][e.id]);t?t.splice(t.length-1,0,r):this.proxyToSource[a.tileID.key][e.id]=[r],n.push(r),o=!0}}this._sourceTilesOverlap[e.id]=o}_setupProxiedCoordsForImageSource(t,i,n){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],o=this.proxyCoords,s=t.getSource(),a=new e.Point(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-a.x),e.min.y=Math.min(e.min.y,t.y-a.y),e.max.x=Math.max(e.max.x,t.x-a.x),e.max.y=Math.max(e.max.y,t.y-a.y),e)),{min:new e.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(t,i)=>{const n=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),o=e.EXTENT/(1<<t.canonical.z),s=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return n+o<s+l.min.x||n>s+l.max.x||r+o<a+l.min.y||r>a+l.max.y};for(let e=0;e<o.length;e++){const s=o[e];for(let e=0;e<i.length;e++){const o=t.getTile(i[e]);if(!o||!o.hasData())continue;if(c(s,o.tileID))continue;const a=this._createProxiedId(s,o,n[s.key]&&n[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(a):this.proxyToSource[s.key][t.id]=[a],r.push(a)}}}_createProxiedId(t,i,n){let r=this.orthoMatrix;if(n){const e=n.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const n=t.canonical.z-i.tileID.canonical.z;let o,s,a;r=e.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;n>0?(o=e.EXTENT>>n,s=o*((i.tileID.canonical.x<<n)-t.canonical.x+l),a=o*((i.tileID.canonical.y<<n)-t.canonical.y)):(o=e.EXTENT<<-n,s=e.EXTENT*(i.tileID.canonical.x-(t.canonical.x+l<<-n)),a=e.EXTENT*(i.tileID.canonical.y-(t.canonical.y<<-n))),e.ortho(r,0,o,0,o,0,1),e.translate(r,r,[s,a,0])}return new Ai(i.tileID,t.key,r)}_findTileCoveringTileID(t,i){let n=i.getTile(t);if(n&&n.hasData())return n;const r=this._findCoveringTileCache[i.id],o=r[t.key];if(n=o?i.getTileByID(o):null,n&&n.hasData()||null===o)return n;let s=n?n.tileID:t,a=s.overscaledZ;const l=i.getSource().minzoom,c=[];if(!o){const r=i.getSource().maxzoom;if(t.canonical.z>=r){const n=t.canonical.z-r;i.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,i.transform.tileZoom),s=new e.OverscaledTileID(a,t.wrap,r,t.canonical.x>>n,t.canonical.y>>n)):0!==n&&(a=r,s=new e.OverscaledTileID(a,t.wrap,r,t.canonical.x>>n,t.canonical.y>>n))}s.key!==t.key&&(c.push(s.key),n=i.getTile(s))}const u=e=>{c.forEach((t=>{r[t]=e})),c.length=0};for(a-=1;a>=l&&(!n||!n.hasData());a--){n&&u(n.tileID.key);const e=s.calculateScaledKey(a);if(n=i.getTileByID(e),n&&n.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):n=i.getTileByID(t)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(t){let i=0;const n=new e.StructArrayLayout2ui4,r=131;for(let e=1;e<129;e++){for(let t=1;t<129;t++)i=e*r+t,n.emplaceBack(i,i+1),n.emplaceBack(i,i+r),n.emplaceBack(i+1,i+r),128===e&&n.emplaceBack(i+r,i+r+1);n.emplaceBack(i+1,i+1+r)}return n}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=e.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ii{static cacheKey(e,t,i,n){let r=`${t}${n?n.cacheKey:""}`;for(const t of i)e.usedDefines.includes(t)&&(r+=`/${t}`);return r}constructor(t,i,n,r,o,s){const a=t.gl;this.program=a.createProgram();const l=function(e){const t=[];for(let i=0;i<e.length;i++){if(null===e[i])continue;const n=e[i].split(" ");t.push(n.pop())}return t}(n.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c);let h=r?r.defines():[];h=h.concat(s.map((e=>`#define ${e}`)));const d=t.isWebGL2?"#version 300 es\n":"",p=d+h.concat(t.extStandardDerivatives&&0===d.length?"#extension GL_OES_standard_derivatives : enable\n".concat(li):li,li,ai,si.fragmentSource,ri.fragmentSource,n.fragmentSource).join("\n"),f=d+h.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ai,si.vertexSource,ri.vertexSource,ni.vertexSource,n.vertexSource).join("\n"),m=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(m,p),a.compileShader(m),a.attachShader(this.program,m);const g=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(g,f),a.compileShader(g),a.attachShader(this.program,g),this.attributes={},this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)u[e]&&(a.bindAttribLocation(this.program,e,u[e]),this.attributes[u[e]]=e);a.linkProgram(this.program),a.deleteShader(g),a.deleteShader(m),this.fixedUniforms=o(t),this.binderUniforms=r?r.getUniforms(t):[],s.includes("TERRAIN")&&(this.terrainUniforms=(t=>({u_dem:new e.Uniform1i(t),u_dem_prev:new e.Uniform1i(t),u_dem_unpack:new e.Uniform4f(t),u_dem_tl:new e.Uniform2f(t),u_dem_scale:new e.Uniform1f(t),u_dem_tl_prev:new e.Uniform2f(t),u_dem_scale_prev:new e.Uniform1f(t),u_dem_size:new e.Uniform1f(t),u_dem_lerp:new e.Uniform1f(t),u_exaggeration:new e.Uniform1f(t),u_depth:new e.Uniform1i(t),u_depth_size_inv:new e.Uniform2f(t),u_meter_to_dem:new e.Uniform1f(t),u_label_plane_matrix_inv:new e.UniformMatrix4f(t)}))(t)),s.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.Uniform3f(t),u_tile_tr_up:new e.Uniform3f(t),u_tile_br_up:new e.Uniform3f(t),u_tile_bl_up:new e.Uniform3f(t),u_tile_up_scale:new e.Uniform1f(t)}))(t)),s.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.UniformMatrix4f(t),u_fog_range:new e.Uniform2f(t),u_fog_color:new e.Uniform4f(t),u_fog_horizon_blend:new e.Uniform1f(t),u_fog_temporal_offset:new e.Uniform1f(t),u_frustum_tl:new e.Uniform3f(t),u_frustum_tr:new e.Uniform3f(t),u_frustum_br:new e.Uniform3f(t),u_frustum_bl:new e.Uniform3f(t),u_globe_pos:new e.Uniform3f(t),u_globe_radius:new e.Uniform1f(t),u_globe_transition:new e.Uniform1f(t),u_is_globe:new e.Uniform1i(t),u_viewport:new e.Uniform2f(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}draw(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f){const m=e.gl;if(this.failedToCreate)return;e.program.set(this.program),e.setDepthMode(i),e.setStencilMode(n),e.setColorMode(r),e.setCullFace(o);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(this.program,e,s[e]);p&&p.setUniforms(this.program,e,this.binderUniforms,h,{zoom:d});const g={[m.LINES]:2,[m.TRIANGLES]:3,[m.LINE_STRIP]:1}[t];for(const i of u.get()){const n=i.vaos||(i.vaos={});(n[a]||(n[a]=new di)).bind(e,this,l,p?p.getPaintVertexBuffers():[],c,i.vertexOffset,f||[]),m.drawElements(t,i.primitiveLength*g,m.UNSIGNED_SHORT,i.primitiveOffset*g*2)}}}function zi(e,t){const i=Math.pow(2,t.tileID.overscaledZ),n=t.tileSize*Math.pow(2,e.transform.tileZoom)/i,r=n*(t.tileID.canonical.x+t.tileID.wrap*i),o=n*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/P(t,1,e.transform.tileZoom),u_pixel_coord_upper:[r>>16,o>>16],u_pixel_coord_lower:[65535&r,65535&o]}}const Di=e.create(),Li=(t,i,n,r,o,s,a,l,c,u,h)=>{const d=i.style.light,p=d.properties.get("position"),f=[p.x,p.y,p.z],m=e.create$1();"viewport"===d.properties.get("anchor")&&(e.fromRotation(m,-i.transform.angle),e.transformMat3(f,f,m));const g=d.properties.get("color"),_=i.transform,y={u_matrix:t,u_lightpos:f,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[g.r,g.g,g.b],u_vertical_gradient:+n,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Di,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:o,u_edge_radius:s};return"globe"===_.projection.name&&(y.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],y.u_zoom_transition=c,y.u_inv_rot_matrix=h,y.u_merc_center=u,y.u_up_dir=_.projection.upVector(new e.CanonicalTileID(0,0,0),u[0]*e.EXTENT,u[1]*e.EXTENT),y.u_height_lift=l),y},Ri=(t,i,n,r,o,s,a,l,c,u,h,d)=>{const p=Li(t,i,n,r,o,s,a,c,u,h,d),f={u_height_factor:-Math.pow(2,a.overscaledZ)/l.tileSize/8};return e.extend(p,zi(i,l),f)},Oi=e=>({u_matrix:e}),Bi=(t,i,n)=>e.extend(Oi(t),zi(i,n)),Fi=(e,t)=>({u_matrix:e,u_world:t}),Ni=(t,i,n,r)=>e.extend(Bi(t,i,n),{u_world:r}),ji=e.create(),Ui=(t,i,n,r,o,s)=>{const a=t.transform,l="globe"===a.projection.name;let c;if("map"===s.paint.get("circle-pitch-alignment"))if(l){const t=e.globePixelsToTileUnits(a.zoom,i.canonical)*a._pixelsPerMercatorPixel;c=Float32Array.from([t,0,0,t])}else c=a.calculatePixelsToTileUnitsMatrix(n);else c=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:t.translatePosMatrix(i.projMatrix,n,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.exported.devicePixelRatio,u_extrude_scale:c,u_inv_rot_matrix:ji,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=r,u.u_merc_center=o,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=e.globeToMercatorTransition(a.zoom);const t=o[0]*e.EXTENT,n=o[1]*e.EXTENT;u.u_up_dir=a.projection.upVector(new e.CanonicalTileID(0,0,0),t,n)}return u},$i=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},Vi=(t,i,n,r)=>{const o=e.EXTENT/n.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(r),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},Gi=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),Wi=e.create(),qi=(t,i,n,r,o,s,a)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.globePixelsToTileUnits(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:P(n,1,s),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Wi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=r,h.u_merc_center=o,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=e.globeToMercatorTransition(l.zoom);const t=o[0]*e.EXTENT,n=o[1]*e.EXTENT;h.u_up_dir=l.projection.upVector(new e.CanonicalTileID(0,0,0),t,n)}return h},Xi=(e,t,i,n,r,o,s)=>{const a=e.transform,l=a.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Yi(e,t,i,n),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:Ki(i)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Hi(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:s}},Zi=(e,t,i,n,r)=>{const o=e.transform;return{u_matrix:Yi(e,t,i,n),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:Hi(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Hi(e,t){return 1/P(e,1,t.tileZoom)}function Yi(e,t,i,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}function Ki(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Ji=(e,t,i,n,r,o)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:i,u_fade_t:n.mix,u_opacity:n.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(a=r.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(s=r.paint.get("raster-contrast"),s>0?1/(1-s):1+s),u_spin_weights:Qi(r.paint.get("raster-hue-rotate")),u_perspective_transform:o};var s,a};function Qi(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const en=e.create(),tn=(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g)=>{const _=o.transform,y={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:_.cameraToCenterDistance,u_rotate_symbol:+n,u_aspect_ratio:_.width/_.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+r,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:en,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:en,u_up_vector:[0,-1,0]};return"globe"===g.name&&(y.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],y.u_zoom_transition=d,y.u_inv_rot_matrix=f,y.u_merc_center=p,y.u_camera_forward=_._camera.forward(),y.u_ecef_origin=e.globeECEFOrigin(_.globeMatrix,h.toUnwrapped()),y.u_tile_matrix=Float32Array.from(_.globeMatrix),y.u_up_vector=m),y},nn=(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,_)=>e.extend(tn(t,i,n,r,o,s,a,l,c,u,d,p,f,m,g,_),{u_gamma_scale:r?o.transform.cameraToCenterDistance*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.exported.devicePixelRatio,u_is_halo:+h}),rn=(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g)=>e.extend(nn(t,i,n,r,o,s,a,l,!0,c,!0,h,d,p,f,m,g),{u_texsize_icon:u,u_texture_icon:1}),on=(e,t,i)=>({u_matrix:e,u_opacity:t,u_color:i}),sn=(t,i,n,r,o)=>e.extend(function(e,t,i){const n=t.imageManager.getPattern(e.toString()),{width:r,height:o}=t.imageManager.getPixelSize(),s=Math.pow(2,i.tileID.overscaledZ),a=i.tileSize*Math.pow(2,t.transform.tileZoom)/s,l=a*(i.tileID.canonical.x+i.tileID.wrap*s),c=a*i.tileID.canonical.y;return{u_image:0,u_pattern_tl:n.tl,u_pattern_br:n.br,u_texsize:[r,o],u_pattern_size:n.displaySize,u_tile_units_to_pixels:1/P(i,1,t.transform.tileZoom),u_pixel_coord_upper:[l>>16,c>>16],u_pixel_coord_lower:[65535&l,65535&c]}}(r,n,o),{u_matrix:t,u_opacity:i}),an={fillExtrusion:t=>({u_matrix:new e.UniformMatrix4f(t),u_lightpos:new e.Uniform3f(t),u_lightintensity:new e.Uniform1f(t),u_lightcolor:new e.Uniform3f(t),u_vertical_gradient:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t),u_edge_radius:new e.Uniform1f(t),u_ao:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_up_dir:new e.Uniform3f(t),u_height_lift:new e.Uniform1f(t)}),fillExtrusionPattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_lightpos:new e.Uniform3f(t),u_lightintensity:new e.Uniform1f(t),u_lightcolor:new e.Uniform3f(t),u_vertical_gradient:new e.Uniform1f(t),u_height_factor:new e.Uniform1f(t),u_edge_radius:new e.Uniform1f(t),u_ao:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_up_dir:new e.Uniform3f(t),u_height_lift:new e.Uniform1f(t),u_image:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t)}),fill:t=>({u_matrix:new e.UniformMatrix4f(t)}),fillPattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_image:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t)}),fillOutline:t=>({u_matrix:new e.UniformMatrix4f(t),u_world:new e.Uniform2f(t)}),fillOutlinePattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_world:new e.Uniform2f(t),u_image:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t)}),circle:t=>({u_camera_to_center_distance:new e.Uniform1f(t),u_extrude_scale:new e.UniformMatrix2f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_up_dir:new e.Uniform3f(t)}),collisionBox:t=>({u_matrix:new e.UniformMatrix4f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_extrude_scale:new e.Uniform2f(t)}),collisionCircle:t=>({u_matrix:new e.UniformMatrix4f(t),u_inv_matrix:new e.UniformMatrix4f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_viewport_size:new e.Uniform2f(t)}),debug:t=>({u_color:new e.UniformColor(t),u_matrix:new e.UniformMatrix4f(t),u_overlay:new e.Uniform1i(t),u_overlay_scale:new e.Uniform1f(t)}),clippingMask:t=>({u_matrix:new e.UniformMatrix4f(t)}),heatmap:t=>({u_extrude_scale:new e.Uniform1f(t),u_intensity:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_up_dir:new e.Uniform3f(t)}),heatmapTexture:t=>({u_image:new e.Uniform1i(t),u_color_ramp:new e.Uniform1i(t),u_opacity:new e.Uniform1f(t)}),hillshade:t=>({u_matrix:new e.UniformMatrix4f(t),u_image:new e.Uniform1i(t),u_latrange:new e.Uniform2f(t),u_light:new e.Uniform2f(t),u_shadow:new e.UniformColor(t),u_highlight:new e.UniformColor(t),u_accent:new e.UniformColor(t)}),hillshadePrepare:t=>({u_matrix:new e.UniformMatrix4f(t),u_image:new e.Uniform1i(t),u_dimension:new e.Uniform2f(t),u_zoom:new e.Uniform1f(t),u_unpack:new e.Uniform4f(t)}),line:t=>({u_matrix:new e.UniformMatrix4f(t),u_pixels_to_tile_units:new e.UniformMatrix2f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_units_to_pixels:new e.Uniform2f(t),u_dash_image:new e.Uniform1i(t),u_gradient_image:new e.Uniform1i(t),u_image_height:new e.Uniform1f(t),u_texsize:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t),u_alpha_discard_threshold:new e.Uniform1f(t),u_trim_offset:new e.Uniform2f(t)}),linePattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_texsize:new e.Uniform2f(t),u_pixels_to_tile_units:new e.UniformMatrix2f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_image:new e.Uniform1i(t),u_units_to_pixels:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t),u_alpha_discard_threshold:new e.Uniform1f(t)}),raster:t=>({u_matrix:new e.UniformMatrix4f(t),u_tl_parent:new e.Uniform2f(t),u_scale_parent:new e.Uniform1f(t),u_fade_t:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t),u_image0:new e.Uniform1i(t),u_image1:new e.Uniform1i(t),u_brightness_low:new e.Uniform1f(t),u_brightness_high:new e.Uniform1f(t),u_saturation_factor:new e.Uniform1f(t),u_contrast_factor:new e.Uniform1f(t),u_spin_weights:new e.Uniform3f(t),u_perspective_transform:new e.Uniform2f(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new e.Uniform1i(t),u_is_size_feature_constant:new e.Uniform1i(t),u_size_t:new e.Uniform1f(t),u_size:new e.Uniform1f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_rotate_symbol:new e.Uniform1i(t),u_aspect_ratio:new e.Uniform1f(t),u_fade_change:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_label_plane_matrix:new e.UniformMatrix4f(t),u_coord_matrix:new e.UniformMatrix4f(t),u_is_text:new e.Uniform1i(t),u_pitch_with_map:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_camera_forward:new e.Uniform3f(t),u_tile_matrix:new e.UniformMatrix4f(t),u_up_vector:new e.Uniform3f(t),u_ecef_origin:new e.Uniform3f(t),u_texture:new e.Uniform1i(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new e.Uniform1i(t),u_is_size_feature_constant:new e.Uniform1i(t),u_size_t:new e.Uniform1f(t),u_size:new e.Uniform1f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_rotate_symbol:new e.Uniform1i(t),u_aspect_ratio:new e.Uniform1f(t),u_fade_change:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_label_plane_matrix:new e.UniformMatrix4f(t),u_coord_matrix:new e.UniformMatrix4f(t),u_is_text:new e.Uniform1i(t),u_pitch_with_map:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_texture:new e.Uniform1i(t),u_gamma_scale:new e.Uniform1f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_camera_forward:new e.Uniform3f(t),u_tile_matrix:new e.UniformMatrix4f(t),u_up_vector:new e.Uniform3f(t),u_ecef_origin:new e.Uniform3f(t),u_is_halo:new e.Uniform1i(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new e.Uniform1i(t),u_is_size_feature_constant:new e.Uniform1i(t),u_size_t:new e.Uniform1f(t),u_size:new e.Uniform1f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_rotate_symbol:new e.Uniform1i(t),u_aspect_ratio:new e.Uniform1f(t),u_fade_change:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_label_plane_matrix:new e.UniformMatrix4f(t),u_coord_matrix:new e.UniformMatrix4f(t),u_is_text:new e.Uniform1i(t),u_pitch_with_map:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_texsize_icon:new e.Uniform2f(t),u_texture:new e.Uniform1i(t),u_texture_icon:new e.Uniform1i(t),u_gamma_scale:new e.Uniform1f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_is_halo:new e.Uniform1i(t)}),background:t=>({u_matrix:new e.UniformMatrix4f(t),u_opacity:new e.Uniform1f(t),u_color:new e.UniformColor(t)}),backgroundPattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_opacity:new e.Uniform1f(t),u_image:new e.Uniform1i(t),u_pattern_tl:new e.Uniform2f(t),u_pattern_br:new e.Uniform2f(t),u_texsize:new e.Uniform2f(t),u_pattern_size:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t)}),terrainRaster:_i,terrainDepth:_i,skybox:t=>({u_matrix:new e.UniformMatrix4f(t),u_sun_direction:new e.Uniform3f(t),u_cubemap:new e.Uniform1i(t),u_opacity:new e.Uniform1f(t),u_temporal_offset:new e.Uniform1f(t)}),skyboxGradient:t=>({u_matrix:new e.UniformMatrix4f(t),u_color_ramp:new e.Uniform1i(t),u_center_direction:new e.Uniform3f(t),u_radius:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t),u_temporal_offset:new e.Uniform1f(t)}),skyboxCapture:t=>({u_matrix_3f:new e.UniformMatrix3f(t),u_sun_direction:new e.Uniform3f(t),u_sun_intensity:new e.Uniform1f(t),u_color_tint_r:new e.Uniform4f(t),u_color_tint_m:new e.Uniform4f(t),u_luminance:new e.Uniform1f(t)}),globeRaster:t=>({u_proj_matrix:new e.UniformMatrix4f(t),u_globe_matrix:new e.UniformMatrix4f(t),u_normalize_matrix:new e.UniformMatrix4f(t),u_merc_matrix:new e.UniformMatrix4f(t),u_zoom_transition:new e.Uniform1f(t),u_merc_center:new e.Uniform2f(t),u_image0:new e.Uniform1i(t),u_grid_matrix:new e.UniformMatrix3f(t),u_skirt_height:new e.Uniform1f(t),u_frustum_tl:new e.Uniform3f(t),u_frustum_tr:new e.Uniform3f(t),u_frustum_br:new e.Uniform3f(t),u_frustum_bl:new e.Uniform3f(t),u_globe_pos:new e.Uniform3f(t),u_globe_radius:new e.Uniform1f(t),u_viewport:new e.Uniform2f(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.Uniform3f(t),u_frustum_tr:new e.Uniform3f(t),u_frustum_br:new e.Uniform3f(t),u_frustum_bl:new e.Uniform3f(t),u_horizon:new e.Uniform1f(t),u_transition:new e.Uniform1f(t),u_fadeout_range:new e.Uniform1f(t),u_color:new e.Uniform4f(t),u_high_color:new e.Uniform4f(t),u_space_color:new e.Uniform4f(t),u_star_intensity:new e.Uniform1f(t),u_star_density:new e.Uniform1f(t),u_star_size:new e.Uniform1f(t),u_temporal_offset:new e.Uniform1f(t),u_horizon_angle:new e.Uniform1f(t),u_rotation_matrix:new e.UniformMatrix4f(t)})};let ln;function cn(t,i,n,r,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=t.useProgram("collisionBox"),d=[];let p=0,f=0;for(let m=0;m<r.length;m++){const g=r[m],_=i.getTile(g),y=_.getBucket(n);if(!y)continue;const x=yt(g,y,u);let v=x;0===o[0]&&0===o[1]||(v=t.translatePosMatrix(x,_,o,s));const b=a?y.textCollisionBox:y.iconCollisionBox,w=y.collisionCircleArray;if(w.length>0){const t=e.create(),i=v;e.mul(t,y.placementInvProjMatrix,u.glCoordMatrix),e.mul(t,t,y.placementViewportMatrix),d.push({circleArray:w,circleOffset:f,transform:i,invTransform:t,projection:y.getProjection()}),p+=w.length/4,f=p}b&&(t.terrain&&t.terrain.setupElevationDraw(_,h),h.draw(l,c.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,Vi(v,u,_,y.getProjection()),n.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,u.zoom,null,[b.collisionVertexBuffer,b.collisionVertexBufferExt]))}if(!a||!d.length)return;const m=t.useProgram("collisionCircle"),g=new e.StructArrayLayout2f1f2i16;g.resize(4*p),g._trim();let _=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,n=e.circleArray[i+0],r=e.circleArray[i+1],o=e.circleArray[i+2],s=e.circleArray[i+3];g.emplace(_++,n,r,o,s,0),g.emplace(_++,n,r,o,s,1),g.emplace(_++,n,r,o,s,2),g.emplace(_++,n,r,o,s,3)}(!ln||ln.length<2*p)&&(ln=function(t){const i=2*t,n=new e.StructArrayLayout3ui6;n.resize(i),n._trim();for(let e=0;e<i;e++){const t=6*e;n.uint16[t+0]=4*e+0,n.uint16[t+1]=4*e+1,n.uint16[t+2]=4*e+2,n.uint16[t+3]=4*e+2,n.uint16[t+4]=4*e+3,n.uint16[t+5]=4*e+0}return n}(p));const y=l.createIndexBuffer(ln,!0),x=l.createVertexBuffer(g,e.collisionCircleLayout.members,!0);for(const i of d){const r={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(v=u).getCameraToCenterDistance(i.projection),u_viewport_size:[v.width,v.height]};m.draw(l,c.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,r,n.id,x,y,e.SegmentVector.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var v;x.destroy(),y.destroy()}const un=e.create();function hn({width:t,height:i,anchor:n,textOffset:r,textScale:o},s){const{horizontalAlign:a,verticalAlign:l}=e.getAnchorAlignment(n),c=-(a-.5)*t,u=-(l-.5)*i,h=e.evaluateVariableOffset(n,r);return new e.Point((c/o+h[0])*s,(u/o+h[1])*s)}function dn(t,i,n,r,o,s,a,l,c,u,h){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={},g=t.getProjection(),_=xt(l,g,s),y=s.elevation,x=g.upVectorScale(l.canonical,s.center.lat,s.worldSize).metersToTile;p.clear();for(let f=0;f<d.length;f++){const v=d.get(f),{tileAnchorX:b,tileAnchorY:w,numGlyphs:S}=v,T=v.hidden||!v.crossTileID||t.allowVerticalPlacement&&!v.placedOrientation?null:r[v.crossTileID];if(T){let r=0,d=0,f=0;if(y){const e=y?y.getAtTileOffset(l,b,w):0,[t,i,n]=g.upVector(l.canonical,b,w);r=e*t*x,d=e*i*x,f=e*n*x}let[E,C,k,M]=nt(v.projectedAnchorX+r,v.projectedAnchorY+d,v.projectedAnchorZ+f,n?_:a);const A=rt(s.getCameraToCenterDistance(g),M);let P=o.evaluateSizeForFeature(t.textSizeData,u,v)*A/e.ONE_EM;n&&(P*=t.tilePixelRatio/c);const I=hn(T,P);n?(({x:E,y:C,z:k}=g.projectTilePoint(b+I.x,w+I.y,l.canonical)),[E,C,k]=nt(E+r,C+d,k+f,a)):(i&&I._rotate(-s.angle),E+=I.x,C+=I.y,k=0);const z=t.allowVerticalPlacement&&v.placedOrientation===e.WritingMode.vertical?Math.PI/2:0;for(let t=0;t<S;t++)e.addDynamicAttributes(p,E,C,k,z);h&&v.associatedIconIndex>=0&&(m[v.associatedIconIndex]={x:E,y:C,z:k,angle:z})}else pt(S,p)}if(h){f.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const n=i.get(t),{numGlyphs:r}=n,o=m[t];if(n.hidden||!o)pt(r,f);else{const{x:t,y:i,z:n,angle:s}=o;for(let o=0;o<r;o++)e.addDynamicAttributes(f,t,i,n,s)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function pn(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function fn(t,i,n,r,o,s,a,l,c,u,h,d){const p=t.context,f=p.gl,m=t.transform,g="map"===l,_="map"===c,y=g&&"point"!==n.layout.get("symbol-placement"),x=g&&!_&&!y,v=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),S=[e.mercatorXfromLng(m.center.lng),e.mercatorYfromLat(m.center.lat)],T=n.layout.get("text-variable-anchor"),E="globe"===m.projection.name,C=[],k=[0,-1,0];let M=k;!E&&!m.mercatorFromTransition||g||(M=function(t){const i=t._camera.getWorldToCamera(t.worldSize,1),n=e.multiply([],i,t.globeMatrix);e.invert(n,n);const r=[0,0,0],o=[0,1,0,0];return e.transformMat4$1(o,o,n),r[0]=o[0],r[1]=o[1],r[2]=o[2],e.normalize(r,r),r}(m));for(const l of r){const r=i.getTile(l),c=r.getBucket(n);if(!c)continue;if("mercator"===c.projection.name&&E)continue;const h=o?c.text:c.icon;if(!h||c.fullyClipped||!h.segments.get().length)continue;const d=h.programConfigurations.get(n.id),p=o||c.sdfIcons,w=o?c.textSizeData:c.iconSizeData,A=_||0!==m.pitch,P=e.evaluateSizeForZoom(w,m.zoom);let I,z,D,L,R=[0,0],O=null;if(o)z=r.glyphAtlasTexture,D=f.LINEAR,I=r.glyphAtlasTexture.size,c.iconsInText&&(R=r.imageAtlasTexture.size,O=r.imageAtlasTexture,L=A||t.options.rotating||t.options.zooming||"composite"===w.kind||"camera"===w.kind?f.LINEAR:f.NEAREST);else{const e=1!==n.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;z=r.imageAtlasTexture,D=p||t.options.rotating||t.options.zooming||e||A?f.LINEAR:f.NEAREST,I=r.imageAtlasTexture.size}const B="globe"===c.projection.name,F=B?M:k,N=B?e.globeToMercatorTransition(m.zoom):0,j=xt(l,c.getProjection(),m),U=m.calculatePixelsToTileUnitsMatrix(r),$=et(j,r.tileID.canonical,_,g,m,c.getProjection(),U),V=t.terrain&&_&&y?e.invert(e.create(),$):un,G=it(j,r.tileID.canonical,_,g,m,c.getProjection(),U),W=T&&c.hasTextData(),q="none"!==n.layout.get("icon-text-fit")&&W&&c.hasIconData();if(y){const e=m.elevation,i=e?e.getAtTileOffsetFunc(l,m.center.lat,m.worldSize,c.getProjection()):null,n=tt(j,r.tileID.canonical,_,g,m,c.getProjection(),U);st(c,j,t,o,n,G,_,u,i,l)}const X=y||o&&T||q,Z=t.translatePosMatrix(j,r,s,a),H=X?un:$,Y=t.translatePosMatrix(G,r,s,a,!0),K=c.getProjection().createInversionMatrix(m,l.canonical),J=[];t.terrainRenderModeElevated()&&_&&J.push("PITCH_WITH_MAP_TERRAIN"),B&&J.push("PROJECTION_GLOBE_VIEW"),X&&J.push("PROJECTED_POS_ON_VIEWPORT");const Q=p&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let ee;ee=p?c.iconsInText?rn(w.kind,P,x,_,t,Z,H,Y,I,R,l,N,S,K,F,c.getProjection()):nn(w.kind,P,x,_,t,Z,H,Y,o,I,!0,l,N,S,K,F,c.getProjection()):tn(w.kind,P,x,_,t,Z,H,Y,o,I,l,N,S,K,F,c.getProjection());const te={program:t.useProgram(pn(p,o,c),d,J),buffers:h,uniformValues:ee,atlasTexture:z,atlasTextureIcon:O,atlasInterpolation:D,atlasInterpolationIcon:L,isSDF:p,hasHalo:Q,tile:r,labelPlaneMatrixInv:V};if(v&&c.canOverlap){b=!0;const t=h.segments.get();for(const i of t)C.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:te})}else C.push({segments:h.segments,sortKey:0,state:te})}b&&C.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of C){const i=e.state;if(t.terrain&&t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:!E,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,mn(i.buffers,e.segments,n,t,i.program,w,h,d,r)),r.u_is_halo=0}mn(i.buffers,e.segments,n,t,i.program,w,h,d,i.uniformValues)}}function mn(t,i,n,r,o,s,a,l,c){const u=r.context,h=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.globeExtVertexBuffer];o.draw(u,u.gl.TRIANGLES,s,a,l,e.CullFaceMode.disabled,c,n.id,t.layoutVertexBuffer,t.indexBuffer,i,n.paint,r.transform.zoom,t.programConfigurations.get(n.id),h)}function gn(t,i,n,r,o,s,a){const l=t.context.gl,c=n.paint.get("fill-pattern"),u=c&&c.constantOr(1);let h,d,p,f,m;a?(d=u&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",h=l.LINES):(d=u?"fillPattern":"fill",h=l.TRIANGLES);for(const g of r){const r=i.getTile(g);if(u&&!r.patternsLoaded())continue;const _=r.getBucket(n);if(!_)continue;t.prepareDrawTile();const y=_.programConfigurations.get(n.id),x=t.useProgram(d,y);u&&(t.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.updatePaintBuffers());const v=c.constantOr(null);if(v&&r.imageAtlas){const e=r.imageAtlas.patternPositions[v.toString()];e&&y.setConstantPatternPositions(e)}const b=t.translatePosMatrix(g.projMatrix,r,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){f=_.indexBuffer2,m=_.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];p="fillOutlinePattern"===d&&u?Ni(b,t,r,e):Fi(b,e)}else f=_.indexBuffer,m=_.segments,p=u?Bi(b,t,r):Oi(b);t.prepareDrawProgram(t.context,x,g.toUnwrapped()),x.draw(t.context,h,o,t.stencilModeForClipping(g),s,e.CullFaceMode.disabled,p,n.id,_.layoutVertexBuffer,f,m,n.paint,t.transform.zoom,y)}}function _n(t,i,n,r,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=n.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=n.paint.get("fill-extrusion-opacity"),f=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),n.paint.get("fill-extrusion-ambient-occlusion-radius")],m=n.layout.get("fill-extrusion-edge-radius"),g=m>0&&!n.paint.get("fill-extrusion-rounded-roof"),_=g?0:m,y="globe"===u.projection.name?e.fillExtrusionHeightLift():0,x="globe"===u.projection.name,v=x?e.globeToMercatorTransition(u.zoom):0,b=[e.mercatorXfromLng(u.center.lng),e.mercatorYfromLat(u.center.lat)],w=[];x&&w.push("PROJECTION_GLOBE_VIEW"),f[0]>0&&w.push("FAUX_AO"),g&&w.push("ZERO_ROOF_RADIUS");for(const m of r){const r=i.getTile(m),g=r.getBucket(n);if(!g||g.projection.name!==u.projection.name)continue;const S=g.programConfigurations.get(n.id),T=t.useProgram(d?"fillExtrusionPattern":"fillExtrusion",S,w);if(t.terrain){const e=t.terrain;if(t.style.terrainSetForDrapingOnly())e.setupElevationDraw(r,T,{useMeterToDem:!0});else{if(!g.enableTerrain)continue;if(e.setupElevationDraw(r,T,{useMeterToDem:!0}),yn(l,i,m,g,n,e),!g.centroidVertexBuffer){const e=T.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}}}d&&(t.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),S.updatePaintBuffers());const E=h.constantOr(null);if(E&&r.imageAtlas){const e=r.imageAtlas.patternPositions[E.toString()];e&&S.setConstantPatternPositions(e)}const C=t.translatePosMatrix(m.projMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),k=u.projection.createInversionMatrix(u,m.canonical),M=n.paint.get("fill-extrusion-vertical-gradient"),A=d?Ri(C,t,M,p,f,_,m,r,y,v,b,k):Li(C,t,M,p,f,_,m,y,v,b,k);t.prepareDrawProgram(l,T,m.toUnwrapped());const P=[];t.terrain&&P.push(g.centroidVertexBuffer),x&&P.push(g.layoutVertexExtBuffer),T.draw(l,l.gl.TRIANGLES,o,s,a,e.CullFaceMode.backCCW,A,n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,t.transform.zoom,S,P)}}function yn(t,i,n,r,o,s){const a=[t=>{let i=t.canonical.x-1,n=t.wrap;return i<0&&(i=(1<<t.canonical.z)-1,n--),new e.OverscaledTileID(t.overscaledZ,n,t.canonical.z,i,t.canonical.y)},t=>{let i=t.canonical.x+1,n=t.wrap;return i===1<<t.canonical.z&&(i=0,n++),new e.OverscaledTileID(t.overscaledZ,n,t.canonical.z,i,t.canonical.y)},t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)],l=e=>{const t=i.getSource().minzoom,n=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},r=[0,-1,1];for(const i of r){if(e.overscaledZ+i<t)continue;const r=n(e.calculateScaledKey(e.overscaledZ+i));if(r)return r}},c=[0,0,0],u=(t,i)=>(c[0]=Math.min(t.min.y,i.min.y),c[1]=Math.max(t.max.y,i.max.y),c[2]=e.EXTENT-i.min.x>t.max.x?i.min.x-e.EXTENT:t.max.x,c),h=(t,i)=>(c[0]=Math.min(t.min.x,i.min.x),c[1]=Math.max(t.max.x,i.max.x),c[2]=e.EXTENT-i.min.y>t.max.y?i.min.y-e.EXTENT:t.max.y,c),d=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>h(e,t),(e,t)=>h(t,e)],p=new e.Point(0,0);let f,m,g;const _=(t,i,r,o,a)=>{const l=[[o?r:t,o?t:r,0],[o?r:i,o?i:r,0]],c=a<0?e.EXTENT+a:a,u=[o?c:(t+i)/2,o?(t+i)/2:c,0];return 0===r&&a<0||0!==r&&a>0?s.getForTilePoints(g,[u],!0,m):l.push(u),s.getForTilePoints(n,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/s.exaggeration()};for(let t=0;t<4;t++){const i=(t<2?1:5)-t,o=r.borders[t];if(0===o.length)continue;const c=g=a[t](n),u=l(c);if(!(u&&u instanceof e.FillExtrusionBucket&&u.enableTerrain))continue;if(r.borderDoneWithNeighborZ[t]===u.canonical.z&&u.borderDoneWithNeighborZ[i]===r.canonical.z)continue;if(m=s.findDEMTileFor(c),!m||!m.dem)continue;if(!f){const e=s.findDEMTileFor(n);if(!e||!e.dem)return;f=e}const h=u.borders[i];let y=0;const x=u.borderDoneWithNeighborZ[i]!==r.canonical.z;if(r.canonical.z===u.canonical.z){for(let n=0;n<o.length;n++){const s=r.featuresOnBorder[o[n]],a=s.borders[t];let l;for(;y<h.length&&(l=u.featuresOnBorder[h[y]],!(l.borders[i][1]>a[0]+3));)x&&u.encodeCentroid(void 0,l,!1),y++;if(l&&y<h.length){const n=y;let o=0;for(;!(l.borders[i][0]>a[1]-3)&&(o++,++y!==h.length);)l=u.featuresOnBorder[h[y]];if(l=u.featuresOnBorder[h[n]],s.intersectsCount()>1||l.intersectsCount()>1||1!==o){1!==o&&(y=n),r.encodeCentroid(void 0,s,!1),x&&u.encodeCentroid(void 0,l,!1);continue}const c=d[t](s,l),f=t%2?e.EXTENT-1:0;p.x=_(c[0],Math.min(e.EXTENT-1,c[1]),f,t<2,c[2]),p.y=0,r.encodeCentroid(p,s,!1),x&&u.encodeCentroid(p,l,!1)}else r.encodeCentroid(void 0,s,!1)}r.borderDoneWithNeighborZ[t]=u.canonical.z,r.needsCentroidUpdate=!0,x&&(u.borderDoneWithNeighborZ[i]=r.canonical.z,u.needsCentroidUpdate=!0)}else{for(const e of o)r.encodeCentroid(void 0,r.featuresOnBorder[e],!1);if(x){for(const e of h)u.encodeCentroid(void 0,u.featuresOnBorder[e],!1);u.borderDoneWithNeighborZ[i]=r.canonical.z,u.needsCentroidUpdate=!0}r.borderDoneWithNeighborZ[t]=u.canonical.z,r.needsCentroidUpdate=!0}}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const xn=new e.Color(1,0,0,1),vn=new e.Color(0,1,0,1),bn=new e.Color(0,0,1,1),wn=new e.Color(1,0,1,1),Sn=new e.Color(0,1,1,1);function Tn(t,i,n){const r=t.context,o=t.transform,s=r.gl,a="globe"===o.projection.name,l=a?["PROJECTION_GLOBE_VIEW"]:null;let c=n.projMatrix;if(a&&e.globeToMercatorTransition(o.zoom)>0){const t=e.transitionTileAABBinECEF(n.canonical,o),i=e.globeDenormalizeECEF(t);c=e.multiply(new Float32Array(16),o.globeMatrix,i),e.multiply(c,o.projMatrix,c)}const u=t.useProgram("debug",null,l),h=i.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(h,u);const d=e.DepthMode.disabled,p=e.StencilMode.disabled,f=t.colorModeForRenderPass(),m="$debug";r.activeTexture.set(s.TEXTURE0),t.emptyTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a?h._makeGlobeTileDebugBuffers(t.context,o):h._makeDebugTileBoundsBuffers(t.context,o.projection);const g=h._tileDebugBuffer||t.debugBuffer,_=h._tileDebugIndexBuffer||t.debugIndexBuffer,y=h._tileDebugSegments||t.debugSegments;u.draw(r,s.LINE_STRIP,d,p,f,e.CullFaceMode.disabled,Gi(c,e.Color.red),m,g,_,y,null,null,null,[h._globeTileDebugBorderBuffer]);const x=h.latestRawTileData,v=Math.floor((x&&x.byteLength||0)/1024),b=i.getTile(n).tileSize,w=512/Math.min(b,512)*(n.overscaledZ/o.zoom)*.5;let S=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(S+=` => ${n.overscaledZ}`),S+=` ${v}kb`,function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,n=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(t,S);const T=h._tileDebugTextBuffer||t.debugBuffer,E=h._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,C=h._tileDebugTextSegments||t.debugSegments;u.draw(r,s.TRIANGLES,d,p,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,Gi(c,e.Color.transparent,w),m,T,E,C,null,null,null,[h._globeTileDebugTextBuffer])}function En(e,t,i,n){kn(e,0,t+i/2,e.transform.width,i,n)}function Cn(e,t,i,n){kn(e,t-i/2,0,i,e.transform.height,n)}function kn(t,i,n,r,o,s){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.exported.devicePixelRatio,n*e.exported.devicePixelRatio,r*e.exported.devicePixelRatio,o*e.exported.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}const Mn=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:An}=Mn;function Pn(e,t,i,n){e.emplaceBack(t,i,n)}class In{constructor(t){this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,Pn(this.vertexArray,-1,-1,1),Pn(this.vertexArray,1,-1,1),Pn(this.vertexArray,-1,1,1),Pn(this.vertexArray,1,1,1),Pn(this.vertexArray,-1,-1,-1),Pn(this.vertexArray,1,-1,-1),Pn(this.vertexArray,-1,1,-1),Pn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,An),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)}}function zn(t,i,n,r,o,s){const a=t.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,i,n,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.fromMat4(e.create$1(),r),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,i.skyboxTexture,0),n.draw(t,a.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Dn=e.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ln{constructor(t){const i=new e.StructArrayLayout5f20;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const n=new e.StructArrayLayout3ui6;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,Dn.members),this.indexBuffer=t.createIndexBuffer(n),this.segments=e.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Rn={symbol:function(t,i,n,r,o){if("translucent"!==t.renderPass)return;const s=e.StencilMode.disabled,a=t.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(t,i,n,r,o,s,a){const l=i.transform,c="map"===o,u="map"===s;for(const i of t){const t=r.getTile(i),o=t.getBucket(n);if(!o||!o.text||!o.text.segments.get().length)continue;const s=e.evaluateSizeForZoom(o.textSizeData,l.zoom),h=xt(i,o.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(t),p=et(h,t.tileID.canonical,u,c,l,o.getProjection(),d),f="none"!==n.layout.get("icon-text-fit")&&o.hasIconData();if(s){const n=Math.pow(2,l.zoom-t.tileID.overscaledZ);dn(o,c,u,a,e.symbolSize,l,p,i,n,s,f)}}}(r,t,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),o),0!==n.paint.get("icon-opacity").constantOr(1)&&fn(t,i,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),s,a),0!==n.paint.get("text-opacity").constantOr(1)&&fn(t,i,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),s,a),i.map.showCollisionBoxes&&(cn(t,i,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),cn(t,i,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,n,r){if("translucent"!==t.renderPass)return;const o=n.paint.get("circle-opacity"),s=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=t.context,u=c.gl,h=t.transform,d=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),p=e.StencilMode.disabled,f=t.colorModeForRenderPass(),m="globe"===h.projection.name,g=[e.mercatorXfromLng(h.center.lng),e.mercatorYfromLat(h.center.lat)],_=[];for(let o=0;o<r.length;o++){const s=r[o],a=i.getTile(s),c=a.getBucket(n);if(!c||c.projection.name!==h.projection.name)continue;const u=c.programConfigurations.get(n.id),d=$i(n);m&&d.push("PROJECTION_GLOBE_VIEW");const p=t.useProgram("circle",u,d),f=c.layoutVertexBuffer,y=c.globeExtVertexBuffer,x=c.indexBuffer,v=h.projection.createInversionMatrix(h,s.canonical),b={programConfiguration:u,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:y,indexBuffer:x,uniformValues:Ui(t,s,a,v,g,n),tile:a};if(l){const t=c.segments.get();for(const i of t)_.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:b})}else _.push({segments:c.segments,sortKey:0,state:b})}l&&_.sort(((e,t)=>e.sortKey-t.sortKey));const y={useDepthForOcclusion:!m};for(const i of _){const{programConfiguration:r,program:o,layoutVertexBuffer:s,globeExtVertexBuffer:a,indexBuffer:l,uniformValues:m,tile:g}=i.state,_=i.segments;t.terrain&&t.terrain.setupElevationDraw(g,o,y),t.prepareDrawProgram(c,o,g.tileID.toUnwrapped()),o.draw(c,u.TRIANGLES,d,p,f,e.CullFaceMode.disabled,m,n.id,s,l,_,n.paint,h.zoom,r,[a])}},heatmap:function(t,i,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,s=o.gl,a=e.StencilMode.disabled,l=new e.ColorMode([s.ONE,s.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,i,n){const r=e.gl,o=t.width*n,s=t.height*n;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,o,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=i.heatmapFbo=e.createFramebuffer(o,s,!1),function(e,t,i,n,r,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,e.isWebGL2&&e.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,r,o,0,s.RGBA,e.extRenderToTextureHalfFloat?e.isWebGL2?s.HALF_FLOAT:e.extTextureHalfFloat.HALF_FLOAT_OES:s.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(e,0,t,a,o,s)}else r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(o,t,n,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.Color.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:null,d=u?e.CullFaceMode.frontCCW:e.CullFaceMode.disabled,p=[e.mercatorXfromLng(c.center.lng),e.mercatorYfromLat(c.center.lat)];for(let f=0;f<r.length;f++){const m=r[f];if(i.hasRenderableParent(m))continue;const g=i.getTile(m),_=g.getBucket(n);if(!_||_.projection.name!==c.projection.name)continue;const y=_.programConfigurations.get(n.id),x=t.useProgram("heatmap",y,h),{zoom:v}=t.transform;t.terrain&&t.terrain.setupElevationDraw(g,x),t.prepareDrawProgram(o,x,m.toUnwrapped());const b=c.projection.createInversionMatrix(c,m.canonical);x.draw(o,s.TRIANGLES,e.DepthMode.disabled,a,l,d,qi(t,m,g,b,p,v,n.paint.get("heatmap-intensity")),n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,n.paint,t.transform.zoom,y,u?[_.globeExtVertexBuffer]:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const n=t.context,r=n.gl,o=i.heatmapFbo;if(!o)return;n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new e.Texture(n,i.colorRamp,r.RGBA)),s.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(n,r.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,((e,t,i,n)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,n))},line:function(t,i,n,r){if("translucent"!==t.renderPass)return;const o=n.paint.get("line-opacity"),s=n.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),c=t.terrain&&t.terrain.renderingToTexture?1:e.exported.devicePixelRatio,u=n.paint.get("line-dasharray"),h=u.constantOr(1),d=n.layout.get("line-cap"),p=n.paint.get("line-pattern"),f=p.constantOr(1),m=n.paint.get("line-gradient"),g=f?"linePattern":"line",_=t.context,y=_.gl,x=(e=>{const t=[];Ki(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET");const n=e.paint.get("line-pattern").constantOr(1),r=1!==e.paint.get("line-opacity").constantOr(1);return!n&&r&&t.push("RENDER_LINE_ALPHA_DISCARD"),t})(n);let v=x.includes("RENDER_LINE_ALPHA_DISCARD");t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(v=!1);for(const o of r){const r=i.getTile(o);if(f&&!r.patternsLoaded())continue;const s=r.getBucket(n);if(!s)continue;t.prepareDrawTile();const b=s.programConfigurations.get(n.id),w=t.useProgram(g,b,x),S=p.constantOr(null);if(S&&r.imageAtlas){const e=r.imageAtlas.patternPositions[S.toString()];e&&b.setConstantPatternPositions(e)}const T=u.constantOr(null),E=d.constantOr(null);if(!f&&T&&E&&r.lineAtlas){const e=r.lineAtlas.getDash(T,E);e&&b.setConstantPatternPositions(e)}let[C,k]=n.paint.get("line-trim-offset");if("round"===E||"square"===E){const e=1;C!==k&&(0===C&&(C-=e),1===k&&(k+=e))}const M=t.terrain?o.projMatrix:null,A=f?Zi(t,r,n,M,c):Xi(t,r,n,M,s.lineClipsArray.length,c,[C,k]);if(m){const r=s.gradients[n.id];let a=r.texture;if(n.gradientVersion!==r.version){let l=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,r=o.canonical.z===n?Math.ceil(1<<t.transform.maxZoom-o.canonical.z):1;l=e.clamp(e.nextPowerOfTwo(s.maxLineLength/e.EXTENT*1024*r),256,_.maxTextureSize)}r.gradient=e.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:s.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.Texture(_,r.gradient,y.RGBA),r.version=n.gradientVersion,a=r.texture}_.activeTexture.set(y.TEXTURE1),a.bind(n.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}h&&(_.activeTexture.set(y.TEXTURE0),r.lineAtlasTexture.bind(y.LINEAR,y.REPEAT),b.updatePaintBuffers()),f&&(_.activeTexture.set(y.TEXTURE0),r.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),b.updatePaintBuffers()),t.prepareDrawProgram(_,w,o.toUnwrapped());const P=i=>{w.draw(_,y.TRIANGLES,a,i,l,e.CullFaceMode.disabled,A,n.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,n.paint,t.transform.zoom,b,[s.layoutVertexBuffer2])};if(v){const i=t.stencilModeForClipping(o).ref;0===i&&t.terrain&&_.clear({stencil:0});const n={func:y.EQUAL,mask:255};A.u_alpha_discard_threshold=.8,P(new e.StencilMode(n,i,255,y.KEEP,y.KEEP,y.INVERT)),A.u_alpha_discard_threshold=0,P(new e.StencilMode(n,i,255,y.KEEP,y.KEEP,y.KEEP))}else P(t.stencilModeForClipping(o))}v&&(t.resetStencilClippingMasks(),t.terrain&&_.clear({stencil:0}))},fill:function(t,i,n,r){const o=n.paint.get("fill-color"),s=n.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=t.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(e.Color.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const o=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);gn(t,i,n,r,o,a,!1)}if("translucent"===t.renderPass&&n.paint.get("fill-antialias")){const o=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);gn(t,i,n,r,o,a,!0)}},"fill-extrusion":function(t,i,n,r){const o=n.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===t.renderPass){const s=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==o||n.paint.get("fill-extrusion-pattern").constantOr(1))_n(t,i,n,r,s,e.StencilMode.disabled,e.ColorMode.disabled),_n(t,i,n,r,s,t.stencilModeFor3D(),t.colorModeForRenderPass()),t.resetStencilClippingMasks();else{const o=t.colorModeForRenderPass();_n(t,i,n,r,s,e.StencilMode.disabled,o)}}},hillshade:function(t,i,n,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const o=t.context,s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),a=t.colorModeForRenderPass(),l=t.terrain&&t.terrain.renderingToTexture,[c,u]="translucent"!==t.renderPass||l?[{},r]:t.stencilConfigForOverlap(r);for(const r of u){const o=i.getTile(r);if(o.needsHillshadePrepare&&"offscreen"===t.renderPass)gi(t,o,n,s,e.StencilMode.disabled,a);else if("translucent"===t.renderPass){const e=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(r):c[r.overscaledZ];fi(t,r,o,n,s,e,a)}}o.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,i,n,r,o,s){if("translucent"!==t.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!r.length)return;const a=t.context,l=a.gl,c=i.getSource(),u=t.useProgram("raster"),h=t.colorModeForRenderPass(),d=t.terrain&&t.terrain.renderingToTexture,[p,f]=c instanceof Me||d?[{},r]:t.stencilConfigForOverlap(r),m=f[f.length-1].overscaledZ,g=!t.options.moving;for(const r of f){const o=d?e.DepthMode.disabled:t.depthModeForSublayer(r.overscaledZ-m,1===n.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,l.LESS),f=r.toUnwrapped(),_=i.getTile(r);if(d&&(!_||!_.hasData()))continue;const y=d?r.projMatrix:t.transform.calculateProjMatrix(f,g),x=t.terrain&&d?t.terrain.stencilModeForRTTOverlap(r):p[r.overscaledZ],v=s?0:n.paint.get("raster-fade-duration");_.registerFadeDuration(v);const b=i.findLoadedParent(r,0),w=Ci(_,b,i,t.transform,v);let S,T;t.terrain&&t.terrain.prepareDrawTile();const E="nearest"===n.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;a.activeTexture.set(l.TEXTURE0),_.texture.bind(E,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(E,l.CLAMP_TO_EDGE),S=Math.pow(2,b.tileID.overscaledZ-_.tileID.overscaledZ),T=[_.tileID.canonical.x*S%1,_.tileID.canonical.y*S%1]):_.texture.bind(E,l.CLAMP_TO_EDGE),_.texture.useMipmap&&a.extTextureFilterAnisotropic&&t.transform.pitch>20&&l.texParameterf(l.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax);const C=Ji(y,T||[0,0],S||1,w,n,c instanceof Me?c.perspectiveTransform:[0,0]);if(t.prepareDrawProgram(a,u,f),c instanceof Me)c.boundsBuffer&&c.boundsSegments&&u.draw(a,l.TRIANGLES,o,e.StencilMode.disabled,h,e.CullFaceMode.disabled,C,n.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments);else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:r,tileBoundsSegments:s}=t.getTileBoundsBuffers(_);u.draw(a,l.TRIANGLES,o,x,h,e.CullFaceMode.disabled,C,n.id,i,r,s)}}t.resetStencilClippingMasks()},background:function(t,i,n,r){const o=n.paint.get("background-color"),s=n.paint.get("background-opacity");if(0===s)return;const a=t.context,l=a.gl,c=t.transform,u=c.tileSize,h=n.paint.get("background-pattern");if(t.isPatternMissing(h))return;const d=!h&&1===o.a&&1===s&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==d)return;const p=e.StencilMode.disabled,f=t.depthModeForSublayer(0,"opaque"===d?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),m=t.colorModeForRenderPass(),g=t.useProgram(h?"backgroundPattern":"background");let _,y=r;y||(_=t.getBackgroundTiles(),y=Object.values(_).map((e=>e.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));for(const d of y){const y=d.toUnwrapped(),x=r?d.projMatrix:t.transform.calculateProjMatrix(y);t.prepareDrawTile();const v=i?i.getTile(d):_?_[d.key]:new e.Tile(d,u,c.zoom,t),b=h?sn(x,s,t,h,{tileID:d,tileSize:u}):on(x,s,o);t.prepareDrawProgram(a,g,y);const{tileBoundsBuffer:w,tileBoundsIndexBuffer:S,tileBoundsSegments:T}=t.getTileBoundsBuffers(v);g.draw(a,l.TRIANGLES,f,p,m,e.CullFaceMode.disabled,b,n.id,w,S,T)}},sky:function(t,i,n){const r=t.transform,o="mercator"===r.projection.name||"globe"===r.projection.name?1:e.smoothstep(7,8,r.zoom),s=n.paint.get("sky-opacity")*o;if(0===s)return;const a=t.context,l=n.paint.get("sky-type"),c=new e.DepthMode(a.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),u=t.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===t.renderPass?n.needsSkyboxCapture(t)&&(function(t,i,n,r){const o=t.context,s=o.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=o.createFramebuffer(32,32,!1),i.skyboxGeometry=new In(o),i.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let e=0;e<6;++e)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=i.getCenter(t,!0),c=t.useProgram("skyboxCapture"),u=new Float64Array(16);e.identity(u),e.rotateY(u,u,.5*-Math.PI),zn(o,i,c,u,l,0),e.identity(u),e.rotateY(u,u,.5*Math.PI),zn(o,i,c,u,l,1),e.identity(u),e.rotateX(u,u,.5*-Math.PI),zn(o,i,c,u,l,2),e.identity(u),e.rotateX(u,u,.5*Math.PI),zn(o,i,c,u,l,3),e.identity(u),zn(o,i,c,u,l,4),e.identity(u),e.rotateY(u,u,Math.PI),zn(o,i,c,u,l,5),o.viewport.set([0,0,t.width,t.height])}(t,n),n.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,i,n,r,o){const s=t.context,a=s.gl,l=t.transform,c=t.useProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,i.skyboxTexture);const u=((e,t,i,n,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:n,u_temporal_offset:r}))(l.skyboxMatrix,i.getCenter(t,!1),0,r,o);t.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,n,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,u,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,n,c,s,u):"gradient"===l&&"sky"===t.renderPass&&function(t,i,n,r,o){const s=t.context,a=s.gl,l=t.transform,c=t.useProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new In(s)),s.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new e.Texture(s,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((t,i,n,r,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.degToRad(n),u_opacity:r,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),r,o);t.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,n,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,n,c,s,u)},debug:function(e,t,i){for(let n=0;n<i.length;n++)Tn(e,t,i[n])},custom:function(t,i,n,r){const o=t.context,s=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&n.isLayerDraped()){if("offscreen"===t.renderPass){const i=s.prerender;if(i){if(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const n=t.transform.pointMerc;i.call(s,o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.globeToMercatorTransition(t.transform.zoom),[n.x,n.y],t.transform.pixelsPerMeterRatio)}else i.call(s,o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const i=s.renderToTile;if(i){const n=r[0].canonical,a=new e.MercatorCoordinate(n.x+r[0].wrap*(1<<n.z),n.y,n.z);o.setDepthMode(e.DepthMode.disabled),o.setStencilMode(e.StencilMode.disabled),o.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),i.call(s,o.gl,a),o.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(e.StencilMode.disabled);const i="3d"===s.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);if(o.setDepthMode(i),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;s.render(o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.globeToMercatorTransition(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else s.render(o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}else e.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class On{constructor(t,i,n=!1){this.context=new Te(t,n),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Pi(this,e));const n=this._terrain;this.transform.elevation=i?n:null,n.update(e,this.transform,t)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,n]=t.getFovAdjustedRange(this.transform._fov);if(i>n)return void(this.transform.fogCullDistSq=null);const r=i+.78*(n-i);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,i){if(this.width=t*e.exported.devicePixelRatio,this.height=i*e.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._layers[e].resize()}setup(){const t=this.context,i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(i,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);const n=new e.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(e.EXTENT,0),n.emplaceBack(0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(n,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);const r=new e.StructArrayLayout2i4;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);const o=new e.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(e.EXTENT,0,e.EXTENT,0),o.emplaceBack(0,e.EXTENT,0,e.EXTENT),o.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.boundsAttributes.members),this.mercatorBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);const s=new e.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new e.StructArrayLayout1ui2;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.Texture(t,new e.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.create();const l=this.context.gl;this.stencilClearMode=new e.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(e.window.performance.now()),this.atmosphereBuffer=new Ln(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,i.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,Ei(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,n){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of n)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=i.id;const r=this.context,o=r.gl;this.nextStencilID+n.length>256&&this.clearStencil(),r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const s=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of n){const n=i.getTile(t),a=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=this.getTileBoundsBuffers(n);s.draw(r,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},a,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,Ei(t.projMatrix),"$clipping",l,c,u)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new e.StencilMode({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new e.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,n=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=n[n.length-1].overscaledZ,o=n[0].overscaledZ-r+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const t={};for(let n=0;n<o;n++)t[n+r]=new e.StencilMode({func:i.GEQUAL,mask:255},n+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=o,[t,n]}return[{[r]:e.StencilMode.disabled},n]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}depthModeForSublayer(t,i,n){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(n||this.context.gl.LEQUAL,i,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this.style=t,this.options=i,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now()),this.imageManager.beginFrame();const n=this.style.order,r=this.style._sourceCaches;for(const e in r){const t=r[e];t.used&&t.prepare(this.context)}const o={},s={},a={};for(const e in r){const t=r[e];o[e]=t.getVisibleCoordinates(),s[e]=o[e].slice().reverse(),a[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<n.length;e++)if(this.style._layers[n[e]].is3D()){this.opaquePassCutoff=e;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.GlobeSharedBuffers(this.context)),!e.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const e of n){const i=this.style._layers[e],n=t._getLayerSourceCache(i);if(!i.hasOffscreenPass()||i.isHidden(this.transform.zoom))continue;const r=n?s[n.id]:void 0;("custom"===i.type||i.isSky()||r&&r.length)&&this.renderLayer(this,n,i,r)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon];const l=this.terrain;if(l&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&l.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:i.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[n[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky())continue;const r=i?s[i.id]:void 0;this._renderTileClippingMasks(e,i,r),this.renderLayer(this,i,e,r)}if(this.style.fog&&this.transform.projection.supportsFog&&function(t,i){const n=t.context,r=n.gl,o=t.transform,s=new e.DepthMode(r.LEQUAL,e.DepthMode.ReadOnly,[0,1]),a=t.useProgram("globeAtmosphere",null,"globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),l=e.globeToMercatorTransition(o.zoom),c=i.properties.get("color").toArray01(),u=i.properties.get("high-color").toArray01(),h=i.properties.get("space-color").toArray01PremultipliedAlpha(),d=e.identity$1([]);e.rotateY$1(d,d,-e.degToRad(o._center.lng)),e.rotateX$1(d,d,e.degToRad(o._center.lat)),e.rotateZ$1(d,d,o.angle),e.rotateX$1(d,d,-o._pitch);const p=e.fromQuat(new Float32Array(16),d),f=e.mapValue(i.properties.get("star-intensity"),0,1,0,.25),m=5e-4,g=e.mapValue(i.properties.get("horizon-blend"),0,1,m,.25),_=e.globeUseCustomAntiAliasing(t,n,o)&&g===m?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,y=t.frameCounter/1e3%1,x=e.length(o.globeCenterInViewSpace),v=Math.sqrt(Math.pow(x,2)-Math.pow(_,2)),b=Math.acos(v/x),w=((t,i,n,r,o,s,a,l,c,u,h,d,p,f)=>({u_frustum_tl:t,u_frustum_tr:i,u_frustum_br:n,u_frustum_bl:r,u_horizon:o,u_transition:s,u_fadeout_range:a,u_color:l,u_high_color:c,u_space_color:u,u_star_intensity:h,u_star_size:5*e.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:d,u_horizon_angle:p,u_rotation_matrix:f}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,l,g,c,u,h,f,y,b,p);t.prepareDrawProgram(n,a);const S=t.atmosphereBuffer;S&&a.draw(n,r.TRIANGLES,s,e.StencilMode.disabled,e.ColorMode.alphaBlended,e.CullFaceMode.backCW,w,"skybox",S.vertexBuffer,S.indexBuffer,S.segments)}(this,this.style.fog),this.renderPass="sky",(e.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const e=this.style._layers[n[this.currentLayer]],i=t._getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?s[i.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;){const e=this.style._layers[n[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const r=i?("symbol"===e.type?a:s)[i.id]:void 0;this._renderTileClippingMasks(e,i,i?o[i.id]:void 0),this.renderLayer(this,i,e,r),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;e.values(this.style._layers).forEach((e=>{const n=t._getLayerSourceCache(e);n&&!e.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<n.getSource().maxzoom)&&(i=n)})),i&&this.options.showTileBoundaries&&Rn.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;En(e,e.transform.height-(t.top||0),3,xn),En(e,t.bottom||0,3,vn),Cn(e,t.left||0,3,bn),Cn(e,e.transform.width-(t.right||0),3,wn);const i=e.transform.centerPoint;!function(e,t,i,n){kn(e,t-1,i-10,2,20,n),kn(e,t-10,i-1,20,2,n)}(e,i.x,e.transform.height-i.y,Sn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}renderLayer(e,t,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||n&&n.length)&&(this.id=i.id,this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&"custom"===i.type)&&Rn[i.type](e,t,i,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),i.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=e.createQueryEXT();this.deferredRenderGpuTimeQueries.push(t),e.beginQueryEXT(e.TIME_ELAPSED_EXT,t)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const n=e[i],r=this.context.extTimerQuery,o=r.getQueryObjectEXT(n.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(n.query),t[i]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery;let i=0;for(const n of e)i+=t.getQueryObjectEXT(n,t.QUERY_RESULT_EXT)/1e6,t.deleteQueryEXT(n);return i}translatePosMatrix(t,i,n,r,o){if(!n[0]&&!n[1])return t;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}const a=[o?n[0]:P(i,n[0],this.transform.zoom),o?n[1]:P(i,n[1],this.transform.zoom),0],l=new Float32Array(16);return e.translate(l,t,a),l}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const e=this.terrain&&this.terrain.renderingToTexture,t=this.terrain&&0===this.terrain.exaggeration(),i=this.style&&this.style.fog,n=[];return this.terrainRenderModeElevated()&&n.push("TERRAIN"),"globe"===this.transform.projection.name&&n.push("GLOBE"),t&&n.push("ZERO_EXAGGERATION"),i&&!e&&0!==i.getOpacity(this.transform.pitch)&&n.push("FOG"),e&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}useProgram(e,t,i){this.cache=this.cache||{};const n=i||[],r=this.currentGlobalDefines().concat(n),o=Ii.cacheKey(ci[e],e,r,t);return this.cache[o]||(this.cache[o]=new Ii(this.context,e,ci[e],t,an[e],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,i,n){if(this.terrain&&this.terrain.renderingToTexture)return;const r=this.style.fog;if(r){const o=r.getOpacity(this.transform.pitch),s=((t,i,n,r,o,s,a,l,c,u,h)=>{const d=t.transform,p=i.properties.get("color").toArray01();p[3]=r;const f=t.frameCounter/1e3%1;return{u_fog_matrix:n?d.calculateFogTileMatrix(n):t.identityMat,u_fog_range:i.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_temporal_offset:f,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.globeToMercatorTransition(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,r,n,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.exported.devicePixelRatio,this.transform.height*e.exported.devicePixelRatio]);i.setFogUniformValues(t,s)}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const r of n)i[r.key]=t[r.key]||new e.Tile(r,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}}class Bn{constructor(e=0,t=0,i=0,n=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=n}interpolate(t,i,n){return null!=i.top&&null!=t.top&&(this.top=e.number(t.top,i.top,n)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,i.bottom,n)),null!=i.left&&null!=t.left&&(this.left=e.number(t.left,i.left,n)),null!=i.right&&null!=t.right&&(this.right=e.number(t.right,i.right,n)),this}getCenter(t,i){const n=e.clamp((this.left+t-this.right)/2,0,t),r=e.clamp((this.top+i-this.bottom)/2,0,i);return new e.Point(n,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Bn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Fn(t,i){const n=e.getColumn(t,3);e.fromQuat(t,i),e.setColumn(t,3,n)}function Nn(t,i){const n=e.identity$1([]);return e.rotateZ$1(n,n,-i),e.rotateX$1(n,n,-t),n}function jn(t,i){const n=[t[0],t[1],0],r=[i[0],i[1],0];if(e.length(n)>=1e-15){const t=e.normalize([],n);e.scale$2(r,t,e.dot(r,t)),i[0]=r[0],i[1]=r[1]}const o=e.cross([],i,t);if(e.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return Nn(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}class Un{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const i=t instanceof e.MercatorCoordinate?t:new e.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.wrap(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const n=this.position,r=this._elevation?this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(t)):0,o=e.MercatorCoordinate.fromLngLat(t,r),s=[o.x-n.x,o.y-n.y,o.z-n.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=jn(s,i)}setPitchBearing(t,i){this.orientation=Nn(e.degToRad(t),e.degToRad(-i))}}class $n{constructor(t,i){this._transform=e.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=e.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&e.setColumn(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.identity$1([]),t&&Fn(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Nn(e,t),Fn(this._transform,this._orientation)}forward(){const t=e.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const n=new Float64Array(16);return e.invert(n,this.getWorldToCamera(t,i)),n}getWorldToCameraPosition(t,i,n){const r=this.position;e.scale$2(r,r,-t);const o=new Float64Array(16);return e.fromScaling(o,[n,n,n]),e.translate(o,o,r),o[10]*=i,o}getWorldToCamera(t,i){const n=new Float64Array(16),r=new Float64Array(4),o=this.position;return e.conjugate(r,this._orientation),e.scale$2(o,o,-t),e.fromQuat(n,r),e.translate(n,n,o),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(t,i,n,r){const o=new Float64Array(16);return e.perspective(o,t,i,n,r),o}getDistanceToElevation(t,i=!1){const n=0===t?0:e.mercatorZfromAltitude(t,i?e.latFromMercatorY(this.position[1]):this.position[1]),r=this.forward();return(n-this.position[2])/r[2]}clone(){return new $n([...this.position],[...this.orientation])}}function Vn(t,i){const n=Wn(t.projection,t.zoom,t.width,t.height),r=function(t,i,n,r,o){const s=new e.LngLat(n.lng-180*qn,n.lat),a=new e.LngLat(n.lng+180*qn,n.lat),l=t.project(s.lng,s.lat),c=t.project(a.lng,a.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=e.MercatorCoordinate.fromLngLat(n);h.y=e.clamp(h.y,-1+qn,1-qn);const d=h.toLngLat(),p=t.project(d.lng,d.lat),f=e.MercatorCoordinate.fromLngLat(d);f.x+=qn;const m=f.toLngLat(),g=t.project(m.lng,m.lat),_=Zn(g.x-p.x,g.y-p.y,u),y=e.MercatorCoordinate.fromLngLat(d);y.y+=qn;const x=y.toLngLat(),v=t.project(x.lng,x.lat),b=Zn(v.x-p.x,v.y-p.y,u),w=Math.abs(_.x)/Math.abs(b.y),S=e.identity([]);e.rotateZ(S,S,-u*(1-(o?0:r)));const T=e.identity([]);return e.scale(T,T,[1,1-(1-w)*r,1]),T[4]=-b.x/b.y*r,e.rotateZ(T,T,u),e.multiply(T,S,T),T}(t.projection,0,t.center,n,i),o=Gn(t);return e.scale(r,r,[o,o,1]),r}function Gn(t){const i=t.projection,n=Wn(t.projection,t.zoom,t.width,t.height),r=Xn(i,t.center),o=Xn(i,e.LngLat.convert(i.center));return Math.pow(2,r*n+(1-n)*o)}function Wn(t,i,n,r,o=1/0){const s=t.range;if(!s)return 0;const a=Math.min(o,Math.max(n,r)),l=Math.log(a/1024)/Math.LN2;return e.smoothstep(s[0]+l,s[1]+l,i)}const qn=1/4e4;function Xn(t,i){const n=e.clamp(i.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),r=new e.LngLat(i.lng-180*qn,n),o=new e.LngLat(i.lng+180*qn,n),s=t.project(r.lng,n),a=t.project(o.lng,n),l=e.MercatorCoordinate.fromLngLat(r),c=e.MercatorCoordinate.fromLngLat(o),u=a.x-s.x,h=a.y-s.y,d=c.x-l.x,p=c.y-l.y,f=Math.sqrt((d*d+p*p)/(u*u+h*h));return Math.log(f)/Math.LN2}function Zn(e,t,i){const n=Math.cos(i),r=Math.sin(i);return{x:e*n-t*r,y:e*r+t*n}}class Hn{constructor(t,i,n,r,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Bn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new $n,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const e=new Hn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(e,t=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=e.getProjection(this.projectionOptions);const r=!t(n,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.getProjection({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.Point(this.width,this.height)}get bearing(){return e.wrap(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;var n;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=(n=new e.ARRAY_TYPE(4),e.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n),function(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);e[0]=n*l+o*a,e[1]=r*l+s*a,e[2]=n*-a+o*l,e[3]=r*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.degToRad(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const e=this._elevation;this._centerAltitude=e.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=e.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let r=0,o=0;for(let s=0;s<i.length;s++){const a=new e.Point(i[s][0]*this.width,n+i[s][1]*(this.height-n)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,o+=c}return 0===o?NaN:r/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,n=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),o=Math.max(n-i,r);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let n;n=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const r=e.length(e.sub([],this._camera.position,n));return e.clamp(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const n=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new Un;return i.position=new e.MercatorCoordinate(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);const i=e.transformQuat([],[0,0,-1],t),n=e.transformQuat([],[0,-1,0],t);if(n[2]<0)return!1;const r=jn(i,n);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.clamp(t[2],r/n,r/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const n=this.pointCoordinate(new e.Point(0,0)),r=this.pointCoordinate(new e.Point(this.width,0)),o=this.pointCoordinate(new e.Point(this.width,this.height)),s=this.pointCoordinate(new e.Point(0,this.height)),a=Math.floor(Math.min(n.x,r.x,o.x,s.x)),l=Math.floor(Math.max(n.x,r.x,o.x,s.x)),c=1;for(let n=a-c;n<=l+c;n++)0!==n&&i.push(new e.UnwrappedTileID(n,t))}return i}coveringTiles(t){let i=this.coveringZoomLevel(t);const n=i,r=this.elevation&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,l=1<<i,c=[l*s.x,l*s.y,0],u="globe"===this.projection.name,h=!u,d=e.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*e.mercatorZfromAltitude(1,this.center.lat),m=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),g=[l*p.x,l*p.y,m*(h?1:f)],_=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?i:0,x=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,v=t.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=this.projection.isReprojectedInTileSpace?Gn(this):1,w=t=>{const i=1/4e4,n=new e.MercatorCoordinate(t.x+i,t.y,t.z),r=new e.MercatorCoordinate(t.x,t.y+i,t.z),o=t.toLngLat(),s=n.toLngLat(),a=r.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*b/i},S=t=>{const i=x,n=v;return{aabb:e.tileAABB(this,l,0,0,0,t,n,i,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:i,wrap:t,fullyVisible:!1}},T=[];let E=[];const C=i,k=t.reparseOverscaled?n:i,M=e=>e*e,A=M((m-this._centerAltitude)*f),P=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=I(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},I=t=>{if(t.zoom<y)return!0;if(t.zoom===C)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(g),o=t.aabb.distanceY(g);let s=A,l=1;if(u){s=M(t.aabb.distanceZ(g));const i=Math.pow(2,t.zoom),n=e.latFromMercatorY((t.y+1)/i),r=e.latFromMercatorY(t.y/i),o=Math.min(Math.max(a,n),r),c=e.circumferenceAtLatitude(o)/e.circumferenceAtLatitude(a);if(l=o===a?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=e.GLOBE_ZOOM_THRESHOLD_MIN&&t.zoom===C-1&&c>=.9)return!0}else if(r&&(s=M(t.aabb.distanceZ(g)*f)),this.projection.isReprojectedInTileSpace&&n<=5){const i=Math.pow(2,t.zoom),n=w(new e.MercatorCoordinate((t.x+.5)/i,(t.y+.5)/i));l=n>.85?1:n}const c=i*i+o*o+s,h=M((1<<C-t.zoom)*_*l*((e,t)=>{if(t*M(.707)<e)return 1;const i=Math.sqrt(t/e);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,A),c));return c<h};if(this.renderWorldCopies)for(let e=1;e<=3;e++)T.push(S(-e)),T.push(S(e));for(T.push(S(0));T.length>0;){const n=T.pop(),s=n.x,a=n.y;let h=n.fullyVisible;if(!h){const e=n.aabb.intersects(d);if(0===e)continue;h=2===e}if(n.zoom!==C&&I(n))for(let t=0;t<4;t++){const i=(s<<1)+t%2,c=(a<<1)+(t>>1),d={aabb:o?n.aabb.quadrant(t):e.tileAABB(this,l,n.zoom+1,i,c,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:i,y:c,wrap:n.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};r&&!u&&(d.tileID=new e.OverscaledTileID(n.zoom+1===C?k:n.zoom+1,n.wrap,n.zoom+1,i,c),P(d)),T.push(d)}else{const r=n.zoom===C?k:n.zoom;if(t.minzoom&&t.minzoom>r)continue;const o=c[0]-(.5+s+(n.wrap<<n.zoom))*(1<<i-n.zoom),l=c[1]-.5-a,u=n.tileID?n.tileID:new e.OverscaledTileID(r,n.wrap,n.zoom,s,a);E.push({tileID:u,distanceSq:o*o+l*l})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,n=this.horizonLineFromTop();E=E.filter((r=>{const o=[0,0,0,1],s=[e.EXTENT,e.EXTENT,0,1],a=this.calculateFogTileMatrix(r.tileID.toUnwrapped());e.transformMat4$1(o,o,a),e.transformMat4$1(s,s,a);const l=e.getAABBPointSquareDist(o,s);if(0===l)return!0;let c=!1;const u=this._elevation;if(u&&l>i&&0!==n){const i=this.calculateProjMatrix(r.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=u.getMinMaxForTile(r.tileID)),o||(o={min:v,max:x});const s=e.furthestTileCorner(this.rotation),a=[s[0]*e.EXTENT,s[1]*e.EXTENT,o.max];e.transformMat4(a,a,i),c=(1-a[1])*this.height*.5<n}return l<i||c}))}return E.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.clamp(t.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),n=this.projection.project(t.lng,i);return new e.Point(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let n,r;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;n=(i.x-o.x)/e,r=(i.y-o.y)/e}else{const e=this.pointCoordinate(i),t=this.pointCoordinate(o);n=e.x-t.x,r=e.y-t.y}const s=this.locationCoordinate(t);this.setLocation(new e.MercatorCoordinate(s.x-n,s.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,i){const n=i?e.mercatorZfromAltitude(i,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new e.MercatorCoordinate(r.x,r.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const n=null!=i?i:this._centerAltitude,r=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.transformMat4$1(r,r,this.pixelMatrixInverse),e.transformMat4$1(o,o,this.pixelMatrixInverse);const s=o[3];e.scale$1(r,r,1/r[3]),e.scale$1(o,o,1/s);const a=r[2],l=o[2];return{p0:r,p1:o,t:a===l?0:(n-a)/(l-a)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];return e.transformMat4$1(i,i,this.pixelMatrixInverse),e.transformMat4$1(n,n,this.pixelMatrixInverse),e.scale$1(i,i,1/i[3]),e.scale$1(n,n,1/n[3]),i[2]=e.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,n[2]=e.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,e.scale$1(i,i,1/this.worldSize),e.scale$1(n,n,1/this.worldSize),new e.Ray([i[0],i[1],i[2]],e.normalize([],e.sub([],n,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:n,t:r}=t,o=e.mercatorZfromAltitude(i[2],this._center.lat),s=e.mercatorZfromAltitude(n[2],this._center.lat);return new e.MercatorCoordinate(e.number(i[0],n[0],r)/this.worldSize,e.number(i[1],n[1],r)/this.worldSize,e.number(o,s,r))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e.MercatorCoordinate(i[0],i[1],i[2]);let n=0,r=this.horizonLineFromTop();if(t.y>r)return this.pointCoordinate(t);const o=.02*r,s=t.clone();for(let t=0;t<10&&r-n>o;t++){s.y=e.number(n,r,.66);const t=this.projection.pointCoordinate3D(this,s.x,s.y);t?(r=s.y,i=t):n=s.y}return i?new e.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const n=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,n+t.toAltitude(),1];return e.transformMat4$1(r,r,this.pixelMatrix),r[3]>0?new e.Point(r[0]/r[3],r[1]/r[3]):new e.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,o=this.pointLocation3D(new e.Point(i,t)),s=this.pointLocation3D(new e.Point(r,t)),a=this.pointLocation3D(new e.Point(r,n)),l=this.pointLocation3D(new e.Point(i,n));let c=Math.min(o.lng,s.lng,a.lng,l.lng),u=Math.max(o.lng,s.lng,a.lng,l.lng),h=Math.min(o.lat,s.lat,a.lat,l.lat),d=Math.max(o.lat,s.lat,a.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,m=(t,i,n,r,o)=>{const s=(t+n)/2,a=(i+r)/2,l=new e.Point(s,a),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,h-_,g-u,_-d);c=Math.min(c,g),u=Math.max(u,g),h=Math.min(h,_),d=Math.max(d,_),(o<f||y>p)&&(m(t,i,s,a,o+1),m(s,a,n,r,o+1))};if(m(i,t,r,t,1),m(r,t,r,n,1),m(r,n,i,n,1),m(i,n,i,t,1),"globe"===this.projection.name){const[t,i]=e.polesInViewport(this);t?(d=90,u=180,c=-180):i&&(h=-90,u=180,c=-180)}return new e.LngLatBounds(new e.LngLat(c,h),new e.LngLat(u,d))}_getBoundsRectangular(t,i){const{top:n,left:r}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new e.Point(r,n),l=new e.Point(s,n),c=new e.Point(s,o),u=new e.Point(r,o);let h=this.pointCoordinate(a,t),d=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,i),f=this.pointCoordinate(u,i),m=(e,t)=>(t.y-e.y)/(t.x-e.x);return h.y>1&&d.y>=0?h=new e.MercatorCoordinate((1-f.y)/m(f,h)+f.x,1):h.y<0&&d.y<=1&&(h=new e.MercatorCoordinate(-f.y/m(f,h)+f.x,0)),d.y>1&&h.y>=0?d=new e.MercatorCoordinate((1-p.y)/m(p,d)+p.x,1):d.y<0&&h.y<=1&&(d=new e.MercatorCoordinate(-p.y/m(p,d)+p.x,0)),(new e.LngLatBounds).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.MAX_MERCATOR_LATITUDE,this.maxLat=e.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=e.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=e.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=e.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,n=this._distanceTileDataCache;if(n[i])return n[i];const r=t.canonical,o=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(r.z),l=(r.x+Math.pow(2,r.z)*t.wrap)*a,c=r.y*a,u=this.point;u.x*=s/this.worldSize,u.y*=s/this.worldSize;const h=this.angle,d=Math.sin(-h),p=-Math.cos(-h);return n[i]={bearing:[d,p],center:[(u.x-l)*o,(u.y-c)*o],scale:a/e.EXTENT*o},n[i]}calculateFogTileMatrix(t){const i=t.key,n=this._fogTileMatrixCache;if(n[i])return n[i];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.multiply(r,this.worldToFogMatrix,r),n[i]=new Float32Array(r),n[i]}calculateProjMatrix(t,i=!1){const n=t.key,r=i?this._alignedProjMatrixCache:this._projMatrixCache;if(r[n])return r[n];const o=this.calculatePosMatrix(t,this.worldSize);return e.multiply(o,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.alignedProjMatrix:this.projMatrix,o),r[n]=new Float32Array(o),r[n]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,n=this._pixelsToTileUnitsCache;if(n[i])return n[i];const r=function(t,i){const{scale:n}=t.tileTransform,r=n*e.EXTENT/(t.tileSize*Math.pow(2,i.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o=new Float32Array(4),l=(s=i.inverseAdjustmentMatrix)[1],c=s[2],u=s[3],d=(a=[r,r])[1],o[0]=s[0]*(h=a[0]),o[1]=l*h,o[2]=c*d,o[3]=u*d,o;var o,s,a,l,c,u,h,d}(t,this);return n[i]=r,n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,i=e.fromScaling([],[t,t,t]);return e.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),r=this._camera.forward(),o=e.mercatorZfromAltitude(1,this._center.lat);n[2]/=o,r[2]/=o,e.normalize(r,r);const s=t.raycast(n,r,t.exaggeration());if(s){const t=e.scaleAndAdd([],n,r,s),i=new e.MercatorCoordinate(t[0],t[1],e.mercatorZfromAltitude(t[2],e.latFromMercatorY(t[1]))),a=(i.z+e.length([i.x-n[0],i.y-n[1],i.z-n[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const i=this._elevation,n=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(n),o=i.getAtPointOrZero(new e.MercatorCoordinate(...r)),s=this.pixelsPerMeter/this.worldSize*o,a=this._minimumHeightOverTerrain(),l=r[2]-s;if(l<=a)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[r[0],r[1],t.z-r[2]],n=e.length(i);i[2]-=(a-l)/this._pixelsPerMercatorPixel;const o=e.length(i);if(0===o)return;e.scale$2(i,i,n/o*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],t.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const i=this.center;return i.lat=e.clamp(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(i.lng=e.clamp(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:n,y:r}=this.point;let o=0,s=n,a=r;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(r-c<u&&(a=u+c),r+c>h&&(a=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),a=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,i=this.worldSize/2-(e+t)/2;s=(n+i+this.worldSize)%this.worldSize-i,s-l<e&&(s=e+l),s+l>t&&(s=t-l),t-e<this.width&&(o=Math.max(o,this.width/(t-e)),s=(t+e)/2)}s===n&&a===r||(this.center=this.unproject(new e.Point(s,a))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.mercatorZfromAltitude(1,this.center.lat)/e.mercatorZfromAltitude(1,e.GLOBE_SCALE_MATCH_LATITUDE));const n=Wn(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const r="meters"===this.projection.zAxisUnit?i:1,o=this._camera.getWorldToCamera(this.worldSize,r),s=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);s[8]=2*-t.x/this.width,s[9]=2*t.y/this.height;let a=e.mul([],s,o);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.identity([]);e.translate(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.multiply(i,i,Vn(this)),e.translate(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.multiply(a,a,i),this.inverseAdjustmentMatrix=function(e){const t=Vn(e,!0);return y([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=e.scale([],a,[this.worldSize,this.worldSize,this.worldSize/r,1]),this.projMatrix=a,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);const l=e.invert([],s);this.frustumCorners=e.FrustumCorners.fromInvProjectionMatrix(l,this.horizonLineFromTop(),this.height);const c=new Float32Array(16);e.identity(c),e.scale(c,c,[1,-1,1]),e.rotateX(c,c,this._pitch),e.rotateZ(c,c,this.angle);const u=e.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),h=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;u[8]=2*-t.x/this.width,u[9]=2*(t.y+h)/this.height,this.skyboxMatrix=e.multiply(c,u,c);const d=this.point,p=d.x,f=d.y,m=this.width%2/2,g=this.height%2/2,_=Math.cos(this.angle),x=Math.sin(this.angle),v=p-Math.round(p)+_*m+x*g,b=f-Math.round(f)+_*g+x*m,w=new Float64Array(a);if(e.translate(w,w,[v>.5?v-1:v,b>.5?b-1:b,0]),this.alignedProjMatrix=w,a=e.create(),e.scale(a,a,[this.width/2,-this.height/2,1]),e.translate(a,a,[1,-1,0]),this.labelPlaneMatrix=a,a=e.create(),e.scale(a,a,[1,-1,1]),e.translate(a,a,[-1,-1,0]),e.scale(a,a,[2/this.width,2/this.height,1]),this.glCoordMatrix=a,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},a=e.invert(new Float64Array(16),this.pixelMatrix),!a)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=a,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.calculateGlobeMatrix(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.transformMat4(t,t,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=a;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,n=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,o=[t,t,i];e.scale$2(o,o,r),e.scale$2(n,n,-1),e.multiply$2(n,n,o);const s=e.create();e.translate(s,s,n),e.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,r)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),n=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-i[0]*r,n.y/this.worldSize-i[1]*r,e/this.worldSize*this._centerAltitude-i[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],r=t[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(o=Math.min((i-n)/r,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:r}=this._camera.getPitchBearing(),o=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),a=Math.max((t[2]-o)/Math.cos(n),s),l=this._zoomFromMercatorZ(a);e.scaleAndAdd(t,t,i,a),this._pitch=e.clamp(n,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(r,-Math.PI,Math.PI),this._setZoom(e.clamp(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,n=e.GLOBE_ZOOM_THRESHOLD_MAX,r=0,o=1/0;for(;n-i>1e-6&&n>i;){const e=i+.5*(n-i),s=this.tileSize*Math.pow(2,e),a=this.getCameraToCenterDistance(this.projection,e,s),l=this.scaleZoom(a/(t*this.tileSize)),c=Math.abs(e-l);c<o&&(o=c,r=e),e<l?i=e:n=e}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const n=Math.min(t.x,i.x),r=Math.max(t.x,i.x),o=Math.min(t.y,i.y),s=Math.max(t.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new e.Point(n,o),new e.Point(r,s),new e.Point(n,s),new e.Point(r,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.Point(0,0),new e.Point(this.width,this.height))}zoomDeltaToMovement(t,i){const n=e.length(e.sub([],this._camera.position,t)),r=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const t=function([t,i,n],r){const o=[t,i,n,1];e.transformMat4$1(o,o,r);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.Point(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.Point(0,t))}}getCameraToCenterDistance(e,t=this.zoom,i=this.worldSize){const n=Wn(e,t,this.width,this.height,1024),r=e.pixelSpaceConversion(this.center.lat,i,n);return.5/Math.tan(.5*this._fov)*this.height*r}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.multiply(t,t,this.globeMatrix),t}}function Yn(e,t){let i=!1,n=null;const r=()=>{n=null,i&&(e(),n=setTimeout(r,t),i=!1)};return()=>(i=!0,n||r(),n)}class Kn{constructor(t){this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yn(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),e.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const i=Jn(t);if(this._hashName){const t=this._hashName;let n=!1;const r=e.window.location.hash.slice(1).split("&").map((e=>{const r=e.split("=")[0];return r===t?(n=!0,`${r}=${i}`):e})).filter((e=>e));return n||r.push(`${t}=${i}`),`#${r.join("&")}`}return`#${i}`}_getCurrentHash(){const t=e.window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((e=>e.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}function Jn(e,t){const i=e.getCenter(),n=Math.round(100*e.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),s=Math.round(i.lng*o)/o,a=Math.round(i.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?`/${s}/${a}/${n}`:`${n}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const Qn={linearity:.3,easing:e.bezier(0,0,.3,1)},er=e.extend({deceleration:2500,maxSpeed:1400},Qn),tr=e.extend({deceleration:20,maxSpeed:1400},Qn),ir=e.extend({deceleration:1e3,maxSpeed:360},Qn),nr=e.extend({deceleration:1e3,maxSpeed:90},Qn);class rr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.exported.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const o=sr(i.pan.mag(),n,e.extend({},er,t||{}));r.offset=i.pan.mult(o.amount/i.pan.mag()),r.center=this._map.transform.center,or(r,o)}if(i.zoom){const e=sr(i.zoom,n,tr);r.zoom=this._map.transform.zoom+e.amount,or(r,e)}if(i.bearing){const t=sr(i.bearing,n,ir);r.bearing=this._map.transform.bearing+e.clamp(t.amount,-179,179),or(r,t)}if(i.pitch){const e=sr(i.pitch,n,nr);r.pitch=this._map.transform.pitch+e.amount,or(r,e)}if(r.zoom||r.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function or(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function sr(t,i,n){const{maxSpeed:r,linearity:o,deceleration:s}=n,a=e.clamp(t*o/(i/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class ar extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n,r={}){const o=f(i.getCanvasContainer(),n),s=i.unproject(o);super(t,e.extend({point:o,lngLat:s,originalEvent:n},r)),this._defaultPrevented=!1,this.target=i}}class lr extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n){const r="touchend"===t?n.changedTouches:n.touches,o=m(i.getCanvasContainer(),r),s=o.map((e=>i.unproject(e))),a=o.reduce(((e,t,i,n)=>e.add(t.div(n.length))),new e.Point(0,0));super(t,{points:o,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:n}),this._defaultPrevented=!1}}class cr extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class ur{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new cr(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new ar(e.type,this._map,e))}mouseup(e){this._map.fire(new ar(e.type,this._map,e))}preclick(t){const i=e.extend({},t);i.type="preclick",this._map.fire(new ar(i.type,this._map,i))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new ar(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new ar(e.type,this._map,e))}mouseover(e){this._map.fire(new ar(e.type,this._map,e))}mouseout(e){this._map.fire(new ar(e.type,this._map,e))}touchstart(e){return this._firePreventable(new lr(e.type,this._map,e))}touchmove(e){this._map.fire(new lr(e.type,this._map,e))}touchend(e){this._map.fire(new lr(e.type,this._map,e))}touchcancel(e){this._map.fire(new lr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new ar(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new ar(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dr{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t,n=this._startPos,r=this._lastPos;if(!n||!r||r.equals(i)||!this._box&&i.dist(n)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const s=Math.min(n.x,i.x),a=Math.max(n.x,i.x),l=Math.min(n.y,i.y),c=Math.max(n.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${s}px,${l}px)`,this._box.style.width=a-s+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(t,i){if(!this._active)return;const n=this._startPos,r=i;if(n&&0===t.button){if(this.reset(),p(),n.x!==r.x||n.y!==r.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(n,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))}}function pr(e,t){const i={};for(let n=0;n<e.length;n++)i[e[n].identifier]=t[n];return i}class fr{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){const i=new e.Point(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=pr(n,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const n=pr(i,t);for(const e in this.touches){const t=n[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class mr{constructor(e){this.singleTap=new fr(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const n=this.singleTap.touchend(e,t,i);if(n){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class gr{constructor(){this._zoomIn=new mr({numTouches:1,numTaps:2}),this._zoomOut=new mr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const n=this._zoomIn.touchend(e,t,i),r=this._zoomOut.touchend(e,t,i);return n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(n)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _r={0:1,2:2};class yr{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=g(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=_r[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&g(e)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xr extends yr{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class vr extends yr{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class br extends yr{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class wr{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.Point(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(t,i,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!e.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,n)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,n){n.length>0&&(this._active=!0);const r=pr(n,i),o=new e.Point(0,0),s=new e.Point(0,0);let a=0;for(const e in r){const t=r[e],i=this._touches[e];i&&(o._add(t),s._add(t.sub(i)),a++,r[e]=t)}if(this._touches=r,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class Sr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){const n=this._firstTwoTouches;if(!n)return;e.preventDefault();const[r,o]=n,s=Tr(i,t,r),a=Tr(i,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[n,r]=this._firstTwoTouches,o=Tr(i,t,n),s=Tr(i,t,r);o&&s||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Tr(e,t,i){for(let n=0;n<e.length;n++)if(e[n].identifier===i)return t[n]}function Er(e,t){return Math.log(e/t)/Math.LN2}class Cr extends Sr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Er(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Er(this._distance,i),pinchAround:t}}}function kr(e,t){return 180*e.angleWith(t)/Math.PI}class Mr extends Sr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:kr(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const n=kr(e,i);return Math.abs(n)<t}}function Ar(e){return Math.abs(e.y)>Math.abs(e.x)}class Pr extends Sr{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Ar(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,i,n){const r=this._lastPoints;if(!r)return;const o=t[0].sub(r[0]),s=t[1].sub(r[1]);return this._map._cooperativeGestures&&!e.isFullscreen()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(o,s,n.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+s.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const n=e.mag()>=2,r=t.mag()>=2;if(!n&&!r)return;if(!n||!r)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return Ar(e)&&Ar(t)&&o}}const Ir={panStep:100,bearingStep:15,pitchStep:10};class zr{constructor(){const e=Ir;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,n=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Dr,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+n*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Dr(e){return e*(2-e)}const Lr=4.000244140625;class Rr{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const n=e.exported.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%Lr==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=f(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Lr?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);const r=i(),o=Math.pow(2,r),s="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*n))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),r=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&r&&o){const t=Math.min((e.exported.now()-this._lastWheelEventTime)/200,1),i=o(t);s=e.number(r,n,i),t<1?this._frameId||(this._frameId=!0):a=!0}else s=n,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.ease;if(this._prevEase){const t=this._prevEase,n=(e.exported.now()-t.start)/t.duration,r=t.easing(n+.01)-t.easing(n),o=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=e.bezier(o,s,.25,1)}return this._prevEase={start:e.exported.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(e.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class Or{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Br{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fr{constructor(){this._tap=new mr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=t[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nr{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jr{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ur{constructor(e,t,i,n){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $r=e=>e.zoom||e.drag||e.pitch||e.rotate;class Vr extends e.Event{}class Gr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const n=e.sub([],i,t);this.radius=e.length(n[2]<0?e.div([],n,this.constants):[n[0],n[1],0])}projectRay(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$1(t,t,this.constants);const i=e.scale$2([],t,this.radius);if(i[2]>0){const t=e.scale$2([],[0,0,1],e.dot(i,[0,0,1])),n=e.scale$2([],e.normalize([],[i[0],i[1],0]),this.radius),r=e.add([],i,e.scale$2([],e.sub([],e.add([],n,t),i),2));i[0]=r[0],i[1]=r[1]}return i}}function Wr(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class qr{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rr(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Gr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.bindAll(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[e.window,"blur",void 0]];for(const[t,i,n]of this._listeners)t.addEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,n)}destroy(){for(const[t,i,n]of this._listeners)t.removeEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new ur(t,e));const n=t.boxZoom=new dr(t,e);this._add("boxZoom",n);const r=new gr,o=new Br;t.doubleClickZoom=new Or(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const s=new Fr;this._add("tapDragZoom",s);const a=t.touchPitch=new Pr(t);this._add("touchPitch",a);const l=new vr(e),c=new br(e);t.dragRotate=new jr(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new xr(e),h=new wr(t,e);t.dragPan=new Nr(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Mr,p=new Cr;t.touchZoomRotate=new Ur(i,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new hr(t));const f=t.scrollZoom=new Rr(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new zr;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$r(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,i){for(const n in e)if(n!==i&&(!t||t.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,n=i?void 0:e,r={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?m(this._el,a):i?void 0:f(this._el,e);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,i)?c.reset():c[t||e.type]&&(h=c[t||e.type](e,l,a),this.mergeHandlerResult(r,o,h,i,n),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[i]=c)}const c={};for(const e in this._previousActiveHandlers)s[e]||(c[e]=n);this._previousActiveHandlers=s,(Object.keys(c).length||Wr(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||Wr(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,i,n,r,o){if(!n)return;e.extend(t,n);const s={handlerName:r,originalEvent:n.originalEvent||o};void 0!==n.zoomDelta&&(i.zoom=s),void 0!==n.panDelta&&(i.drag=s),void 0!==n.pitchDelta&&(i.pitch=s),void 0!==n.bearingDelta&&(i.rotate=s)}_applyChanges(){const t={},i={},n={};for(const[r,o,s]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.Point(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.extend(i,o),e.extend(n,s);this._updateMapTransform(t,i,n),this._changes=[]}_updateMapTransform(t,i,n){const r=this._map,o=r.transform,s=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Wr(t)){const e=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",e!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&r._stop(!0),!Wr(t))return void this._fireEvents(i,n,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=t;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==p&&(h=p),(l||(e=>i[e]&&!this._eventsInProgress[e])("drag"))&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a)if("mercator"===o.projection.name){const e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(a)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const t=o.pointCoordinate(h);if("globe"===o.projection.name){a=a.rotate(-o.angle);const i=o._pixelsPerMercatorPixel/o.worldSize;f[0]=-a.x*e.mercatorScale(e.latFromMercatorY(t.y))*i,f[1]=-a.y*e.mercatorScale(o.center.lat)*i}else{const e=o.pointCoordinate(h.sub(a));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const m=o.zoom,g=[0,0,0];if(l){const t=s(d||o.pointCoordinate3D(h)),i={dir:e.normalize([],e.sub([],t,o._camera.position))};if(i.dir[2]<0){const n=o.zoomDeltaToMovement(t,l);e.scale$2(g,i.dir,n)}}const _=e.add(f,f,g);o._translateCameraConstrained(_),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,n,!0)}_fireEvents(t,i,n){const r=$r(this._eventsInProgress),o=$r(t),s={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(s[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in s)this._fireEvent(e,s[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:n}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||n,a[`${e}end`]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=$r(this._eventsInProgress);if(n&&(r||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.Event(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new Vr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Xr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Zr extends e.Evented{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,e.bindAll(["_renderFrameCallback"],this)}getCenter(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,n){return t=e.Point.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),n)}panTo(t,i,n){return this.easeTo(e.extend({center:t},i),n)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,n){return this.easeTo(e.extend({zoom:t},i),n)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,n){return this.easeTo(e.extend({bearing:t},i),n)}resetNorth(t,i){return this.rotateTo(0,e.extend({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){t=e.LngLatBounds.convert(t);const n=i&&i.bearing||0,r=i&&i.pitch||0,o=t.getNorthWest(),s=t.getSouthEast();return this._cameraForBounds(this.transform,o,s,n,r,i)}_extendCameraOptions(t){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.extend(i,t.padding),t}_minimumAABBFrustumDistance(e,t){const i=t.max[0]-t.min[0],n=t.max[1]-t.min[1];return i/n>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):n/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,i,n,r,o,s){const a=t.clone(),l=this._extendCameraOptions(s);a.bearing=r,a.pitch=o;const c=e.LngLat.convert(i),u=e.LngLat.convert(n),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),p=e.latLngToECEF(h,d),f=e.normalize([],p),m=e.normalize([],e.cross([],f,[0,1,0])),g=e.cross([],m,f),_=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[p,e.latLngToECEF(c.lat,c.lng),e.latLngToECEF(u.lat,c.lng),e.latLngToECEF(u.lat,u.lng),e.latLngToECEF(c.lat,u.lng),e.latLngToECEF(h,c.lng),e.latLngToECEF(h,u.lng),e.latLngToECEF(c.lat,d),e.latLngToECEF(u.lat,d)];let x=e.Aabb.fromPoints(y.map((t=>[e.dot(m,t),e.dot(g,t),e.dot(f,t)])));const v=e.transformMat4([],x.center,_);0===e.squaredLength(v)&&e.set(v,0,0,1),e.normalize(v,v),e.scale$2(v,v,e.GLOBE_RADIUS),a.center=e.ecefToLatLng(v);const b=a.getWorldToCameraMatrix(),w=e.invert(new Float64Array(16),b);x=e.Aabb.applyTransform(x,e.multiply([],b,_)),e.transformMat4(v,v,b);const S=.5*(x.max[2]-x.min[2]),T=this._minimumAABBFrustumDistance(a,x),E=e.scale$2([],[0,0,1],S),C=e.add(E,v,E),k=T+(0===a.pitch?0:e.distance(v,C)),M=a.globeCenterInViewSpace,A=e.sub([],v,[M[0],M[1],M[2]]);e.normalize(A,A),e.scale$2(A,A,k);const P=e.add([],v,A);e.transformMat4(P,P,w);const I=e.earthRadius/e.GLOBE_RADIUS,z=e.length(P),D=e.mercatorZfromAltitude(Math.max(z*I-e.earthRadius,Number.EPSILON),0),L=Math.min(a.zoomFromMercatorZAdjusted(D),l.maxZoom);return L>.5*(e.GLOBE_ZOOM_THRESHOLD_MIN+e.GLOBE_ZOOM_THRESHOLD_MAX)?(a.setProjection({name:"mercator"}),a.zoom=L,this._cameraForBounds(a,i,n,r,o,s)):{center:a.center,zoom:L,bearing:r,pitch:o}}queryTerrainElevation(t,i){const n=this.transform.elevation;return n?(i=e.extend({},{exaggerated:!0},i),n.getAtPoint(e.MercatorCoordinate.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,n,r,o,s){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,i,n,r,o,s);const a=t.clone(),l=this._extendCameraOptions(s),c=a.padding;a.bearing=r,a.pitch=o;const u=e.LngLat.convert(i),h=e.LngLat.convert(n),d=new e.LngLat(u.lng,h.lat),p=new e.LngLat(h.lng,u.lat),f=a.project(u),m=a.project(h),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(h),y=this.queryTerrainElevation(d),x=this.queryTerrainElevation(p),v=[[f.x,f.y,Math.min(g||0,_||0,y||0,x||0)],[m.x,m.y,Math.max(g||0,_||0,y||0,x||0)]];let b=e.Aabb.fromPoints(v);const w=a.getWorldToCameraMatrix(),S=e.invert(new Float64Array(16),w);b=e.Aabb.applyTransform(b,w);const T=e.sub([],b.max,b.min),E=c.left||0,C=c.right||0,k=c.bottom||0,M=c.top||0,{left:A,right:P,top:I,bottom:z}=l.padding,D=.5*(E+C),L=.5*(M+k),R=Math.min(a.scaleZoom(a.scale*Math.min((a.width-(E+C+A+P))/T[0],(a.height-(k+M+z+I))/T[1])),l.maxZoom),O=a.scale/a.zoomScale(R);b=new e.Aabb([b.min[0]-(A+D)*O,b.min[1]-(z+L)*O,b.min[2]],[b.max[0]+(P+D)*O,b.max[1]+(I+L)*O,b.max[2]]);const B=.5*T[2],F=this._minimumAABBFrustumDistance(a,b),N=[0,0,1,0];e.transformMat4$1(N,N,w),e.normalize$2(N,N);const j=e.scale$2([],N,F+B),U=e.add([],b.center,j),$=("number"==typeof l.offset.x&&"number"==typeof l.offset.y?new e.Point(l.offset.x,l.offset.y):e.Point.convert(l.offset)).rotate(-e.degToRad(r));b.center[0]-=$.x*O,b.center[1]+=$.y*O,e.transformMat4(b.center,b.center,S),e.transformMat4(U,U,S);const V=[b.center[0],b.center[1],U[2]*a.pixelsPerMeter];e.scale$2(V,V,1/a.worldSize);const G=e.lngFromMercatorX(V[0]),W=e.latFromMercatorY(V[1]),q=Math.min(a._zoomFromMercatorZ(V[2]),l.maxZoom),X=new e.LngLat(G,W);return a.mercatorFromTransition&&q<.5*(e.GLOBE_ZOOM_THRESHOLD_MIN+e.GLOBE_ZOOM_THRESHOLD_MAX)?(a.setProjection({name:"globe"}),a.zoom=q,this._cameraForBounds(a,i,n,r,o,s)):{center:X,zoom:q,bearing:r,pitch:o}}fitBounds(e,t,i){const n=this.cameraForBounds(e,t);return this._fitInternal(n,t,i)}fitScreenCoordinates(t,i,n,r,o){const s=e.Point.convert(t),a=e.Point.convert(i),l=new e.Point(Math.min(s.x,a.x),Math.min(s.y,a.y)),c=new e.Point(Math.max(s.x,a.x),Math.max(s.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,a))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.Point(l.x,c.y)),p=this.transform.pointLocation3D(new e.Point(c.x,l.y)),f=[Math.min(u.lng,h.lng,d.lng,p.lng),Math.min(u.lat,h.lat,d.lat,p.lat)],m=[Math.max(u.lng,h.lng,d.lng,p.lng),Math.max(u.lat,h.lat,d.lat,p.lat)],g=r&&r.pitch?r.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,f,m,n,g,r);return this._fitInternal(_,r,o)}_fitInternal(t,i,n){return t?(delete(i=e.extend(t,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(t,i){this.stop();const n=t.preloadOnly?this.transform.clone():this.transform;let r=!1,o=!1,s=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=e.LngLat.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(o=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(s=!0,n.pitch=+t.pitch),null==t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),t.preloadOnly?(this._preloadTiles(n),this):(this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),r&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),o&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),s&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.warnOnce(Xr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const n=this.transform;if(!n.projection.supportsFreeCamera)return e.warnOnce(Xr),this;this.stop();const r=n.zoom,o=n.pitch,s=n.bearing;n.setFreeCameraOptions(t);const a=r!==n.zoom,l=o!==n.pitch,c=s!==n.bearing;return this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),a&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),c&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),l&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const n=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:n.padding,d=e.Point.convert(t.offset);let p,f,m;if("globe"===n.projection.name){const i=e.MercatorCoordinate.fromLngLat(n.center),r=d.rotate(-n.angle);i.x+=r.x/n.worldSize,i.y+=r.y/n.worldSize;const o=i.toLngLat(),s=e.LngLat.convert(t.center||o);this._normalizeCenter(s),p=n.centerPoint.add(r),f=new e.Point(i.x,i.y).mult(n.worldSize),m=new e.Point(e.mercatorXfromLng(s.lng),e.mercatorYfromLat(s.lat)).mult(n.worldSize).sub(f)}else{p=n.centerPoint.add(d);const i=n.pointLocation(p),r=e.LngLat.convert(t.center||i);this._normalizeCenter(r),f=n.project(i),m=n.project(r).sub(f)}const g=n.zoomScale(l-r);let _,y;t.around&&(_=e.LngLat.convert(t.around),y=n.locationPoint(_));const x=this._zooming||l!==r,v=this._rotating||o!==c,b=this._pitching||u!==s,w=!n.isPaddingEqual(h),S=n=>S=>{if(x&&(n.zoom=e.number(r,l,S)),v&&(n.bearing=e.number(o,c,S)),b&&(n.pitch=e.number(s,u,S)),w&&(n.interpolatePadding(a,h,S),p=n.centerPoint.add(d)),_)n.setLocationAtPoint(_,y);else{const e=n.zoomScale(n.zoom-r),t=l>r?Math.min(2,g):Math.max(.5,g),i=Math.pow(t,1-S),o=n.unproject(f.add(m.mult(S*i)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,p)}return t.preloadOnly||this._fireMoveEvents(i),n};if(t.preloadOnly){const e=this._emulate(S,t.duration,n);return this._preloadTiles(e),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=x,this._rotating=v,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,T),this._ease(S(n),(e=>{n.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||n.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!n.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new e.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new e.Event("zoomend",t)),r&&this.fire(new e.Event("rotateend",t)),o&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){const n=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const n=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?e.clamp(+t.zoom,n.minZoom,n.maxZoom):r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:n.padding,d=n.zoomScale(l-r),p=e.Point.convert(t.offset);let f=n.centerPoint.add(p);const m=n.pointLocation(f),g=e.LngLat.convert(t.center||m);this._normalizeCenter(g);const _=n.project(m),y=n.project(g).sub(_);let x=t.curve;const v=Math.max(n.width,n.height),b=v/d,w=y.mag();if("minZoom"in t){const i=e.clamp(Math.min(t.minZoom,r,l),n.minZoom,n.maxZoom),o=v/n.zoomScale(i-r);x=Math.sqrt(o/w*2)}const S=x*x;function T(e){const t=(b*b-v*v+(e?-1:1)*S*S*w*w)/(2*(e?b:v)*S*w);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function C(e){return(Math.exp(e)+Math.exp(-e))/2}const k=T(0);let M=function(e){return C(k)/C(k+x*e)},A=function(e){return v*((C(k)*(E(t=k+x*e)/C(t))-E(k))/S)/w;var t},P=(T(1)-k)/x;if(Math.abs(w)<1e-6||!isFinite(P)){if(Math.abs(v-b)<1e-6)return this.easeTo(t,i);const e=b<v?-1:1;P=Math.abs(Math.log(b/v))/x,A=function(){return 0},M=function(t){return Math.exp(e*x*t)}}t.duration="duration"in t?+t.duration:1e3*P/("screenSpeed"in t?+t.screenSpeed/x:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const I=o!==c,z=u!==s,D=!n.isPaddingEqual(h),L=n=>d=>{const m=d*P,x=1/M(m);n.zoom=1===d?l:r+n.scaleZoom(x),I&&(n.bearing=e.number(o,c,d)),z&&(n.pitch=e.number(s,u,d)),D&&(n.interpolatePadding(a,h,d),f=n.centerPoint.add(p));const v=1===d?g:n.unproject(_.add(y.mult(A(m))).mult(x));return n.setLocationAtPoint(n.renderWorldCopies?v.wrap():v,f),n._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),n};if(t.preloadOnly){const e=this._emulate(L,t.duration,n);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=I,this._pitching=z,this._padding=D,this._prepareEase(i,!1),this._ease(L(n),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,n){!1===n.animate||0===n.duration?(t(1),i()):(this._easeStart=e.exported.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.exported.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.wrap(t,-180,180);const n=Math.abs(t-i);return Math.abs(t-360-i)<n&&(t-=360),Math.abs(t+360-i)<n&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.maxBounds)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.exported.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,i){const n=Math.ceil(15*t/1e3),r=[],o=e(i.clone());for(let e=0;e<=n;e++){const t=o(e/n);r.push(t.clone())}return r}}class Hr{constructor(t={}){this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString(`AttributionControl.${t}`);e.setAttribute("aria-label",i),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){const n=i.reduce(((e,t,n)=>(t.value&&(e+=`${t.key}=${t.value}${n<i.length-1?"&":""}`),e)),"?");t.href=`${e.config.FEEDBACK_URL}/${n}#${Jn(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let n=i+1;n<e.length;n++)if(e[n].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Yr{constructor(){e.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=o("div","mapboxgl-ctrl");const t=o("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Kr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Jr(t,i,n){if(t=new e.LngLat(t.lng,t.lat),i){const r=new e.LngLat(t.lng-360,t.lat),o=new e.LngLat(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),a=n.locationPoint(t).distSqr(i),l=i.x<0||i.y<0||i.x>n.width||i.y>n.height;n.locationPoint(r).distSqr(i)<a&&(l||Math.abs(r.lng-n.center.lng)<s)?t=r:n.locationPoint(o).distSqr(i)<a&&(l||Math.abs(o.lng-n.center.lng)<s)&&(t=o)}for(;Math.abs(t.lng-n.center.lng)>180;){const e=n.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=n.width&&e.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}const Qr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class eo extends e.Evented{constructor(t,i){if(super(),(t instanceof e.window.HTMLElement||i)&&(t=e.extend({element:t},i)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=e.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const i=41,n=27,r=s("svg",{display:"block",height:i*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${i}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},r));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=e.Point.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const n=this._element.classList;for(const e in Qr)n.remove(`mapboxgl-marker-anchor-${e}`);n.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[n,-1*(t-i+n)],"bottom-right":[-n,-1*(t-i+n)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const i=e.unproject(t),n=e.getFreeCameraOptions();if(!n.position)return!1;const r=n.position.toLngLat();return r.distanceTo(i)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const n=t.unproject(i);let r;t._showingGlobe()&&e.isLngLatBehindGlobe(t.transform,this._lngLat)?r=0:(r=1-t._queryFogOpacity(n),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity=`${r}`,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${Qr[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const t=this._pos,i=this._map,n=this.getPitchAlignment();if(!i||!t||"map"!==n)return"";if(!i._showingGlobe()){const e=i.getPitch();return e?`rotateX(${e}deg)`:""}const r=e.radToDeg(e.globeTiltAtLngLat(i.transform,this._lngLat)),o=t.sub(e.globeCenterToScreenPoint(i.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(0===s)return"";const a=r/s;return`rotateX(${-o.y*a}deg) rotateY(${o.x*a}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let n=0;const r=this.getRotationAlignment();if("map"===r)if(i._showingGlobe()){const t=i.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),r=i.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(t);n=e.radToDeg(Math.atan2(r.y,r.x))-90}else n=-i.getBearing();else if("horizon"===r){const r=e.smoothstep(4,6,i.getZoom()),o=e.globeCenterToScreenPoint(i.transform);o.y+=r*i.transform.height;const s=t.sub(o),a=e.radToDeg(Math.atan2(s.y,s.x));n=(a>90?a-270:a+90)*(1-r)}return n+=this._rotation,n?`rotateZ(${n}deg)`:""}_update(t){e.window.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=Jr(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),!0===t?this._updateFrameId=e.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),i._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.Point.convert(t),this._update(),this}_onMove(t){const i=this._map;if(!i)return;const n=this._pointerdownPos,r=this._positionDelta;if(n&&r){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;if(t.point.dist(n)<e)return;this._isDragging=!0}this._pos=t.point.sub(r),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,i=this._pos;t&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const to={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},io=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function no(t=new e.Point(0,0),i="bottom"){if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case"top":return new e.Point(0,t);case"top-left":return new e.Point(n,n);case"top-right":return new e.Point(-n,n);case"bottom":return new e.Point(0,-t);case"bottom-left":return new e.Point(n,-n);case"bottom-right":return new e.Point(-n,-n);case"left":return new e.Point(t,0);case"right":return new e.Point(-t,0)}return new e.Point(0,0)}return t instanceof e.Point||Array.isArray(t)?e.Point.convert(t):e.Point.convert(t[i]||[0,0])}class ro{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}const oo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},so={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},ao={showCompass:!0,showZoom:!0,visualizePitch:!1};class lo{constructor(t,i,n=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new vr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,n&&(this.mousePitch=new br({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),u()}move(e,t){const i=this.map,n=this.mouseRotate.mousemoveWindow(e,t),r=n&&n.bearingDelta;if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const n=this.mousePitch.mousemoveWindow(e,t),r=n&&n.pitchDelta;r&&i.setPitch(i.getPitch()+r)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),e.window.removeEventListener("mousemove",this.mousemove),e.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),f(this.element,t)),e.window.addEventListener("mousemove",this.mousemove),e.window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=m(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const co={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},uo={maxWidth:100,unit:"metric"},ho={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},po={version:e.version,supported:i,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:class extends Zr{constructor(t){if(e.LivePerformanceUtils.mark(e.PerformanceMarkers.create),null!=(t=e.extend({},so,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.isSafariWithAntialiasingBug(e.window)&&(t.antialias=!1,e.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Hn(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._useWebGL2=t.useWebGL2,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._optimizeForTerrain=t.optimizeForTerrain,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new Kr,this._domRenderTaskQueue=new Kr,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.uniqueId(),this._locale=e.extend({},oo,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ro(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof e.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new qr(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this._hash=t.hash&&new Kn("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),t.attributionControl&&this.addControl(new Hr({customAttribution:t.customAttribution})),this._logoControl=new Yr,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.Event(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.Event(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),this.fire(new e.Event("resize",t)),i&&this.fire(new e.Event("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?e.window.navigator.language:Array.isArray(t)?0===t.length?void 0:t.map((t=>"auto"===t?e.window.navigator.language:t)):t}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style._reloadSources();for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,i=t.projection.name;let n;"globe"===i&&t.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?(t.setMercatorFromTransition(),n=!0):"mercator"===i&&t.zoom<e.GLOBE_ZOOM_THRESHOLD_MAX&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let i;if(i="globe"===t.name&&this.transform.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const e in this.style._sourceCaches)this.style._sourceCaches[e].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}unproject(t){return this.transform.pointLocation3D(e.Point.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let n=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e))),s=o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];s.length?n||(n=!0,i.call(this,new ar(e,this,r.originalEvent,{features:s}))):n=!1},o=()=>{n=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let n=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e)));(o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?n=!0:n&&(n=!1,i.call(this,new ar(e,this,r.originalEvent)))},o=t=>{n&&(n=!1,i.call(this,new ar(e,this,t.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:o}}}{const n=e=>{const n=t.filter((e=>this.getLayer(e))),r=n.length?this.queryRenderedFeatures(e.point,{layers:n}):[];r.length&&(e.features=r,i.call(this,e),delete e.features)};return{layers:new Set(t),listener:i,delegates:{[e]:n}}}}on(e,t,i){if(void 0===i)return super.on(e,t);Array.isArray(t)||(t=[t]);const n=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(const e in n.delegates)this.on(e,n.delegates[e]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);Array.isArray(t)||(t=[t]);const n=this._createDelegatedListener(e,t,i);for(const e in n.delegates)this.once(e,n.delegates[e]);return this}off(e,t,i){if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);const n=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const o=e[r];if(o.listener===i&&n(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(t,i){return this.style?(void 0!==i||void 0===t||t instanceof e.Point||Array.isArray(t)||(i=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}isPointOnSurface(t){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&e.warnOnce(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(e.Point.convert(t))}setStyle(t,i){return!1!==(i=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new Kt(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Kt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const n=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(n,e.ResourceType.Style);e.getJSON(r,((t,n)=>{t?this.fire(new e.ErrorEvent(t)):n&&this._updateDiff(n,i)}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t)&&this._update(!0)}catch(n){e.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.warnOnce("There is no style added to the map."),!1)}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){return!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,i,{pixelRatio:n=1,sdf:r=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap){const{width:l,height:c,data:u}=e.exported.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},u),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:r,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,u=i;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},new Uint8Array(u.data)),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:r,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}updateImage(t,i){const n=this.style.getImage(t);if(!n)return void this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap?e.exported.getImageData(i):i,{width:o,height:s}=r;void 0!==o&&void 0!==s?o===n.data.width&&s===n.data.height?(n.data.replace(r.data,!(i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap)),this.style.updateImage(t,n)):this.fire(new e.ErrorEvent(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,i){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),((t,n)=>{i(t,n instanceof e.window.HTMLImageElement?e.exported.getImageData(n):n)}))}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0)}setFilter(e,t,i={}){return this.style.setFilter(e,t,i),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i,n={}){return this.style.setPaintProperty(e,t,i,n),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i,n={}){return this.style.setLayoutProperty(e,t,i,n),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.LngLat.convert(t),this.transform):0}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let n,r,o,s=this._container;for(;s&&(!r||!o);){const t=e.window.getComputedStyle(s).transform;t&&"none"!==t&&(n=t.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(r=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(o=n[3])),s=s.parentElement}this._containerWidth=r?Math.abs(t/r):t,this._containerHeight=o?Math.abs(i/o):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=o("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=o("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=o("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{n[e]=o("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const n=e.exported.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.extend({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",t),r=n||this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);r?(this._useWebGL2&&!n&&e.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),e.storeAuthState(r,!0),this.painter=new On(r,this.transform,!!n),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.exported$1.testSupport(r)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;const n=this.painter.context.extTimerQuery,r=e.exported.now();if(this.listens("gpu-timing-frame")&&(i=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],e.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],e.window.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,n=e.exported.now(),r=new e.EvaluationParameters(t,{now:n,fadeDuration:o,pitch:i,transition:this.style.getTransition()});this.style.update(r)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(r),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.exported.now()-r;n.endQueryEXT(n.TIME_ELAPSED_EXT,i),setTimeout((()=>{const o=n.getQueryObjectEXT(i,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(i),this.fire(new e.Event("gpu-timing-frame",{cpuTime:t,gpuTime:o})),e.window.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:o}})}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.Event("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.Event("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const a=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(a||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(s=this._updateAverageElevation(r,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,e.LivePerformanceUtils.mark(e.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&e.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let n=this.transform.sampleAverageElevation(),r=!1;this.transform.elevation&&(r=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-n);if(o>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.AUTH_ERR_MSG||401===t.status)){const t=this.painter.context.gl;e.storeAuthState(t,!1),this._logoControl instanceof Yr&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,n=i.createFramebuffer();function r(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,i){let n=i[1]-i[0];const r=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);n+=(i[o+2]-i[o+1])*(1-a/r)}return n}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1),e.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),e.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new e.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.exported.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const i=this.style?Object.values(this.style._sourceCaches):[];return e.asyncAll(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===e.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(t,i){e.setCacheLimits(t,i)}get version(){return e.version}},NavigationControl:class{constructor(t){this.options=e.extend({},ao,t),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),n=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lo(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=o("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends e.Evented{constructor(t){super(),this.options=e.extend({geolocation:e.window.navigator.geolocation},co,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yn(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const i=(e=!!this.options.geolocation)=>{this._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>i("denied"!==e.state))).catch((()=>i())):i()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,r=this._map.getBearing(),o=e.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),o,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,i=e.mercatorZfromAltitude(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new eo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new eo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{e.window.addEventListener("ondeviceorientationabsolute"in e.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==e.window.DeviceMotionEvent&&"function"==typeof e.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),e.window.removeEventListener("deviceorientation",this._onDeviceOrientation),e.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hr,ScaleControl:class{constructor(t){this.options=e.extend({},uo,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,n=t._containerWidth/2-e/2,r=t.unproject([n,i]),o=t.unproject([n+e,i]),s=r.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*s;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,i){this._map._requestDomTask((()=>{const n=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(t),r=n/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(n):`${n}&nbsp;${ho[i]}`,this._container.style.width=e*r+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(to),t),e.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const i=e.window.document.createDocumentFragment(),n=e.window.document.createElement("body");let r;for(n.innerHTML=t;r=n.firstChild,r;)i.appendChild(r);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=o("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,n=this._pos;if(!t||!i||!n)return"bottom";const r=i.offsetWidth,o=i.offsetHeight,s=n.x<r/2,a=n.x>t.transform.width-r/2;if(n.y+e<o)return s?"top-left":a?"top-right":"top";if(n.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const i=this._map,n=this._content;if(!i||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=o("div","mapboxgl-popup",i.getContainer()),this._tip=o("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Jr(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:i.project(this._lngLat),n=no(this.options.offset),r=this._anchor=this._getAnchor(n.y),o=no(this.options.offset,r),s=e.add(o).round();i._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${Qr[r]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const t=e.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(io);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:eo,Style:Kt,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.Point,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:Un,Evented:e.Evented,config:e.config,prewarm:function(){Ne().acquire(Oe)},clearPrewarmedResources:function(){const e=Fe;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Oe),Fe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return Be.workerCount},set workerCount(e){Be.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.exported.setNow,restoreNow:e.exported.restoreNow};return po})),i}()},703:(e,t,i)=>{"use strict";var n=i(414);function r(){}function o(){}o.resetWarningCache=r,e.exports=function(){function e(e,t,i,r,o,s){if(s!==n){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:r};return i.PropTypes=i,i}},697:(e,t,i)=>{e.exports=i(703)()},414:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},448:(e,t,i)=>{"use strict";var n=i(294),r=i(840);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,i,n,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function x(e,t,i,n){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,n){if(null==t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,r,n)&&(i=null),n||null===r?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):r.mustUseProperty?e[r.propertyName]=null===i?3!==r.type&&"":i:(t=r.attributeName,n=r.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(r=r.type)||4===r&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var v=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),k=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),z=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function R(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=L&&e[L]||e["@@iterator"])?e:null}var O,B=Object.assign;function F(e){if(void 0===O)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var N=!1;function j(e,t){if(!e||N)return"";N=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var n=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){n=e}e.call(t.prototype)}else{try{throw Error()}catch(e){n=e}e()}}catch(t){if(t&&n&&"string"==typeof t.stack){for(var r=t.stack.split("\n"),o=n.stack.split("\n"),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||r[s]!==o[a]){var l="\n"+r[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{N=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?F(e):""}function U(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function $(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case E:return"Profiler";case T:return"StrictMode";case A:return"Suspense";case P:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case k:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case M:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case I:return null!==(t=e.displayName||null)?t:$(e.type)||"Memo";case z:t=e._payload,e=e._init;try{return $(e(t))}catch(e){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==i&&"function"==typeof i.get&&"function"==typeof i.set){var r=i.get,o=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=W(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function Z(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function H(e,t){var i=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function Y(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=G(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function K(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function J(e,t){K(e,t);var i=G(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,i):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Q(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ee(e,t,i){"number"===t&&Z(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var te=Array.isArray;function ie(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+G(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(o(92));if(te(i)){if(1<i.length)throw Error(o(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:G(i)}}function oe(e,t){var i=G(t.value),n=G(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function de(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,i){return null==t||"boolean"==typeof t||""===t?"":i||"number"!=typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),r=me(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var _e=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(o(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Te=null;function Ee(e){if(e=xr(e)){if("function"!=typeof we)throw Error(o(280));var t=e.stateNode;t&&(t=br(t),we(e.stateNode,e.type,t))}}function Ce(e){Se?Te?Te.push(e):Te=[e]:Se=e}function ke(){if(Se){var e=Se,t=Te;if(Te=Se=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Me(e,t){return e(t)}function Ae(){}var Pe=!1;function Ie(e,t,i){if(Pe)return e(t,i);Pe=!0;try{return Me(e,t,i)}finally{Pe=!1,(null!==Se||null!==Te)&&(Ae(),ke())}}function ze(e,t){var i=e.stateNode;if(null===i)return null;var n=br(i);if(null===n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!=typeof i)throw Error(o(231,t,typeof i));return i}var De=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){De=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){De=!1}function Re(e,t,i,n,r,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(e){this.onError(e)}}var Oe=!1,Be=null,Fe=!1,Ne=null,je={onError:function(e){Oe=!0,Be=e}};function Ue(e,t,i,n,r,o,s,a,l){Oe=!1,Be=null,Re.apply(je,arguments)}function $e(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ge(e){if($e(e)!==e)throw Error(o(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=$e(e)))throw Error(o(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(n=r.return)){i=n;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===i)return Ge(r),e;if(s===n)return Ge(r),t;s=s.sibling}throw Error(o(188))}if(i.return!==n.return)i=r,n=s;else{for(var a=!1,l=r.child;l;){if(l===i){a=!0,i=r,n=s;break}if(l===n){a=!0,n=r,i=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===i){a=!0,i=s,n=r;break}if(l===n){a=!0,n=s,i=r;break}l=l.sibling}if(!a)throw Error(o(189))}}if(i.alternate!==n)throw Error(o(190))}if(3!==i.tag)throw Error(o(188));return i.stateNode.current===i?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Xe=r.unstable_scheduleCallback,Ze=r.unstable_cancelCallback,He=r.unstable_shouldYield,Ye=r.unstable_requestPaint,Ke=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,Qe=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,it=r.unstable_LowPriority,nt=r.unstable_IdlePriority,rt=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var i=e.pendingLanes;if(0===i)return 0;var n=0,r=e.suspendedLanes,o=e.pingedLanes,s=268435455&i;if(0!==s){var a=s&~r;0!==a?n=ht(a):0!==(o&=s)&&(n=ht(o))}else 0!==(s=i&~r)?n=ht(s):0!==o&&(n=ht(o));if(0===n)return 0;if(0!==t&&t!==n&&0==(t&r)&&((r=n&-n)>=(o=t&-t)||16===r&&0!=(4194240&o)))return t;if(0!=(4&n)&&(n|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(i=31-st(t)),n|=e[i],t&=~r;return n}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0==(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function _t(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=i}function yt(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-st(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}var xt=0;function vt(e){return 1<(e&=-e)?4<e?0!=(268435455&e)?16:536870912:4:1}var bt,wt,St,Tt,Et,Ct=!1,kt=[],Mt=null,At=null,Pt=null,It=new Map,zt=new Map,Dt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rt(e,t){switch(e){case"focusin":case"focusout":Mt=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":It.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":zt.delete(t.pointerId)}}function Ot(e,t,i,n,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=xr(t))&&wt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Bt(e){var t=yr(e.target);if(null!==t){var i=$e(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Ve(i)))return e.blockedOn=t,void Et(e.priority,(function(){St(i)}))}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Ht(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=xr(i))&&wt(t),e.blockedOn=i,!1;var n=new(i=e.nativeEvent).constructor(i.type,i);ve=n,i.target.dispatchEvent(n),ve=null,t.shift()}return!0}function Nt(e,t,i){Ft(e)&&i.delete(t)}function jt(){Ct=!1,null!==Mt&&Ft(Mt)&&(Mt=null),null!==At&&Ft(At)&&(At=null),null!==Pt&&Ft(Pt)&&(Pt=null),It.forEach(Nt),zt.forEach(Nt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,jt)))}function $t(e){function t(t){return Ut(t,e)}if(0<kt.length){Ut(kt[0],e);for(var i=1;i<kt.length;i++){var n=kt[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Mt&&Ut(Mt,e),null!==At&&Ut(At,e),null!==Pt&&Ut(Pt,e),It.forEach(t),zt.forEach(t),i=0;i<Dt.length;i++)(n=Dt[i]).blockedOn===e&&(n.blockedOn=null);for(;0<Dt.length&&null===(i=Dt[0]).blockedOn;)Bt(i),null===i.blockedOn&&Dt.shift()}var Vt=v.ReactCurrentBatchConfig,Gt=!0;function Wt(e,t,i,n){var r=xt,o=Vt.transition;Vt.transition=null;try{xt=1,Xt(e,t,i,n)}finally{xt=r,Vt.transition=o}}function qt(e,t,i,n){var r=xt,o=Vt.transition;Vt.transition=null;try{xt=4,Xt(e,t,i,n)}finally{xt=r,Vt.transition=o}}function Xt(e,t,i,n){if(Gt){var r=Ht(e,t,i,n);if(null===r)Gn(e,t,n,Zt,i),Rt(e,n);else if(function(e,t,i,n,r){switch(t){case"focusin":return Mt=Ot(Mt,e,t,i,n,r),!0;case"dragenter":return At=Ot(At,e,t,i,n,r),!0;case"mouseover":return Pt=Ot(Pt,e,t,i,n,r),!0;case"pointerover":var o=r.pointerId;return It.set(o,Ot(It.get(o)||null,e,t,i,n,r)),!0;case"gotpointercapture":return o=r.pointerId,zt.set(o,Ot(zt.get(o)||null,e,t,i,n,r)),!0}return!1}(r,e,t,i,n))n.stopPropagation();else if(Rt(e,n),4&t&&-1<Lt.indexOf(e)){for(;null!==r;){var o=xr(r);if(null!==o&&bt(o),null===(o=Ht(e,t,i,n))&&Gn(e,t,n,Zt,i),o===r)break;r=o}null!==r&&n.stopPropagation()}else Gn(e,t,n,null,i)}}var Zt=null;function Ht(e,t,i,n){if(Zt=null,null!==(e=yr(e=be(n))))if(null===(t=$e(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Zt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Qe:return 1;case et:return 4;case tt:case it:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Kt=null,Jt=null,Qt=null;function ei(){if(Qt)return Qt;var e,t,i=Jt,n=i.length,r="value"in Kt?Kt.value:Kt.textContent,o=r.length;for(e=0;e<n&&i[e]===r[e];e++);var s=n-e;for(t=1;t<=s&&i[n-t]===r[o-t];t++);return Qt=r.slice(e,1<t?1-t:void 0)}function ti(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ii(){return!0}function ni(){return!1}function ri(e){function t(t,i,n,r,o){for(var s in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ii:ni,this.isPropagationStopped=ni,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ii)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ii)},persist:function(){},isPersistent:ii}),t}var oi,si,ai,li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ci=ri(li),ui=B({},li,{view:0,detail:0}),hi=ri(ui),di=B({},ui,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ti,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ai&&(ai&&"mousemove"===e.type?(oi=e.screenX-ai.screenX,si=e.screenY-ai.screenY):si=oi=0,ai=e),oi)},movementY:function(e){return"movementY"in e?e.movementY:si}}),pi=ri(di),fi=ri(B({},di,{dataTransfer:0})),mi=ri(B({},ui,{relatedTarget:0})),gi=ri(B({},li,{animationName:0,elapsedTime:0,pseudoElement:0})),_i=B({},li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yi=ri(_i),xi=ri(B({},li,{data:0})),vi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Si(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wi[e])&&!!t[e]}function Ti(){return Si}var Ei=B({},ui,{key:function(e){if(e.key){var t=vi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ti(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?bi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ti,charCode:function(e){return"keypress"===e.type?ti(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ti(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ci=ri(Ei),ki=ri(B({},di,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mi=ri(B({},ui,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ti})),Ai=ri(B({},li,{propertyName:0,elapsedTime:0,pseudoElement:0})),Pi=B({},di,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ii=ri(Pi),zi=[9,13,27,32],Di=u&&"CompositionEvent"in window,Li=null;u&&"documentMode"in document&&(Li=document.documentMode);var Ri=u&&"TextEvent"in window&&!Li,Oi=u&&(!Di||Li&&8<Li&&11>=Li),Bi=String.fromCharCode(32),Fi=!1;function Ni(e,t){switch(e){case"keyup":return-1!==zi.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ji(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Ui=!1;var $i={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!$i[e.type]:"textarea"===t}function Gi(e,t,i,n){Ce(n),0<(t=qn(t,"onChange")).length&&(i=new ci("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Wi=null,qi=null;function Xi(e){Fn(e,0)}function Zi(e){if(X(vr(e)))return e}function Hi(e,t){if("change"===e)return t}var Yi=!1;if(u){var Ki;if(u){var Ji="oninput"in document;if(!Ji){var Qi=document.createElement("div");Qi.setAttribute("oninput","return;"),Ji="function"==typeof Qi.oninput}Ki=Ji}else Ki=!1;Yi=Ki&&(!document.documentMode||9<document.documentMode)}function en(){Wi&&(Wi.detachEvent("onpropertychange",tn),qi=Wi=null)}function tn(e){if("value"===e.propertyName&&Zi(qi)){var t=[];Gi(t,qi,e,be(e)),Ie(Xi,t)}}function nn(e,t,i){"focusin"===e?(en(),qi=i,(Wi=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function rn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Zi(qi)}function on(e,t){if("click"===e)return Zi(t)}function sn(e,t){if("input"===e||"change"===e)return Zi(t)}var an="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function ln(e,t){if(an(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!h.call(t,r)||!an(e[r],t[r]))return!1}return!0}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function un(e,t){var i,n=cn(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cn(n)}}function hn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dn(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var i="string"==typeof t.contentWindow.location.href}catch(e){i=!1}if(!i)break;t=Z((e=t.contentWindow).document)}return t}function pn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fn(e){var t=dn(),i=e.focusedElem,n=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&hn(i.ownerDocument.documentElement,i)){if(null!==n&&pn(i))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=i.textContent.length,o=Math.min(n.start,r);n=void 0===n.end?o:Math.min(n.end,r),!e.extend&&o>n&&(r=n,n=o,o=r),r=un(i,o);var s=un(i,n);r&&s&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mn=u&&"documentMode"in document&&11>=document.documentMode,gn=null,_n=null,yn=null,xn=!1;function vn(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;xn||null==gn||gn!==Z(n)||("selectionStart"in(n=gn)&&pn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},yn&&ln(yn,n)||(yn=n,0<(n=qn(_n,"onSelect")).length&&(t=new ci("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=gn)))}function bn(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var wn={animationend:bn("Animation","AnimationEnd"),animationiteration:bn("Animation","AnimationIteration"),animationstart:bn("Animation","AnimationStart"),transitionend:bn("Transition","TransitionEnd")},Sn={},Tn={};function En(e){if(Sn[e])return Sn[e];if(!wn[e])return e;var t,i=wn[e];for(t in i)if(i.hasOwnProperty(t)&&t in Tn)return Sn[e]=i[t];return e}u&&(Tn=document.createElement("div").style,"AnimationEvent"in window||(delete wn.animationend.animation,delete wn.animationiteration.animation,delete wn.animationstart.animation),"TransitionEvent"in window||delete wn.transitionend.transition);var Cn=En("animationend"),kn=En("animationiteration"),Mn=En("animationstart"),An=En("transitionend"),Pn=new Map,In="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zn(e,t){Pn.set(e,t),l(t,[e])}for(var Dn=0;Dn<In.length;Dn++){var Ln=In[Dn];zn(Ln.toLowerCase(),"on"+(Ln[0].toUpperCase()+Ln.slice(1)))}zn(Cn,"onAnimationEnd"),zn(kn,"onAnimationIteration"),zn(Mn,"onAnimationStart"),zn("dblclick","onDoubleClick"),zn("focusin","onFocus"),zn("focusout","onBlur"),zn(An,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),On=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rn));function Bn(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,n,r,s,a,l,c){if(Ue.apply(this,arguments),Oe){if(!Oe)throw Error(o(198));var u=Be;Oe=!1,Be=null,Fe||(Fe=!0,Ne=u)}}(n,t,void 0,e),e.currentTarget=null}function Fn(e,t){t=0!=(4&t);for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var s=n.length-1;0<=s;s--){var a=n[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;Bn(r,a,c),o=l}else for(s=0;s<n.length;s++){if(l=(a=n[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;Bn(r,a,c),o=l}}}if(Fe)throw e=Ne,Fe=!1,Ne=null,e}function Nn(e,t){var i=t[mr];void 0===i&&(i=t[mr]=new Set);var n=e+"__bubble";i.has(n)||(Vn(t,e,2,!1),i.add(n))}function jn(e,t,i){var n=0;t&&(n|=4),Vn(i,e,n,t)}var Un="_reactListening"+Math.random().toString(36).slice(2);function $n(e){if(!e[Un]){e[Un]=!0,s.forEach((function(t){"selectionchange"!==t&&(On.has(t)||jn(t,!1,e),jn(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Un]||(t[Un]=!0,jn("selectionchange",!1,t))}}function Vn(e,t,i,n){switch(Yt(t)){case 1:var r=Wt;break;case 4:r=qt;break;default:r=Xt}i=r.bind(null,t,i,e),r=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):void 0!==r?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function Gn(e,t,i,n,r){var o=n;if(0==(1&t)&&0==(2&t)&&null!==n)e:for(;;){if(null===n)return;var s=n.tag;if(3===s||4===s){var a=n.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===s)for(s=n.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==a;){if(null===(s=yr(a)))return;if(5===(l=s.tag)||6===l){n=o=s;continue e}a=a.parentNode}}n=n.return}Ie((function(){var n=o,r=be(i),s=[];e:{var a=Pn.get(e);if(void 0!==a){var l=ci,c=e;switch(e){case"keypress":if(0===ti(i))break e;case"keydown":case"keyup":l=Ci;break;case"focusin":c="focus",l=mi;break;case"focusout":c="blur",l=mi;break;case"beforeblur":case"afterblur":l=mi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mi;break;case Cn:case kn:case Mn:l=gi;break;case An:l=Ai;break;case"scroll":l=hi;break;case"wheel":l=Ii;break;case"copy":case"cut":case"paste":l=yi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=ki}var u=0!=(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=n;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=ze(f,d))&&u.push(Wn(f,m,p)))),h)break;f=f.return}0<u.length&&(a=new l(a,c,null,i,r),s.push({event:a,listeners:u}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||i===ve||!(c=i.relatedTarget||i.fromElement)||!yr(c)&&!c[fr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=n,null!==(c=(c=i.relatedTarget||i.toElement)?yr(c):null)&&(c!==(h=$e(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(u=pi,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=ki,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?a:vr(l),p=null==c?a:vr(c),(a=new u(m,f+"leave",l,i,r)).target=h,a.relatedTarget=p,m=null,yr(r)===n&&((u=new u(d,f+"enter",c,i,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=Xn(p))f++;for(p=0,m=d;m;m=Xn(m))p++;for(;0<f-p;)u=Xn(u),f--;for(;0<p-f;)d=Xn(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Xn(u),d=Xn(d)}u=null}else u=null;null!==l&&Zn(s,a,l,u,!1),null!==c&&null!==h&&Zn(s,h,c,u,!0)}if("select"===(l=(a=n?vr(n):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Hi;else if(Vi(a))if(Yi)g=sn;else{g=rn;var _=nn}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=on);switch(g&&(g=g(e,n))?Gi(s,g,i,r):(_&&_(e,a,n),"focusout"===e&&(_=a._wrapperState)&&_.controlled&&"number"===a.type&&ee(a,"number",a.value)),_=n?vr(n):window,e){case"focusin":(Vi(_)||"true"===_.contentEditable)&&(gn=_,_n=n,yn=null);break;case"focusout":yn=_n=gn=null;break;case"mousedown":xn=!0;break;case"contextmenu":case"mouseup":case"dragend":xn=!1,vn(s,i,r);break;case"selectionchange":if(mn)break;case"keydown":case"keyup":vn(s,i,r)}var y;if(Di)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Ui?Ni(e,i)&&(x="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(x="onCompositionStart");x&&(Oi&&"ko"!==i.locale&&(Ui||"onCompositionStart"!==x?"onCompositionEnd"===x&&Ui&&(y=ei()):(Jt="value"in(Kt=r)?Kt.value:Kt.textContent,Ui=!0)),0<(_=qn(n,x)).length&&(x=new xi(x,e,null,i,r),s.push({event:x,listeners:_}),y?x.data=y:null!==(y=ji(i))&&(x.data=y))),(y=Ri?function(e,t){switch(e){case"compositionend":return ji(t);case"keypress":return 32!==t.which?null:(Fi=!0,Bi);case"textInput":return(e=t.data)===Bi&&Fi?null:e;default:return null}}(e,i):function(e,t){if(Ui)return"compositionend"===e||!Di&&Ni(e,t)?(e=ei(),Qt=Jt=Kt=null,Ui=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Oi&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(n=qn(n,"onBeforeInput")).length&&(r=new xi("onBeforeInput","beforeinput",null,i,r),s.push({event:r,listeners:n}),r.data=y))}Fn(s,t)}))}function Wn(e,t,i){return{instance:e,listener:t,currentTarget:i}}function qn(e,t){for(var i=t+"Capture",n=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=ze(e,i))&&n.unshift(Wn(e,o,r)),null!=(o=ze(e,t))&&n.push(Wn(e,o,r))),e=e.return}return n}function Xn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Zn(e,t,i,n,r){for(var o=t._reactName,s=[];null!==i&&i!==n;){var a=i,l=a.alternate,c=a.stateNode;if(null!==l&&l===n)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=ze(i,o))&&s.unshift(Wn(i,l,a)):r||null!=(l=ze(i,o))&&s.push(Wn(i,l,a))),i=i.return}0!==s.length&&e.push({event:t,listeners:s})}var Hn=/\r\n?/g,Yn=/\u0000|\uFFFD/g;function Kn(e){return("string"==typeof e?e:""+e).replace(Hn,"\n").replace(Yn,"")}function Jn(e,t,i){if(t=Kn(t),Kn(e)!==t&&i)throw Error(o(425))}function Qn(){}var er=null,tr=null;function ir(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var nr="function"==typeof setTimeout?setTimeout:void 0,rr="function"==typeof clearTimeout?clearTimeout:void 0,or="function"==typeof Promise?Promise:void 0,sr="function"==typeof queueMicrotask?queueMicrotask:void 0!==or?function(e){return or.resolve(null).then(e).catch(ar)}:nr;function ar(e){setTimeout((function(){throw e}))}function lr(e,t){var i=t,n=0;do{var r=i.nextSibling;if(e.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0===n)return e.removeChild(r),void $t(t);n--}else"$"!==i&&"$?"!==i&&"$!"!==i||n++;i=r}while(i);$t(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,pr="__reactProps$"+hr,fr="__reactContainer$"+hr,mr="__reactEvents$"+hr,gr="__reactListeners$"+hr,_r="__reactHandles$"+hr;function yr(e){var t=e[dr];if(t)return t;for(var i=e.parentNode;i;){if(t=i[fr]||i[dr]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=ur(e);null!==e;){if(i=e[dr])return i;e=ur(e)}return t}i=(e=i).parentNode}return null}function xr(e){return!(e=e[dr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function vr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function br(e){return e[pr]||null}var wr=[],Sr=-1;function Tr(e){return{current:e}}function Er(e){0>Sr||(e.current=wr[Sr],wr[Sr]=null,Sr--)}function Cr(e,t){Sr++,wr[Sr]=e.current,e.current=t}var kr={},Mr=Tr(kr),Ar=Tr(!1),Pr=kr;function Ir(e,t){var i=e.type.contextTypes;if(!i)return kr;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in i)o[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function zr(e){return null!=(e=e.childContextTypes)}function Dr(){Er(Ar),Er(Mr)}function Lr(e,t,i){if(Mr.current!==kr)throw Error(o(168));Cr(Mr,t),Cr(Ar,i)}function Rr(e,t,i){var n=e.stateNode;if(t=t.childContextTypes,"function"!=typeof n.getChildContext)return i;for(var r in n=n.getChildContext())if(!(r in t))throw Error(o(108,V(e)||"Unknown",r));return B({},i,n)}function Or(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||kr,Pr=Mr.current,Cr(Mr,e),Cr(Ar,Ar.current),!0}function Br(e,t,i){var n=e.stateNode;if(!n)throw Error(o(169));i?(e=Rr(e,t,Pr),n.__reactInternalMemoizedMergedChildContext=e,Er(Ar),Er(Mr),Cr(Mr,e)):Er(Ar),Cr(Ar,i)}var Fr=null,Nr=!1,jr=!1;function Ur(e){null===Fr?Fr=[e]:Fr.push(e)}function $r(){if(!jr&&null!==Fr){jr=!0;var e=0,t=xt;try{var i=Fr;for(xt=1;e<i.length;e++){var n=i[e];do{n=n(!0)}while(null!==n)}Fr=null,Nr=!1}catch(t){throw null!==Fr&&(Fr=Fr.slice(e+1)),Xe(Qe,$r),t}finally{xt=t,jr=!1}}return null}var Vr=[],Gr=0,Wr=null,qr=0,Xr=[],Zr=0,Hr=null,Yr=1,Kr="";function Jr(e,t){Vr[Gr++]=qr,Vr[Gr++]=Wr,Wr=e,qr=t}function Qr(e,t,i){Xr[Zr++]=Yr,Xr[Zr++]=Kr,Xr[Zr++]=Hr,Hr=e;var n=Yr;e=Kr;var r=32-st(n)-1;n&=~(1<<r),i+=1;var o=32-st(t)+r;if(30<o){var s=r-r%5;o=(n&(1<<s)-1).toString(32),n>>=s,r-=s,Yr=1<<32-st(t)+r|i<<r|n,Kr=o+e}else Yr=1<<o|i<<r|n,Kr=e}function eo(e){null!==e.return&&(Jr(e,1),Qr(e,1,0))}function to(e){for(;e===Wr;)Wr=Vr[--Gr],Vr[Gr]=null,qr=Vr[--Gr],Vr[Gr]=null;for(;e===Hr;)Hr=Xr[--Zr],Xr[Zr]=null,Kr=Xr[--Zr],Xr[Zr]=null,Yr=Xr[--Zr],Xr[Zr]=null}var io=null,no=null,ro=!1,oo=null;function so(e,t){var i=zc(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function ao(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,io=e,no=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,io=e,no=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==Hr?{id:Yr,overflow:Kr}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=zc(18,null,null,0)).stateNode=t,i.return=e,e.child=i,io=e,no=null,!0);default:return!1}}function lo(e){return 0!=(1&e.mode)&&0==(128&e.flags)}function co(e){if(ro){var t=no;if(t){var i=t;if(!ao(e,t)){if(lo(e))throw Error(o(418));t=cr(i.nextSibling);var n=io;t&&ao(e,t)?so(n,i):(e.flags=-4097&e.flags|2,ro=!1,io=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,ro=!1,io=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;io=e}function ho(e){if(e!==io)return!1;if(!ro)return uo(e),ro=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ir(e.type,e.memoizedProps)),t&&(t=no)){if(lo(e))throw po(),Error(o(418));for(;t;)so(e,t),t=cr(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){no=cr(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}no=null}}else no=io?cr(e.stateNode.nextSibling):null;return!0}function po(){for(var e=no;e;)e=cr(e.nextSibling)}function fo(){no=io=null,ro=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var go=v.ReactCurrentBatchConfig;function _o(e,t){if(e&&e.defaultProps){for(var i in t=B({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}var yo=Tr(null),xo=null,vo=null,bo=null;function wo(){bo=vo=xo=null}function So(e){var t=yo.current;Er(yo),e._currentValue=t}function To(e,t,i){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function Eo(e,t){xo=e,bo=vo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(va=!0),e.firstContext=null)}function Co(e){var t=e._currentValue;if(bo!==e)if(e={context:e,memoizedValue:t,next:null},null===vo){if(null===xo)throw Error(o(308));vo=e,xo.dependencies={lanes:0,firstContext:e}}else vo=vo.next=e;return t}var ko=null;function Mo(e){null===ko?ko=[e]:ko.push(e)}function Ao(e,t,i,n){var r=t.interleaved;return null===r?(i.next=i,Mo(t)):(i.next=r.next,r.next=i),t.interleaved=i,Po(e,n)}function Po(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var Io=!1;function zo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Do(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Lo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ro(e,t,i){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!=(2&Al)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,Po(e,i)}return null===(r=n.interleaved)?(t.next=t,Mo(n)):(t.next=r.next,r.next=t),n.interleaved=t,Po(e,i)}function Oo(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194240&i))){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,yt(e,i)}}function Bo(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,o=null;if(null!==(i=i.firstBaseUpdate)){do{var s={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===o?r=o=s:o=o.next=s,i=i.next}while(null!==i);null===o?r=o=t:o=o.next=t}else r=o=t;return i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:n.shared,effects:n.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Fo(e,t,i,n){var r=e.updateQueue;Io=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=r.baseState;for(s=0,u=c=l=null,a=o;;){var d=a.lane,p=a.eventTime;if((n&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(d=t,p=i,m.tag){case 1:if("function"==typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=m.payload)?f.call(p,h,d):f))break e;h=B({},h,d);break e;case 2:Io=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=d;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(d=a).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Bl|=s,e.lanes=s,e.memoizedState=h}}function No(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],r=n.callback;if(null!==r){if(n.callback=null,n=i,"function"!=typeof r)throw Error(o(191,r));r.call(n)}}}var jo=(new n.Component).refs;function Uo(e,t,i,n){i=null==(i=i(n,t=e.memoizedState))?t:B({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var $o={isMounted:function(e){return!!(e=e._reactInternals)&&$e(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=tc(),r=ic(e),o=Lo(n,r);o.payload=t,null!=i&&(o.callback=i),null!==(t=Ro(e,o,r))&&(nc(t,e,r,n),Oo(t,e,r))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=tc(),r=ic(e),o=Lo(n,r);o.tag=1,o.payload=t,null!=i&&(o.callback=i),null!==(t=Ro(e,o,r))&&(nc(t,e,r,n),Oo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=tc(),n=ic(e),r=Lo(i,n);r.tag=2,null!=t&&(r.callback=t),null!==(t=Ro(e,r,n))&&(nc(t,e,n,i),Oo(t,e,n))}};function Vo(e,t,i,n,r,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!ln(i,n)||!ln(r,o))}function Go(e,t,i){var n=!1,r=kr,o=t.contextType;return"object"==typeof o&&null!==o?o=Co(o):(r=zr(t)?Pr:Mr.current,o=(n=null!=(n=t.contextTypes))?Ir(e,r):kr),t=new t(i,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=$o,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function Wo(e,t,i,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&$o.enqueueReplaceState(t,t.state,null)}function qo(e,t,i,n){var r=e.stateNode;r.props=i,r.state=e.memoizedState,r.refs=jo,zo(e);var o=t.contextType;"object"==typeof o&&null!==o?r.context=Co(o):(o=zr(t)?Pr:Mr.current,r.context=Ir(e,o)),r.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(Uo(e,t,o,i),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&$o.enqueueReplaceState(r,r.state,null),Fo(e,i,r,n),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function Xo(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(o(309));var n=i.stateNode}if(!n)throw Error(o(147,e));var r=n,s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=r.refs;t===jo&&(t=r.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!=typeof e)throw Error(o(284));if(!i._owner)throw Error(o(290,e))}return e}function Zo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ho(e){return(0,e._init)(e._payload)}function Yo(e){function t(t,i){if(e){var n=t.deletions;null===n?(t.deletions=[i],t.flags|=16):n.push(i)}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Lc(e,t)).index=0,e.sibling=null,e}function s(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags|=2,i):n:(t.flags|=2,i):(t.flags|=1048576,i)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=Fc(i,e.mode,n)).return=e,t):((t=r(t,i)).return=e,t)}function c(e,t,i,n){var o=i.type;return o===S?h(e,t,i.props.children,n,i.key):null!==t&&(t.elementType===o||"object"==typeof o&&null!==o&&o.$$typeof===z&&Ho(o)===t.type)?((n=r(t,i.props)).ref=Xo(e,t,i),n.return=e,n):((n=Rc(i.type,i.key,i.props,null,e.mode,n)).ref=Xo(e,t,i),n.return=e,n)}function u(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=Nc(i,e.mode,n)).return=e,t):((t=r(t,i.children||[])).return=e,t)}function h(e,t,i,n,o){return null===t||7!==t.tag?((t=Oc(i,e.mode,n,o)).return=e,t):((t=r(t,i)).return=e,t)}function d(e,t,i){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Fc(""+t,e.mode,i)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case b:return(i=Rc(t.type,t.key,t.props,null,e.mode,i)).ref=Xo(e,null,t),i.return=e,i;case w:return(t=Nc(t,e.mode,i)).return=e,t;case z:return d(e,(0,t._init)(t._payload),i)}if(te(t)||R(t))return(t=Oc(t,e.mode,i,null)).return=e,t;Zo(e,t)}return null}function p(e,t,i,n){var r=null!==t?t.key:null;if("string"==typeof i&&""!==i||"number"==typeof i)return null!==r?null:l(e,t,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case b:return i.key===r?c(e,t,i,n):null;case w:return i.key===r?u(e,t,i,n):null;case z:return p(e,t,(r=i._init)(i._payload),n)}if(te(i)||R(i))return null!==r?null:h(e,t,i,n,null);Zo(e,i)}return null}function f(e,t,i,n,r){if("string"==typeof n&&""!==n||"number"==typeof n)return l(t,e=e.get(i)||null,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case b:return c(t,e=e.get(null===n.key?i:n.key)||null,n,r);case w:return u(t,e=e.get(null===n.key?i:n.key)||null,n,r);case z:return f(e,t,i,(0,n._init)(n._payload),r)}if(te(n)||R(n))return h(t,e=e.get(i)||null,n,r,null);Zo(t,n)}return null}function m(r,o,a,l){for(var c=null,u=null,h=o,m=o=0,g=null;null!==h&&m<a.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var _=p(r,h,a[m],l);if(null===_){null===h&&(h=g);break}e&&h&&null===_.alternate&&t(r,h),o=s(_,o,m),null===u?c=_:u.sibling=_,u=_,h=g}if(m===a.length)return i(r,h),ro&&Jr(r,m),c;if(null===h){for(;m<a.length;m++)null!==(h=d(r,a[m],l))&&(o=s(h,o,m),null===u?c=h:u.sibling=h,u=h);return ro&&Jr(r,m),c}for(h=n(r,h);m<a.length;m++)null!==(g=f(h,r,m,a[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),o=s(g,o,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach((function(e){return t(r,e)})),ro&&Jr(r,m),c}function g(r,a,l,c){var u=R(l);if("function"!=typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var h=u=null,m=a,g=a=0,_=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(_=m,m=null):_=m.sibling;var x=p(r,m,y.value,c);if(null===x){null===m&&(m=_);break}e&&m&&null===x.alternate&&t(r,m),a=s(x,a,g),null===h?u=x:h.sibling=x,h=x,m=_}if(y.done)return i(r,m),ro&&Jr(r,g),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=d(r,y.value,c))&&(a=s(y,a,g),null===h?u=y:h.sibling=y,h=y);return ro&&Jr(r,g),u}for(m=n(r,m);!y.done;g++,y=l.next())null!==(y=f(m,r,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),a=s(y,a,g),null===h?u=y:h.sibling=y,h=y);return e&&m.forEach((function(e){return t(r,e)})),ro&&Jr(r,g),u}return function e(n,o,s,l){if("object"==typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"==typeof s&&null!==s){switch(s.$$typeof){case b:e:{for(var c=s.key,u=o;null!==u;){if(u.key===c){if((c=s.type)===S){if(7===u.tag){i(n,u.sibling),(o=r(u,s.props.children)).return=n,n=o;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===z&&Ho(c)===u.type){i(n,u.sibling),(o=r(u,s.props)).ref=Xo(n,u,s),o.return=n,n=o;break e}i(n,u);break}t(n,u),u=u.sibling}s.type===S?((o=Oc(s.props.children,n.mode,l,s.key)).return=n,n=o):((l=Rc(s.type,s.key,s.props,null,n.mode,l)).ref=Xo(n,o,s),l.return=n,n=l)}return a(n);case w:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){i(n,o.sibling),(o=r(o,s.children||[])).return=n,n=o;break e}i(n,o);break}t(n,o),o=o.sibling}(o=Nc(s,n.mode,l)).return=n,n=o}return a(n);case z:return e(n,o,(u=s._init)(s._payload),l)}if(te(s))return m(n,o,s,l);if(R(s))return g(n,o,s,l);Zo(n,s)}return"string"==typeof s&&""!==s||"number"==typeof s?(s=""+s,null!==o&&6===o.tag?(i(n,o.sibling),(o=r(o,s)).return=n,n=o):(i(n,o),(o=Fc(s,n.mode,l)).return=n,n=o),a(n)):i(n,o)}}var Ko=Yo(!0),Jo=Yo(!1),Qo={},es=Tr(Qo),ts=Tr(Qo),is=Tr(Qo);function ns(e){if(e===Qo)throw Error(o(174));return e}function rs(e,t){switch(Cr(is,t),Cr(ts,e),Cr(es,Qo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Er(es),Cr(es,t)}function os(){Er(es),Er(ts),Er(is)}function ss(e){ns(is.current);var t=ns(es.current),i=le(t,e.type);t!==i&&(Cr(ts,e),Cr(es,i))}function as(e){ts.current===e&&(Er(es),Er(ts))}var ls=Tr(0);function cs(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var us=[];function hs(){for(var e=0;e<us.length;e++)us[e]._workInProgressVersionPrimary=null;us.length=0}var ds=v.ReactCurrentDispatcher,ps=v.ReactCurrentBatchConfig,fs=0,ms=null,gs=null,_s=null,ys=!1,xs=!1,vs=0,bs=0;function ws(){throw Error(o(321))}function Ss(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!an(e[i],t[i]))return!1;return!0}function Ts(e,t,i,n,r,s){if(fs=s,ms=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ds.current=null===e||null===e.memoizedState?aa:la,e=i(n,r),xs){s=0;do{if(xs=!1,vs=0,25<=s)throw Error(o(301));s+=1,_s=gs=null,t.updateQueue=null,ds.current=ca,e=i(n,r)}while(xs)}if(ds.current=sa,t=null!==gs&&null!==gs.next,fs=0,_s=gs=ms=null,ys=!1,t)throw Error(o(300));return e}function Es(){var e=0!==vs;return vs=0,e}function Cs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===_s?ms.memoizedState=_s=e:_s=_s.next=e,_s}function ks(){if(null===gs){var e=ms.alternate;e=null!==e?e.memoizedState:null}else e=gs.next;var t=null===_s?ms.memoizedState:_s.next;if(null!==t)_s=t,gs=e;else{if(null===e)throw Error(o(310));e={memoizedState:(gs=e).memoizedState,baseState:gs.baseState,baseQueue:gs.baseQueue,queue:gs.queue,next:null},null===_s?ms.memoizedState=_s=e:_s=_s.next=e}return _s}function Ms(e,t){return"function"==typeof t?t(e):t}function As(e){var t=ks(),i=t.queue;if(null===i)throw Error(o(311));i.lastRenderedReducer=e;var n=gs,r=n.baseQueue,s=i.pending;if(null!==s){if(null!==r){var a=r.next;r.next=s.next,s.next=a}n.baseQueue=r=s,i.pending=null}if(null!==r){s=r.next,n=n.baseState;var l=a=null,c=null,u=s;do{var h=u.lane;if((fs&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:e(n,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=n):c=c.next=d,ms.lanes|=h,Bl|=h}u=u.next}while(null!==u&&u!==s);null===c?a=n:c.next=l,an(n,t.memoizedState)||(va=!0),t.memoizedState=n,t.baseState=a,t.baseQueue=c,i.lastRenderedState=n}if(null!==(e=i.interleaved)){r=e;do{s=r.lane,ms.lanes|=s,Bl|=s,r=r.next}while(r!==e)}else null===r&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function Ps(e){var t=ks(),i=t.queue;if(null===i)throw Error(o(311));i.lastRenderedReducer=e;var n=i.dispatch,r=i.pending,s=t.memoizedState;if(null!==r){i.pending=null;var a=r=r.next;do{s=e(s,a.action),a=a.next}while(a!==r);an(s,t.memoizedState)||(va=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),i.lastRenderedState=s}return[s,n]}function Is(){}function zs(e,t){var i=ms,n=ks(),r=t(),s=!an(n.memoizedState,r);if(s&&(n.memoizedState=r,va=!0),n=n.queue,Gs(Rs.bind(null,i,n,e),[e]),n.getSnapshot!==t||s||null!==_s&&1&_s.memoizedState.tag){if(i.flags|=2048,Ns(9,Ls.bind(null,i,n,r,t),void 0,null),null===Pl)throw Error(o(349));0!=(30&fs)||Ds(i,t,r)}return r}function Ds(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Ls(e,t,i,n){t.value=i,t.getSnapshot=n,Os(t)&&Bs(e)}function Rs(e,t,i){return i((function(){Os(t)&&Bs(e)}))}function Os(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!an(e,i)}catch(e){return!0}}function Bs(e){var t=Po(e,1);null!==t&&nc(t,e,1,-1)}function Fs(e){var t=Cs();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ms,lastRenderedState:e},t.queue=e,e=e.dispatch=ia.bind(null,ms,e),[t.memoizedState,e]}function Ns(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function js(){return ks().memoizedState}function Us(e,t,i,n){var r=Cs();ms.flags|=e,r.memoizedState=Ns(1|t,i,void 0,void 0===n?null:n)}function $s(e,t,i,n){var r=ks();n=void 0===n?null:n;var o=void 0;if(null!==gs){var s=gs.memoizedState;if(o=s.destroy,null!==n&&Ss(n,s.deps))return void(r.memoizedState=Ns(t,i,o,n))}ms.flags|=e,r.memoizedState=Ns(1|t,i,o,n)}function Vs(e,t){return Us(8390656,8,e,t)}function Gs(e,t){return $s(2048,8,e,t)}function Ws(e,t){return $s(4,2,e,t)}function qs(e,t){return $s(4,4,e,t)}function Xs(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Zs(e,t,i){return i=null!=i?i.concat([e]):null,$s(4,4,Xs.bind(null,t,e),i)}function Hs(){}function Ys(e,t){var i=ks();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&Ss(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Ks(e,t){var i=ks();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&Ss(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function Js(e,t,i){return 0==(21&fs)?(e.baseState&&(e.baseState=!1,va=!0),e.memoizedState=i):(an(i,t)||(i=mt(),ms.lanes|=i,Bl|=i,e.baseState=!0),t)}function Qs(e,t){var i=xt;xt=0!==i&&4>i?i:4,e(!0);var n=ps.transition;ps.transition={};try{e(!1),t()}finally{xt=i,ps.transition=n}}function ea(){return ks().memoizedState}function ta(e,t,i){var n=ic(e);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},na(e))ra(t,i);else if(null!==(i=Ao(e,t,i,n))){nc(i,e,n,tc()),oa(i,t,n)}}function ia(e,t,i){var n=ic(e),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(na(e))ra(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,i);if(r.hasEagerState=!0,r.eagerState=a,an(a,s)){var l=t.interleaved;return null===l?(r.next=r,Mo(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(e){}null!==(i=Ao(e,t,r,n))&&(nc(i,e,n,r=tc()),oa(i,t,n))}}function na(e){var t=e.alternate;return e===ms||null!==t&&t===ms}function ra(e,t){xs=ys=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function oa(e,t,i){if(0!=(4194240&i)){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,yt(e,i)}}var sa={readContext:Co,useCallback:ws,useContext:ws,useEffect:ws,useImperativeHandle:ws,useInsertionEffect:ws,useLayoutEffect:ws,useMemo:ws,useReducer:ws,useRef:ws,useState:ws,useDebugValue:ws,useDeferredValue:ws,useTransition:ws,useMutableSource:ws,useSyncExternalStore:ws,useId:ws,unstable_isNewReconciler:!1},aa={readContext:Co,useCallback:function(e,t){return Cs().memoizedState=[e,void 0===t?null:t],e},useContext:Co,useEffect:Vs,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,Us(4194308,4,Xs.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Us(4194308,4,e,t)},useInsertionEffect:function(e,t){return Us(4,2,e,t)},useMemo:function(e,t){var i=Cs();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=Cs();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=ta.bind(null,ms,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},Cs().memoizedState=e},useState:Fs,useDebugValue:Hs,useDeferredValue:function(e){return Cs().memoizedState=e},useTransition:function(){var e=Fs(!1),t=e[0];return e=Qs.bind(null,e[1]),Cs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var n=ms,r=Cs();if(ro){if(void 0===i)throw Error(o(407));i=i()}else{if(i=t(),null===Pl)throw Error(o(349));0!=(30&fs)||Ds(n,t,i)}r.memoizedState=i;var s={value:i,getSnapshot:t};return r.queue=s,Vs(Rs.bind(null,n,s,e),[e]),n.flags|=2048,Ns(9,Ls.bind(null,n,s,i,t),void 0,null),i},useId:function(){var e=Cs(),t=Pl.identifierPrefix;if(ro){var i=Kr;t=":"+t+"R"+(i=(Yr&~(1<<32-st(Yr)-1)).toString(32)+i),0<(i=vs++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=bs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},la={readContext:Co,useCallback:Ys,useContext:Co,useEffect:Gs,useImperativeHandle:Zs,useInsertionEffect:Ws,useLayoutEffect:qs,useMemo:Ks,useReducer:As,useRef:js,useState:function(){return As(Ms)},useDebugValue:Hs,useDeferredValue:function(e){return Js(ks(),gs.memoizedState,e)},useTransition:function(){return[As(Ms)[0],ks().memoizedState]},useMutableSource:Is,useSyncExternalStore:zs,useId:ea,unstable_isNewReconciler:!1},ca={readContext:Co,useCallback:Ys,useContext:Co,useEffect:Gs,useImperativeHandle:Zs,useInsertionEffect:Ws,useLayoutEffect:qs,useMemo:Ks,useReducer:Ps,useRef:js,useState:function(){return Ps(Ms)},useDebugValue:Hs,useDeferredValue:function(e){var t=ks();return null===gs?t.memoizedState=e:Js(t,gs.memoizedState,e)},useTransition:function(){return[Ps(Ms)[0],ks().memoizedState]},useMutableSource:Is,useSyncExternalStore:zs,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var i="",n=t;do{i+=U(n),n=n.return}while(n);var r=i}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:r,digest:null}}function ha(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var pa="function"==typeof WeakMap?WeakMap:Map;function fa(e,t,i){(i=Lo(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Wl||(Wl=!0,ql=n),da(0,t)},i}function ma(e,t,i){(i=Lo(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"==typeof n){var r=t.value;i.payload=function(){return n(r)},i.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(i.callback=function(){da(0,t),"function"!=typeof n&&(null===Xl?Xl=new Set([this]):Xl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function ga(e,t,i){var n=e.pingCache;if(null===n){n=e.pingCache=new pa;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(i)||(r.add(i),e=Cc.bind(null,e,t,i),t.then(e,e))}function _a(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ya(e,t,i,n,r){return 0==(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=Lo(-1,1)).tag=2,Ro(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var xa=v.ReactCurrentOwner,va=!1;function ba(e,t,i,n){t.child=null===e?Jo(t,null,i,n):Ko(t,e.child,i,n)}function wa(e,t,i,n,r){i=i.render;var o=t.ref;return Eo(t,r),n=Ts(e,t,i,n,o,r),i=Es(),null===e||va?(ro&&i&&eo(t),t.flags|=1,ba(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wa(e,t,r))}function Sa(e,t,i,n,r){if(null===e){var o=i.type;return"function"!=typeof o||Dc(o)||void 0!==o.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Rc(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ta(e,t,o,n,r))}if(o=e.child,0==(e.lanes&r)){var s=o.memoizedProps;if((i=null!==(i=i.compare)?i:ln)(s,n)&&e.ref===t.ref)return Wa(e,t,r)}return t.flags|=1,(e=Lc(o,n)).ref=t.ref,e.return=t,t.child=e}function Ta(e,t,i,n,r){if(null!==e){var o=e.memoizedProps;if(ln(o,n)&&e.ref===t.ref){if(va=!1,t.pendingProps=n=o,0==(e.lanes&r))return t.lanes=e.lanes,Wa(e,t,r);0!=(131072&e.flags)&&(va=!0)}}return ka(e,t,i,n,r)}function Ea(e,t,i){var n=t.pendingProps,r=n.children,o=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0==(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(Ll,Dl),Dl|=i;else{if(0==(1073741824&i))return e=null!==o?o.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cr(Ll,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==o?o.baseLanes:i,Cr(Ll,Dl),Dl|=n}else null!==o?(n=o.baseLanes|i,t.memoizedState=null):n=i,Cr(Ll,Dl),Dl|=n;return ba(e,t,r,i),t.child}function Ca(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function ka(e,t,i,n,r){var o=zr(i)?Pr:Mr.current;return o=Ir(t,o),Eo(t,r),i=Ts(e,t,i,n,o,r),n=Es(),null===e||va?(ro&&n&&eo(t),t.flags|=1,ba(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wa(e,t,r))}function Ma(e,t,i,n,r){if(zr(i)){var o=!0;Or(t)}else o=!1;if(Eo(t,r),null===t.stateNode)Ga(e,t),Go(t,i,n),qo(t,i,n,r),n=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=i.contextType;"object"==typeof c&&null!==c?c=Co(c):c=Ir(t,c=zr(i)?Pr:Mr.current);var u=i.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof s.getSnapshotBeforeUpdate;h||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==n||l!==c)&&Wo(t,s,n,c),Io=!1;var d=t.memoizedState;s.state=d,Fo(t,n,s,r),l=t.memoizedState,a!==n||d!==l||Ar.current||Io?("function"==typeof u&&(Uo(t,i,u,n),l=t.memoizedState),(a=Io||Vo(t,i,a,n,d,l,c))?(h||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),s.props=n,s.state=l,s.context=c,n=a):("function"==typeof s.componentDidMount&&(t.flags|=4194308),n=!1)}else{s=t.stateNode,Do(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:_o(t.type,a),s.props=c,h=t.pendingProps,d=s.context,"object"==typeof(l=i.contextType)&&null!==l?l=Co(l):l=Ir(t,l=zr(i)?Pr:Mr.current);var p=i.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==h||d!==l)&&Wo(t,s,n,l),Io=!1,d=t.memoizedState,s.state=d,Fo(t,n,s,r);var f=t.memoizedState;a!==h||d!==f||Ar.current||Io?("function"==typeof p&&(Uo(t,i,p,n),f=t.memoizedState),(c=Io||Vo(t,i,c,n,d,f,l)||!1)?(u||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(n,f,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(n,f,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=f),s.props=n,s.state=f,s.context=l,n=c):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),n=!1)}return Aa(e,t,i,n,o,r)}function Aa(e,t,i,n,r,o){Ca(e,t);var s=0!=(128&t.flags);if(!n&&!s)return r&&Br(t,i,!1),Wa(e,t,o);n=t.stateNode,xa.current=t;var a=s&&"function"!=typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&s?(t.child=Ko(t,e.child,null,o),t.child=Ko(t,null,a,o)):ba(e,t,a,o),t.memoizedState=n.state,r&&Br(t,i,!0),t.child}function Pa(e){var t=e.stateNode;t.pendingContext?Lr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Lr(0,t.context,!1),rs(e,t.containerInfo)}function Ia(e,t,i,n,r){return fo(),mo(r),t.flags|=256,ba(e,t,i,n),t.child}var za,Da,La,Ra,Oa={dehydrated:null,treeContext:null,retryLane:0};function Ba(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fa(e,t,i){var n,r=t.pendingProps,s=ls.current,a=!1,l=0!=(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!=(2&s)),n?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Cr(ls,1&s),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0==(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,a?(r=t.mode,a=t.child,l={mode:"hidden",children:l},0==(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Bc(l,r,0,null),e=Oc(e,r,i,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ba(i),t.memoizedState=Oa,e):Na(t,l));if(null!==(s=e.memoizedState)&&null!==(n=s.dehydrated))return function(e,t,i,n,r,s,a){if(i)return 256&t.flags?(t.flags&=-257,ja(e,t,a,n=ha(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=n.fallback,r=t.mode,n=Bc({mode:"visible",children:n.children},r,0,null),(s=Oc(s,r,a,null)).flags|=2,n.return=t,s.return=t,n.sibling=s,t.child=n,0!=(1&t.mode)&&Ko(t,e.child,null,a),t.child.memoizedState=Ba(a),t.memoizedState=Oa,s);if(0==(1&t.mode))return ja(e,t,a,null);if("$!"===r.data){if(n=r.nextSibling&&r.nextSibling.dataset)var l=n.dgst;return n=l,ja(e,t,a,n=ha(s=Error(o(419)),n,void 0))}if(l=0!=(a&e.childLanes),va||l){if(null!==(n=Pl)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!=(r&(n.suspendedLanes|a))?0:r)&&r!==s.retryLane&&(s.retryLane=r,Po(e,r),nc(n,e,r,-1))}return gc(),ja(e,t,a,n=ha(Error(o(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Mc.bind(null,e),r._reactRetry=t,null):(e=s.treeContext,no=cr(r.nextSibling),io=t,ro=!0,oo=null,null!==e&&(Xr[Zr++]=Yr,Xr[Zr++]=Kr,Xr[Zr++]=Hr,Yr=e.id,Kr=e.overflow,Hr=t),t=Na(t,n.children),t.flags|=4096,t)}(e,t,l,r,n,s,i);if(a){a=r.fallback,l=t.mode,n=(s=e.child).sibling;var c={mode:"hidden",children:r.children};return 0==(1&l)&&t.child!==s?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Lc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==n?a=Lc(n,a):(a=Oc(a,l,i,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,l=null===(l=e.child.memoizedState)?Ba(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~i,t.memoizedState=Oa,r}return e=(a=e.child).sibling,r=Lc(a,{mode:"visible",children:r.children}),0==(1&t.mode)&&(r.lanes=i),r.return=t,r.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function Na(e,t){return(t=Bc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function ja(e,t,i,n){return null!==n&&mo(n),Ko(t,e.child,null,i),(e=Na(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ua(e,t,i){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),To(e.return,t,i)}function $a(e,t,i,n,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=i,o.tailMode=r)}function Va(e,t,i){var n=t.pendingProps,r=n.revealOrder,o=n.tail;if(ba(e,t,n.children,i),0!=(2&(n=ls.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ua(e,i,t);else if(19===e.tag)Ua(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Cr(ls,n),0==(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===cs(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),$a(t,!1,r,i,o);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===cs(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}$a(t,!0,i,null,o);break;case"together":$a(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ga(e,t){0==(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wa(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Bl|=t.lanes,0==(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(i=Lc(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Lc(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function qa(e,t){if(!ro)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Xa(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=14680064&r.subtreeFlags,n|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function Za(e,t,i){var n=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xa(t),null;case 1:case 17:return zr(t.type)&&Dr(),Xa(t),null;case 3:return n=t.stateNode,os(),Er(Ar),Er(Mr),hs(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==oo&&(ac(oo),oo=null))),Da(e,t),Xa(t),null;case 5:as(t);var r=ns(is.current);if(i=t.type,null!==e&&null!=t.stateNode)La(e,t,i,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(o(166));return Xa(t),null}if(e=ns(es.current),ho(t)){n=t.stateNode,i=t.type;var s=t.memoizedProps;switch(n[dr]=t,n[pr]=s,e=0!=(1&t.mode),i){case"dialog":Nn("cancel",n),Nn("close",n);break;case"iframe":case"object":case"embed":Nn("load",n);break;case"video":case"audio":for(r=0;r<Rn.length;r++)Nn(Rn[r],n);break;case"source":Nn("error",n);break;case"img":case"image":case"link":Nn("error",n),Nn("load",n);break;case"details":Nn("toggle",n);break;case"input":Y(n,s),Nn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},Nn("invalid",n);break;case"textarea":re(n,s),Nn("invalid",n)}for(var l in ye(i,s),r=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"==typeof c?n.textContent!==c&&(!0!==s.suppressHydrationWarning&&Jn(n.textContent,c,e),r=["children",c]):"number"==typeof c&&n.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Jn(n.textContent,c,e),r=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Nn("scroll",n)}switch(i){case"input":q(n),Q(n,s,!0);break;case"textarea":q(n),se(n);break;case"select":case"option":break;default:"function"==typeof s.onClick&&(n.onclick=Qn)}n=r,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof n.is?e=l.createElement(i,{is:n.is}):(e=l.createElement(i),"select"===i&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,i),e[dr]=t,e[pr]=n,za(e,t,!1,!1),t.stateNode=e;e:{switch(l=xe(i,n),i){case"dialog":Nn("cancel",e),Nn("close",e),r=n;break;case"iframe":case"object":case"embed":Nn("load",e),r=n;break;case"video":case"audio":for(r=0;r<Rn.length;r++)Nn(Rn[r],e);r=n;break;case"source":Nn("error",e),r=n;break;case"img":case"image":case"link":Nn("error",e),Nn("load",e),r=n;break;case"details":Nn("toggle",e),r=n;break;case"input":Y(e,n),r=H(e,n),Nn("invalid",e);break;case"option":default:r=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},r=B({},n,{value:void 0}),Nn("invalid",e);break;case"textarea":re(e,n),r=ne(e,n),Nn("invalid",e)}for(s in ye(i,r),c=r)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?ge(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===s?"string"==typeof u?("textarea"!==i||""!==u)&&de(e,u):"number"==typeof u&&de(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Nn("scroll",e):null!=u&&x(e,s,u,l))}switch(i){case"input":q(e),Q(e,n,!1);break;case"textarea":q(e),se(e);break;case"option":null!=n.value&&e.setAttribute("value",""+G(n.value));break;case"select":e.multiple=!!n.multiple,null!=(s=n.value)?ie(e,!!n.multiple,s,!1):null!=n.defaultValue&&ie(e,!!n.multiple,n.defaultValue,!0);break;default:"function"==typeof r.onClick&&(e.onclick=Qn)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Xa(t),null;case 6:if(e&&null!=t.stateNode)Ra(e,t,e.memoizedProps,n);else{if("string"!=typeof n&&null===t.stateNode)throw Error(o(166));if(i=ns(is.current),ns(es.current),ho(t)){if(n=t.stateNode,i=t.memoizedProps,n[dr]=t,(s=n.nodeValue!==i)&&null!==(e=io))switch(e.tag){case 3:Jn(n.nodeValue,i,0!=(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jn(n.nodeValue,i,0!=(1&e.mode))}s&&(t.flags|=4)}else(n=(9===i.nodeType?i:i.ownerDocument).createTextNode(n))[dr]=t,t.stateNode=n}return Xa(t),null;case 13:if(Er(ls),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ro&&null!==no&&0!=(1&t.mode)&&0==(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==n&&null!==n.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[dr]=t}else fo(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Xa(t),s=!1}else null!==oo&&(ac(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!=(128&t.flags)?(t.lanes=i,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!=(1&t.mode)&&(null===e||0!=(1&ls.current)?0===Rl&&(Rl=3):gc())),null!==t.updateQueue&&(t.flags|=4),Xa(t),null);case 4:return os(),Da(e,t),null===e&&$n(t.stateNode.containerInfo),Xa(t),null;case 10:return So(t.type._context),Xa(t),null;case 19:if(Er(ls),null===(s=t.memoizedState))return Xa(t),null;if(n=0!=(128&t.flags),null===(l=s.rendering))if(n)qa(s,!1);else{if(0!==Rl||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=cs(e))){for(t.flags|=128,qa(s,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=i,i=t.child;null!==i;)e=n,(s=i).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Cr(ls,1&ls.current|2),t.child}e=e.sibling}null!==s.tail&&Ke()>Vl&&(t.flags|=128,n=!0,qa(s,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=cs(l))){if(t.flags|=128,n=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),qa(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!ro)return Xa(t),null}else 2*Ke()-s.renderingStartTime>Vl&&1073741824!==i&&(t.flags|=128,n=!0,qa(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=s.last)?i.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ke(),t.sibling=null,i=ls.current,Cr(ls,n?1&i|2:1&i),t):(Xa(t),null);case 22:case 23:return dc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!=(1&t.mode)?0!=(1073741824&Dl)&&(Xa(t),6&t.subtreeFlags&&(t.flags|=8192)):Xa(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Ha(e,t){switch(to(t),t.tag){case 1:return zr(t.type)&&Dr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return os(),Er(Ar),Er(Mr),hs(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 5:return as(t),null;case 13:if(Er(ls),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Er(ls),null;case 4:return os(),null;case 10:return So(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}za=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Da=function(){},La=function(e,t,i,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,ns(es.current);var o,s=null;switch(i){case"input":r=H(e,r),n=H(e,n),s=[];break;case"select":r=B({},r,{value:void 0}),n=B({},n,{value:void 0}),s=[];break;case"textarea":r=ne(e,r),n=ne(e,n),s=[];break;default:"function"!=typeof r.onClick&&"function"==typeof n.onClick&&(e.onclick=Qn)}for(u in ye(i,n),i=null,r)if(!n.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(o in l)l.hasOwnProperty(o)&&(i||(i={}),i[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in n){var c=n[u];if(l=null!=r?r[u]:void 0,n.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(i||(i={}),i[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(i||(i={}),i[o]=c[o])}else i||(s||(s=[]),s.push(u,i)),i=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Nn("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}i&&(s=s||[]).push("style",i);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Ra=function(e,t,i,n){i!==n&&(t.flags|=4)};var Ya=!1,Ka=!1,Ja="function"==typeof WeakSet?WeakSet:Set,Qa=null;function el(e,t){var i=e.ref;if(null!==i)if("function"==typeof i)try{i(null)}catch(i){Ec(e,t,i)}else i.current=null}function tl(e,t,i){try{i()}catch(i){Ec(e,t,i)}}var il=!1;function nl(e,t,i){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&tl(t,i,o)}r=r.next}while(r!==n)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var n=i.create;i.destroy=n()}i=i.next}while(i!==t)}}function ol(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"==typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dr],delete t[pr],delete t[mr],delete t[gr],delete t[_r])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!=(i=i._reactRootContainer)||null!==t.onclick||(t.onclick=Qn));else if(4!==n&&null!==(e=e.child))for(cl(e,t,i),e=e.sibling;null!==e;)cl(e,t,i),e=e.sibling}function ul(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(ul(e,t,i),e=e.sibling;null!==e;)ul(e,t,i),e=e.sibling}var hl=null,dl=!1;function pl(e,t,i){for(i=i.child;null!==i;)fl(e,t,i),i=i.sibling}function fl(e,t,i){if(ot&&"function"==typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(rt,i)}catch(e){}switch(i.tag){case 5:Ka||el(i,t);case 6:var n=hl,r=dl;hl=null,pl(e,t,i),dl=r,null!==(hl=n)&&(dl?(e=hl,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):hl.removeChild(i.stateNode));break;case 18:null!==hl&&(dl?(e=hl,i=i.stateNode,8===e.nodeType?lr(e.parentNode,i):1===e.nodeType&&lr(e,i),$t(e)):lr(hl,i.stateNode));break;case 4:n=hl,r=dl,hl=i.stateNode.containerInfo,dl=!0,pl(e,t,i),hl=n,dl=r;break;case 0:case 11:case 14:case 15:if(!Ka&&(null!==(n=i.updateQueue)&&null!==(n=n.lastEffect))){r=n=n.next;do{var o=r,s=o.destroy;o=o.tag,void 0!==s&&(0!=(2&o)||0!=(4&o))&&tl(i,t,s),r=r.next}while(r!==n)}pl(e,t,i);break;case 1:if(!Ka&&(el(i,t),"function"==typeof(n=i.stateNode).componentWillUnmount))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(e){Ec(i,t,e)}pl(e,t,i);break;case 21:pl(e,t,i);break;case 22:1&i.mode?(Ka=(n=Ka)||null!==i.memoizedState,pl(e,t,i),Ka=n):pl(e,t,i);break;default:pl(e,t,i)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new Ja),t.forEach((function(t){var n=Ac.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))}))}}function gl(e,t){var i=t.deletions;if(null!==i)for(var n=0;n<i.length;n++){var r=i[n];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(o(160));fl(s,a,r),hl=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(e){Ec(r,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)_l(t,e),t=t.sibling}function _l(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),yl(e),4&n){try{nl(3,e,e.return),rl(3,e)}catch(t){Ec(e,e.return,t)}try{nl(5,e,e.return)}catch(t){Ec(e,e.return,t)}}break;case 1:gl(t,e),yl(e),512&n&&null!==i&&el(i,i.return);break;case 5:if(gl(t,e),yl(e),512&n&&null!==i&&el(i,i.return),32&e.flags){var r=e.stateNode;try{de(r,"")}catch(t){Ec(e,e.return,t)}}if(4&n&&null!=(r=e.stateNode)){var s=e.memoizedProps,a=null!==i?i.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&K(r,s),xe(l,a);var u=xe(l,s);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?ge(r,d):"dangerouslySetInnerHTML"===h?he(r,d):"children"===h?de(r,d):x(r,h,d,u)}switch(l){case"input":J(r,s);break;case"textarea":oe(r,s);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ie(r,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ie(r,!!s.multiple,s.defaultValue,!0):ie(r,!!s.multiple,s.multiple?[]:"",!1))}r[pr]=s}catch(t){Ec(e,e.return,t)}}break;case 6:if(gl(t,e),yl(e),4&n){if(null===e.stateNode)throw Error(o(162));r=e.stateNode,s=e.memoizedProps;try{r.nodeValue=s}catch(t){Ec(e,e.return,t)}}break;case 3:if(gl(t,e),yl(e),4&n&&null!==i&&i.memoizedState.isDehydrated)try{$t(t.containerInfo)}catch(t){Ec(e,e.return,t)}break;case 4:default:gl(t,e),yl(e);break;case 13:gl(t,e),yl(e),8192&(r=e.child).flags&&(s=null!==r.memoizedState,r.stateNode.isHidden=s,!s||null!==r.alternate&&null!==r.alternate.memoizedState||($l=Ke())),4&n&&ml(e);break;case 22:if(h=null!==i&&null!==i.memoizedState,1&e.mode?(Ka=(u=Ka)||h,gl(t,e),Ka=u):gl(t,e),yl(e),8192&n){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!=(1&e.mode))for(Qa=e,h=e.child;null!==h;){for(d=Qa=h;null!==Qa;){switch(f=(p=Qa).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:el(p,p.return);var m=p.stateNode;if("function"==typeof m.componentWillUnmount){n=p,i=p.return;try{t=n,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(e){Ec(n,i,e)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){wl(d);continue}}null!==f?(f.return=p,Qa=f):wl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,u?"function"==typeof(s=r.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=d.stateNode,a=null!=(c=d.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",a))}catch(t){Ec(e,e.return,t)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(t){Ec(e,e.return,t)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gl(t,e),yl(e),4&n&&ml(e);case 21:}}function yl(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(al(i)){var n=i;break e}i=i.return}throw Error(o(160))}switch(n.tag){case 5:var r=n.stateNode;32&n.flags&&(de(r,""),n.flags&=-33),ul(e,ll(e),r);break;case 3:case 4:var s=n.stateNode.containerInfo;cl(e,ll(e),s);break;default:throw Error(o(161))}}catch(t){Ec(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function xl(e,t,i){Qa=e,vl(e,t,i)}function vl(e,t,i){for(var n=0!=(1&e.mode);null!==Qa;){var r=Qa,o=r.child;if(22===r.tag&&n){var s=null!==r.memoizedState||Ya;if(!s){var a=r.alternate,l=null!==a&&null!==a.memoizedState||Ka;a=Ya;var c=Ka;if(Ya=s,(Ka=l)&&!c)for(Qa=r;null!==Qa;)l=(s=Qa).child,22===s.tag&&null!==s.memoizedState?Sl(r):null!==l?(l.return=s,Qa=l):Sl(r);for(;null!==o;)Qa=o,vl(o,t,i),o=o.sibling;Qa=r,Ya=a,Ka=c}bl(e)}else 0!=(8772&r.subtreeFlags)&&null!==o?(o.return=r,Qa=o):bl(e)}}function bl(e){for(;null!==Qa;){var t=Qa;if(0!=(8772&t.flags)){var i=t.alternate;try{if(0!=(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ka||rl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Ka)if(null===i)n.componentDidMount();else{var r=t.elementType===t.type?i.memoizedProps:_o(t.type,i.memoizedProps);n.componentDidUpdate(r,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&No(t,s,n);break;case 3:var a=t.updateQueue;if(null!==a){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}No(t,a,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&i.focus();break;case"img":c.src&&(i.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&$t(d)}}}break;default:throw Error(o(163))}Ka||512&t.flags&&ol(t)}catch(e){Ec(t,t.return,e)}}if(t===e){Qa=null;break}if(null!==(i=t.sibling)){i.return=t.return,Qa=i;break}Qa=t.return}}function wl(e){for(;null!==Qa;){var t=Qa;if(t===e){Qa=null;break}var i=t.sibling;if(null!==i){i.return=t.return,Qa=i;break}Qa=t.return}}function Sl(e){for(;null!==Qa;){var t=Qa;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{rl(4,t)}catch(e){Ec(t,i,e)}break;case 1:var n=t.stateNode;if("function"==typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(e){Ec(t,r,e)}}var o=t.return;try{ol(t)}catch(e){Ec(t,o,e)}break;case 5:var s=t.return;try{ol(t)}catch(e){Ec(t,s,e)}}}catch(e){Ec(t,t.return,e)}if(t===e){Qa=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Qa=a;break}Qa=t.return}}var Tl,El=Math.ceil,Cl=v.ReactCurrentDispatcher,kl=v.ReactCurrentOwner,Ml=v.ReactCurrentBatchConfig,Al=0,Pl=null,Il=null,zl=0,Dl=0,Ll=Tr(0),Rl=0,Ol=null,Bl=0,Fl=0,Nl=0,jl=null,Ul=null,$l=0,Vl=1/0,Gl=null,Wl=!1,ql=null,Xl=null,Zl=!1,Hl=null,Yl=0,Kl=0,Jl=null,Ql=-1,ec=0;function tc(){return 0!=(6&Al)?Ke():-1!==Ql?Ql:Ql=Ke()}function ic(e){return 0==(1&e.mode)?1:0!=(2&Al)&&0!==zl?zl&-zl:null!==go.transition?(0===ec&&(ec=mt()),ec):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function nc(e,t,i,n){if(50<Kl)throw Kl=0,Jl=null,Error(o(185));_t(e,i,n),0!=(2&Al)&&e===Pl||(e===Pl&&(0==(2&Al)&&(Fl|=i),4===Rl&&lc(e,zl)),rc(e,n),1===i&&0===Al&&0==(1&t.mode)&&(Vl=Ke()+500,Nr&&$r()))}function rc(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,l=r[s];-1===l?0!=(a&i)&&0==(a&n)||(r[s]=pt(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var n=dt(e,e===Pl?zl:0);if(0===n)null!==i&&Ze(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=i&&Ze(i),1===t)0===e.tag?function(e){Nr=!0,Ur(e)}(cc.bind(null,e)):Ur(cc.bind(null,e)),sr((function(){0==(6&Al)&&$r()})),i=null;else{switch(vt(n)){case 1:i=Qe;break;case 4:i=et;break;case 16:default:i=tt;break;case 536870912:i=nt}i=Pc(i,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function oc(e,t){if(Ql=-1,ec=0,0!=(6&Al))throw Error(o(327));var i=e.callbackNode;if(Sc()&&e.callbackNode!==i)return null;var n=dt(e,e===Pl?zl:0);if(0===n)return null;if(0!=(30&n)||0!=(n&e.expiredLanes)||t)t=_c(e,n);else{t=n;var r=Al;Al|=2;var s=mc();for(Pl===e&&zl===t||(Gl=null,Vl=Ke()+500,pc(e,t));;)try{xc();break}catch(t){fc(e,t)}wo(),Cl.current=s,Al=r,null!==Il?t=0:(Pl=null,zl=0,t=Rl)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(n=r,t=sc(e,r))),1===t)throw i=Ol,pc(e,0),lc(e,n),rc(e,Ke()),i;if(6===t)lc(e,n);else{if(r=e.current.alternate,0==(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var n=0;n<i.length;n++){var r=i[n],o=r.getSnapshot;r=r.value;try{if(!an(o(),r))return!1}catch(e){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=_c(e,n))&&(0!==(s=ft(e))&&(n=s,t=sc(e,s))),1===t))throw i=Ol,pc(e,0),lc(e,n),rc(e,Ke()),i;switch(e.finishedWork=r,e.finishedLanes=n,t){case 0:case 1:throw Error(o(345));case 2:case 5:wc(e,Ul,Gl);break;case 3:if(lc(e,n),(130023424&n)===n&&10<(t=$l+500-Ke())){if(0!==dt(e,0))break;if(((r=e.suspendedLanes)&n)!==n){tc(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=nr(wc.bind(null,e,Ul,Gl),t);break}wc(e,Ul,Gl);break;case 4:if(lc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,r=-1;0<n;){var a=31-st(n);s=1<<a,(a=t[a])>r&&(r=a),n&=~s}if(n=r,10<(n=(120>(n=Ke()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*El(n/1960))-n)){e.timeoutHandle=nr(wc.bind(null,e,Ul,Gl),n);break}wc(e,Ul,Gl);break;default:throw Error(o(329))}}}return rc(e,Ke()),e.callbackNode===i?oc.bind(null,e):null}function sc(e,t){var i=jl;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=_c(e,t))&&(t=Ul,Ul=i,null!==t&&ac(t)),e}function ac(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function lc(e,t){for(t&=~Nl,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-st(t),n=1<<i;e[i]=-1,t&=~n}}function cc(e){if(0!=(6&Al))throw Error(o(327));Sc();var t=dt(e,0);if(0==(1&t))return rc(e,Ke()),null;var i=_c(e,t);if(0!==e.tag&&2===i){var n=ft(e);0!==n&&(t=n,i=sc(e,n))}if(1===i)throw i=Ol,pc(e,0),lc(e,t),rc(e,Ke()),i;if(6===i)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Ul,Gl),rc(e,Ke()),null}function uc(e,t){var i=Al;Al|=1;try{return e(t)}finally{0===(Al=i)&&(Vl=Ke()+500,Nr&&$r())}}function hc(e){null!==Hl&&0===Hl.tag&&0==(6&Al)&&Sc();var t=Al;Al|=1;var i=Ml.transition,n=xt;try{if(Ml.transition=null,xt=1,e)return e()}finally{xt=n,Ml.transition=i,0==(6&(Al=t))&&$r()}}function dc(){Dl=Ll.current,Er(Ll)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,rr(i)),null!==Il)for(i=Il.return;null!==i;){var n=i;switch(to(n),n.tag){case 1:null!=(n=n.type.childContextTypes)&&Dr();break;case 3:os(),Er(Ar),Er(Mr),hs();break;case 5:as(n);break;case 4:os();break;case 13:case 19:Er(ls);break;case 10:So(n.type._context);break;case 22:case 23:dc()}i=i.return}if(Pl=e,Il=e=Lc(e.current,null),zl=Dl=t,Rl=0,Ol=null,Nl=Fl=Bl=0,Ul=jl=null,null!==ko){for(t=0;t<ko.length;t++)if(null!==(n=(i=ko[t]).interleaved)){i.interleaved=null;var r=n.next,o=i.pending;if(null!==o){var s=o.next;o.next=r,n.next=s}i.pending=n}ko=null}return e}function fc(e,t){for(;;){var i=Il;try{if(wo(),ds.current=sa,ys){for(var n=ms.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}ys=!1}if(fs=0,_s=gs=ms=null,xs=!1,vs=0,kl.current=null,null===i||null===i.return){Rl=1,Ol=t,Il=null;break}e:{var s=e,a=i.return,l=i,c=t;if(t=zl,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,h=l,d=h.tag;if(0==(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=_a(a);if(null!==f){f.flags&=-257,ya(f,a,l,0,t),1&f.mode&&ga(s,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0==(1&t)){ga(s,u,t),gc();break e}c=Error(o(426))}else if(ro&&1&l.mode){var _=_a(a);if(null!==_){0==(65536&_.flags)&&(_.flags|=256),ya(_,a,l,0,t),mo(ua(c,l));break e}}s=c=ua(c,l),4!==Rl&&(Rl=2),null===jl?jl=[s]:jl.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Bo(s,fa(0,c,t));break e;case 1:l=c;var y=s.type,x=s.stateNode;if(0==(128&s.flags)&&("function"==typeof y.getDerivedStateFromError||null!==x&&"function"==typeof x.componentDidCatch&&(null===Xl||!Xl.has(x)))){s.flags|=65536,t&=-t,s.lanes|=t,Bo(s,ma(s,l,t));break e}}s=s.return}while(null!==s)}bc(i)}catch(e){t=e,Il===i&&null!==i&&(Il=i=i.return);continue}break}}function mc(){var e=Cl.current;return Cl.current=sa,null===e?sa:e}function gc(){0!==Rl&&3!==Rl&&2!==Rl||(Rl=4),null===Pl||0==(268435455&Bl)&&0==(268435455&Fl)||lc(Pl,zl)}function _c(e,t){var i=Al;Al|=2;var n=mc();for(Pl===e&&zl===t||(Gl=null,pc(e,t));;)try{yc();break}catch(t){fc(e,t)}if(wo(),Al=i,Cl.current=n,null!==Il)throw Error(o(261));return Pl=null,zl=0,Rl}function yc(){for(;null!==Il;)vc(Il)}function xc(){for(;null!==Il&&!He();)vc(Il)}function vc(e){var t=Tl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?bc(e):Il=t,kl.current=null}function bc(e){var t=e;do{var i=t.alternate;if(e=t.return,0==(32768&t.flags)){if(null!==(i=Za(i,t,Dl)))return void(Il=i)}else{if(null!==(i=Ha(i,t)))return i.flags&=32767,void(Il=i);if(null===e)return Rl=6,void(Il=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Il=t);Il=t=e}while(null!==t);0===Rl&&(Rl=5)}function wc(e,t,i){var n=xt,r=Ml.transition;try{Ml.transition=null,xt=1,function(e,t,i,n){do{Sc()}while(null!==Hl);if(0!=(6&Al))throw Error(o(327));i=e.finishedWork;var r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<i;){var r=31-st(i),o=1<<r;t[r]=0,n[r]=-1,e[r]=-1,i&=~o}}(e,s),e===Pl&&(Il=Pl=null,zl=0),0==(2064&i.subtreeFlags)&&0==(2064&i.flags)||Zl||(Zl=!0,Pc(tt,(function(){return Sc(),null}))),s=0!=(15990&i.flags),0!=(15990&i.subtreeFlags)||s){s=Ml.transition,Ml.transition=null;var a=xt;xt=1;var l=Al;Al|=4,kl.current=null,function(e,t){if(er=Gt,pn(e=dn())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var r=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{i.nodeType,s.nodeType}catch(e){i=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==i||0!==r&&3!==d.nodeType||(l=a+r),d!==s||0!==n&&3!==d.nodeType||(c=a+n),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===i&&++u===r&&(l=a),p===s&&++h===n&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(tr={focusedElem:e,selectionRange:i},Gt=!1,Qa=t;null!==Qa;)if(e=(t=Qa).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,Qa=e;else for(;null!==Qa;){t=Qa;try{var m=t.alternate;if(0!=(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,_=m.memoizedState,y=t.stateNode,x=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:_o(t.type,g),_);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var v=t.stateNode.containerInfo;1===v.nodeType?v.textContent="":9===v.nodeType&&v.documentElement&&v.removeChild(v.documentElement);break;default:throw Error(o(163))}}catch(e){Ec(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Qa=e;break}Qa=t.return}m=il,il=!1}(e,i),_l(i,e),fn(tr),Gt=!!er,tr=er=null,e.current=i,xl(i,e,r),Ye(),Al=l,xt=a,Ml.transition=s}else e.current=i;if(Zl&&(Zl=!1,Hl=e,Yl=r),s=e.pendingLanes,0===s&&(Xl=null),function(e){if(ot&&"function"==typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(rt,e,void 0,128==(128&e.current.flags))}catch(e){}}(i.stateNode),rc(e,Ke()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)r=t[i],n(r.value,{componentStack:r.stack,digest:r.digest});if(Wl)throw Wl=!1,e=ql,ql=null,e;0!=(1&Yl)&&0!==e.tag&&Sc(),s=e.pendingLanes,0!=(1&s)?e===Jl?Kl++:(Kl=0,Jl=e):Kl=0,$r()}(e,t,i,n)}finally{Ml.transition=r,xt=n}return null}function Sc(){if(null!==Hl){var e=vt(Yl),t=Ml.transition,i=xt;try{if(Ml.transition=null,xt=16>e?16:e,null===Hl)var n=!1;else{if(e=Hl,Hl=null,Yl=0,0!=(6&Al))throw Error(o(331));var r=Al;for(Al|=4,Qa=e.current;null!==Qa;){var s=Qa,a=s.child;if(0!=(16&Qa.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Qa=u;null!==Qa;){var h=Qa;switch(h.tag){case 0:case 11:case 15:nl(8,h,s)}var d=h.child;if(null!==d)d.return=h,Qa=d;else for(;null!==Qa;){var p=(h=Qa).sibling,f=h.return;if(sl(h),h===u){Qa=null;break}if(null!==p){p.return=f,Qa=p;break}Qa=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(null!==g)}}Qa=s}}if(0!=(2064&s.subtreeFlags)&&null!==a)a.return=s,Qa=a;else e:for(;null!==Qa;){if(0!=(2048&(s=Qa).flags))switch(s.tag){case 0:case 11:case 15:nl(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Qa=y;break e}Qa=s.return}}var x=e.current;for(Qa=x;null!==Qa;){var v=(a=Qa).child;if(0!=(2064&a.subtreeFlags)&&null!==v)v.return=a,Qa=v;else e:for(a=x;null!==Qa;){if(0!=(2048&(l=Qa).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(e){Ec(l,l.return,e)}if(l===a){Qa=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,Qa=b;break e}Qa=l.return}}if(Al=r,$r(),ot&&"function"==typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(rt,e)}catch(e){}n=!0}return n}finally{xt=i,Ml.transition=t}}return!1}function Tc(e,t,i){e=Ro(e,t=fa(0,t=ua(i,t),1),1),t=tc(),null!==e&&(_t(e,1,t),rc(e,t))}function Ec(e,t,i){if(3===e.tag)Tc(e,e,i);else for(;null!==t;){if(3===t.tag){Tc(t,e,i);break}if(1===t.tag){var n=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===Xl||!Xl.has(n))){t=Ro(t,e=ma(t,e=ua(i,e),1),1),e=tc(),null!==t&&(_t(t,1,e),rc(t,e));break}}t=t.return}}function Cc(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&i,Pl===e&&(zl&i)===i&&(4===Rl||3===Rl&&(130023424&zl)===zl&&500>Ke()-$l?pc(e,0):Nl|=i),rc(e,t)}function kc(e,t){0===t&&(0==(1&e.mode)?t=1:(t=ut,0==(130023424&(ut<<=1))&&(ut=4194304)));var i=tc();null!==(e=Po(e,t))&&(_t(e,t,i),rc(e,i))}function Mc(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),kc(e,i)}function Ac(e,t){var i=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(i=r.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(o(314))}null!==n&&n.delete(t),kc(e,i)}function Pc(e,t){return Xe(e,t)}function Ic(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zc(e,t,i,n){return new Ic(e,t,i,n)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Lc(e,t){var i=e.alternate;return null===i?((i=zc(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Rc(e,t,i,n,r,s){var a=2;if(n=e,"function"==typeof e)Dc(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case S:return Oc(i.children,r,s,t);case T:a=8,r|=8;break;case E:return(e=zc(12,i,t,2|r)).elementType=E,e.lanes=s,e;case A:return(e=zc(13,i,t,r)).elementType=A,e.lanes=s,e;case P:return(e=zc(19,i,t,r)).elementType=P,e.lanes=s,e;case D:return Bc(i,r,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case C:a=10;break e;case k:a=9;break e;case M:a=11;break e;case I:a=14;break e;case z:a=16,n=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=zc(a,i,t,r)).elementType=e,t.type=n,t.lanes=s,t}function Oc(e,t,i,n){return(e=zc(7,e,n,t)).lanes=i,e}function Bc(e,t,i,n){return(e=zc(22,e,n,t)).elementType=D,e.lanes=i,e.stateNode={isHidden:!1},e}function Fc(e,t,i){return(e=zc(6,e,null,t)).lanes=i,e}function Nc(e,t,i){return(t=zc(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function jc(e,t,i,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Uc(e,t,i,n,r,o,s,a,l){return e=new jc(e,t,i,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=zc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},zo(o),e}function $c(e){if(!e)return kr;e:{if($e(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(zr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var i=e.type;if(zr(i))return Rr(e,i,t)}return t}function Vc(e,t,i,n,r,o,s,a,l){return(e=Uc(i,n,!0,e,0,o,0,a,l)).context=$c(null),i=e.current,(o=Lo(n=tc(),r=ic(i))).callback=null!=t?t:null,Ro(i,o,r),e.current.lanes=r,_t(e,r,n),rc(e,n),e}function Gc(e,t,i,n){var r=t.current,o=tc(),s=ic(r);return i=$c(i),null===t.context?t.context=i:t.pendingContext=i,(t=Lo(o,s)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Ro(r,t,s))&&(nc(e,r,s,o),Oo(e,r,s)),s}function Wc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function qc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function Xc(e,t){qc(e,t),(e=e.alternate)&&qc(e,t)}Tl=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ar.current)va=!0;else{if(0==(e.lanes&i)&&0==(128&t.flags))return va=!1,function(e,t,i){switch(t.tag){case 3:Pa(t),fo();break;case 5:ss(t);break;case 1:zr(t.type)&&Or(t);break;case 4:rs(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;Cr(yo,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Cr(ls,1&ls.current),t.flags|=128,null):0!=(i&t.child.childLanes)?Fa(e,t,i):(Cr(ls,1&ls.current),null!==(e=Wa(e,t,i))?e.sibling:null);Cr(ls,1&ls.current);break;case 19:if(n=0!=(i&t.childLanes),0!=(128&e.flags)){if(n)return Va(e,t,i);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Cr(ls,ls.current),n)break;return null;case 22:case 23:return t.lanes=0,Ea(e,t,i)}return Wa(e,t,i)}(e,t,i);va=0!=(131072&e.flags)}else va=!1,ro&&0!=(1048576&t.flags)&&Qr(t,qr,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Ga(e,t),e=t.pendingProps;var r=Ir(t,Mr.current);Eo(t,i),r=Ts(null,t,n,e,r,i);var s=Es();return t.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,zr(n)?(s=!0,Or(t)):s=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,zo(t),r.updater=$o,t.stateNode=r,r._reactInternals=t,qo(t,n,e,i),t=Aa(null,t,n,!0,s,i)):(t.tag=0,ro&&s&&eo(t),ba(null,t,r,i),t=t.child),t;case 16:n=t.elementType;e:{switch(Ga(e,t),e=t.pendingProps,n=(r=n._init)(n._payload),t.type=n,r=t.tag=function(e){if("function"==typeof e)return Dc(e)?1:0;if(null!=e){if((e=e.$$typeof)===M)return 11;if(e===I)return 14}return 2}(n),e=_o(n,e),r){case 0:t=ka(null,t,n,e,i);break e;case 1:t=Ma(null,t,n,e,i);break e;case 11:t=wa(null,t,n,e,i);break e;case 14:t=Sa(null,t,n,_o(n.type,e),i);break e}throw Error(o(306,n,""))}return t;case 0:return n=t.type,r=t.pendingProps,ka(e,t,n,r=t.elementType===n?r:_o(n,r),i);case 1:return n=t.type,r=t.pendingProps,Ma(e,t,n,r=t.elementType===n?r:_o(n,r),i);case 3:e:{if(Pa(t),null===e)throw Error(o(387));n=t.pendingProps,r=(s=t.memoizedState).element,Do(e,t),Fo(t,n,null,i);var a=t.memoizedState;if(n=a.element,s.isDehydrated){if(s={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Ia(e,t,n,i,r=ua(Error(o(423)),t));break e}if(n!==r){t=Ia(e,t,n,i,r=ua(Error(o(424)),t));break e}for(no=cr(t.stateNode.containerInfo.firstChild),io=t,ro=!0,oo=null,i=Jo(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(fo(),n===r){t=Wa(e,t,i);break e}ba(e,t,n,i)}t=t.child}return t;case 5:return ss(t),null===e&&co(t),n=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,a=r.children,ir(n,r)?a=null:null!==s&&ir(n,s)&&(t.flags|=32),Ca(e,t),ba(e,t,a,i),t.child;case 6:return null===e&&co(t),null;case 13:return Fa(e,t,i);case 4:return rs(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Ko(t,null,n,i):ba(e,t,n,i),t.child;case 11:return n=t.type,r=t.pendingProps,wa(e,t,n,r=t.elementType===n?r:_o(n,r),i);case 7:return ba(e,t,t.pendingProps,i),t.child;case 8:case 12:return ba(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(n=t.type._context,r=t.pendingProps,s=t.memoizedProps,a=r.value,Cr(yo,n._currentValue),n._currentValue=a,null!==s)if(an(s.value,a)){if(s.children===r.children&&!Ar.current){t=Wa(e,t,i);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===s.tag){(c=Lo(-1,i&-i)).tag=2;var u=s.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=i,null!==(c=s.alternate)&&(c.lanes|=i),To(s.return,i,t),l.lanes|=i;break}c=c.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=i,null!==(l=a.alternate)&&(l.lanes|=i),To(a,i,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}ba(e,t,r.children,i),t=t.child}return t;case 9:return r=t.type,n=t.pendingProps.children,Eo(t,i),n=n(r=Co(r)),t.flags|=1,ba(e,t,n,i),t.child;case 14:return r=_o(n=t.type,t.pendingProps),Sa(e,t,n,r=_o(n.type,r),i);case 15:return Ta(e,t,t.type,t.pendingProps,i);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:_o(n,r),Ga(e,t),t.tag=1,zr(n)?(e=!0,Or(t)):e=!1,Eo(t,i),Go(t,n,r),qo(t,n,r,i),Aa(null,t,n,!0,e,i);case 19:return Va(e,t,i);case 22:return Ea(e,t,i)}throw Error(o(156,t.tag))};var Zc="function"==typeof reportError?reportError:function(e){console.error(e)};function Hc(e){this._internalRoot=e}function Yc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Qc(){}function eu(e,t,i,n,r){var o=i._reactRootContainer;if(o){var s=o;if("function"==typeof r){var a=r;r=function(){var e=Wc(s);a.call(e)}}Gc(t,s,e,r)}else s=function(e,t,i,n,r){if(r){if("function"==typeof n){var o=n;n=function(){var e=Wc(s);o.call(e)}}var s=Vc(t,n,e,0,null,!1,0,"",Qc);return e._reactRootContainer=s,e[fr]=s.current,$n(8===e.nodeType?e.parentNode:e),hc(),s}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof n){var a=n;n=function(){var e=Wc(l);a.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Qc);return e._reactRootContainer=l,e[fr]=l.current,$n(8===e.nodeType?e.parentNode:e),hc((function(){Gc(t,l,i,n)})),l}(i,t,e,r,n);return Wc(s)}Yc.prototype.render=Hc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Gc(e,t,null,null)},Yc.prototype.unmount=Hc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){Gc(null,e,null,null)})),t[fr]=null}},Yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Dt.length&&0!==t&&t<Dt[i].priority;i++);Dt.splice(i,0,e),0===i&&Bt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=ht(t.pendingLanes);0!==i&&(yt(t,1|i),rc(t,Ke()),0==(6&Al)&&(Vl=Ke()+500,$r()))}break;case 13:hc((function(){var t=Po(e,1);if(null!==t){var i=tc();nc(t,e,1,i)}})),Xc(e,1)}},wt=function(e){if(13===e.tag){var t=Po(e,134217728);if(null!==t)nc(t,e,134217728,tc());Xc(e,134217728)}},St=function(e){if(13===e.tag){var t=ic(e),i=Po(e,t);if(null!==i)nc(i,e,t,tc());Xc(e,t)}},Tt=function(){return xt},Et=function(e,t){var i=xt;try{return xt=e,t()}finally{xt=i}},we=function(e,t,i){switch(t){case"input":if(J(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=br(n);if(!r)throw Error(o(90));X(n),J(n,r)}}}break;case"textarea":oe(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},Me=uc,Ae=hc;var tu={usingClientEntryPoint:!1,Events:[xr,vr,br,Ce,ke,uc]},iu={findFiberByHostInstance:yr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},nu={bundleType:iu.bundleType,version:iu.version,rendererPackageName:iu.rendererPackageName,rendererConfig:iu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:v.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:iu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{rt=ru.inject(nu),ot=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(o(200));return function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.createRoot=function(e,t){if(!Kc(e))throw Error(o(299));var i=!1,n="",r=Zc;return null!=t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Uc(e,1,!1,null,0,i,0,n,r),e[fr]=t.current,$n(8===e.nodeType?e.parentNode:e),new Hc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,i){if(!Jc(t))throw Error(o(200));return eu(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!Kc(e))throw Error(o(405));var n=null!=i&&i.hydratedSources||null,r=!1,s="",a=Zc;if(null!=i&&(!0===i.unstable_strictMode&&(r=!0),void 0!==i.identifierPrefix&&(s=i.identifierPrefix),void 0!==i.onRecoverableError&&(a=i.onRecoverableError)),t=Vc(t,null,e,1,null!=i?i:null,r,0,s,a),e[fr]=t.current,$n(e),n)for(e=0;e<n.length;e++)r=(r=(i=n[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,r]:t.mutableSourceEagerHydrationData.push(i,r);return new Yc(t)},t.render=function(e,t,i){if(!Jc(t))throw Error(o(200));return eu(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(o(40));return!!e._reactRootContainer&&(hc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fr]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,i,n){if(!Jc(i))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,i,!1,n)},t.version="18.2.0-next-9e3b772b8-20220608"},745:(e,t,i)=>{"use strict";var n=i(935);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},935:(e,t,i)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=i(448)},655:(e,t,i)=>{"use strict";var n;i.d(t,{OL:()=>g,UT:()=>d,rU:()=>m});var r=i(294),o=i(250),s=i(599);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},a.apply(this,arguments)}function l(e,t){if(null==e)return{};var i,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)i=o[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const c=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"],u=["aria-current","caseSensitive","className","end","style","to","children"];const h=(n||(n=i.t(r,2))).startTransition;function d(e){let{basename:t,children:i,future:n,window:a}=e,l=r.useRef();null==l.current&&(l.current=(0,s.q_)({window:a,v5Compat:!0}));let c=l.current,[u,d]=r.useState({action:c.action,location:c.location}),{v7_startTransition:p}=n||{},f=r.useCallback((e=>{p&&h?h((()=>d(e))):d(e)}),[d,p]);return r.useLayoutEffect((()=>c.listen(f)),[c,f]),r.createElement(o.F0,{basename:t,children:i,location:u.location,navigationType:u.action,navigator:c})}const p="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,f=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,m=r.forwardRef((function(e,t){let i,{onClick:n,relative:u,reloadDocument:h,replace:d,state:m,target:g,to:_,preventScrollReset:y}=e,x=l(e,c),{basename:v}=r.useContext(o.Us),b=!1;if("string"==typeof _&&f.test(_)&&(i=_,p))try{let e=new URL(window.location.href),t=_.startsWith("//")?new URL(e.protocol+_):new URL(_),i=(0,s.Zn)(t.pathname,v);t.origin===e.origin&&null!=i?_=i+t.search+t.hash:b=!0}catch(e){}let w=(0,o.oQ)(_,{relative:u}),S=function(e,t){let{target:i,replace:n,state:a,preventScrollReset:l,relative:c}=void 0===t?{}:t,u=(0,o.s0)(),h=(0,o.TH)(),d=(0,o.WU)(e,{relative:c});return r.useCallback((t=>{if(function(e,t){return!(0!==e.button||t&&"_self"!==t||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(t,i)){t.preventDefault();let i=void 0!==n?n:(0,s.Ep)(h)===(0,s.Ep)(d);u(e,{replace:i,state:a,preventScrollReset:l,relative:c})}}),[h,u,d,n,a,i,e,l,c])}(_,{replace:d,state:m,target:g,preventScrollReset:y,relative:u});return r.createElement("a",a({},x,{href:i||w,onClick:b||h?n:function(e){n&&n(e),e.defaultPrevented||S(e)},ref:t,target:g}))}));const g=r.forwardRef((function(e,t){let{"aria-current":i="page",caseSensitive:n=!1,className:s="",end:c=!1,style:h,to:d,children:p}=e,f=l(e,u),g=(0,o.WU)(d,{relative:f.relative}),_=(0,o.TH)(),y=r.useContext(o.FR),{navigator:x}=r.useContext(o.Us),v=x.encodeLocation?x.encodeLocation(g).pathname:g.pathname,b=_.pathname,w=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;n||(b=b.toLowerCase(),w=w?w.toLowerCase():null,v=v.toLowerCase());let S,T=b===v||!c&&b.startsWith(v)&&"/"===b.charAt(v.length),E=null!=w&&(w===v||!c&&w.startsWith(v)&&"/"===w.charAt(v.length)),C=T?i:void 0;S="function"==typeof s?s({isActive:T,isPending:E}):[s,T?"active":null,E?"pending":null].filter(Boolean).join(" ");let k="function"==typeof h?h({isActive:T,isPending:E}):h;return r.createElement(m,a({},f,{"aria-current":C,className:S,ref:t,style:k,to:d}),"function"==typeof p?p({isActive:T,isPending:E}):p)}));var _,y;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher"})(_||(_={})),function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(y||(y={}))},250:(e,t,i)=>{"use strict";var n;i.d(t,{AW:()=>z,F0:()=>D,FR:()=>l,TH:()=>m,Us:()=>c,WU:()=>x,Z5:()=>L,j3:()=>I,oQ:()=>p,s0:()=>_});var r=i(294),o=i(599);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},s.apply(this,arguments)}const a=r.createContext(null);const l=r.createContext(null);const c=r.createContext(null);const u=r.createContext(null);const h=r.createContext({outlet:null,matches:[],isDataRoute:!1});const d=r.createContext(null);function p(e,t){let{relative:i}=void 0===t?{}:t;f()||(0,o.J0)(!1);let{basename:n,navigator:s}=r.useContext(c),{hash:a,pathname:l,search:u}=x(e,{relative:i}),h=l;return"/"!==n&&(h="/"===l?n:(0,o.RQ)([n,l])),s.createHref({pathname:h,search:u,hash:a})}function f(){return null!=r.useContext(u)}function m(){return f()||(0,o.J0)(!1),r.useContext(u).location}function g(e){r.useContext(c).static||r.useLayoutEffect(e)}function _(){let{isDataRoute:e}=r.useContext(h);return e?function(){let{router:e}=M(C.UseNavigateStable),t=P(k.UseNavigateStable),i=r.useRef(!1);return g((()=>{i.current=!0})),r.useCallback((function(n,r){void 0===r&&(r={}),i.current&&("number"==typeof n?e.navigate(n):e.navigate(n,s({fromRouteId:t},r)))}),[e,t])}():function(){f()||(0,o.J0)(!1);let e=r.useContext(a),{basename:t,navigator:i}=r.useContext(c),{matches:n}=r.useContext(h),{pathname:s}=m(),l=JSON.stringify((0,o.Zq)(n).map((e=>e.pathnameBase))),u=r.useRef(!1);return g((()=>{u.current=!0})),r.useCallback((function(n,r){if(void 0===r&&(r={}),!u.current)return;if("number"==typeof n)return void i.go(n);let a=(0,o.pC)(n,JSON.parse(l),s,"path"===r.relative);null==e&&"/"!==t&&(a.pathname="/"===a.pathname?t:(0,o.RQ)([t,a.pathname])),(r.replace?i.replace:i.push)(a,r.state,r)}),[t,i,l,s,e])}()}const y=r.createContext(null);function x(e,t){let{relative:i}=void 0===t?{}:t,{matches:n}=r.useContext(h),{pathname:s}=m(),a=JSON.stringify((0,o.Zq)(n).map((e=>e.pathnameBase)));return r.useMemo((()=>(0,o.pC)(e,JSON.parse(a),s,"path"===i)),[e,a,s,i])}function v(e,t,i){f()||(0,o.J0)(!1);let{navigator:n}=r.useContext(c),{matches:a}=r.useContext(h),l=a[a.length-1],d=l?l.params:{},p=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let g,_=m();if(t){var y;let e="string"==typeof t?(0,o.cP)(t):t;"/"===p||(null==(y=e.pathname)?void 0:y.startsWith(p))||(0,o.J0)(!1),g=e}else g=_;let x=g.pathname||"/",v="/"===p?x:x.slice(p.length)||"/",b=(0,o.fp)(e,{pathname:v});let w=E(b&&b.map((e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:(0,o.RQ)([p,n.encodeLocation?n.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?p:(0,o.RQ)([p,n.encodeLocation?n.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),a,i);return t&&w?r.createElement(u.Provider,{value:{location:s({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:o.aU.Pop}},w):w}function b(){let e=function(){var e;let t=r.useContext(d),i=A(k.UseRouteError),n=P(k.UseRouteError);if(t)return t;return null==(e=i.errors)?void 0:e[n]}(),t=(0,o.WK)(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,n="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:n};return r.createElement(r.Fragment,null,r.createElement("h2",null,"Unexpected Application Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},t),i?r.createElement("pre",{style:s},i):null,null)}const w=r.createElement(b,null);class S extends r.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error?r.createElement(h.Provider,{value:this.props.routeContext},r.createElement(d.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function T(e){let{routeContext:t,match:i,children:n}=e,o=r.useContext(a);return o&&o.static&&o.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=i.route.id),r.createElement(h.Provider,{value:t},n)}function E(e,t,i){var n;if(void 0===t&&(t=[]),void 0===i&&(i=null),null==e){var s;if(null==(s=i)||!s.errors)return null;e=i.matches}let a=e,l=null==(n=i)?void 0:n.errors;if(null!=l){let e=a.findIndex((e=>e.route.id&&(null==l?void 0:l[e.route.id])));e>=0||(0,o.J0)(!1),a=a.slice(0,Math.min(a.length,e+1))}return a.reduceRight(((e,n,o)=>{let s=n.route.id?null==l?void 0:l[n.route.id]:null,c=null;i&&(c=n.route.errorElement||w);let u=t.concat(a.slice(0,o+1)),h=()=>{let t;return t=s?c:n.route.Component?r.createElement(n.route.Component,null):n.route.element?n.route.element:e,r.createElement(T,{match:n,routeContext:{outlet:e,matches:u,isDataRoute:null!=i},children:t})};return i&&(n.route.ErrorBoundary||n.route.errorElement||0===o)?r.createElement(S,{location:i.location,revalidation:i.revalidation,component:c,error:s,children:h(),routeContext:{outlet:null,matches:u,isDataRoute:!0}}):h()}),null)}var C=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(C||{}),k=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(k||{});function M(e){let t=r.useContext(a);return t||(0,o.J0)(!1),t}function A(e){let t=r.useContext(l);return t||(0,o.J0)(!1),t}function P(e){let t=function(e){let t=r.useContext(h);return t||(0,o.J0)(!1),t}(),i=t.matches[t.matches.length-1];return i.route.id||(0,o.J0)(!1),i.route.id}(n||(n=i.t(r,2))).startTransition;function I(e){return function(e){let t=r.useContext(h).outlet;return t?r.createElement(y.Provider,{value:e},t):t}(e.context)}function z(e){(0,o.J0)(!1)}function D(e){let{basename:t="/",children:i=null,location:n,navigationType:s=o.aU.Pop,navigator:a,static:l=!1}=e;f()&&(0,o.J0)(!1);let h=t.replace(/^\/*/,"/"),d=r.useMemo((()=>({basename:h,navigator:a,static:l})),[h,a,l]);"string"==typeof n&&(n=(0,o.cP)(n));let{pathname:p="/",search:m="",hash:g="",state:_=null,key:y="default"}=n,x=r.useMemo((()=>{let e=(0,o.Zn)(p,h);return null==e?null:{location:{pathname:e,search:m,hash:g,state:_,key:y},navigationType:s}}),[h,p,m,g,_,y,s]);return null==x?null:r.createElement(c.Provider,{value:d},r.createElement(u.Provider,{children:i,value:x}))}function L(e){let{children:t,location:i}=e;return v(R(t),i)}new Promise((()=>{}));r.Component;function R(e,t){void 0===t&&(t=[]);let i=[];return r.Children.forEach(e,((e,n)=>{if(!r.isValidElement(e))return;let s=[...t,n];if(e.type===r.Fragment)return void i.push.apply(i,R(e.props.children,s));e.type!==z&&(0,o.J0)(!1),e.props.index&&e.props.children&&(0,o.J0)(!1);let a={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=R(e.props.children,s)),i.push(a)})),i}},251:(e,t,i)=>{"use strict";var n=i(294),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var n,o={},c=null,u=null;for(n in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,n)&&!l.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:u,props:o,_owner:a.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},408:(e,t)=>{"use strict";var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}function y(){}function x(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=_.prototype;var v=x.prototype=new y;v.constructor=x,m(v,_.prototype),v.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,n){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)w.call(t,r)&&!T.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:i,type:e,key:s,ref:a,props:o,_owner:S.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}var k=/\/+/g;function M(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,r,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case n:l=!0}}if(l)return s=s(l=e),e=""===o?"."+M(l,0):o,b(s)?(r="",null!=e&&(r=e.replace(k,"$&/")+"/"),A(s,t,r,"",(function(e){return e}))):null!=s&&(C(s)&&(s=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,r+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(k,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",b(e))for(var c=0;c<e.length;c++){var u=o+M(a=e[c],c);l+=A(a,t,r,u,s)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=A(a=a.value,t,r,u=o+M(a,c++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,i){if(null==e)return e;var n=[],r=0;return A(e,n,"","",(function(e){return t.call(i,e,r++)})),n}function I(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var z={current:null},D={transition:null},L={ReactCurrentDispatcher:z,ReactCurrentBatchConfig:D,ReactCurrentOwner:S};t.Children={map:P,forEach:function(e,t,i){P(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=r,t.Profiler=s,t.PureComponent=x,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!T.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:i,type:e.type,key:o,ref:s,props:r,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return z.current.useCallback(e,t)},t.useContext=function(e){return z.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return z.current.useDeferredValue(e)},t.useEffect=function(e,t){return z.current.useEffect(e,t)},t.useId=function(){return z.current.useId()},t.useImperativeHandle=function(e,t,i){return z.current.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return z.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return z.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return z.current.useMemo(e,t)},t.useReducer=function(e,t,i){return z.current.useReducer(e,t,i)},t.useRef=function(e){return z.current.useRef(e)},t.useState=function(e){return z.current.useState(e)},t.useSyncExternalStore=function(e,t,i){return z.current.useSyncExternalStore(e,t,i)},t.useTransition=function(){return z.current.useTransition()},t.version="18.2.0"},294:(e,t,i)=>{"use strict";e.exports=i(408)},893:(e,t,i)=>{"use strict";e.exports=i(251)},53:(e,t)=>{"use strict";function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var n=i-1>>>1,r=e[n];if(!(0<o(r,t)))break e;e[n]=t,e[i]=r,i=n}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,r=e.length,s=r>>>1;n<s;){var a=2*(n+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,i))c<r&&0>o(u,l)?(e[n]=u,e[c]=i,n=c):(e[n]=l,e[a]=i,n=a);else{if(!(c<r&&0>o(u,i)))break e;e[n]=u,e[c]=i,n=c}}}return t}function o(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,_="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function v(e){for(var t=n(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,i(c,t)}t=n(u)}}function b(e){if(g=!1,v(e),!m)if(null!==n(c))m=!0,D(w);else{var t=n(u);null!==t&&L(b,t.startTime-e)}}function w(e,i){m=!1,g&&(g=!1,y(C),C=-1),f=!0;var o=p;try{for(v(i),d=n(c);null!==d&&(!(d.expirationTime>i)||e&&!A());){var s=d.callback;if("function"==typeof s){d.callback=null,p=d.priorityLevel;var a=s(d.expirationTime<=i);i=t.unstable_now(),"function"==typeof a?d.callback=a:d===n(c)&&r(c),v(i)}else r(c);d=n(c)}if(null!==d)var l=!0;else{var h=n(u);null!==h&&L(b,h.startTime-i),l=!1}return l}finally{d=null,p=o,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,T=!1,E=null,C=-1,k=5,M=-1;function A(){return!(t.unstable_now()-M<k)}function P(){if(null!==E){var e=t.unstable_now();M=e;var i=!0;try{i=E(!0,e)}finally{i?S():(T=!1,E=null)}}else T=!1}if("function"==typeof x)S=function(){x(P)};else if("undefined"!=typeof MessageChannel){var I=new MessageChannel,z=I.port2;I.port1.onmessage=P,S=function(){z.postMessage(null)}}else S=function(){_(P,0)};function D(e){E=e,T||(T=!0,S())}function L(e,i){C=_((function(){e(t.unstable_now())}),i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var i=p;p=t;try{return e()}finally{p=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=p;p=e;try{return t()}finally{p=i}},t.unstable_scheduleCallback=function(e,r,o){var s=t.unstable_now();switch("object"==typeof o&&null!==o?o="number"==typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,i(u,e),null===n(c)&&e===n(u)&&(g?(y(C),C=-1):g=!0,L(b,o-s))):(e.sortIndex=a,i(c,e),m||f||(m=!0,D(w))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=p;return function(){var i=p;p=t;try{return e.apply(this,arguments)}finally{p=i}}}},840:(e,t,i)=>{"use strict";e.exports=i(53)},774:e=>{e.exports=function(e,t,i,n){var r=i?i.call(n,e,t):void 0;if(void 0!==r)return!!r;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var o=Object.keys(e),s=Object.keys(t);if(o.length!==s.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(t),l=0;l<o.length;l++){var c=o[l];if(!a(c))return!1;var u=e[c],h=t[c];if(!1===(r=i?i.call(n,u,h,c):void 0)||void 0===r&&u!==h)return!1}return!0}}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var i=o[e]={exports:{}};return r[e].call(i.exports,i,i.exports,s),i.exports}s.m=r,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"==typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"==typeof i.then)return i}var r=Object.create(null);s.r(r);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>o[e]=()=>i[e]));return o.default=()=>i,s.d(r,o),r},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,i)=>(s.f[i](e,t),t)),[])),s.u=e=>e+".index."+s.h()+".js",s.miniCssF=e=>{},s.h=()=>"cef882d1fe8ea4377f8f",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},n="modsen-currency-tracker:",s.l=(e,t,r,o)=>{if(i[e])i[e].push(t);else{var a,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==n+r){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",n+r),a.src=e),i[e]=[t];var d=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var r=i[e];if(delete i[e],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(n))),t)return t(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&!e;)e=i[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={179:0};s.f.j=(t,i)=>{var n=s.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var r=new Promise(((i,r)=>n=e[t]=[i,r]));i.push(n[2]=r);var o=s.p+s.u(t),a=new Error;s.l(o,(i=>{if(s.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",a.name="ChunkLoadError",a.type=r,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,r,[o,a,l]=i,c=0;if(o.some((t=>0!==e[t]))){for(n in a)s.o(a,n)&&(s.m[n]=a[n]);if(l)l(s)}for(t&&t(i);c<o.length;c++)r=o[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0},i=self.webpackChunkmodsen_currency_tracker=self.webpackChunkmodsen_currency_tracker||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),s.nc=void 0,(()=>{"use strict";s(294);var e=s(745),t=s(655),i=s(646),n=s(200),r=s(893);e.createRoot(document.getElementById("root")).render((0,r.jsx)(t.UT,{children:(0,r.jsx)(i.SV,{children:(0,r.jsx)(n.p,{children:(0,r.jsx)(i.gV,{})})})}))})()})();